<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/*
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 *
 * @author Baptiste Mazin     &lt;baptiste.mazin@telecom-paristech.fr&gt;
 * @author Guillaume Tartavel &lt;guillaume.tartavel@telecom-paristech.fr&gt;
 */
<span id='Matrix'>/** @class Matrix */
</span>
(function (Matrix, Matrix_prototype) {
    &quot;use strict&quot;;


    //////////////////////////////////////////////////////////////////
    //                   Matrix import/export functions             //
    //////////////////////////////////////////////////////////////////


<span id='Matrix-method-toArray'>    /**
</span>     * Convert 2D Matrix to 2D Array for export.
     *
     * __Also see:__
     * {@link Matrix#fromArray}.
     *
     * @return {Number[][]} A 2D Array.
     *
     * @todo Tests.
     */
    Matrix_prototype.toArray = function () {

        var strErr = &quot;Matrix.toArray: function only available for &quot;;
        if (this.ndims() &gt; 2) {
            throw new Error(strErr + &quot;2D matrix.&quot;);
        }
        var id;
        if (this.isreal()) {
            id = this.getData();
        } else {
            throw new Error(strErr + &quot;for real matrix.&quot;);
        }

        var view = this.getView();
        var fy = view.getFirst(0), dy = view.getStep(0), ly = view.getEnd(0);
        var fx = view.getFirst(1), dx = view.getStep(1), lx = view.getEnd(1);

        var y, ny, x, n, o, xTab;
        for (o = [], y = fy, ny = ly; y !== ny; y += dy) {
            for (xTab = [], x = y + fx, n = y + lx; x !== n; x += dx) {
                xTab.push(id[x]);
            }
            o.push(xTab);
        }
        return o;
    };

<span id='Matrix-method-fromArray'>    /**
</span>     * Convert 2D Array to Matrix. An Array is considered
     * as a column vector and an Array of Array as a set of
     * column vectors.
     *
     * __Also see:__
     * {@link Matrix#toArray},
     * {@link Matrix#toMatrix}.
     *
     * @param {Number[][]} array Array to convert.
     *
     * @return {Matrix}
     *
     * @todo Check parameters for 1D argument.
     */
    Matrix.fromArray = function (a) {
        var size, data;
        if (a[0].length) {
            if (a[0][0].length) {
                throw new Error(&quot;Matrix.fromArray: Only work with Array up to 2 dimensions.&quot;);
            }
            size = [a[0].length, a.length];
            data = [];
            var i, ei;
            for (i = 0, ei = a.length; i &lt; ei; i++) {
                var subtab = Array.prototype.slice.apply(a[i]);
                data = data.concat(subtab);
            }
        } else {
            size = a.length;
            data = a;
        }
        return new Matrix(size, data);
    };

<span id='Matrix-method-dlmwrite'>    /** Convert 2D Matrix to formated string such like coma
</span>     * separated values (CSV) strings.
     *
     * __Also see:__
     * {@link Matrix#dlmread}.
     *
     * @param {String} [delim=&#39;\n&#39;]  column delimiters.
     *
     * @return {String} A string.
     *
     * @matlike
     */
    Matrix_prototype.dlmwrite = function (d) {

        if (d !== undefined &amp;&amp; typeof d !== &quot;string&quot;) {
            throw new Error(&quot;Matrix.dlmread: Wrong delimiter specification.&quot;);
        }
        if (this.ndims() &gt; 2) {
            throw new Error(&quot;Matrix.dlmwrite: function only available for 2D matrix.&quot;);
        }

        var view = this.getView(), td = this.getData();
        var dn = view.getStep(1), ln = view.getEnd(1);
        var m = view.getSize(0);
        var i, ij, ei, eij;

        var str = &#39;&#39;;
        for (i = 0, ei = m; i &lt; ei; i++) {
            for (ij = i, eij = i + ln - dn; ij &lt; eij; ij += dn) {
                str += td[ij] + d;
            }
            str += td[ij] + &quot;\n&quot;;
        }

        return str;
    };

<span id='Matrix-method-dlmread'>    /**
</span>     * Convert string with values delimited by characters
     * to Matrix.
     *
     * __Also see:__
     * {@link Matrix#dlmwrite}.
     *
     * @param {String} [delim] Column delimiters.
     *
     * @return {Matrix}
     *
     * @matlike
     */
    Matrix.dlmread = function (csv, d) {

        if (d !== undefined &amp;&amp; typeof d !== &quot;string&quot;) {
            throw new Error(&quot;Matrix.dlmread: Wrong delimiter specification.&quot;);
        }
        csv = csv.split(&quot;\n&quot;);
        if (csv[csv.length - 1] === &quot;&quot;) {
            csv.pop();
        }
        var i, ei, j, ej;
        var output = [];
        var reg = /[\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?/g;
        for (i = 0, ei = csv.length; i &lt; ei; i++) {
            var row = d ? csv[i].split(d) : csv[i].match(reg);
            for (j = 0, ej = row.length; j &lt; ej; j++) {
                row[j] = parseFloat(row[j]);
            }
            output.push(row);
        }
        return Matrix.fromArray(output).transpose();
    };

<span id='Matrix-method-toMatlab'>    /**
</span>     * Convert 2D Matrix to a string for copy/paste into Matlab.
     *
     * @return {String} A string.
     */
    Matrix_prototype.toMatlab = function () {

        if (this.ndims() &gt; 2) {
            throw new Error(&quot;Matrix.toMatlab: function available only for 2D matrix.&quot;);
        }

        var pad = function (real, imag) {
            var str = real.toString();
            if (typeof imag === &#39;number&#39;) {
                str += imag &gt; 0 ? &#39; + &#39; : &#39; - &#39;;
                str += Math.abs(imag).toString();
                str += &#39; * i&#39;;
            }
            return str;
        };

        var o = &#39;&#39;, id, ird, iid;
        if (this.isreal()) {
            id = this.getData();
        } else {
            ird = this.getRealData();
            iid = this.getImagData();
        }
        var view = this.getView();
        var fy = view.getFirst(0), dy = view.getStep(0), ly = view.getEnd(0);
        var fx = view.getFirst(1), dx = view.getStep(1), lx = view.getEnd(1);

        var y, ny, x, n;
        o += &#39;[&#39;;
        for (y = fy, ny = ly; y !== ny; y += dy) {
            if (y !== fy) {
                o += &#39; &#39;;
            }
            if (this.isreal()) {
                for (x = y + fx, n = y + lx; x !== n; x += dx) {
                    o += pad(id[x]);
                    if (x !== n - dx) {
                        o += &#39;,&#39;;
                    }
                }
            } else {
                for (x = y + fx, n = y + lx; x !== n; x += dx) {
                    o += pad(ird[x], iid[x]);
                    if (x !== n - dx) {
                        o += &#39;,&#39;;
                    }
                }
            }
            if (y !== ny - dy) {
                o += &#39;;&#39;;
            }
        }
        o += &#39;]&#39;;
        return o;
    };

<span id='Matrix-method-toString'>    /**
</span>     * Convert Matrix to string for display purposes.
     *
     * @param {Number} [precision=4] Precision used to display the Matrix.
     *
     * @param {String} [name] Name of the Matrix.
     *
     * @return {String} A string.
     *
     * @fixme There is some bugs when displaying complex Matrix.
     */
    Matrix_prototype.toString = function (arg1, arg2) {

        var precision, name = &#39;&#39;;
        if (arg1 === undefined) {
            precision = 4;
        } else if (typeof arg1 === &#39;string&#39;) {
            name = arg1;
            precision = 4;
        } else {
            precision = arg1;
        }
        if (typeof arg2 === &#39;string&#39;) {
            name = arg2;
        }

        var length = precision + 5;
        var pad = function (real, imag) {
            var str = &#39;&#39;;
            if (typeof real === &#39;number&#39;) {
                if (real % 1 === 0) {
                    str += real;
                } else {
                    str += real.toFixed(precision);
                }
                while (str.length &lt; length) {
                    str = &#39; &#39; + str;
                }
            } else {
                str += real.toString();
            }

            if (imag === undefined) {
                return str;
            }
            if (imag === 0) {
                while (str.length &lt; 2 * length + 1) {
                    str = str + &#39; &#39;;
                }
                return str;
            }
            if (typeof imag === &#39;number&#39;) {
                str += imag &gt; 0 ? &#39; + &#39; : &#39; - &#39;;
                if (real % 1 === 0) {
                    str += Math.abs(imag);
                } else {
                    str += Math.abs(imag).toFixed(precision);
                }
                while (str.length &lt; length) {
                    str = &#39; &#39; + str;
                }
            } else {
                str += imag.toString();
            }
            str += &#39;i&#39;;
            return str;
        };
        var i, ie, o = &#39;&#39;, s;
        if (this.isempty()) {
            o += &#39;Empty array: &#39;;
            s = this.getSize();
            for (i = 0, ie = s.length - 1; i &lt; ie; i++) {
                o += s[i] + &#39;-by-&#39;;
            }
            o += s[i];
            return o;
        }

        if (this.getLength() &gt; 10000) {
            o += &#39;Array: &#39;;
            s = this.getSize();
            for (i = 0, ie = s.length - 1; i &lt; ie; i++) {
                o += s[i] + &#39;-by-&#39;;
            }
            o += s[i];
            return o;
        }

        var id, ird, iid;
        if (this.isreal()) {
            id = this.getData();
        } else {
            ird = this.getRealData();
            iid = this.getImagData();
        }

        var iterator = this.getIterator(2);
        var it = iterator.iterator, b  = iterator.begin, e = iterator.isEnd;
        var z = this.getSize(2);
        var view = this.getView();
        var fy = view.getFirst(0), dy = view.getStep(0), ly = view.getEnd(0);
        var fx = view.getFirst(1), dx = view.getStep(1), lx = view.getEnd(1);

        var y, ny, x, n;
        for (i = b(); !e(); i = it()) {
            o += name;
            if (z &gt; 1) {
                o += &#39;(:,:,&#39; + iterator.getPosition() + &#39;) = [\n&#39;;
            } else {
                o += &#39; = [\n&#39;;
            }
            for (y = i + fy, ny = i + ly; y !== ny; y += dy) {
                o += &#39;\t&#39;;
                if (this.isreal()) {
                    for (x = y + fx, n = y + lx; x !== n; x += dx) {
                        o += pad(id[x]) + &#39; &#39;;
                    }
                } else {
                    for (x = y + fx, n = y + lx; x !== n; x += dx) {
                        o += pad(ird[x], iid[x]) + &#39; &#39;;
                    }
                }
                o += &#39;\n&#39;;
            }
            o += &#39;]\n&#39;;
        }

        return o;
    };

<span id='Matrix-method-toMatrix'>    /** Cast data to Matrix. An Array is considered
</span>     * as a column vector and an Array of Array as a set of
     * column vectors.
     *
     * If the input is a `Matrix` then it will be returned unchanged
     *
     * @param {Number|Number[]|Matrix} data
     *  Data to convert
     *
     * @return {Matrix}
     */
    Matrix.toMatrix = function (data, type) {
        if (data instanceof Matrix) {
            return data;
        }
        if (data.constructor === Number) {
            data = [data];
        }
        var d = Array.prototype.concat.apply([], data);
        var isBoolean = false, size;
        
        if (Tools.isArrayOfBooleans(d)) {
            isBoolean = true;
        } else if (!Tools.isArrayOfNumbers(d)) {
            throw new Error(&#39;Matrix.toMatrix: Array must only contain numbers or booleans.&#39;);
        }
        if (d.length === 1) {
            size = 1;
        } else if (d.length === data.length) {
            size = [d.length, 1];
        } else {
            size = [];
            var t = data;
            while (t.length) {
                size.push(t.length);
                t = t[0];
            }
            size = size.reverse();
        }
        return new Matrix(size, d, false, isBoolean);
    };


    //////////////////////////////////////////////////////////////////
    //                   Matrix display functions                   //
    //////////////////////////////////////////////////////////////////


<span id='Matrix-method-display'>    /** Display the matrix in the console.
</span>     *
     * @param {Number} precision
     *
     * @param {String} str
     *  String describing the content of the matrix.
     *  Used for display purpose
     *
     * @chainable
     */
    Matrix_prototype.display = function (arg1, arg2) {
        console.log(this.toString(arg1, arg2));
        return this;
    };

})(Matrix, Matrix.prototype);
</pre>
</body>
</html>
