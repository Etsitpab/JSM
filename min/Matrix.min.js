/**
 * This program is free software: you can redistribute it and/or modify    
 * it under the terms of the GNU General Public License as published by        
 * the Free Software Foundation, either version 3 of the License, or 
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * 
 * @author Baptiste Mazin     <baptiste.mazin@telecom-paristech.fr> 
 * @author Guillaume Tartavel <guillaume.tartavel@telecom-paristech.fr> 
 */
function Matrix(r,t,a,e){"use strict";var i;var n,o,s;var f=false;var u;var g;var v;var l;var h;var c;var p=function(t){if(t instanceof Matrix){t=t.getCopy().getData()}r=Tools.checkSize(t);i=new MatrixView(r);u=i.getIndex;g=i.getDimLength;v=i.getLength;l=i.getSize;c=i.displayView;h=i.getIterator.bind(i);this.getIndex=u;this.getDimLength=g;this.getLength=v;this.getSize=l;this.displayView=c;this.getIterator=h}.bind(this);var m=function(r,a,u){p(r);var g=Tools.isSet(u)?u:false;if(!Tools.isBoolean(g)){throw new Error('Matrix: "complex" argument must be a boolean')}if(Tools.isArrayLike(a)){n=a instanceof Array?new Matrix.dataType(a):a;t=a.constructor;if(n.length!==i.getLength()*(g?2:1)){throw new Error("Matrix: data and size are incompatible.")}if(g){o=n.subarray(0,i.getLength());s=n.subarray(i.getLength())}}else{t=Tools.checkType(a);if(typeof a==="string"){switch(a.toLowerCase()){case"logical":case"bool":case"boolean":f=true;break;default:f=false}}var v=i.getLength();if(!g){n=new t(v)}else{n=new t(2*v);o=n.subarray(0,v);s=n.subarray(v)}}if(Tools.isSet(e)){if(!Tools.isBoolean(e)){throw new Error('Matrix: "bool" argument must be a boolean')}if(e){f=true}}return this}.bind(this);this.initialize=m;var x=function(){if(!Tools.isSet(s)){return true}var r,t;for(r=0,t=s.length;r<t;r++){if(s[r]!==0){return false}}n=o;o=undefined;s=undefined;return true};var w=function(){return v()===1};var M=function(){return n.length===0};var y=function(r,t){r=Tools.isArrayLike(r)?u(r):r;if(!Tools.isSet(t)){return x()?n[r]:[o[r],s[r]]}if(!x()){n[r]=t}else{o[r]=t[0];s[r]=t[1]}return t}.bind(this);var d=function(){return n};var D=function(){if(!x()){throw Error("Matrix.getDataScalar: Data must be real.")}if(v()!==1){throw Error("Matrix.getDataScalar: Data length must be 1.")}return n[0]};var b=function(){if(!Tools.isSet(s)){throw new Error("Matrix.getRealData: expected a complex Matrix.")}return o};var S=function(){if(!Tools.isSet(s)){throw new Error("Matrix.getImagData: expected a complex Matrix.")}return s};var I=function(r){if(!x()){throw new Error("Matrix.toComplex: expected a non-complex Matrix.")}var t=new n.constructor(n.length*2);o=t.subarray(0,n.length);s=t.subarray(n.length);o.set(n);if(r instanceof Matrix){Tools.checkSizeEquals(this,r,Matrix.ignoreTrailingDims);if(!r.isreal()){throw new Error("Matrix.toComplex: imaginary part cannot be complex.")}r=r.getData()}if(Tools.isArrayLike(r)){if(r.length!==n.length){throw new Error("Matrix.toComplex: imaginary part has invalid length.")}s.set(r)}else if(Tools.isSet(r)){throw new Error("Matrix.toComplex: invalid argument.")}n=t;return this}.bind(this);var z=function(){return f?"logical":n.constructor.name};var R=function(){return new MatrixView(i)};this.value=y;this.getData=d;this.getDataScalar=D;this.getRealData=b;this.getImagData=S;this.getDataType=z;this.getView=R;this.isreal=x;this.isscalar=w;this.isempty=M;this.toComplex=I;var E=function(){var r=Array.prototype.slice.apply(arguments);if(Tools.isArrayLike(r[0])){r=r[0]}if(r.length===0){r=this.getLength()}r=Tools.checkSize(r,"column");var t,a,e=1;for(t=0,a=r.length;t<a;t++){e*=r[t]}if(e!==this.getLength()){throw new Error("Matrix.reshape: number of elements must not change.")}p(r);return this}.bind(this);this.reshape=E;var T=function(){var t=!x();var a=n instanceof Array?n.slice():new n.constructor(n);return new Matrix(r,a,t,f)};this.getCopy=T;return m(r,t,a)}Matrix.dataType=Float64Array;Matrix.ignoreTrailingDims=true;if(typeof window==="undefined"){module.exports.Matrix=Matrix}var IT;(function(r,t){"use strict";t.toArray=function(){var r="Matrix.toArray: function only available for ";if(this.ndims()>2){throw new Error(r+"2D matrix.")}var t;if(this.isreal()){t=this.getData()}else{throw new Error(r+"for real matrix.")}var a=this.getView();var e=a.getFirst(0),i=a.getStep(0),n=a.getEnd(0);var o=a.getFirst(1),s=a.getStep(1),f=a.getEnd(1);var u,g,v,l,h,c;for(h=[],u=e,g=n;u!==g;u+=i){for(c=[],v=u+o,l=u+f;v!==l;v+=s){c.push(t[v])}h.push(c)}return h};r.fromArray=function(t){var a,e;if(t[0].length){if(t[0][0].length){throw new Error("Matrix.fromArray: Only work with Array up to 2 dimensions.")}a=[t[0].length,t.length];e=[];var i,n;for(i=0,n=t.length;i<n;i++){var o=Array.prototype.slice.apply(t[i]);e=e.concat(o)}}else{a=t.length;e=t}return new r(a,e)};t.dlmwrite=function(r){if(r!==undefined&&typeof r!=="string"){throw new Error("Matrix.dlmread: Wrong delimiter specification.")}if(this.ndims()>2){throw new Error("Matrix.dlmwrite: function only available for 2D matrix.")}var t=this.getView(),a=this.getData();var e=t.getStep(1),i=t.getEnd(1);var n=t.getSize(0);var o,s,f,u;var g="";for(o=0,f=n;o<f;o++){for(s=o,u=o+i-e;s<u;s+=e){g+=a[s]+r}g+=a[s]+"\n"}return g};r.dlmread=function(t,a){if(a!==undefined&&typeof a!=="string"){throw new Error("Matrix.dlmread: Wrong delimiter specification.")}t=t.split("\n");if(t[t.length-1]===""){t.pop()}var e,i,n,o;var s=[];var f=/[\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?/g;for(e=0,i=t.length;e<i;e++){var u=a?t[e].split(a):t[e].match(f);for(n=0,o=u.length;n<o;n++){u[n]=parseFloat(u[n])}s.push(u)}return r.fromArray(s).transpose()};t.toMatlab=function(){if(this.ndims()>2){throw new Error("Matrix.toMatlab: function available only for 2D matrix.")}var r=function(r,t){var a=r.toString();if(typeof t==="number"){a+=t>0?" + ":" - ";a+=Math.abs(t).toString();a+=" * i"}return a};var t="",a,e,i;if(this.isreal()){a=this.getData()}else{e=this.getRealData();i=this.getImagData()}var n=this.getView();var o=n.getFirst(0),s=n.getStep(0),f=n.getEnd(0);var u=n.getFirst(1),g=n.getStep(1),v=n.getEnd(1);var l,h,c,p;t+="[";for(l=o,h=f;l!==h;l+=s){if(l!==o){t+=" "}if(this.isreal()){for(c=l+u,p=l+v;c!==p;c+=g){t+=r(a[c]);if(c!==p-g){t+=","}}}else{for(c=l+u,p=l+v;c!==p;c+=g){t+=r(e[c],i[c]);if(c!==p-g){t+=","}}}if(l!==h-s){t+=";"}}t+="]";return t};t.toString=function(r,t){var a,e="";if(r===undefined){a=4}else if(typeof r==="string"){e=r;a=4}else{a=r}if(typeof t==="string"){e=t}var i=a+5;var n=function(r,t){var e="";if(typeof r==="number"){if(r%1===0){e+=r}else{e+=r.toFixed(a)}while(e.length<i){e=" "+e}}else{e+=r.toString()}if(t===undefined){return e}if(t===0){while(e.length<2*i+1){e=e+" "}return e}if(typeof t==="number"){e+=t>0?" + ":" - ";if(r%1===0){e+=Math.abs(t)}else{e+=Math.abs(t).toFixed(a)}while(e.length<i){e=" "+e}}else{e+=t.toString()}e+="i";return e};var o,s,f="",u;if(this.isempty()){f+="Empty array: ";u=this.getSize();for(o=0,s=u.length-1;o<s;o++){f+=u[o]+"-by-"}f+=u[o];return f}if(this.getLength()>1e4){f+="Array: ";u=this.getSize();for(o=0,s=u.length-1;o<s;o++){f+=u[o]+"-by-"}f+=u[o];return f}var g,v,l;if(this.isreal()){g=this.getData()}else{v=this.getRealData();l=this.getImagData()}var h=this.getIterator(2);var c=h.iterator,p=h.begin,m=h.isEnd;var x=this.getSize(2);var w=this.getView();var M=w.getFirst(0),y=w.getStep(0),d=w.getEnd(0);var D=w.getFirst(1),b=w.getStep(1),S=w.getEnd(1);var I,z,R,E;for(o=p();!m();o=c()){f+=e;if(x>1){f+="(:,:,"+h.getPosition()+") = [\n"}else{f+=" = [\n"}for(I=o+M,z=o+d;I!==z;I+=y){f+="	";if(this.isreal()){for(R=I+D,E=I+S;R!==E;R+=b){f+=n(g[R])+" "}}else{for(R=I+D,E=I+S;R!==E;R+=b){f+=n(v[R],l[R])+" "}}f+="\n"}f+="]\n"}return f};r.toMatrix=function(t){if(t instanceof r){return t}if(t.constructor===Number){t=[t]}var a=Array.prototype.concat.apply([],t);if(!Tools.isArrayOfNumbers(a)){throw new Error("Matrix.toMatrix: Array must only contain Number.")}if(a.length===1){return new r(1,a)}if(a.length===t.length){return new r([a.length,1],a)}var e=[],i=t;while(i.length){e.push(i.length);i=i[0]}return new r(e.reverse(),a)};t.display=function(r,t){console.log(this.toString(r,t));return this}})(Matrix,Matrix.prototype);(function(r,t){"use strict";t.extractViewFrom=function(t){if(this.isreal()){var a=this.getData();return new r(t.getSize(),t.extractFrom(a))}var e=new r(t.getSize(),this.getDataType(),true);t.extractFrom(this.getRealData(),e.getRealData());t.extractFrom(this.getImagData(),e.getImagData());return e};t.extractViewTo=function(r,t){if(this.isreal()&&t.isreal()){r.extractTo(this.getData(),t.getData());return t}if(this.isreal()||t.isreal()){this.toComplex()}r.extractTo(this.getRealData(),t.getRealData());r.extractTo(this.getImagData(),t.getImagData());return t};var a=function(r){r=Array.prototype.slice.apply(r);var t,a;for(t=0,a=r.length;t<a;t++){r[t]=r[t]?true:false}return r};t.selectView=function(t){t=Array.prototype.slice.apply(t);var e=Tools,i=e.checkSizeEquals,n=r.ignoreTrailingDims;var o=t[0];var s,f;if(o instanceof r&&t.length===1){var u=o.getData();var g=new MatrixView([this.getLength(),1]);if(o.islogical()&&i(this.getSize(),o.getSize(),n)){return g.selectBooleanDimension(0,u)}else if(e.isArrayOfNumbers(u,0,this.numel(0)-1)){return g.selectIndicesDimension(0,u)}throw new Error("Matrix.selectView: Invalid Matrix selection.")}for(s=0,f=t.length;s<f;s++){o=t[s];if(o instanceof r){if(o.isvector()){if(o.islogical()){o=a(o.getData())}else{o=[o.getData()]}}else{throw new Error("Matrix.selectView: Invalid Matrix selection:",o)}}t[s]=o}return MatrixView.prototype.select.apply(this.getView(),t)};t.select=function(){if(arguments.length===0){return this.getCopy().reshape(this.getLength())}var t=this.selectView(arguments);if(arguments.length===1&&arguments[0]instanceof r){if(t.getLength()===arguments[0].getLength()){return this.extractViewFrom(t).reshape(arguments[0].getSize())}return this.extractViewFrom(t)}return this.extractViewFrom(t)};t.set=function(){var t=Array.prototype.slice.apply(arguments);var a=r.toMatrix(t.pop());var e=this.selectView(t);if(t.length===1&&t[0]instanceof r){var i=a.getSize(),n=t[0].getSize();var o=a.reshape().extractViewTo(e,this.getCopy().reshape());o=o.reshape(n);a.reshape(i);return o}return a.extractViewTo(e,this.getCopy())};t.repmat=function(){var t=Tools.checkSize(arguments,"square");var a,e=this.getView();var i=this.size();var n,o=1,s=[];for(a=0,n=Math.max(i.length,t.length);a<n;a++){s[a]=(i[a]||1)*(t[a]||1);o*=s[a]}var f=new r(s,this.getDataType(),!this.isreal());var u=f.getView();var g,v,l,h;if(this.isreal()){l=f.getData();g=this.getData()}else{l=f.getRealData();h=f.getImagData();g=this.getRealData();v=this.getImagData()}for(a=0,n=i.length;a<n;a++){u.selectDimension(a,[0,i[a],-1])}var c,p=u.getIterator(0),m=p.begin,x=p.isEnd;for(c=m();!x();c=p()){var w=f.getView(),M=p.getPosition();for(a=0,n=t.length;a<n;a++){var y=i[a]||1,d=M[a]*y;w.selectDimension(a,[d,1,d+y-1])}e.extract(g,w,l);if(!this.isreal()){e.extract(v,w,h)}}return f};t.permute=function(r){var t=this.getView().permute(r);return this.extractViewFrom(t)};t.ipermute=function(r){var t=this.getView().ipermute(r);return this.extractViewFrom(t)};t.shiftdim=function(r){var t=this.getView();r=t.shiftDimension(r);return[this.extractViewFrom(t),r]};t.rot90=function(r){var t=this.getView().rot90(r);return this.extractViewFrom(t)};t.flipdim=function(r){var t=this.getView().selectDimension(r,[-1,0]);return this.extractViewFrom(t)};t.fliplr=function(){return this.flipdim(1)};t.flipud=function(){return this.flipdim(0)};t.cat=function(){var t=arguments[0];var a=this.getSize();if(a[t]===undefined){a[t]=1}var e;for(e=1;e<arguments.length;e++){a[t]+=arguments[e].getSize(t)}var i=new r(a);var n=i.getView();var o=this.getSize(t)-1;n.selectDimension(t,[0,o]);this.extractViewTo(n,i);n.restore();for(e=1;e<arguments.length;e++){n.selectDimension(t,[o+1,o+=arguments[e].getSize(t)]);arguments[e].extractViewTo(n,i);n.restore()}return i}})(Matrix,Matrix.prototype);(function(r,t){"use strict";t.numel=function(){return this.getLength()};t.ndims=function(){return this.getDimLength()};t.size=function(r){switch(typeof r){case"number":if(!Tools.isInteger(r,0)){throw new Error("Matrix.size: invalid argument.")}return this.getSize(r)||1;case"undefined":return this.getSize();default:throw new Error("Matrix.size: Wrong argument type.")}};t.type=function(){switch(this.getDataType().toLowerCase()){case"boolean":case"logical":return"logical";case"array":case"float64array":return"double";case"float32array":return"single";case"int32array":return"int32";case"uint32array":return"uint32";case"int16array":return"int16";case"uint16array":return"uint16";case"int8array":return"int8";case"uint8clampedarray":return"uint8c";case"uint8array":return"uint8";default:return new Error("Matrix.type: Unknown data type.")}};t.isrow=function(){var r=this.size();return r.length===2&&r[0]===1};t.iscolumn=function(){var r=this.size();return r.length===2&&r[1]===1};t.isvector=function(){var r=this.size();return r.length===2&&(r[1]===1||r[0]===1)};t.ismatrix=function(){return this.getSize().length<=2};t.issquare=function(){if(this.getSize(0)!==this.getSize(1)){throw false}return true};t.isinteger=function(){switch(this.getDataType().toLowerCase()){case"uint8array":case"uint8clampedarray":case"uint16array":case"uint32array":case"int8array":case"int16array":case"int32array":return true;default:return false}};t.isfloat=function(){switch(this.getDataType().toLowerCase()){case"float32array":case"float64array":return true;default:return false}};t.islogical=function(){var r=this.getDataType().toLowerCase();if(r==="logical"||r==="boolean"||r==="bool"){return true}return false};r.intmin=function(r){switch(r){case"uint8c":case"uint8":case"uint16":case"uint32":return 0;case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648;default:throw new Error("Matrix.intmin: Unknown data type.")}};r.intmax=function(r){switch(r){case"int8":return 127;case"uint8c":case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295;default:throw new Error("Matrix.intmax: Unknown data type.")}};r.realmin=function(r){switch(r){case undefined:case"double":return Number.MIN_VALUE;case"single":return 1.1755e-38;default:throw new Error("Matrix.realmin: Unknown data type.")}};r.realmax=function(r){switch(r){case undefined:case"double":return Number.MAX_VALUE;case"single":return 3.4028e38;default:throw new Error("Matrix.realmin: Unknown data type.")}}})(Matrix,Matrix.prototype);(function(r,t){"use strict";var a=typeof module!=="undefined"&&module.exports?true:false;var e,i,n;if(a){e=require("fs");i=require("canvas");n=i.Image}else{n=Image}var o=function(r,t){var e;if(a){e=new i}else{e=document.createElement("canvas")}e.width=r||0;e.height=t||0;return e};r.colon=function(){var t=Tools.checkColon(arguments);var a=t[0],e=t[1],i=t[2];if(!isFinite(a)||!isFinite(e)||!isFinite(i)){throw new Error("Parameters are invalid number (Infitity or NaN).")}var n=2.2204e-16;var o=2*n*Math.max(Math.abs(a),Math.abs(i));var s=e>0?1:-1;var f;var u=Tools.isInteger;if(u(a)&&e===1){f=Math.floor(i)-a}else if(u(a)&&u(e)){var g=Math.floor(a/e);var v=a-g*e;f=Math.floor((i-v)/e)-g}else{f=Math.round((i-a)/e);if(s*(a+f*e-i)>o){f=f-1}}var l=a+f*e;if(s*(l-i)>-o){l=i}var h=new r(f+1);var c=h.getData();var p,m=Math.floor(f/2)+1;var x=a,w=l;for(p=0;p<m;p++,x+=e,w-=e){c[p]=x;c[f-p]=w}if(f%2===0){c[f/2]=(a+l)/2}return h};r.linspace=function(t,a,e){if(!Tools.isNumber(t)){throw new Error}if(!Tools.isNumber(a)){throw new Error}if(e===undefined){e=100}else if(!Tools.isInteger(e,1)){throw new Error("Matrix.linspace: Bins shoulb be an integer > 1.")}var i=e-1;return r.colon(t,(a-t)/i,a)};r.zeros=function(){var t,a;if(typeof arguments[arguments.length-1]==="string"){a=Array.prototype.pop.apply(arguments)}t=Tools.checkSize(arguments,"square");return new r(t,a)};r.ones=function(){var t;if(typeof arguments[arguments.length-1]==="string"){t=Array.prototype.pop.apply(arguments)}var a=Tools.checkSize(arguments,"square");var e=new r(a,t),i=e.getData();var n,o;for(n=0,o=i.length;n<o;++n){i[n]=1}return e};r.rand=function(){var t,a;if(typeof arguments[arguments.length-1]==="string"){a=Array.prototype.pop.apply(arguments)}t=Tools.checkSize(arguments,"square");var e=new r(t,a),i=e.getData();var n,o,s=Math.random;for(n=0,o=i.length;n<o;++n){i[n]=s()}return e};r.randn=function(){var t,a;if(typeof arguments[arguments.length-1]==="string"){a=Array.prototype.pop.apply(arguments)}t=Tools.checkSize(arguments,"square");var e=new r(t,a),i=e.getData();var n,o;var s=Math.random,f=Math.PI*2;var u=Math.sqrt,g=Math.sin,v=Math.log;for(n=0,o=i.length;n<o;++n){var l=f*s();var h=u(-2*v(1-s()));i[n]=h*g(l)}return e};r.randi=function(){var t,a,e;t=Array.prototype.shift.apply(arguments);t=Tools.checkRange(t);if(typeof arguments[arguments.length-1]==="string"){e=Array.prototype.pop.apply(arguments)}a=arguments.length===0?[1]:arguments;a=Tools.checkSize(a,"square");var i=new r(a,e),n=i.getData();var o,s,f=t[0],u=t[1]-f+1;var g=Math.random,v=Math.floor;for(o=0,s=n.length;o<s;++o){n[o]=v(g()*u)+f}return i};r.eye=function(){var t,a;if(typeof arguments[arguments.length-1]==="string"){a=Array.prototype.pop.apply(arguments)}t=Tools.checkSize(arguments,"square");var e=new r(t,a);var i=e.getData();var n=e.getView(),o=e.getIterator(2);var s=o.iterator,f=o.begin,u=o.isEnd;var g=n.getFirst(1),v=n.getStep(1);var l=n.getFirst(0),h=n.getStep(0);var c=Math.min(n.getSize(1),n.getSize(0));var p,m,x;for(p=f();!u();p=s()){for(m=p+g+l,x=0;x<c;m+=v,x++){i[m+x*h]=1}}return e};r.complex=function(t,a){t=r.toMatrix(t);a=r.toMatrix(a);if(!(t instanceof r)){throw new Error("Matrix.complex: real argument must be a matrix.")}if(!t.isreal()){throw new Error("Matrix.complex: real argument must be a real matrix.")}if(!(a instanceof r)){throw new Error("Matrix.complex: imag argument must be a matrix.")}if(!a.isreal()){throw new Error("Matrix.complex: imag argument must be a real matrix.")}if(!Tools.checkSizeEquals(t.getSize(),a.getSize(),r.ignoreTrailingDims)){throw new Error("Matrix.complex: imag and real Matrix must "+"have the same size.")}var e=t.getData(),i=a.getData();var n=new r.dataType(e.length*2);n.subarray(0,e.length).set(e);n.subarray(e.length).set(i);return new r(t.getSize(),n,true)};r.imread=function(t,s,f){var u="Matrix.imread: ";var g=new r;if(!a&&typeof t==="string"&&document.getElementById(t)){t=document.getElementById(t)}var v=function(r){var t,a=r.getContext("2d");var e=r.width,i=r.height;try{t=a.getImageData(0,0,e,i)}catch(n){if(f!==undefined){f.call(this,n);return}throw n}var o=new Uint8ClampedArray(t.data);var u=new MatrixView([4,e,i]).select([0,2],[0,-1],[0,-1]).permute([2,1,0]);this.initialize(u.getSize(),u.extractFrom(o));if(s){s.call(this,this)}}.bind(g);var l=function(r){if(!a){r=r instanceof Event?this:r}var t=o(r.width,r.height);t.getContext("2d").drawImage(r,0,0,r.width,r.height);v(t)};var h=function(r){var t=new n;t.onerror=f||function(){throw new Error(u+"Error occuring while loading image.")};if(a){t.src=e.readFileSync(r);l(t)}else{t.src=r;t.onload=l}};if(typeof t==="string"){h(t)}else if(!a&&t instanceof Image){l(t)}else if(!a&&t instanceof HTMLCanvasElement){v(t)}else if(a&&t instanceof i){v(t)}else{throw new Error(u+"invalid source argument")}return g};r.diag=function(t){t=r.toMatrix(t);var a=t.numel();t=t.getData();var e=r.zeros(a);var i=e.getData();var n,o,s;for(n=0,o=i.length,s=0;n<o;n+=a+1,s++){i[n]=t[s]}return e};r.loadImages=function s(t,a){var e=[],i,n;a=a.bind(e);var o=function(r){return function(){e[r]=this;for(var i=0,n=t.length;i<n;i++){if(!e[i]||e[i].isempty()){return}}a()}};for(i=0,n=t.length;i<n;i++){if(t[i]instanceof Image){r.imread(t[i],o(i))}}return e}})(Matrix,Matrix.prototype);(function(r,t){"use strict";var a=function(r,t,a,e){for(var i=t+a,n=t+e,o=r[t];i<n;i+=a){if(r[i]<o){o=r[i]}}return o};var e=function(r,t,a,e){for(var i=t+a,n=t+e,o=r[t],s=t;i<n;i+=a){if(r[i]<o){o=r[i];s=i}}return s};var i=function(r,t,a,e){for(var i=t+a,n=t+e,o=r[t];i<n;i+=a){if(r[i]>o){o=r[i]}}return o};var n=function(r,t,a,e){for(var i=t+a,n=t+e,o=r[t],s=t;i<n;i+=a){if(r[i]>o){o=r[i];s=i}}return s};var o=function(r,t,a,e){for(var i=t,n=t+e,o=0;i<n;i+=a){o+=r[i]}return o};var s=function(r,t,a,e){for(var i=t,n=t+e,o=0;i<n;i+=a){o+=r[i]}return o*a/e};var f=function(r,t,a,e){for(var i=t,n=t+e,o=1;i<n;i+=a){o*=r[i]}return o};var u=function(r,t,a,e){var i=s(r,t,a,e);for(var n=t,o=t+e,f=0;n<o;n+=a){var u=r[n]-i;f+=u*u}return f*a/(e-1)};var g=function(r,t,a,e){return u(r,t,a,e)*(e-1)/e};var v=function(r,t,a,e){for(var i=t+a,n=t+e;i<n;i+=a){r[i]+=r[i-a]}};var l=function(r,t,a,e){for(var i=t+a,n=t+e;i<n;i+=a){r[i]*=r[i-a]}};var h=function(r,t){var a=r.ndims(),e=[t];for(var i=0;i<a;i++){if(i!==t){e.push(i)}}return e};var c=function(t,a,e,i,n){i=i||false;if(!Tools.isSet(e)){if(i){a(t.getData(),0,1,t.numel());return t}var o=a(t.getData(),0,1,t.numel());return r.toMatrix(o)}if(!Tools.isInteger(e,0)){throw new Error("Matrix.applyDim: Invalid dimension.")}var s=t.getView(),f=h(s,e);s.permute(f);var u=t.getData(),g=s.getIterator(1);var v=g.iterator,l=g.begin,c=g.isEnd;var p=s.getStep(0),m=s.getEnd(0);var x,w;if(!i){var M=t.getSize();M[e]=1;var y=new r(M,n),d=new y.getData;for(x=l(),w=0;!c();x=v(),w++){d[w]=a(u,x,p,m)}return y}if(n!==undefined){t=n;n=n.getData()}for(x=l();!c();x=v()){a(u,x,p,m,n)}return t};t.min=function(r){return c(this,a,r)};t.amin=function(r){return c(this,e,r,undefined,"uint32")};t.max=function(r){return c(this,i,r)};t.amax=function(r){return c(this,n,r,undefined,"uint32")};t.sum=function(r){return c(this,o,r)};t.prod=function(r){return c(this,f,r)};t.mean=function(r){return c(this,s,r)};t.variance=function(r,t){switch(typeof t){case"undefined":t=-1;break;case"boolean":t=t===false?-1:0;break;case"number":if(t===0){t=-1}else if(t===1){t=0}else{throw new Error("Matrix.variance: Invalid argument.")}break;default:throw new Error("Matrix.variance: Invalid argument.")}if(t===-1){return c(this,u,r)}return c(this,g,r)};t.std=function(r,t){var a=this.variance(r,t);if(typeof a==="number"){return Math.sqrt(a)}return a.arrayfun(Math.sqrt)};t.cumsum=function(r){return c(this,v,r,true)};t.cumprod=function(r){return c(this,l,r,true)};(function(){var t=function(r,t){var a=Math.exp(-t),e=Math.random;for(var i=0,n=r.length;i<n;i++){var o=1,s=0;do{s++;o*=e()}while(o>a);r[i]=s-1}};var a=function(r,t){t=-t;var a=Math.random,e=Math.log;for(var i=0,n=r.length;i<n;++i){r[i]=t*e(a())}};r.poissrnd=function(){var a=Array.prototype.shift.apply(arguments);var e=Tools.checkSize(arguments,"square");var i=new r(e),n=i.getData();t(n,a);return i};r.exprnd=function(){var t=Array.prototype.shift.apply(arguments);var e=Tools.checkSize(arguments,"square");var i=new r(e),n=i.getData();a(n,t);return i}})();(function(){var a,e,i;var n=function(r,t){return a[r]-a[t]};var o=function(r,t){return a[t]-a[r]};var s=function(r,t){return r-t};var f=function(r,t){return t-r};var u=function(r,t,e,n){var o,s,f;for(o=t,s=0,f=t+n;o<f;o+=e,s++){a[s]=r[o]}Array.prototype.sort.call(a,i);for(o=t,s=0,f=t+n;o<f;o+=e,s++){r[o]=a[s]}};var g=function(r,t,n,o,s){var f,u,g;for(f=t,u=0,g=t+o;f<g;f+=n,u++){a[u]=r[f];e[u]=u}Array.prototype.sort.call(e,i);for(f=t,u=0,g=t+o;f<g;f+=n,u++){s[f]=e[u]*n+t}};t.sort=function(r,t){var e=typeof r==="number"?this.getSize(r):this.numel();a=new Float64Array(e);if(t==="ascend"){i=s}else if(t==="descend"){i=f}else{throw new Error("Matrix.sort: Wrong mode selection")}return c(this,u,r,true)};r.sort=function(r,t,a){return r.getCopy().sort(t,a)};t.asort=function(t,s){var f=typeof t==="number"?this.getSize(t):this.numel();a=new Float64Array(f);e=new Uint32Array(f);if(s==="ascend"){i=n}else if(s==="descend"){i=o}else{throw new Error("Matrix.sort: Wrong mode selection")}var u=new r(this.getSize(),"uint32");return c(this,g,t,true,u)};r.asort=function(r,t,a){return r.getCopy().asort(t,a)}})();r.accumarray=function(t,a,e){t=r.toMatrix(t);if(!Tools.isArrayOfIntegers(t.getData(),0)){throw new Error("Matrix.accumarray: Subs should be an array of positive integers.")}var i=t.max(0).getData();var n,o,s=[1];if(Tools.isSet(e)){for(n=0,o=i.length;n<o;n++){if(e[n]<i[n]+1){throw new Error("Matrix.accumarray: Size and Subs values are unconsistent.")}}}else{e=[];for(n=0,o=i.length;n<o;n++){e[n]=i[n]+1}}for(n=0,o=e.length-1;n<o;n++){s[n+1]=s[n]*e[n]}if(t.ndims()>2){throw Error("Matrix.accumarray: Subs must be a 2D Array.")}var f=t.getData(),u=t.numel(),g=t.getSize(0);var v,l,h,c,p,m;var x=new Uint32Array(g);for(l=0,h=0;h<u;l++,h+=g){for(v=0,c=h,m=s[l];v<g;v++,c++){x[v]+=f[c]*m}}if(a instanceof r){a=a.getData()}var w=new r(e),M=w.getData();if(Tools.isArrayLike(a)&&a.length===x.length){for(n=0,o=x.length;n<o;n++){M[x[n]]+=a[n]}}else if(typeof a==="number"){for(n=0,o=x.length;n<o;n++){M[x[n]]+=a}}else{throw new Error("Matrix.accumarray: Wrong val argument.")}return w}})(Matrix,Matrix.prototype);(function(r,t){"use strict";t.cast=function(t){var a;switch(t.toLowerCase()){case"boolean":case"bool":case"logical":a=true}t=Tools.checkType(t);var e=new t(this.getData());return new r(this.getSize(),e,undefined,true)};t.double=function(){return this.cast("double")};t.single=function(){return this.cast("single")};t.int8=function(){return this.cast("int8")};t.int16=function(){return this.cast("int16")};t.int32=function(){return this.cast("int32")};t.uint8=function(){return this.cast("uint8")};t.uint8c=function(){return this.cast("uint8c")};t.uint16=function(){return this.cast("uint16")};t.uint32=function(){return this.cast("uint32")};t.isnan=function(){var t=new r(this.getSize(),"logical");var a=t.getData();var e,i;if(this.isreal()){var n=this.getData();for(e=0,i=a.length;e<i;e++){a[e]=isNaN(n[e])}}else{var o=this.getRealData(),s=this.getImagData();for(e=0,i=a.length;e<i;e++){a[e]=isNaN(o[e])||isNaN(s[e])}}return t};t.isinf=function(){var t=new r(this.getSize(),"logical");var a=t.getData();var e,i;if(this.isreal()){var n=this.getData();for(e=0,i=a.length;e<i;e++){var o=n[e];a[e]=o===Infinity||o===-Infinity}}else{var s=this.getRealData(),f=this.getImagData();for(e=0,i=a.length;e<i;e++){var u=s[e],g=f[e];a[e]=u===Infinity||u===-Infinity||g===Infinity||g===-Infinity}}return t};t.isfinite=function(){var t=new r(this.getSize(),"logical");var a=t.getData();var e,i;if(this.isreal()){var n=this.getData();for(e=0,i=a.length;e<i;e++){a[e]=isFinite(n[e])}}else{var o=this.getRealData(),s=this.getImagData();for(e=0,i=a.length;e<i;e++){a[e]=isFinite(o[e])||isFinite(s[e])}}return t}})(Matrix,Matrix.prototype);(function(r,t){"use strict";t.real=function(){if(this.isreal()){throw new Error("Matrix.real: This function can be only"+" used with a complex Matrix. ")}var t=this.getRealData();return new r(this.getSize(),new t.constructor(t))};t.imag=function(){if(this.isreal()){throw new Error("Matrix.imag: This function can be only"+" used with a complex Matrix. ")}var t=this.getImagData();return new r(this.getSize(),new t.constructor(t))};(function(r){var t=function(r){for(var t=0,a=r.length;t<a;t++){r[t]=0}};var a=function(r,t){for(var a=0,e=r.length;a<e;a++){r[a]=Math.atan2(t[a],r[a]);t[a]=0}};r.angle=function(){if(this.isreal()){t(this.getData())}else{a(this.getRealData(),this.getImagData())}return this}})(t);(function(r){var t=function(r){for(var t=0,a=r.length;t<a;t++){r[t]=r[t]>0?r[t]:-r[t]}};var a=function(r,t){for(var a=0,e=r.length;a<e;a++){var i=t[a],n=r[a];r[a]=Math.sqrt(i*i+n*n);t[a]=0}};r.abs=function(){if(this.isreal()){t(this.getData())}else{a(this.getRealData(),this.getImagData())}return this}})(t);t.conj=function(){if(this.isreal()===true){return this}var r,t,a=this.getImagData();for(r=0,t=a.length;r<t;r++){a[r]=-a[r]}return this}})(Matrix,Matrix.prototype);(function(Matrix,Matrix_prototype){"use strict";(function(r){var t=function(r){for(var t=0,a=r.length;t<a;t++){r[t]=Math.sqrt(r[t])}};var a=function(r,t){for(var a=0,e=r.length;a<e;a++){var i=r[a],n=t[a];var o=Math.sqrt(i*i+n*n);r[a]=Math.sqrt((i+o)*.5);t[a]=n<0?-Math.sqrt((o-i)*.5):Math.sqrt((o-i)*.5)}};r.sqrt=function(){if(this.isreal()){t(this.getData())}else{a(this.getRealData(),this.getImagData())}return this}})(Matrix_prototype);Matrix_prototype.cos=function(){var r=this.getData(),t,a;for(t=0,a=r.length;t<a;t++){r[t]=Math.cos(r[t])}return this};Matrix_prototype.sin=function(){var r=this.getData(),t,a;for(t=0,a=r.length;t<a;t++){r[t]=Math.sin(r[t])}return this};Matrix_prototype.tan=function(){var r=this.getData(),t,a;for(t=0,a=r.length;t<a;t++){r[t]=Math.tan(r[t])}return this};(function(r){var t=function(r){for(var t=0,a=r.length;t<a;t++){r[t]=Math.exp(r[t])}};var a=function(r,t){for(var a=0,e=r.length;a<e;a++){var i=Math.exp(r[a]),n=t[a];r[a]=i*Math.cos(n);t[a]=i*Math.sin(n)}};r.exp=function(){if(this.isreal()){t(this.getData())}else{a(this.getRealData(),this.getImagData())}return this}})(Matrix_prototype);Matrix_prototype.log=function(){var r=this.getData(),t,a;for(t=0,a=r.length;t<a;t++){r[t]=Math.log(r[t])}return this};Matrix_prototype.log10=function(){var r=this.getData(),t,a;var e=Math.log(10);for(t=0,a=r.length;t<a;t++){r[t]=Math.log(r[t])*e}return this};Matrix_prototype.log2=function(){var r=this.getData(),t,a;var e=Math.log(2);for(t=0,a=r.length;t<a;t++){r[t]=Math.log(r[t])*e}return this};Matrix_prototype.floor=function(){var r=this.getData(),t,a;for(t=0,a=r.length;t<a;t++){r[t]=Math.floor(r[t])}return this};Matrix_prototype.ceil=function(){var r=this.getData(),t,a;for(t=0,a=r.length;t<a;t++){r[t]=Math.ceil(r[t])}return this};Matrix_prototype.round=function(){var r=this.getData(),t,a;for(t=0,a=r.length;t<a;t++){r[t]=Math.round(r[t])}return this};Matrix_prototype.acos=function(){var r=this.getData(),t,a;for(t=0,a=r.length;t<a;t++){r[t]=Math.acos(r[t])}return this};Matrix_prototype.asin=function(){var r=this.getData(),t,a;for(t=0,a=r.length;t<a;t++){r[t]=Math.asin(r[t])}return this};Matrix_prototype.atan=function(){var r=this.getData(),t,a;for(t=0,a=r.length;t<a;t++){r[t]=Math.acos(r[t])}return this};Matrix_prototype.atan2=function(r){var t=this.getCopy();if(!Tools.checkSizeEquals(t.size(),r.size(),Matrix.ignoreTrailingDims)){throw new Error("Matrix.atan2: Side of of elements must be equal.")}var a=t.getData(),e=r.getData();var i,n;for(i=0,n=a.length;i<n;i++){a[i]=Math.atan2(a[i],e[i])}return t};var booleanOperators=function(r,t,a){if(!t.isreal()||a instanceof Matrix&&!a.isreal()){throw new Error("Matrix.booleanOperators: This function doesn't "+"work with complex numbers.")}var e=t.getData(),i=e.length;var n,o,s;if(typeof a==="number"){n=new Matrix(t.size(),"boolean");o=n.getData();if(r==="==="||r==="=="){for(s=0;s<i;s++){o[s]=e[s]===a?1:0}}else if(r==="!=="||r==="!="){for(s=0;s<i;s++){o[s]=e[s]!==a?1:0}}else if(r==="&&"){for(s=0;s<i;s++){o[s]=e[s]&&a?1:0}}else if(r==="||"){for(s=0;s<i;s++){o[s]=e[s]||a?1:0}}else if(r==="<"){for(s=0;s<i;s++){o[s]=e[s]<a?1:0}}else if(r==="<="){for(s=0;s<i;s++){o[s]=e[s]<=a?1:0}}else if(r===">"){for(s=0;s<i;s++){o[s]=e[s]>a?1:0}}else if(r===">="){for(s=0;s<i;s++){o[s]=e[s]>=a?1:0}}else{throw new Error("Matrix: Unknown operator '"+r+"'.")}}else if(a instanceof Matrix){var f=Tools.checkSizeEquals(t.size(),a.size(),Matrix.ignoreTrailingDims);n=new Matrix(f,"boolean");o=n.getData();var u=a.getData();if(r==="==="||r==="=="){for(s=0;s<i;s++){o[s]=e[s]===u[s]?1:0}}else if(r==="!=="||r==="!="){for(s=0;s<i;s++){o[s]=e[s]!==u[s]?1:0}}else if(r==="&&"){for(s=0;s<i;s++){o[s]=e[s]&&u[s]?1:0}}else if(r==="||"){for(s=0;s<i;s++){o[s]=e[s]||u[s]?1:0}}else if(r==="<"){for(s=0;s<i;s++){o[s]=e[s]<u[s]?1:0}}else if(r==="<="){for(s=0;s<i;s++){o[s]=e[s]<=u[s]?1:0}}else if(r===">"){for(s=0;s<i;s++){o[s]=e[s]>=u[s]?1:0}}else if(r===">="){for(s=0;s<i;s++){o[s]=e[s]>=u[s]?1:0}}else{throw new Error("Unknown operator '"+r+"'.")}}else{throw new Error("Argument must be a Matrix or a number")}return n};Matrix_prototype.eq=function(r){return booleanOperators("===",this,r)};Matrix_prototype["==="]=Matrix_prototype.eq;Matrix_prototype.ne=function(r){return booleanOperators("!==",this,r)};Matrix_prototype["!=="]=Matrix_prototype.ne;Matrix_prototype.gt=function(r){return booleanOperators(">",this,r)};Matrix_prototype[">"]=Matrix_prototype.gt;Matrix_prototype.ge=function(r){return booleanOperators(">=",this,r)};Matrix_prototype[">="]=Matrix_prototype.ge;Matrix_prototype.lt=function(r){return booleanOperators("<",this,r)};Matrix_prototype["<"]=Matrix_prototype.lt;Matrix_prototype.le=function(r){return booleanOperators("<=",this,r)};Matrix_prototype["<="]=Matrix_prototype.le;Matrix_prototype.and=function(r){return booleanOperators("&&",this,r)
};Matrix_prototype["&&"]=Matrix_prototype.and;Matrix_prototype.or=function(r){return booleanOperators("||",this,r)};Matrix_prototype["||"]=Matrix_prototype.or;Matrix_prototype.neg=function(){var r=this.getCopy();var t=r.getData();var a,e;for(a=0,e=t.length;a<e;a++){t[a]=!t[a]?1:0}return r};var generateArithmeticOperators=function(){var operators={"+":{name:"plus","real/real":{scalar:"a[x] += b;",matrix:"a[x] += b[x];"},"real/imag":{scalar:"ar[x] += br;    ai[x] = bi;",matrix:"ar[x] += br[x]; ai[x] = bi[x];"},"imag/real":{scalar:"ar[x] += b;",matrix:"ar[x] += b[x];"},"imag/imag":{scalar:"ar[x] += br;    ai[x] += bi;",matrix:"ar[x] += br[x]; ai[x] += bi[x];"},AIsScalar:"B.getCopy().plus(A);",AIsMatrix:"A.getCopy().plus(B);"},"-":{name:"minus","real/real":{scalar:"a[x] -= b;",matrix:"a[x] -= b[x];"},"real/imag":{scalar:"ar[x] -= br;    ai[x] = -bi;",matrix:"ar[x] -= br[x]; ai[x] = -bi[x];"},"imag/real":{scalar:"ar[x] -= b;",matrix:"ar[x] -= b[x];"},"imag/imag":{scalar:"ar[x] -= br;    ai[x] -= bi;",matrix:"ar[x] -= br[x]; ai[x] -= bi[x];"},AIsScalar:"B.getCopy().plus(A.uminus());",AIsMatrix:"A.getCopy().minus(B);"},".*":{name:"times","real/real":{scalar:"a[x] *= b;",matrix:"a[x] *= b[x];"},"real/imag":{scalar:"ai[x] = ar[x] * bi;    ar[x] *= br;",matrix:"ai[x] = ar[x] * bi[x]; ar[x] *= br[x];"},"imag/real":{scalar:"ar[x] *= b;    ai[x] *= b;",matrix:"ar[x] *= b[x]; ai[x] *= b[x];"},"imag/imag":{scalar:"var r = ar[x], i = ai[x];"+"ar[x] = r * br - i * bi;"+"ai[x] = r * bi + i * br;",matrix:"var r1 = ar[x], i1 = ai[x], r2 = br[x], i2 = bi[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().times(A);",AIsMatrix:"A.getCopy().times(B);"},"./":{name:"rdivide","real/real":{scalar:"a[x] /= b;",matrix:"a[x] /= b[x];"},"real/imag":{scalar_before:"ai.set(ar);"+"tmp = 1 / (br * br + bi * bi);"+"br = br * tmp;"+"bi = -bi * tmp;",scalar:"ai[x] *= bi;           ar[x] *= br;",matrix:"ai[x] = ar[x] * bi[x]; ar[x] *= br[x];"},"imag/real":{scalar_before:"var b = 1 / b;",scalar:"ar[x] *= b;    ai[x] *= b;",matrix:"ar[x] /= b[x]; ai[x] /= b[x];"},"imag/imag":{scalar_before:"var tmp = 1 / (br * br + bi * bi);"+"br *= tmp;"+"bi *= tmp;",scalar:"var r = ar[x], i = ai[x];"+"ar[x] = r * br + i * bi;"+"ai[x] = i * bi - r * br;",matrix:"var r1 = ar[x], i1 = ai[x], r2 = br[x], i2 = bi[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().rdivide(A);",AIsMatrix:"A.getCopy().ldivide(B);"},".\\":{name:"ldivide","real/real":{scalar:"a[x] = b / a[x];",matrix:"a[x] = b[x] / a[x];"},"real/imag":{scalar:"ai[x] = bi / ar[x];    ar[x] = br / ar[x];",matrix:"ai[x] = bi[x] / ar[x]; ar[x] = br[x] / ar[x];"},"imag/real":{scalar:"var tmp = 1 / (ar[x] * ar[x] + ai[x] * ai[x]);"+"ai[x] = bi * tmp; ar[x] = br * tmp;",matrix:"var tmp = 1 / (ar[x] * ar[x] + ai[x] * ai[x]);"+"ai[x] = bi[x] * tmp; ar[x] = br[x] * tmp;"},"imag/imag":{scalar:"var r = br[x], i = bi[x];"+"ar[x] = r * ar + i * ai;"+"ai[x] = i * ai - r * ar;",matrix:"var r1 = br[x], i1 = bi[x], r2 = ar[x], i2 = ai[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().ldivide(A);",AIsMatrix:"A.getCopy().rdivide(B);"},".^":{name:"power","real/real":{scalar_before:"var pow = Math.pow;",matrix_before:"var pow = Math.pow;",scalar:"a[x] = pow(a[x], b);",matrix:"a[x] = pow(a[x], b[x]);"},"real/imag":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},"imag/real":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},"imag/imag":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},AIsScalar:"B.isscalar() ? A.getCopy().power(B) : undefined;",AIsMatrix:"A.getCopy().power(B);"}};var fct=function(r){"use strict";r=Matrix.toMatrix(r);var t,a=this.numel();var e=this,i,n,o,s;if(r.isscalar()){if(e.isreal()){if(r.isreal()){e=e.getData();r=r.getDataScalar();"real/real-scalar"}else{e.toComplex();i=e.getRealData();n=e.getImagData();o=r.getRealData()[0];s=r.getImagData()[0];"real/imag-scalar"}}else{i=e.getRealData();n=e.getImagData();if(r.isreal()){r=r.getDataScalar();"imag/real-scalar"}else{o=r.getRealData()[0];s=r.getImagData()[0];"imag/imag-scalar"}}}else{Tools.checkSizeEquals(e.getSize(),r.getSize(),Matrix.ignoreTrailingDims);if(e.isreal()){if(r.isreal()){e=e.getData();r=r.getData();"real/real-matrix"}else{e.toComplex();i=e.getRealData();n=e.getImagData();o=r.getRealData();s=r.getImagData();"real/imag-matrix"}}else{i=e.getRealData();n=e.getImagData();if(r.isreal()){r=r.getData();"imag/real-matrix"}else{o=r.getRealData();s=r.getImagData();"imag/imag-matrix"}}}return this}.toString();var fct2=function(r,t){"use strict";r=Matrix.toMatrix(r);t=Matrix.toMatrix(t);if(r.isscalar()){return"AIsScalar"}else{return"AIsMatrix"}}.toString();var addLoop=function(r){return"for (x = 0; x < n; x++) {"+r+"}"};var replace=function(r,t,a){var e=t[a].scalar_before?t[a].scalar_before:"";var i=t[a].matrix_before?t[a].matrix_before:"";e+=addLoop(t[a].scalar);i+=addLoop(t[a].matrix);r=r.replace('"'+a+'-matrix";',i);r=r.replace('"'+a+'-scalar";',e);return r};var o,op,fun;for(o in operators){op=operators[o];fun=replace(fct,op,"real/real");fun=replace(fun,op,"real/imag");fun=replace(fun,op,"imag/real");fun=replace(fun,op,"imag/imag");eval("Matrix.prototype."+op.name+" = "+fun);fun=fct2.replace('"AIsScalar";',op.AIsScalar);fun=fun.replace('"AIsMatrix";',op.AIsMatrix);eval("Matrix."+op.name+" = "+fun)}};Matrix_prototype.plus=function(r){r=Matrix.toMatrix(r);var t,a=this.numel();var e=this,i,n,o,s;if(r.isscalar()){if(e.isreal()){if(r.isreal()){e=e.getData();r=r.getDataScalar();for(t=0;t<a;t++){e[t]+=r}}else{e.toComplex();i=e.getRealData();n=e.getImagData();o=r.getRealData()[0];s=r.getImagData()[0];for(t=0;t<a;t++){i[t]+=o;n[t]=s}}}else{i=e.getRealData();n=e.getImagData();if(r.isreal()){r=r.getDataScalar();for(t=0;t<a;t++){i[t]+=r}}else{o=r.getRealData()[0];s=r.getImagData()[0];for(t=0;t<a;t++){i[t]+=o;n[t]+=s}}}}else{Tools.checkSizeEquals(e.getSize(),r.getSize(),Matrix.ignoreTrailingDims);if(e.isreal()){if(r.isreal()){e=e.getData();r=r.getData();for(t=0;t<a;t++){e[t]+=r[t]}}else{e.toComplex();i=e.getRealData();n=e.getImagData();o=r.getRealData();s=r.getImagData();for(t=0;t<a;t++){i[t]+=o[t];n[t]=s[t]}}}else{i=e.getRealData();n=e.getImagData();if(r.isreal()){r=r.getData();for(t=0;t<a;t++){i[t]+=r[t]}}else{o=r.getRealData();s=r.getImagData();for(t=0;t<a;t++){i[t]+=o[t];n[t]+=s[t]}}}}return this};Matrix_prototype["+="]=function(r){return this.plus(r)};Matrix_prototype["+"]=function(r){return this.getCopy().plus(r)};Matrix.plus=function(r,t){return r["+"](t)};Matrix_prototype.minus=function(r){r=Matrix.toMatrix(r);var t,a=this.numel();var e=this,i,n,o,s;if(r.isscalar()){if(e.isreal()){if(r.isreal()){e=e.getData();r=r.getDataScalar();for(t=0;t<a;t++){e[t]-=r}}else{e.toComplex();i=e.getRealData();n=e.getImagData();o=r.getRealData()[0];s=r.getImagData()[0];for(t=0;t<a;t++){i[t]-=o;n[t]=-s}}}else{i=e.getRealData();n=e.getImagData();if(r.isreal()){r=r.getDataScalar();for(t=0;t<a;t++){i[t]-=r}}else{o=r.getRealData()[0];s=r.getImagData()[0];for(t=0;t<a;t++){i[t]-=o;n[t]-=s}}}}else{Tools.checkSizeEquals(e.getSize(),r.getSize(),Matrix.ignoreTrailingDims);if(e.isreal()){if(r.isreal()){e=e.getData();r=r.getData();for(t=0;t<a;t++){e[t]-=r[t]}}else{e.toComplex();i=e.getRealData();n=e.getImagData();o=r.getRealData();s=r.getImagData();for(t=0;t<a;t++){i[t]-=o[t];n[t]=-s[t]}}}else{i=e.getRealData();n=e.getImagData();if(r.isreal()){r=r.getData();for(t=0;t<a;t++){i[t]-=r[t]}}else{o=r.getRealData();s=r.getImagData();for(t=0;t<a;t++){i[t]-=o[t];n[t]-=s[t]}}}}return this};Matrix_prototype["-="]=function(r){return this.minus(r)};Matrix_prototype["-"]=function(r){return this.getCopy().minus(r)};Matrix.minus=function(r,t){return r["-"](t)};Matrix_prototype.uminus=function(){var r,t=this.numel();if(this.isreal()){var a=this.getData();for(r=0;r<t;r++){a[r]=-a[r]}}else{var e=this.getRealData(),i=this.getImagData();for(r=0;r<t;r++){e[r]=-e[r];i[r]=-i[r]}}return this};Matrix.uminus=function(r){return r.getCopy().uminus()};Matrix_prototype.times=function(r){r=Matrix.toMatrix(r);var t,a=this.numel();var e=this,i,n,o,s;if(r.isscalar()){if(e.isreal()){if(r.isreal()){e=e.getData();r=r.getDataScalar();for(t=0;t<a;t++){e[t]*=r}}else{e.toComplex();i=e.getRealData();n=e.getImagData();o=r.getRealData()[0];s=r.getImagData()[0];for(t=0;t<a;t++){n[t]=i[t]*s;i[t]*=o}}}else{i=e.getRealData();n=e.getImagData();if(r.isreal()){r=r.getDataScalar();for(t=0;t<a;t++){i[t]*=r;n[t]*=r}}else{o=r.getRealData()[0];s=r.getImagData()[0];for(t=0;t<a;t++){var f=i[t],u=n[t];i[t]=f*o-u*s;n[t]=f*s+u*o}}}}else{Tools.checkSizeEquals(e.getSize(),r.getSize(),Matrix.ignoreTrailingDims);if(e.isreal()){if(r.isreal()){e=e.getData();r=r.getData();for(t=0;t<a;t++){e[t]*=r[t]}}else{e.toComplex();i=e.getRealData();n=e.getImagData();o=r.getRealData();s=r.getImagData();for(t=0;t<a;t++){n[t]=i[t]*s[t];i[t]*=o[t]}}}else{i=e.getRealData();n=e.getImagData();if(r.isreal()){r=r.getData();for(t=0;t<a;t++){i[t]*=r[t];n[t]*=r[t]}}else{o=r.getRealData();s=r.getImagData();for(t=0;t<a;t++){var g=i[t],v=n[t],l=o[t],h=s[t];var c=1/(l*l+h*h);i[t]=(g*l+v*h)*c;n[t]=(v*l-g*h)*c}}}}return this};Matrix_prototype["*="]=function(r){return this.times(r)};Matrix_prototype[".*"]=function(r){return this.getCopy().times(r)};Matrix.times=function(r,t){return r[".*"](t)};Matrix_prototype.rdivide=function(r){r=Matrix.toMatrix(r);var t,a=this.numel(),e;var i=this,n,o,s,f;if(r.isscalar()){if(i.isreal()){if(r.isreal()){i=i.getData();r=r.getDataScalar();for(t=0;t<a;t++){i[t]/=r}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=r.getRealData()[0];f=r.getImagData()[0];o.set(n);e=1/(s*s+f*f);s=s*e;f=-f*e;for(t=0;t<a;t++){o[t]*=f;n[t]*=s}}}else{n=i.getRealData();o=i.getImagData();if(r.isreal()){r=r.getDataScalar();r=1/r;for(t=0;t<a;t++){n[t]*=r;o[t]*=r}}else{s=r.getRealData()[0];f=r.getImagData()[0];e=1/(s*s+f*f);s*=e;f*=e;for(t=0;t<a;t++){var u=n[t],g=o[t];n[t]=u*s+g*f;o[t]=g*f-u*s}}}}else{Tools.checkSizeEquals(i.getSize(),r.getSize(),Matrix.ignoreTrailingDims);if(i.isreal()){if(r.isreal()){i=i.getData();r=r.getData();for(t=0;t<a;t++){i[t]/=r[t]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=r.getRealData();f=r.getImagData();for(t=0;t<a;t++){o[t]=n[t]*f[t];n[t]*=s[t]}}}else{n=i.getRealData();o=i.getImagData();if(r.isreal()){r=r.getData();for(t=0;t<a;t++){n[t]/=r[t];o[t]/=r[t]}}else{s=r.getRealData();f=r.getImagData();for(t=0;t<a;t++){var v=n[t],l=o[t],h=s[t],c=f[t];var p=1/(h*h+c*c);n[t]=(v*h+l*c)*p;o[t]=(l*h-v*c)*p}}}}return this};Matrix_prototype["/="]=function(r){return this.rdivide(r)};Matrix_prototype["./"]=function(r){return this.getCopy().rdivide(r)};Matrix.rdivide=function(r,t){return r["./"](t)};Matrix_prototype.ldivide=function(r){r=Matrix.toMatrix(r);var t,a=this.numel(),e;var i=this,n,o,s,f;if(r.isscalar()){if(i.isreal()){if(r.isreal()){i=i.getData();r=r.getDataScalar();for(t=0;t<a;t++){i[t]=r/i[t]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=r.getRealData()[0];f=r.getImagData()[0];for(t=0;t<a;t++){o[t]=f/n[t];n[t]=s/n[t]}}}else{n=i.getRealData();o=i.getImagData();if(r.isreal()){r=r.getDataScalar();for(t=0;t<a;t++){e=1/(n[t]*n[t]+o[t]*o[t]);o[t]=f*e;n[t]=s*e}}else{s=r.getRealData()[0];f=r.getImagData()[0];for(t=0;t<a;t++){var u=s[t],g=f[t];n[t]=u*n+g*o;o[t]=g*o-u*n}}}}else{Tools.checkSizeEquals(i.getSize(),r.getSize(),Matrix.ignoreTrailingDims);if(i.isreal()){if(r.isreal()){i=i.getData();r=r.getData();for(t=0;t<a;t++){i[t]=r[t]/i[t]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=r.getRealData();f=r.getImagData();for(t=0;t<a;t++){o[t]=f[t]/n[t];n[t]=s[t]/n[t]}}}else{n=i.getRealData();o=i.getImagData();if(r.isreal()){r=r.getData();for(t=0;t<a;t++){e=1/(n[t]*n[t]+o[t]*o[t]);o[t]=f[t]*e;n[t]=s[t]*e}}else{s=r.getRealData();f=r.getImagData();for(t=0;t<a;t++){var v=s[t],l=f[t],h=n[t],c=o[t];var p=1/(h*h+c*c);n[t]=(v*h+l*c)*p;o[t]=(l*h-v*c)*p}}}}return this};Matrix_prototype["\\="]=function(r){return this.ldivide(r)};Matrix_prototype[".\\"]=function(r){return this.getCopy().ldivide(r)};Matrix.ldivide=function(r,t){return r[".\\"](t)};Matrix_prototype.power=function(r){r=Matrix.toMatrix(r);var t,a=this.numel();var e=this,i,n,o,s,f,u;var g=Math.pow,v=Math.sqrt,l=Math.cos,h=Math.sin,c=Math.atan2;if(r.isscalar()){if(e.isreal()){if(r.isreal()){e=e.getData();r=r.getDataScalar();for(t=0;t<a;t++){e[t]=g(e[t],r)}}else{e.toComplex();i=e.getRealData();n=e.getImagData();o=r.getRealData()[0];s=r.getImagData()[0];for(t=0;t<a;t++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}else{i=e.getRealData();n=e.getImagData();if(r.isreal()){r=r.getDataScalar();for(t=0;t<a;t++){f=g(v(i[t]*i[t]+n[t]*n[t]),r);u=r*c(n[t],i[t]);i[t]=f*l(u);n[t]=f*h(u)}}else{o=r.getRealData()[0];s=r.getImagData()[0];for(t=0;t<a;t++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}}else{Tools.checkSizeEquals(e.getSize(),r.getSize(),Matrix.ignoreTrailingDims);if(e.isreal()){if(r.isreal()){e=e.getData();r=r.getData();for(t=0;t<a;t++){e[t]=g(e[t],r[t])}}else{e.toComplex();i=e.getRealData();n=e.getImagData();o=r.getRealData();s=r.getImagData();for(t=0;t<a;t++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}else{i=e.getRealData();n=e.getImagData();if(r.isreal()){r=r.getData();for(t=0;t<a;t++){f=g(v(i[t]*i[t]+n[t]*n[t]),r[t]);u=r[t]*c(n[t],i[t]);i[t]=f*l(u);n[t]=f*h(u)}}else{o=r.getRealData();s=r.getImagData();for(t=0;t<a;t++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}}return this};Matrix_prototype[".^"]=function(r){return this.getCopy().power(r)};Matrix.power=function(r,t){return r[".^"](t)};(function(r){var t=function(r,t){var a,e;for(a=0,e=r.length;a<e;a++){r[a]=t(r[a])}};r.arrayfun=function(r){if(!this.isreal()){throw new Error("Matrix.arrayfun: This function doesn't "+"work with complex numbers.")}if(typeof r!=="function"){throw new Error("Matrix.arrayfun: Argument must be a function.")}t(this.getData(),r.bind(this));return this}})(Matrix_prototype);Matrix_prototype.transpose=function(){if(!this.ismatrix()){throw new Error("Matrix.transpose: "+"Transposition is only defined for matrix.")}var r=this.getView().swapDimensions(0,1);return this.extractViewFrom(r)};Matrix_prototype.ctranspose=function(){return this.transpose().conj()};(function(r){var t=function(r,t){for(var a=0,e=0;a<t;a++){var i=r[a];e+=i>0?i:-i}return e};var a=function(r,t){for(var a=0,e=0;a<t;a++){var i=r[a];e+=i*i}return e};var e=function(r,t,a){var e=Math.pow,i=Math.abs;for(var n=0,o=0;n<t;n++){o+=e(i(r[n]),a)}return o};r.norm=function(r){if(r===undefined){r=2}else if(!Tools.isNumber(r)){throw new Error("Matrix.norm: Argument p must be a number.")}var i=this.getData(),n=i.length;var o;if(r===1){o=t(i,n)}else if(r===2){o=a(i,n)}else{o=e(i,n,r)}return Math.pow(o,1/r)}})(Matrix_prototype);Matrix_prototype.triu=function(r){if(r===undefined){r=0}var t=this.getView();var a=t.getStep(1),e=t.getSize(0),i=t.getSize(1);var n,o,s,f;if(this.isreal()){var u=this.getData();for(n=0,o=0;n<i;o+=a,n++){for(s=o+n+1-r,f=o+e;s<f;s++){u[s]=0}}}else{var g=this.getRealData(),v=this.getImagData();for(n=0,o=0;n<i;o+=a,n++){for(s=o+n+1-r,f=o+e;s<f;s++){g[s]=0;v[s]=0}}}return this};Matrix_prototype.tril=function(r){var t=this.getCopy();if(r===undefined){r=0}var a=t.getView();var e=a.getStep(1),i=a.getSize(0),n=a.getSize(1);var o,s,f,u,g;g=Math.min(i,n);if(this.isreal()){var v=t.getData();for(o=0,s=0;o<n;s+=e,o++){for(f=s,u=s+o-r;f<u;f++){v[f]=0}}}else{var l=t.getRealData(),h=t.getImagData();for(o=0,s=0;o<n;s+=e,o++){for(f=s,u=s+o-r;f<u;f++){l[f]=0;h[f]=0}}}return t};Matrix_prototype.diag=function(r){if(r===undefined){r=0}var t=this.getView();var a=t.getStep(0),e=t.getSize(0);var i=t.getStep(1),n=t.getSize(1);var o,s;if(r>0){r=Math.abs(r);o=i;s=Math.min(e,n-r)}else{r=Math.abs(r);o=a;s=Math.min(e-r,n)}if(s<=0){throw new Error("Matrix.diag: Invalid diagonal requirement.")}var f=new Matrix([1,s],this.type(),!this.isreal());var u,g;var v=i+a;g=r*o;if(this.isreal()){var l=this.getData();var h=f.getData();for(u=0;u<s;u++,g+=v){h[u]=l[g]}}else{var c=this.getRealData(),p=this.getImagData();var m=f.getRealData(),x=f.getImagData();for(u=0;u<s;u++,g+=v){m[u]=c[g];x[u]=p[g]}}return f};Matrix.bsxfun=function(r,t,a){t=Matrix.toMatrix(t);a=Matrix.toMatrix(a);if(!t.isreal()||!a.isreal()){throw new Error("Matrix.bsxfun: This function doesn't "+"work with complex numbers.")}var e=t.getView(),i=a.getView();var n,o=Math.max(e.ndims(),i.ndims());for(n=0;n<o;n++){var s=t.getSize(n),f=a.getSize(n);if(s===1&&f>1){e.selectIndicesDimension(n,new Uint8Array(f))}else if(f===1&&s>1){i.selectIndicesDimension(n,new Uint8Array(s))}else if(f!==s){throw new Error("Matrix.bsxfun: Incompatiblity on dimension: "+n)}}var u=Matrix.zeros(e.getSize());var g=u.getData(),v=t.getData(),l=a.getData();var h=e.getIterator(0),c=i.getIterator(0);var p=h.iterator,m=h.begin,x=h.isEnd;var w=c.iterator,M=c.begin;var y,d,D;if(r instanceof Function){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=r(v[d],l[D])}}else if(r==="plus"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]+l[D]}}else if(r==="minus"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]-l[D]}}else if(r==="times"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]*l[D]}}else if(r==="rdivide"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]/l[D]}}else if(r==="ldivide"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=l[D]/v[d]}}else if(r==="min"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=l[D]>v[d]?v[d]:l[D]}}else if(r==="power"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=Math.pow(v[d],l[D])}}else if(r==="hypot"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=Math.sqrt(l[D]*l[D]+v[d]*v[d])}}else if(r==="atan2"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=Math.atan2(v[d],l[D])}}else if(r==="eq"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]===l[D]?1:0}}else if(r==="ne"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]!==l[D]?1:0}}else if(r==="lt"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]<l[D]?1:0}}else if(r==="le"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]<=l[D]?1:0}}else if(r==="gt"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]>l[D]?1:0}}else if(r==="ge"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]>=l[D]?1:0}}else if(r==="and"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]&&l[D]?1:0}}else if(r==="or"){for(d=m(),D=M(),y=0;!x();d=p(),D=w(),y++){g[y]=v[d]||l[D]?1:0}}else{throw new Error("Matrix.bsxfun: Wrong function argument.")}return u}})(Matrix,Matrix.prototype);(function(r){"use strict";var t={matrix:function(r,t,a,e,i){e=e||1;i=i||3;a=(a||1)*i;var n=t[0],o=t[3],s=t[6];var f=t[1],u=t[4],g=t[7];var v=t[2],l=t[5],h=t[8];for(var c=0,p=e,m=2*e;c<a;c+=i,p+=i,m+=i){var x=r[c],w=r[p],M=r[m];r[c]=n*x+o*w+s*M;r[p]=f*x+u*w+g*M;r[m]=v*x+l*w+h*M}return r},"RGB to RGB":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){var s=r[i],f=r[n],u=r[o];r[i]=s;r[n]=f;r[o]=u}return r},applyFunctionRGB:function(r,t,a,e,i){e=e||1;i=i||3;a=(a||1)*i;for(var n=0,o=e,s=2*e;n<a;n+=i,o+=i,s+=i){var f=t(r[n],r[o],r[s]);r[n]=f[0];r[o]=f[1];r[s]=f[2]}return r},applyFunctionColor:function(r,t,a,e,i){e=e||1;i=i||3;a=(a||1)*i;for(var n=0,o=e,s=2*e;n<a;n+=i,o+=i,s+=i){var f=r[n],u=r[o],g=r[s];var v=t([f,u,g]);r[n]=v[0];r[o]=v[1];r[s]=v[2]}return r},"RGB to GRAY":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){var s=r[i],f=r[n],u=r[o];var g=.2989*s+.587*f+.114*u;r[i]=g;r[n]=g;r[o]=g}return r},"RGB to HSV":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=1/6;for(var n=0,o=a,s=2*a;n<t;n+=e,o+=e,s+=e){var f=r[n],u=r[o],g=r[s];var v=(f>u?f:u)>g?f>u?f:u:g;var l=v-((f<u?f:u)<g?f<u?f:u:g),h=0;if(l!==0){if(v===f){h=(u-g)/l*i}else if(v===u){h=(2+(g-f)/l)*i}else if(v===g){h=(4+(f-u)/l)*i}if(h<0){h+=1}if(v!==0){l/=v}}r[n]=h;r[o]=l;r[s]=v}return r},"HSV to RGB":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){var s=r[i],f=r[n],u=r[o];var g=(s*6|0)%6;var v=s*6-g;var l=u*(1-f);var h=u*(1-v*f);var c=u*(1-(1-v)*f);switch(g){case 0:r[i]=u;r[n]=c;r[o]=l;break;case 1:r[i]=h;r[n]=u;r[o]=l;break;case 2:r[i]=l;r[n]=u;r[o]=c;break;case 3:r[i]=l;r[n]=h;r[o]=u;break;case 4:r[i]=c;r[n]=l;r[o]=u;break;case 5:r[i]=u;r[n]=l;r[o]=h;break}}return r},"RGB to HSL":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=Math.sqrt(3),n=1/(2*Math.PI),o=1/3;for(var s=0,f=a,u=2*a;s<t;s+=e,f+=e,u+=e){var g=r[s],v=r[f],l=r[u];var h=Math.atan2(i*(v-l),2*g-v-l)*n;r[s]=h<0?h+1:h;var c=(g>v?g:v)>l?g>v?g:v:l;var p=(g<v?g:v)<l?g<v?g:v:l;r[f]=c-p;r[u]=(g+v+l)*o}return r},"HSL to RGB":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=Math.PI,n=i/3,o=i*2,s=2*i/3;var f=1/3;var u=Math.sqrt(3)/2,g=1/Math.sqrt(3);for(var v=0,l=a,h=2*a;v<t;v+=e,l+=e,h+=e){var c=r[v],p=r[l],m=r[h];var x=c*o;var w=x;while(w>n){w-=n}var M=u*p/Math.sin(s-w);var y=M*Math.cos(x)*f,d=M*Math.sin(x)*g;r[v]=m+y*2;r[l]=m-y+d;r[h]=m-y-d}return r},"RGB to HSI":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=1/Math.sqrt(3),n=1/Math.sqrt(2),o=1/Math.sqrt(6);for(var s=0,f=a,u=2*a;s<t;s+=e,f+=e,u+=e){var g=r[s],v=r[f],l=r[u];var h=(v-l)*n;var c=(2*g-v-l)*o;r[s]=Math.atan2(h,c);r[f]=Math.sqrt(h*h+c*c);r[u]=(g+v+l)*i}return r},"HSI to RGB":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=Math.sqrt(3),n=Math.sqrt(2),o=Math.sqrt(6);var s=1/6,f=1/3;for(var u=0,g=a,v=2*a;u<t;u+=e,g+=e,v+=e){var l=r[u],h=r[g],c=r[v];var p=h*Math.sin(l);var m=h*Math.cos(l);var x=c*i,w=p*n,M=m*o;var y=(x+M)*f;var d=(2*x+3*w-M)*s;var D=(2*x-3*w-M)*s;r[u]=y;r[g]=d;r[v]=D}return r},"LinearRGB to sRGB":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=.055,n=1/2.4;for(var o=0,s=a,f=2*a;o<t;o+=e,s+=e,f+=e){var u=r[o],g=r[s],v=r[f];r[o]=u>.0031308?1.055*Math.pow(u,n)-i:u*12.92;r[s]=g>.0031308?1.055*Math.pow(g,n)-i:g*12.92;r[f]=v>.0031308?1.055*Math.pow(v,n)-i:v*12.92}return r},"sRGB to LinearRGB":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=1/12.92,n=.055,o=1/1.055;for(var s=0,f=a,u=2*a;s<t;s+=e,f+=e,u+=e){var g=r[s],v=r[f],l=r[u];r[s]=g>.04045?Math.pow((g+n)*o,2.4):g*i;r[f]=v>.04045?Math.pow((v+n)*o,2.4):v*i;r[u]=l>.04045?Math.pow((l+n)*o,2.4):l*i}return r},"RGB to CMY":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){r[i]=1-r[i];r[n]=1-r[n];r[o]=1-r[o]}return r},"CMY to RGB":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){r[i]=1-r[i];r[n]=1-r[n];r[o]=1-r[o]}return r},"RGB to Opponent":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=1/Math.sqrt(3),n=1/Math.sqrt(2),o=1/Math.sqrt(6);for(var s=0,f=a,u=2*a;s<t;s+=e,f+=e,u+=e){var g=r[s],v=r[f],l=r[u];r[s]=(g+v+l)*i;r[f]=(g-v)*n;r[u]=(g+v-2*l)*o}return r},"Opponent to RGB":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=Math.sqrt(3),n=Math.sqrt(2),o=Math.sqrt(6);var s=1/6,f=1/3;for(var u=0,g=a,v=2*a;u<t;u+=e,g+=e,v+=e){var l=r[u],h=r[g],c=r[v];var p=l*i,m=h*n,x=c*o;r[u]=(2*p+3*m+x)*s;r[g]=(2*p-3*m+x)*s;r[v]=(p-x)*f}return r},"RGB to Ohta":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=1/Math.sqrt(3),n=1/Math.sqrt(2),o=1/Math.sqrt(6);for(var s=0,f=a,u=2*a;s<t;s+=e,f+=e,u+=e){var g=r[s],v=r[f],l=r[u];r[s]=(g+v+l)*i;r[f]=(g-l)*n;r[u]=(-g+2*v-l)*o}return r},"Ohta to RGB":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=Math.sqrt(3),n=Math.sqrt(2),o=Math.sqrt(6);var s=1/6,f=1/3;for(var u=0,g=a,v=2*a;u<t;u+=e,g+=e,v+=e){var l=r[u],h=r[g],c=r[v];var p=l*i,m=h*n,x=c*o;r[g]=(p+x)*f;r[u]=(2*p+3*m-x)*s;r[v]=(2*p-3*m-x)*s}return r},"LinearRGB to rgY":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){var s=r[i],f=r[n],u=r[o];var g=s+f+u;if(g>0){var v=1/g;r[i]=s*v;r[n]=f*v;r[o]=g}else{r[i]=1/3;r[n]=1/3;r[o]=0}}return r},"rgY to LinearRGB":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){var s=r[i],f=r[n],u=r[o];r[i]=s*u;r[n]=f*u;r[o]=(1-s-f)*u}return r},getXYZTransform:function(r,a,e){a=a||[.31271,.32902,1];e=e||[.64,.33,1,.3,.6,1,.15,.06,1];var i=t["xyY to XYZ"](a);i=Matrix.toMatrix(i);var e=t["xyY to XYZ"](e,3);e=new Matrix([3,3],e);var n=Matrix.diag(e.inv().mtimes(i));var o=e.mtimes(n);return r?o.inv():o},"LinearRGB to XYZ":function(r,a,e,i,n,o){var s=t.getXYZTransform(false,n,o).getData();t.matrix(r,s,a,e,i);return r},"XYZ to LinearRGB":function(r,a,e,i,n,o){var s=t.getXYZTransform(true,n,o).getData();t.matrix(r,s,a,e,i);return r},"XYZ to Lab":function(r,t,a,e,i){a=a||1;e=e||3;t=(t||1)*e;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o;var u=(1-n-o)*s/o;var g=1/f,v=1/s,l=1/u;var h=1/3,c=16/116;for(var p=0,m=a,x=2*a;p<t;p+=e,m+=e,x+=e){var w=r[p],M=r[m],y=r[x];var d=w*g;if(d>.008856){d=Math.pow(d,h)}else{d=7.787*d+c}var D=M*v;if(D>.008856){D=Math.pow(D,h)}else{D=7.787*D+c}var b=y*l;if(b>.008856){b=Math.pow(b,h)}else{b=7.787*b+c}r[p]=116*D-16;r[m]=500*(d-D);r[x]=200*(D-b)}return r},"Lab to XYZ":function(r,t,a,e,i){a=a||1;e=e||3;t=(t||1)*e;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o;var u=(1-n-o)*s/o;var g=Math.pow(.008856,1/3),v=1/7.787;var l=1/116,h=1/500,c=1/200;var p=16/116;for(var m=0,x=a,w=2*a;m<t;m+=e,x+=e,w+=e){var M=r[m],y=r[x],d=r[w];var D=(M+16)*l;var b=D+y*h;var S=D-d*c;if(D>g){D=Math.pow(D,3)}else{D=(D-p)*v}if(b>g){b=Math.pow(b,3)}else{b=(b-p)*v}if(S>g){S=Math.pow(S,3)}else{S=(S-p)*v}r[m]=b*f;r[x]=D*s;r[w]=S*u}return r},"XYZ to Luv":function(r,t,a,e,i){a=a||1;e=e||3;t=(t||1)*e;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o;var u=(1-n-o)*s/o;var g=1/s;var v=4*f/(f+15*s+3*u);var l=9*s/(f+15*s+3*u);var h=1/3;for(var c=0,p=a,m=2*a;c<t;c+=e,p+=e,m+=e){var x=r[c],w=r[p],M=r[m];var y=w*g;if(y>.008856){y=116*Math.pow(y,h)-16}else{y*=903.3}var d=1/(x+15*w+3*M);d=isFinite(d)?d:0;var D=4*d*x;var b=9*d*w;d=13*y;r[c]=y;r[p]=d*(D-v);r[m]=d*(b-l)}return r},"Luv to XYZ":function(r,t,a,e,i){a=a||1;e=e||3;t=(t||1)*e;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o;var u=(1-n-o)*s/o;var g=4*f/(f+15*s+3*u);var v=9*s/(f+15*s+3*u);var l=Math.pow(.008856,1/3),h=1/7.787;var c=1/116,p=16/116;for(var m=0,x=a,w=2*a;m<t;m+=e,x+=e,w+=e){var M=r[m],y=r[x],d=r[w];var D=(M+16)*c;if(D>l){D=Math.pow(D,3)}else{D=(D-p)*h}var b=1/(13*M);b=isFinite(b)?b:0;var S=y*b+g;var I=d*b+v;b=D/(4*I);r[m]=9*S*b;r[x]=D;r[w]=(12-3*S-20*I)*b}return r},"Lab to Lch":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=1/(2*Math.PI);for(var n=0,o=a,s=2*a;n<t;n+=e,o+=e,s+=e){var f=r[n],u=r[o],g=r[s];var v=Math.atan2(g,u)*i;r[n]=f;r[o]=Math.sqrt(u*u+g*g);r[s]=v<0?v+1:v}return r},"Lch to Lab":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=Math.PI*2;for(var n=0,o=a,s=2*a;n<t;n+=e,o+=e,s+=e){var f=r[n],u=r[o],g=r[s];var v=g*i;var l=Math.cos(v)*u;var h=Math.sin(v)*u;r[n]=f;r[o]=l;r[s]=h}return r},"RGB to XYZ":function(r,a,e,i){t["sRGB to LinearRGB"](r,a,e,i);t["LinearRGB to XYZ"](r,a,e,i);return r},"XYZ to RGB":function(r,a,e,i){t["XYZ to LinearRGB"](r,a,e,i);t["LinearRGB to sRGB"](r,a,e,i);return r},"RGB to Lab":function(r,a,e,i,n){t["sRGB to LinearRGB"](r,a,e,i);t["LinearRGB to XYZ"](r,a,e,i,n);t["XYZ to Lab"](r,a,e,i,n);return r},"Lab to RGB":function(r,a,e,i){t["Lab to XYZ"](r,a,e,i);t["XYZ to LinearRGB"](r,a,e,i);t["LinearRGB to sRGB"](r,a,e,i);return r},"RGB to Luv":function(r,a,e,i,n){t["sRGB to LinearRGB"](r,a,e,i);t["LinearRGB to XYZ"](r,a,e,i);t["XYZ to Luv"](r,a,e,i,n);return r},"Luv to RGB":function(r,a,e,i,n){t["Luv to XYZ"](r,a,e,i,n);t["XYZ to LinearRGB"](r,a,e,i);t["LinearRGB to sRGB"](r,a,e,i);return r},"RGB to Lch":function(r,a,e,i,n){t["sRGB to LinearRGB"](r,a,e,i);t["LinearRGB to XYZ"](r,a,e,i);t["XYZ to Lab"](r,a,e,i,n);t["Lab to Lch"](r,a,e,i);return r},"Lch to RGB":function(r,a,e,i,n){t["Lch to Lab"](r,a,e,i);t["Lab to XYZ"](r,a,e,i,n);t["XYZ to LinearRGB"](r,a,e,i);t["LinearRGB to sRGB"](r,a,e,i);return r},"XYZ to xyY":function(r,t,a,e,i){a=a||1;e=e||3;t=(t||1)*e;i=i||[.31271,.32902,1];var n=i[0],o=i[1];for(var s=0,f=a,u=2*a;s<t;s+=e,f+=e,u+=e){var g=r[s],v=r[f],l=r[u];var h=1/(g+v+l);if(isFinite(h)){r[s]=g*h;r[f]=v*h;r[u]=v}else{r[s]=n;r[f]=o;r[u]=0}}return r},"xyY to XYZ":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){var s=r[i],f=r[n],u=r[o];var g=u/f;r[i]=s*g;r[n]=u;r[o]=(1-s-f)*g}return r},"XYZ to 1960 uvY":function(r,t,a,e,i){a=a||1;e=e||3;t=(t||1)*e;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o,u=(1-n-o)*s/o;var g=4*f/(f+15*s+3*u);var v=6*s/(f+15*s+3*u);for(var l=0,h=a,c=2*a;l<t;l+=e,h+=e,c+=e){var p=r[l],m=r[h],x=r[c];if(m===0){r[l]=g;r[h]=v;r[c]=0}else{var w=1/(p+15*m+3*x);r[l]=4*p*w;r[h]=6*m*w;r[c]=m}}return r},"1960 uvY to XYZ":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=6/4,n=1/3;for(var o=0,s=a,f=2*a;o<t;o+=e,s+=e,f+=e){var u=r[o],g=r[s],v=r[f];var l=1/g;var h=i*v*u*l;r[o]=h;r[s]=v;r[f]=(6*v*l-h-15*v)*n}return r},"XYZ to 1976 u'v'Y":function(r,t,a,e,i){a=a||1;e=e||3;t=(t||1)*e;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o,u=(1-n-o)*s/o;var g=4*f/(f+15*s+3*u);var v=9*s/(f+15*s+3*u);for(var l=0,h=a,c=2*a;l<t;l+=e,h+=e,c+=e){var p=r[l],m=r[h],x=r[c];if(m===0){r[l]=g;r[h]=v;r[c]=0}else{var w=1/(p+15*m+3*x);r[l]=4*p*w;r[h]=9*m*w;r[c]=m}}return r},"1976 u'v'Y to XYZ":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;var i=9/4,n=1/3;for(var o=0,s=a,f=2*a;o<t;o+=e,s+=e,f+=e){var u=r[o],g=r[s],v=r[f];var l=1/g;var h=i*v*u*l;r[o]=h;r[s]=v;r[f]=(9*v*l-h-15*v)*n}return r},"xyY to 1960 uvY":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){var s=r[i],f=r[n];var u=1/(-2*s+12*f+3);r[i]=4*s*u;r[n]=6*f*u}return r},"1960 uvY to xyY":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){var s=r[i],f=r[n];var u=1/(2*s-8*f+4);r[i]=3*s*u;r[n]=2*f*u}return r},"1976 u'v'Y to xyY":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){var s=r[i],f=r[n];var u=1/(6*s-16*f+12);r[i]=9*s*u;r[n]=4*f*u}return r},"xyY to 1976 u'v'Y":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e;for(var i=0,n=a,o=2*a;i<t;i+=e,n+=e,o+=e){var s=r[i],f=r[n];var u=1/(-2*s+12*f+3);r[i]=4*s*u;r[n]=9*f*u}return r},"1976 u'v'Y to 1960 uvY":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e+a;var i=2/3;for(var n=a;n<t;n+=e){r[n]*=i}return r},"1960 uvY to 1976 u'v'Y":function(r,t,a,e){a=a||1;e=e||3;t=(t||1)*e+a;var i=3/2;for(var n=a;n<t;n+=e){r[n]*=i}return r},"RGB to rgY":function(r,a,e,i){t["sRGB to LinearRGB"](r,a,e,i);t["LinearRGB to rgY"](r,a,e,i);return r},"rgY to RGB":function(r,a,e,i){t["rgY to LinearRGB"](r,a,e,i);t["LinearRGB to sRGB"](r,a,e,i);return r},"rgY to xyY":function(r,a,e,i){t["rgY to LinearRGB"](r,a,e,i);t["LinearRGB to XYZ"](r,a,e,i);t["XYZ to xyY"](r,a,e,i);return r},"xyY to rgY":function(r,a,e,i){t["xyY to XYZ"](r,a,e,i);t["XYZ to LinearRGB"](r,a,e,i);t["LinearRGB to rgY"](r,a,e,i);return r},"RGB to xyY":function(r,a,e,i){t["sRGB to LinearRGB"](r,a,e,i);t["LinearRGB to XYZ"](r,a,e,i);t["XYZ to xyY"](r,a,e,i);return r},"xyY to RGB":function(r,a,e,i){t["xyY to XYZ"](r,a,e,i);t["XYZ to LinearRGB"](r,a,e,i);t["LinearRGB to sRGB"](r,a,e,i);return r},"RGB to 1960 uvY":function(r,a,e,i){t["sRGB to LinearRGB"](r,a,e,i);t["LinearRGB to XYZ"](r,a,e,i);t["XYZ to xyY"](r,a,e,i);t["xyY to 1960 uvY"](r,a,e,i);return r},"1960 uvY to RGB":function(r,a,e,i){t["1960 uvY to xyY"](r,a,e,i);t["xyY to XYZ"](r,a,e,i);t["XYZ to LinearRGB"](r,a,e,i);t["LinearRGB to sRGB"](r,a,e,i);return r},"RGB to 1976 u'v'Y":function(r,a,e,i){t["sRGB to LinearRGB"](r,a,e,i);
t["LinearRGB to XYZ"](r,a,e,i);t["XYZ to 1976 u'v'Y"](r,a,e,i);return r},"1976 u'v'Y to RGB":function(r,a,e,i){t["1976 u'v'Y to XYZ"](r,a,e,i);t["XYZ to LinearRGB"](r,a,e,i);t["LinearRGB to sRGB"](r,a,e,i);return r}};r.Colorspaces=t})(Matrix);(function(r,t){"use strict";var a={lab2lch:"Lab to Lch",lab2srgb:"Lab to RGB",lab2xyz:"Lab to XYZ",lch2lab:"Lch to Lab",srgb2cmyk:"RGB to CMY",srgb2lab:"RGB to Lab",srgb2xyz:"RGB to XYZ",upvpl2xyz:"1976 u'v'Y to XYZ",uvl2xyz:"1960 uvY to XYZ",xyl2xyz:"xyY to XYZ",xyz2lab:"XYZ to Lab",xyz2srgb:"XYZ to RGB",xyz2upvpl:"XYZ to 1976 u'v'",xyz2uvl:"XYZ to 1960 uv",xyz2xyl:"XYZ to xyY"};t.applycform=function(t){if(this.ndims()!==3||this.getSize(2)<3){throw new Error("Matrix.applycform: Matrix must be an "+"image with RGB components.")}var e=this.getSize(0)*this.getSize(1);if(typeof t==="string"){if(r.Colorspaces[t]){r.Colorspaces[t](this.getData(),e,e,1)}else if(r.Colorspaces[a[t]]){r.Colorspaces[a[t]](this.getData(),e,e,1)}}else if(typeof t==="function"){if(t.length===3){r.Colorspaces.applyFunctionRGB(this.getData(),t,e,e,1)}else if(t.length===1){r.Colorspaces.applyFunctionColor(this.getData(),t,e,e,1)}}else{t=r.toMatrix(t);if(!Tools.checkSizeEquals(t.size(),[3,3],r.ignoreTrailingDims)){throw new Error("Matrix.applycform: Matrix argument must be 3x3.")}r.Colorspaces.matrix(this.getData(),t.getData(),e,e,1)}return this};r.applycform=function(r,t){return r.getCopy().applycform(t)};t.toColormap=function(t){var a=this.getData(),e=this.getSize(),i=a.length;e[2]=3;var n=new r(e),o=n.getData();var s=o.subarray(0,i),f=o.subarray(i,2*i),u=o.subarray(2*i,3*i);var g,v,l=Math.floor;if(t==="JET"){for(g=0;g<i;g++){v=a[g]*4;if(v>=4){v=3.99}else if(v<0){v=0}switch(l(v*2)%8){case 0:s[g]=0;f[g]=0;u[g]=v+.5;break;case 1:case 2:s[g]=0;u[g]=1;f[g]=v-.5;break;case 3:case 4:s[g]=v-1.5;f[g]=1;u[g]=2.5-v;break;case 5:case 6:s[g]=1;f[g]=3.5-v;u[g]=0;break;case 7:s[g]=4.5-v;f[g]=0;u[g]=0;break}}}else if(t==="HUE"){for(g=0;g<i;g++){var h=a[g];v=l(h*6)%6;var c=h*6-v;switch(v){case 0:s[g]=1;f[g]=c;u[g]=0;break;case 1:s[g]=1-c;f[g]=1;u[g]=0;break;case 2:s[g]=0;f[g]=1;u[g]=c;break;case 3:s[g]=0;f[g]=1-c;u[g]=1;break;case 4:s[g]=c;f[g]=0;u[g]=1;break;case 5:s[g]=1;f[g]=0;u[g]=1-c;break}}}else if(t==="HUE"){o.set(a)}return n};t.correctImage=function(r,t){t=t||CIE.getIlluminant("D65");var a=CIE.getIlluminantConversionMatrix(t,r);this.applycform("sRGB to LinearRGB").applycform(a).applycform("LinearRGB to sRGB");return this};r.correctImage=function(r,t,a){return r.getCopy().correctImage(t,a)};t.im2CCT=function(){var t=CIE["xyY to CCT"];var a=this.getSize();a.pop();var e=new r(a,"single");var i=this.getData(),n=e.getData();var o=this.getView();var s=o.getStep(0),f=o.getEnd(0),u;var g=o.getStep(1),v=o.getEnd(1),l;var h=o.getStep(2);var c,p,m,x,w,M=[];for(c=0,l=v;c!==l;c+=g){p=c;m=c+h;x=c+2*h;for(u=c+f;p!==u;p+=s,m+=s,x+=s){M[0]=i[p];M[1]=i[m];M[2]=i[x];w=t(M);w=w<1668?1668:w>2e4?2e4:w;w=isNaN(w)?24999:w;n[p]=w}}return e};t.CCT2im=function(){var t=CIE["CCT to xyY"];var a=this.getSize();a[2]=3;var e=new r(a,"single");var i=this.getData(),n=e.getData();var o=e.getView();var s=o.getStep(0),f=o.getEnd(0),u;var g=o.getStep(1),v=o.getEnd(1),l;var h=o.getStep(2);var c,p,m,x,w=[];for(c=0,l=v;c!==l;c+=g){p=c;m=c+h;x=c+2*h;for(u=c+f;p!==u;p+=s,m+=s,x+=s){w=t(i[p]);n[p]=w[0];n[m]=w[1];n[x]=w[2]}}return e}})(Matrix,Matrix.prototype);(function(r){"use strict";var t=function(r,t){if(!Tools.isInteger(t)||!Tools.isInRange(t,0,2)){throw new Error("Matrix.calerf: Invalid argument.")}var a=3.97886080735226;var e=.2753747415973768;var i=.49016508058531844;var n=.7743681991195386;var o=1.0792551515585667;var s=1.313146538310231;var f=1.3704021768233816;var u=1.1890298290927332;var g=.8052764087529106;var v=.35752427444953105;var l=.016620792496936737;var h=-.11946395996432542;var c=-.0838864557023002;var p=.002493672000535033;var m=.039097684558848406;var x=.016131532973325226;var w=-.013382364453346007;var M=-.012722381378212275;var y=.003833351262648873;var d=.007736725283135267;var D=-.0008707796353172959;var b=-.003963850973605135;var S=.00011931402283834095;var I=.0012710976495261409;var z=new Float64Array([5.958930743e-11,-1.13739022964e-9,1.466005199839e-8,-1.635035446196e-7,16461004480962e-19,-1492559551950604e-20,.00012055331122299264,-.0008548326981129666,.005223977624823223,-.026866170645077334,.11283791670954882,-.3761263890318375,1.1283791670955126,2.372510631e-11,-4.5493253732e-10,5.90362766598e-9,-6.642090827576e-8,6.7595634268133e-7,-621188515924e-17,510388300970969e-19,-.00037015410692956176,.00233307631218881,-.012549884771821921,.05657061146827042,-.21379664776456006,.8427007929497149,9.49905026e-12,-1.8310229805e-10,2.39463074e-9,-2.721444369609e-8,2.8045522331686e-7,-261830022482897e-20,2195455056768781e-20,-.00016358986921372656,.0010705215356411031,-.006082847181135901,.029869784652462584,-.13055593046562267,.674933236039655,3.82722073e-12,-7.421598602e-11,9.793057408e-10,-1.126008898854e-8,1.1775134830784e-7,-11199275838265e-19,962023443095201e-20,-7404402135070773e-20,.0005068999365414488,-.003075530514392729,.016689778925531657,-.08548534594781312,.5690907664239364,1.55296588e-12,-3.032205868e-11,4.0424830707e-10,-4.71135111493e-9,5.011915876293e-8,-4.8722516178974e-7,430683284629395e-20,-3445026145385764e-20,.00024879276133931664,-.0016294094174807928,.009887863739323505,-.05962426839442304,.49766113250947636]);var R=new Float64Array([-2.9734388465e-10,2.69776334046e-9,-6.40788827665e-9,-1.6678201321e-8,-2.1854388148686e-7,266246030457984e-20,1612722157047886e-20,-.00025616361025506627,.00015380842432375364,.00815533022524928,-.014022836638963193,-.19746892495383023,.7151172032884284,-1.951073787e-11,-3.2302692214e-10,5.22461866919e-9,3.42940918551e-9,-3.5772874310272e-7,1.9999935792654e-7,2687044575042908e-20,-.00011843240273775776,-.0008099172895603227,.006610629705022412,.009095309223548273,-.20160072778491014,.5116969671872764,3.147682272e-11,-4.8465972408e-10,6.3675740242e-10,3.377623323271e-8,-1.5451139637086e-7,-203340624738438e-20,1947204525295057e-20,2854147231653228e-20,-.0010156506315220028,.0027118700352009566,.023280950354228107,-.16725021123116876,.32490054966649434,2.31936337e-11,-6.303206648e-11,-2.64888267434e-9,2.050708040581e-8,1.1371857327578e-7,-211211337219663e-20,368797328322935e-20,9823686253424796e-20,-.0006586024399045536,-.0007528581489523087,.025854344242029606,-.11637092784486193,.1826733677529661,-3.67789363e-12,2.0876046746e-10,-1.93319027226e-9,-4.35953392472e-9,1.8006992266137e-7,-7.8441223763969e-7,-675407647949153e-20,8428418334440096e-20,-.00017604388937031816,-.002397296114350716,.02064129023876023,-.06905562880005864,.09084526782065479]);var E=r.getCopy();var T=E.getData(),L,C;var B,A,Y,G,k;var q=Math.abs,V=Math.floor,_=Math.exp;if(t===0){for(L=0,C=E.getLength();L<C;L++){B=q(T[L]);if(B<2.2){A=B*B;Y=V(A);A=A-Y;Y=Y*13;G=((((((((((((z[Y]*A+z[Y+1])*A+z[Y+2])*A+z[Y+3])*A+z[Y+4])*A+z[Y+5])*A+z[Y+6])*A+z[Y+7])*A+z[Y+8])*A+z[Y+9])*A+z[Y+10])*A+z[Y+11])*A+z[Y+12])*B}else if(B<6.9){Y=V(B);A=B-Y;Y=13*(Y-2);G=(((((((((((R[Y]*A+R[Y+1])*A+R[Y+2])*A+R[Y+3])*A+R[Y+4])*A+R[Y+5])*A+R[Y+6])*A+R[Y+7])*A+R[Y+8])*A+R[Y+9])*A+R[Y+10])*A+R[Y+11])*A+R[Y+12];G=G*G;G=G*G;G=G*G;G=1-G*G}else{G=1}if(T[L]<0){G=-G}T[L]=G}}else if(t===1){for(L=0,C=E.getLength();L<C;L++){A=a/(a+q(T[L]));k=A-.5;G=(((((((((I*k+S)*k+b)*k+D)*k+d)*k+y)*k+M)*k+w)*k+x)*k+m)*k+p;G=((((((((((((G*k+c)*k+h)*k+l)*k+v)*k+g)*k+u)*k+f)*k+s)*k+o)*k+n)*k+i)*k+e)*A*_(-T[L]*T[L]);if(T[L]<0){G=2-G}T[L]=G}}else if(t===2){for(L=0,C=E.getLength();L<C;L++){A=a/(a+q(T[L]));k=A-.5;G=(((((((((I*k+S)*k+b)*k+D)*k+d)*k+y)*k+M)*k+w)*k+x)*k+m)*k+p;G=((((((((((((G*k+c)*k+h)*k+l)*k+v)*k+g)*k+u)*k+f)*k+s)*k+o)*k+n)*k+i)*k+e)*A*_(-T[L]*T[L]);if(T[L]<0){G=2-G}T[L]=_(T[L]*T[L])*G}}return E};r.erf=function(){return t(this,0)};r.erfc=function(){return t(this,1)};r.erfcx=function(){return t(this,2)};(function(r){var t=171.624;var a=new Float64Array([-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054]),e=new Float64Array([-30.840230011973897,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.25967555349]),i=new Float64Array([-.001910444077728,.00084171387781295,-.0005952379913043012,.0007936507935003503,-.0027777777777776816,.08333333333333333,.0057083835261]);var n=function(r){return r>0?Math.floor(r):Math.ceil(r)};r.gamma=function(){if(!this.isreal()){throw"Matrix.gamma: Do not work on complex numbers."}var r=Number.POSITIVE_INFINITY,o=.9189385332046728,s=2.22507e-308,f=2.220446049250313e-16;var u,g,v,l,h,c,p,m,x;var w=this.getData(),M,y;for(M=0,y=w.length;M<y;M++){u=w[M];var d=0,D=1,b=0,S=u;if(S<=0){S=-u;c=n(S);p=S-c;if(p!==0){if(c!==n(c*.5)*2){d=1}D=-Math.PI/Math.sin(Math.PI*p);S+=1}else{w[M]=r;continue}}if(S<f){if(S>=s){p=1/S}else{w[M]=r;continue}}else if(S<12){c=S;if(S<1){h=S;S+=1}else{b=parseInt(S,10)-1;S-=parseFloat(b);h=S-1}l=0;v=1;for(g=0;g<8;++g){l=(l+a[g])*h;v=v*h+e[g]}p=l/v+1;if(c<S){p/=c}else if(c>S){for(g=0;g<b;++g){p*=S;S+=1}}}else{if(S<=t){x=S*S;m=i[6];for(g=0;g<6;g++){m=m/x+i[g]}m=m/S-S+o;m+=(S-.5)*Math.log(S);p=Math.exp(m)}else{w[M]=r;continue}}if(d){p=-p}if(D!==1){p=D/p}w[M]=p}return this}})(r)})(Matrix.prototype);(function(r,t){"use strict";var a=typeof module!=="undefined"&&module.exports?true:false;var e,i,n;if(a){e=require("fs");i=require("canvas");n=i.Image}else{n=Image}var o=function(r,t){var e;if(a){e=new i}else{e=document.createElement("canvas")}e.width=r||0;e.height=t||0;return e};t.convertImage=function(t){var a=new r(this.getSize(),t);var e,i;if(this.isfloat()||this.islogical()){e=[0,1]}else if(this.isinteger()){e=[r.intmin(this.type()),r.intmax(this.type())]}var n=e[0],o=1/(e[1]-e[0]);if(a.isfloat()||this.islogical()){i=[0,1]}else if(a.isinteger()){i=[r.intmin(a.type()),r.intmax(a.type())]}var s=i[0],f=o*(i[1]-i[0]);var u=this.getData(),g=new a.getData;var v,l;for(v=0,l=u.length;v<l;v++){g[v]=(u[v]-n)*f-s}return new r(this.getSize(),g)};t.im2double=function(){return this.convertImage("double")};t.im2single=function(){return this.convertImage("single")};t.im2uint8=function(){return this.convertImage("uint8")};t.im2uint8c=function(){return this.convertImage("uint8c")};t.getImageData=function(){var t;if(this.isfloat()||this.islogical()){t=[0,1]}else if(this.isinteger()){t=[r.intmin(this.type()),r.intmax(this.type())]}var a=t[0],e=255/(t[1]-t[0]);var i=this.getSize(1),n=this.getSize(0);var s=o().getContext("2d").createImageData(i,n);var f=n*i,u;var g=this.getData(),v=s.data;var l,h,c,p,m,x,w;switch(this.getSize(2)){case 1:for(h=0,l=0;h<n;h++){for(c=h,u=h+f;c<u;c+=n){w=(g[c]-a)*e;v[l++]=w;v[l++]=w;v[l++]=w;v[l++]=255}}break;case 2:for(h=0,l=0;h<n;h++){for(c=h,p=h+f,u=h+f;c<u;c+=n,p+=n){w=(g[c]-a)*e;v[l++]=w;v[l++]=w;v[l++]=w;v[l++]=(g[p]-a)*e}}break;case 3:for(h=0,l=0;h<n;h++){for(c=h,p=h+f,m=h+2*f,u=p;c<u;c+=n,p+=n,m+=n){v[l++]=(g[c]-a)*e;v[l++]=(g[p]-a)*e;v[l++]=(g[m]-a)*e;v[l++]=255}}break;case 4:for(h=0,l=0;h<n;h++){for(c=h,p=c+f,m=p+f,x=m+f,u=p;c<u;c+=n,p+=n,m+=n,x+=n){v[l++]=(g[c]-a)*e;v[l++]=(g[p]-a)*e;v[l++]=(g[m]-a)*e;v[l++]=(g[x]-a)*e}}break}return s};t.toImage=function(r){if(a){throw new Error("Matrix.toImage: Canvas doesn't exist.")}var t=o(this.getSize(1),this.getSize(0));var e=this.getImageData();t.getContext("2d").putImageData(e,0,0);var i=new Image;i.src=t.toDataURL();i.onload=r;return i};if(a){r.prototype.imwrite=function(r,t){var a=o(this.getSize(1),this.getSize(0));a.getContext("2d").putImageData(this.getImageData(),0,0);var i=e.createWriteStream(r),n;if(/\.(png)$/i.test(r.toLowerCase())){n=a.pngStream()}else if(/\.(jpeg|jpg)$/i.test(r.toLowerCase())){n=a.jpegStream()}else{throw new Error("Matrix.imwrite: invalid file extension.")}n.on("data",function(r){i.write(r)});if(t){n.on("end",t.bind(this))}}}r.fspecial=function(t,a,e){var i,n,o,s;var f,u,g,v,l,h,c,p;var m,x,w;var M=function(r,t){return Math.exp(-(r*r+t*t)/(2*s*s))};switch(t.toLowerCase()){case"average":if(Tools.isArrayLike(a)){o=a[0];n=a[1]}else{o=a===undefined?3:a;n=o}return r.ones([o,n])["./"](o*n);case"disk":break;case"gaussian":if(Tools.isArrayLike(a)){o=a[0];n=a[1]}else{o=a===undefined?3:a;n=o}s=e===undefined?.5:e;f=[];p=0;for(v=0,u=-(n-1)/2,h=n*o;v<h;v+=o,u++){for(l=v,c=v+o,g=-(o-1)/2;l<c;l++,g++){m=M(u,g);f[l]=m;p+=m}}for(x=0,w=f.length;x<w;x++){f[x]/=p}return new r([o,n],f);case"laplacian":i=a===undefined?.2:a;return new r([3,3],[i/4,(1-i)/4,i/4,(1-i)/4,-1,(1-i)/4,i/4,(1-i)/4,i/4])[".*"](4/(i+1));case"log":if(Tools.isArrayLike(a)){o=a[0];n=a[1]}else{o=a===undefined?3:a;n=o}s=e===undefined?.5:e;f=[];p=0;for(v=0,u=-(n-1)/2,h=n*o;v<h;v+=o,u++){for(l=v,c=v+o,g=-(o-1)/2;l<c;l++,g++){m=M(u,g);f[l]=(u*u+g*g-2*s*s)*m/Math.pow(s,4);p+=m}}for(x=0,w=f.length;x<w;x++){f[x]/=p}p=0;for(x=0,w=f.length;x<w;x++){p+=f[x]}p/=n*o;for(x=0,w=f.length;x<w;x++){f[x]-=p}return new r([o,n],f);case"unsharp":i=a===undefined?.2:a;return new r([3,3],[-i,i-1,-i,i-1,i+5,i-1,-i,i-1,-i])[".*"](1/(i+1));case"prewitt":return new r([3,3],[1,0,-1,1,0,-1,1,0,-1]);case"sobel":return new r([3,3],[1,0,-1,2,0,-2,1,0,-1]);default:return}};t.filter=function(t){var a="Matrix.filter: ";if(!t.ismatrix()){throw new Error(a+"Kernel must be a vector.")}var e=new r(this.getSize(),this.getDataType());var i=this.getData(),n=e.getData();var o=e.getView();var s=o.getStep(2),f=o.getEnd(2);var u=o.getStep(1),g=o.getEnd(1);var v=o.getEnd(0);var l=t.getSize(0),h=t.getSize(1),c=t.getData();var p=t.getView();var m=p.getStep(1),x=p.getEnd(1);var w=p.getEnd(0);var M=Math.floor,y=Math.ceil;var d=M((h-1)/2),D=M((l-1)/2);var b=y((h-1)/2),S=y((l-1)/2);var I;var z,R,E,T,L,C,B,A,Y,G,k,q,V,_;for(z=0;z!==f;z+=s){for(R=0,E=z,T=z+d*u;E!==T;R++,E+=u){for(L=0,C=E,B=E+D;C!==B;L++,C++){I=0;for(A=z,G=d-R,k=G*m;k!==x;G++,k+=m,A+=u){for(Y=A,q=k+D-L,_=k+w;q!==_;q++,Y++){I+=i[Y]*c[q]}}n[C]=I}for(B=E+v-S;C!==B;L++,C++){I=0;for(A=z,G=d-R,k=G*m;k!==x;G++,k+=m,A+=u){for(Y=A+L-D,q=k,_=k+w;q!==_;q++,Y++){I+=i[Y]*c[q]}}n[C]=I}for(B=E+v;C!==B;L++,C++){I=0;for(A=z,G=d-R,k=G*m;k!==x;G++,k+=m,A+=u){for(Y=A+L-D,q=k,l=k+w+(v-(L+S+1));q!==l;q++,Y++){I+=i[Y]*c[q]}}n[C]=I}}for(T=z+g-b*u;E!==T;R++,E+=u){for(L=0,C=E,B=E+D;C!==B;L++,C++){I=0;for(A=E-d*u,G=0,k=G*m;k!==x;G++,k+=m,A+=u){for(Y=A,q=k+D-L,_=k+w;q!==_;q++,Y++){I+=i[Y]*c[q]}}n[C]=I}for(B=E+v-S;C!==B;L++,C++){I=0;for(A=E-d*u,G=0,k=G*m;k!==x;G++,k+=m,A+=u){for(Y=A+L-D,q=k,_=k+w;q!==_;q++,Y++){I+=i[Y]*c[q]}}n[C]=I}for(B=E+v;C!==B;L++,C++){I=0;for(A=E-d*u,G=0,k=G*m;k!==x;G++,k+=m,A+=u){for(Y=A+L-D,q=k,l=k+w+(v-(L+S+1));q!==l;q++,Y++){I+=i[Y]*c[q]}}n[C]=I}}for(T=z+g;E!==T;R++,E+=u){for(L=0,C=E,B=E+D;C!==B;L++,C++){I=0;for(A=E-d*u,G=0,k=0,V=x+(g/u-(R+b+1))*m;k!==V;G++,k+=m,A+=u){for(Y=A,q=k+D-L,_=k+w;q!==_;q++,Y++){I+=i[Y]*c[q]}}n[C]=I}for(B=E+v-S;C!==B;L++,C++){I=0;for(A=E-d*u,G=0,k=0,V=x+(g/u-(R+b+1))*m;k!==V;G++,k+=m,A+=u){for(Y=A+L-D,q=k,_=k+w;q!==_;q++,Y++){I+=i[Y]*c[q]}}n[C]=I}for(B=E+v;C!==B;L++,C++){I=0;for(A=E-d*u,G=0,k=0,V=x+(g/u-(R+b+1))*m;k!==V;G++,k+=m,A+=u){for(Y=A+L-D,q=k,l=k+w+(v-(L+S+1));q!==l;q++,Y++){I+=i[Y]*c[q]}}n[C]=I}}}return e};t.bilateral=function(t,a,e){var i="Matrix.filter: ";var e=e||3;var n=r.fspecial("gaussian",Math.round(e*t),t);var o=-1/(2*a);if(!n.ismatrix()){throw new Error(i+"Kernel must be a vector.")}var s=new r(this.getSize(),this.getDataType());var f=this.getData(),u=s.getData();var g=s.getView();var v=g.getStep(2),l=g.getEnd(2);var h=g.getStep(1),c=g.getEnd(1);var p=g.getEnd(0);var m=n.getSize(0),x=n.getSize(1),w=n.getData();var M=n.getView();var y=M.getStep(1),d=M.getEnd(1);var D=M.getEnd(0);var b=Math.floor,S=Math.ceil;var I=b((x-1)/2),z=b((m-1)/2);var R=S((x-1)/2),E=S((m-1)/2);var T=Math.exp;var L;var C,B,A,Y,G,k,q,V,_,F,X,Z,U,N,H,O,P,W;for(C=0;C!==l;C+=v){for(B=0,A=C,Y=C+I*h;A!==Y;B++,A+=h){for(G=0,k=A,q=A+z;k!==q;G++,k++){H=f[k];L=0;O=0;for(V=C,F=I-B,X=F*y;X!==d;F++,X+=y,V+=h){for(_=V,Z=X+z-G,N=X+D;Z!==N;Z++,_++){W=H-f[_];P=w[Z]*T(o*W*W);L+=P;O+=f[_]*P}}u[k]=O/L}for(q=A+p-E;k!==q;G++,k++){H=f[k];L=0;O=0;for(V=C,F=I-B,X=F*y;X!==d;F++,X+=y,V+=h){for(_=V+G-z,Z=X,N=X+D;Z!==N;Z++,_++){W=H-f[_];P=w[Z]*T(o*W*W);L+=P;O+=f[_]*P}}u[k]=O/L}for(q=A+p;k!==q;G++,k++){H=f[k];L=0;O=0;for(V=C,F=I-B,X=F*y;X!==d;F++,X+=y,V+=h){for(_=V+G-z,Z=X,m=X+D+(p-(G+E+1));Z!==m;Z++,_++){W=H-f[_];P=w[Z]*T(o*W*W);L+=P;O+=f[_]*P}}u[k]=O/L}}for(Y=C+c-R*h;A!==Y;B++,A+=h){for(G=0,k=A,q=A+z;k!==q;G++,k++){H=f[k];L=0;O=0;for(V=A-I*h,F=0,X=F*y;X!==d;F++,X+=y,V+=h){for(_=V,Z=X+z-G,N=X+D;Z!==N;Z++,_++){W=H-f[_];P=w[Z]*T(o*W*W);L+=P;O+=f[_]*P}}u[k]=O/L}for(q=A+p-E;k!==q;G++,k++){H=f[k];L=0;O=0;for(V=A-I*h,F=0,X=F*y;X!==d;F++,X+=y,V+=h){for(_=V+G-z,Z=X,N=X+D;Z!==N;Z++,_++){W=H-f[_];P=w[Z]*T(o*W*W);L+=P;O+=f[_]*P}}u[k]=O/L}for(q=A+p;k!==q;G++,k++){H=f[k];L=0;O=0;for(V=A-I*h,F=0,X=F*y;X!==d;F++,X+=y,V+=h){for(_=V+G-z,Z=X,m=X+D+(p-(G+E+1));Z!==m;Z++,_++){W=H-f[_];P=w[Z]*T(o*W*W);L+=P;O+=f[_]*P}}u[k]=O/L}}for(Y=C+c;A!==Y;B++,A+=h){for(G=0,k=A,q=A+z;k!==q;G++,k++){H=f[k];L=0;O=0;for(V=A-I*h,F=0,X=0,U=d+(c/h-(B+R+1))*y;X!==U;F++,X+=y,V+=h){for(_=V,Z=X+z-G,N=X+D;Z!==N;Z++,_++){W=H-f[_];P=w[Z]*T(o*W*W);L+=P;O+=f[_]*P}}u[k]=O/L}for(q=A+p-E;k!==q;G++,k++){L=0;O=0;H=f[k];for(V=A-I*h,F=0,X=0,U=d+(c/h-(B+R+1))*y;X!==U;F++,X+=y,V+=h){for(_=V+G-z,Z=X,N=X+D;Z!==N;Z++,_++){W=H-f[_];P=w[Z]*T(o*W*W);L+=P;O+=f[_]*P}}u[k]=O/L}for(q=A+p;k!==q;G++,k++){H=f[k];L=0;O=0;for(V=A-I*h,F=0,X=0,U=d+(c/h-(B+R+1))*y;X!==U;F++,X+=y,V+=h){for(_=V+G-z,Z=X,m=X+D+(p-(G+E+1));Z!==m;Z++,_++){W=H-f[_];P=w[Z]*T(o*W*W);L+=P;O+=f[_]*P}}u[k]=O/L}}}return s};t.filter1d=function(t,a){var e=this.constructor.name+".filter1d: ";if(a===undefined){a="C"}if(!t.isvector()){throw new Error("Matrix.filter1d: Kernel must be a vector")}var i=t.getLength(),n=t.getData();if(typeof a==="string"){switch(a.toUpperCase()){case"C":case"CL":a=Math.floor((i-1)/2);break;case"CR":a=Math.ceil((i-1)/2);break;case"L":a=0;break;case"R":a=i-1;break;default:throw new Error(e+"unknown origin position '"+a+"'")}}else if(typeof a==="number"){if(a<0){a+=i}if(a<0||a>=i){throw new Error(e+"origin value must satisfy : |origin| < kernel.length")}}var o=new r(this.getSize(),this.getDataType());var s=this.getData(),f=o.getData();var u=o.getView();var g=u.getStep(2),v=u.getEnd(2);var l=u.getStep(1),h=u.getEnd(1);var c=u.getEnd(0);if(a>=c/2){throw new Error("Matrix.filter1d: Kernel is too large.")}var p,m=c-a;var x,w,M,y,d,D,b;for(x=0;x!==v;x+=g){for(w=x,M=x+h;w!==M;w+=l){for(y=w,d=w+a;y<d;y++){for(p=0,b=0,D=2*w+a-y;D>w;b++,D--){p+=n[b]*s[D]}for(D=w;b<i;b++,D++){p+=n[b]*s[D]}f[y]=p}for(y=w+a,d=w+m;y<d;y++){for(p=0,b=0,D=y-a;b<i;b++,D++){p+=n[b]*s[D]}f[y]=p}for(y=w+m,d=w+c;y<d;y++){for(p=0,b=0,D=y-a;D<d;b++,D++){p+=n[b]*s[D]}for(D=d-2;b<i;b++,D--){p+=n[b]*s[D]}f[y]=p}}}return o};t.separableFilter=function(r,t){if(t===undefined){t=r}return this.filter1d(r).permute([1,0,2]).filter1d(t).permute([1,0,2])};t.gaussian=function(r,t,a){a=a||3;var e=s.gaussian(r,0,a);var i;if(typeof t==="number"){i=s.gaussian(t,0,a)}else{i=e}return this.separableFilter(e,i)};t.gaussianGradient=function(t){if(!t){t=2}var a=s.gaussian(t,1,3);var e=s.gaussian(t,0,3);var i=this.separableFilter(e,a);var n=this.separableFilter(a,e);var o=.5/Math.PI;var f=r.zeros(this.getSize()),u=r.zeros(this.getSize());var g=i.getData(),v=n.getData();var l=f.getData(),h=u.getData();var c,p;for(c=0,p=g.length;c<p;c++){var m=g[c],x=v[c];l[c]=Math.sqrt(m*m+x*x);var w=Math.atan2(x,m)*o;h[c]=w<0?w+1:w}return{x:i,y:n,norm:f,phase:u}};t.fastGaussian=function(r,t,a){if(!t){t=r}if(!a){a=4}if(r<=0||a<1){throw new Error("Matrix.fastGaussian: sigma and"+" numsteps values have to be positives")}var e=function(r,t){var e=r.getData();var i=t*t/(2*a);var n=(1+2*i-Math.sqrt(1+4*i))/(2*i);var o=1/(1-n);var s=Math.pow(n/i,a);var f,u;var g=function(r,t){var e,i,f;for(f=0;f<a;f++){r[0]*=o;for(e=1;e<t;e++){r[e]+=n*r[e-1]}r[t-1]*=o;for(e--;e>0;e--){r[e-1]+=n*r[e]}}for(e=0,i=t;e<i;e++){r[e]*=s}};var v=r.getView();var l=v.getStep(2),h=v.getEnd(2);var c=v.getStep(1),p=v.getEnd(1);var m=v.getEnd(0);var x;for(f=0;f!==h;f+=l){for(u=f,x=f+p;u!==x;u+=c){var w=e.subarray(u);g(w,m)}}return r};var i=e(this.getCopy(),r).permute([1,0,2]);return e(i,t).permute([1,0,2])};t.gradient=function(t,a,e,i,n){var o=.70710678,s=6.8284271,f=.35355339;var u=.29289322,g=1/s,v=.5/Math.PI;var l={},h,c,p,m,x;var w=this.getSize();var M=this.getDataType();if(t){l.x=new r(w,M);h=l.x.getData()}if(a){l.y=new r(w,M);c=l.y.getData()}if(e){l.norm=new r(w,M);p=l.norm.getData()}if(i){l.phase=new r(w,M);m=l.phase.getData()}if(n){l.laplacian=new r(w,M);x=l.laplacian.getData()}var y=this.getData();var d=this.getView();var D=d.getStep(2),b=d.getEnd(2);var S=d.getStep(1),I=d.getEnd(1);var z=d.getEnd(0);var R,E,T,L,C,B,A;for(R=0;R!==b;R+=D){for(E=R+S,T=R+I-S;E!==T;E+=S){for(B=E-S,L=E,A=E+S,C=E+z-2;L<C;L){var Y=y[B],G=y[++B],k=y[B+1];var q=y[L],V=y[++L],_=y[L+1];var F=y[A],X=y[++A],Z=y[A+1];var U=Z-Y,N=k-F;var H=u*(X-G+f*(U-N));var O=u*(q-_-f*(U+N));if(t){h[L]=H}if(a){c[L]=O}if(e){p[L]=Math.sqrt(H*H+O*O)}if(i){var P=Math.atan2(-O,H)*v;m[L]=P<0?P+1:P}if(n){x[L]=(o*(Y+k+F+Z)+(q+G+X+_))*g-V}}}}return l};t.fastGaussian=function(r,t,a){if(!t){t=r}if(!a){a=4}if(r<=0||a<1){throw new Error("Matrix.fastGaussian: sigma and"+" numsteps values have to be positives")}var e=function(r,t){var e=r.getData();var i=t*t/(2*a);var n=(1+2*i-Math.sqrt(1+4*i))/(2*i);var o=1/(1-n);var s=Math.pow(n/i,a);var f,u;var g=function(r,t){var e,i,f;for(f=0;f<a;f++){r[0]*=o;for(e=1;e<t;e++){r[e]+=n*r[e-1]}r[t-1]*=o;for(e--;e>0;e--){r[e-1]+=n*r[e]}}for(e=0,i=t;e<i;e++){r[e]*=s}};var v=r.getView();var l=v.getStep(2),h=v.getEnd(2);var c=v.getStep(1),p=v.getEnd(1);var m=v.getEnd(0);var x;for(f=0;f!==h;f+=l){for(u=f,x=f+p;u!==x;u+=c){var w=e.subarray(u);g(w,m)}}return r};var i=e(this.getCopy(),r).permute([1,0,2]);return e(i,t).permute([1,0,2])};t.conv=function(t,a){if(!this.isvector()||!t.isvector()){throw new Error("Matrix.conv: Input must be vector.")}var e=this.getData(),i=e.length;var n=t.getData(),o=n.length;if(i<o){return t.conv(this,a)}var s=Tools.checkType(this.getDataType());var f=new s(i+o-1),u=f.length;var g,v,l,h,c,p,m;for(c=0,p=o-1;c<p;c++){for(m=0,v=0,l=c+1,h=c;v<l;v++,h--){m+=e[v]*n[h]}f[c]=m}for(c=o-1,g=0,p=i;c<p;c++,g++){for(m=0,v=g,l=c+1,h=o-1;v<l;v++,h--){m+=e[v]*n[h]}f[c]=m}for(c=i,g=i-o+1;c<u;c++,g++){for(m=0,v=g,h=o-1;v<i;v++,h--){m+=e[v]*n[h]}f[c]=m}switch(a){case undefined:case"full":return new r(u,f);case"same":var x=Math.ceil(o/2);return new r(i,f.subarray(x,x+i));case"valid":return new r(i-o+1,f.subarray(o-1,i));default:throw new Error("Matrix.conv: Invalid shape parameter.")}};t.blockFilter=function(t,a,e){if(!e){e=this.im2double().cumsum(0).cumsum(1)}var i=r.zeros(this.getSize());var n=e.getData(),o=i.getData();var s=this.getView();var f=s.getStep(2),u=s.getEnd(2);var g=s.getStep(1),v=s.getEnd(1);var l=s.getStep(0),h=s.getEnd(0);var c=a/2|0,p=(t/2|0)*g;var m,x,w,M,y;var d,D,b,S;for(w=0;w!==u;w+=f){var I=o.subarray(w+p+c);var z=n.subarray(w);var R=n.subarray(w+2*c+1);var E=n.subarray(w+2*(p+1)*g);var T=n.subarray(w+2*((p+1)*g+c+1));for(M=0,m=0+v;M!==m;M+=g){for(y=M,x=M+h;y<x;y++){I[y]=T[y]+z[y]-E[y]-R[y]}}}return i};var s={};s.normalize=function(r){var t;var a=r.length;var e=0;for(t=0;t<a;t++){e+=Math.abs(r[t])}if(e!==0){for(t=0;t<a;t++){r[t]/=e}}return r};s.gaussian=function(t,a,e){var i,n;if(e===undefined){e=3}if(a===undefined){a=0}var o=1+2*Math.ceil(t*Math.sqrt(e*2*Math.log(10)));var s=new r.dataType(o);var f=(o-1)/2;var u=0,g=Math.abs;for(i=0;i<(o+1)/2;i++){n=i-f;var v=1/(Math.sqrt(2*Math.PI)*t);v*=Math.exp(-(n*n)/(2*t*t));s[i]=s[o-1-i]=v}switch(a){case 0:for(i=0,u=0;i<s.length;i++){u+=g(s[i])}break;case 1:for(i=0,u=0;i<s.length;i++){n=i-f;s[i]*=-n/Math.pow(t,2);u+=g(n*s[i])}break;case 2:for(i=0,u=0;i<s.length;i++){n=i-f;s[i]*=n*n/Math.pow(t,4)-1/Math.pow(t,2);u+=g(s[i])}u/=s.length;for(i=0;i<s.length;i++){s[i]-=g(u)}for(i=0,u=0;i<s.length;i++){n=i-f;u+=g(.5*n*n*s[i])}break;default:throw new Error("Kernel.gaussian: Derive order can be 0,1 or 2 but not "+a)}if(u!==0){for(i=0;i<s.length;i++){s[i]/=u}}return new r(s.length,s)};t.imshow=function(r,t){if(a){console.warn("Matrix.imshow: function not available in nodejs.");return}var e=this.constructor.name+".imshow: ";var i=this.getSize(1);var n=this.getSize(0);if(typeof r==="string"&&document.getElementById(r)){r=document.getElementById(r)}var o;if(r===undefined||r===null){r=document.createElement("canvas");o=window.open("","","width="+i,"height="+n);o.document.body.appendChild(r)}if(!(r instanceof HTMLCanvasElement)){throw new Error(e+"Invalid canvas.")}var s=this.getImageData();if(t===undefined||t===1){r.width=i;r.height=n;r.getContext("2d").putImageData(s,0,0)}else{if(t==="fit"){var f=r.width/i;var u=r.height/n;t=Math.min(f,u);t=t>1?1:t}else if(typeof t!=="number"){throw new Error(e+"scale must be a number or 'fit'")}r.width=Math.round(i*t);r.height=Math.round(n*t);var g=document.createElement("canvas");g.width=i;g.height=n;var v=g.getContext("2d");v.putImageData(s,0,0);r.getContext("2d").drawImage(g,0,0,i,n,0,0,r.width,r.height)}return o||this};t.print=function(){var r=this.imshow();r.print();r.close();return this};t.imagesc=function(r,t){var a=this.min().getDataScalar(),e=this.max().getDataScalar();return this["-"](a)["./"](e-a).imshow(r,t)};t.imtransform=function(t){t=r.toMatrix(t);var a=this.getSize(0),e=this.getSize(1);var i=o(e,a),n=i.getContext("2d");var s=o(),f=s.getContext("2d");var u=r.toMatrix([0,0,1,e,0,1,e,a,1,0,a,1]).reshape([3,4]);var g=t.mtimes(u).transpose();var v=g.max(0).getData(),l=g.min(0).getData();var h=this.getImageData();n.putImageData(h,0,0);var c=t.getData();s.width=v[0]-l[0];s.height=v[1]-l[1];f.translate(-l[0],-l[1]);f.transform(c[0],c[1],c[3],c[4],c[6],c[7]);f.drawImage(i,0,0);return r.imread(s).convertImage(this.type())};t.imhist=function(t){if(!this.ismatrix()){throw new Error("Matrix.imhist: This function only works on grey-level images.")}t=t||256;var a=this.getData();var e=r.zeros(t,1),i=e.getData();var n;if(this.isinteger()){n=r.intmax(this.type())}else if(this.islogical()){n=1;t=2}else if(this.isfloat()){n=1}else{throw new Error("Matrix.imhist: unknow data type.")}var o,s,f=1/n*t;for(o=0,s=a.length;o<s;o++){i[a[o]*f|0]++}return e};(function(){var a=function(r,t){var a=r.length;var e=new Float32Array(t);var i,n=Math.floor;for(i=0;i<a;++i){var o=n(r[i]*t);o=o>=t?t-1:o;++e[o]}var s=e[0];for(i=1;i<t;++i){s=e[i]+=s}e.sum=r.length;return e};t.histeq=function(t){var e=this.im2double().applycform("RGB to HSL");var i=e.select([],[],2).getData();var n=a(i,t);var o=1/n.sum,s=Math.floor;for(var f=0;f<i.length;++f){i[f]=n[s(i[f]*t)]*o}var u=new r([e.size(0),e.size(1)],i);return e.set([],[],2,u).applycform("HSL to RGB")}})();t.rgb2gray=function(){if(this.ndims()!==3||this.getSize(2)<3){throw new Error("Matrix.rgb2gray: Matrix must be an "+"image with RGB components.")}var t=this.getSize();t[2]-=2;var a=new r(t,this.getDataType());var e=this.getData(),i=a.getData();var n=this.getView();var o=n.getEnd(0),s;var f=n.getStep(1),u=n.getEnd(1),g;var v=n.getStep(2);var l,h,c,p;for(l=0,g=u;l!==g;l+=f){h=l;c=l+v;p=l+2*v;for(s=l+o;h<s;h++,c++,p++){i[h]=.3*e[h]+.59*e[c]+.11*e[p]}}if(this.getSize(2)===4){var m=i.subarray(v);var x=e.subarray(3*v);m.set(x)}return a}})(Matrix,Matrix.prototype);(function(r,t){"use strict";var a=460;var e=new Uint16Array([2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997,1009,1013,1019,1021,1031,1033,1039,1049,1051,1061,1063,1069,1087,1091,1093,1097,1103,1109,1117,1123,1129,1151,1153,1163,1171,1181,1187,1193,1201,1213,1217,1223,1229,1231,1237,1249,1259,1277,1279,1283,1289,1291,1297,1301,1303,1307,1319,1321,1327,1361,1367,1373,1381,1399,1409,1423,1427,1429,1433,1439,1447,1451,1453,1459,1471,1481,1483,1487,1489,1493,1499,1511,1523,1531,1543,1549,1553,1559,1567,1571,1579,1583,1597,1601,1607,1609,1613,1619,1621,1627,1637,1657,1663,1667,1669,1693,1697,1699,1709,1721,1723,1733,1741,1747,1753,1759,1777,1783,1787,1789,1801,1811,1823,1831,1847,1861,1867,1871,1873,1877,1879,1889,1901,1907,1913,1931,1933,1949,1951,1973,1979,1987,1993,1997,1999,2003,2011,2017,2027,2029,2039,2053,2063,2069,2081,2083,2087,2089,2099,2111,2113,2129,2131,2137,2141,2143,2153,2161,2179,2203,2207,2213,2221,2237,2239,2243,2251,2267,2269,2273,2281,2287,2293,2297,2309,2311,2333,2339,2341,2347,2351,2357,2371,2377,2381,2383,2389,2393,2399,2411,2417,2423,2437,2441,2447,2459,2467,2473,2477,2503,2521,2531,2539,2543,2549,2551,2557,2579,2591,2593,2609,2617,2621,2633,2647,2657,2659,2663,2671,2677,2683,2687,2689,2693,2699,2707,2711,2713,2719,2729,2731,2741,2749,2753,2767,2777,2789,2791,2797,2801,2803,2819,2833,2837,2843,2851,2857,2861,2879,2887,2897,2903,2909,2917,2927,2939,2953,2957,2963,2969,2971,2999,3001,3011,3019,3023,3037,3041,3049,3061,3067,3079,3083,3089,3109,3119,3121,3137,3163,3167,3169,3181,3187,3191,3203,3209,3217,3221,3229,3251,3253,3257]);var i=function(r){if(r==1){return 0}var t=[],i,n,o;for(i=n=0;n<a;n++){if(r%e[n]==0){o=e[n];do{t[i]=o;i++;r=r/o}while(r%o==0)}}if(r!=1){t[i]=r;i++}return t};var n=function(r,t,a){var e=r[t];r[t]=r[a];r[a]=e};var o=function(r,t,a,e){var i=r.length/2,n,o;if(e===1){for(n=0,o=0;n<i;n++){t[n]=r[o++];a[n]=-r[o++]}}else{var s=1/i;for(n=0,o=0;n<i;n++){t[n]=r[o++]*s;a[n]=-r[o++]*s}}};var s=function(r,t){var a=r.length,e,i;var n=new Float64Array(2*a);if(t){for(e=0,i=0;e<a;e++){n[i++]=r[e];n[i++]=-t[e]}}else{for(e=0,i=0;e<a;e++,i++){n[i++]=r[e]}}return n};var f=function(r,t,a){var e,i,o,f,u;var g,v,l,h,c,p;var m,x;var w=r.length,M=s(r,t);var y=w<<1;for(u=1,o=1;u<y;u+=2){if(o>u){n(M,o-1,u-1);n(M,o,u)}e=y>>1;while(e>=2&&o>e){o=o-e;e>>=1}o=o+e}var d=2;while(y>d){f=2*d;p=2*Math.PI/(a*d);g=Math.sin(.5*p);l=-2*g*g;h=Math.sin(p);v=1;c=0;for(e=1;e<d;e+=2){for(u=e-1;u<=y-1;u+=f){o=u+d;m=v*M[o]-c*M[o+1];x=v*M[o+1]+c*M[o];M[o]=M[u]-m;M[o+1]=M[u+1]-x;M[u]+=m;M[u+1]+=x}v=(g=v)*l-c*h+v;c=c*l+g*h+c}d=f}return M};var u=function(r,t,a,e){var i=r.length;var n=new Float64Array(i),o=new Float64Array(i);var f=2*Math.PI/i;for(v=0;v<i;v++){n[v]=Math.cos(v*f);o[v]=a*Math.sin(v*f)}var u=s(r,t),g=new Float64Array(2*i);var v,l,h,c,p,m,x;var w=1,M,y=e.length;for(M=0;M<y;M++){p=e[M];m=i/w/p;x=w*p;for(h=0;h<2*i;h++){g[h]=0}for(l=0;l<p;l++){for(c=0;c<x;c++){var d=c*l%x*m;var D=n[d],b=o[d];var S=2*m*c,I=2*m*(l+c%w*p);for(v=0;v<m;v++,S+=2,I+=2){g[S]+=u[I]*D-u[I+1]*b;g[S+1]+=u[I]*b+u[I+1]*D}}}var z=u;u=g;g=z;w*=p}return u};var g=function(r,t,a,e,n){var s=r.length,g=i(s),v=g.length;var l=!n?1:-1,h;if(s>1&&g[v-1]!=2){h=u(r,t,l,g)}else{h=f(r,t,l)}return o(h,a,e,l)};var v=function(t,a){if(t.isreal()){t.toComplex()}var e=new r(t.getSize(),Float64Array,true);var i=t.getRealData(),n=t.getImagData();var o=e.getRealData(),s=e.getImagData();var f=t.getSize(0),u=t.numel()/f;for(var v=0,l=0;v<u;v++,l+=f){var h=i.subarray(l,f+l),c=n.subarray(l,f+l);var p=o.subarray(l,f+l),m=s.subarray(l,f+l);g(h,c,p,m,a)}return e};t.fft=function(){return v(this,false)};r.fft=function(t){return v(r.toMatrix(t),false)};t.fft2=function(){var r=v(this,false);r=v(r.transpose(),false);return r.transpose()};r.fft2=function(t){var a=v(r.toMatrix(t),false);a=v(a.transpose(),false);return a.transpose()};t.ifft=function(){return v(this,true)};r.ifft=function(t){return v(r.toMatrix(t),false)};t.ifft2=function(){return this.fft().transpose().fft().transpose()};r.ifft2=function(t){return r.toMatrix(t).fft().transpose().fft().transpose()}})(Matrix,Matrix.prototype);var root=typeof window==="undefined"?module.exports:window;(function(r){function t(r,t,a,e){"use strict";
this.bins=[r,t];this.mesure=a;if(e){this.baryCenter(e)}}t.prototype.toString=function(){"use strict";return"["+this.bins.toString()+"]"};t.prototype.getCopy=function(){"use strict";var r=new t(this.bins[0],this.bins[1],this.mesure);r.norm=this.norm;r.phase=this.phase;return r};t.prototype.compar=function(r,t){"use strict";return r.mesure<t.mesure};t.prototype.baryCenter=function(r,t){"use strict";var a=r.length;var e=this.bins[0],i=this.bins[1];t=t||a;var n=0,o,s=0;if(i>=e){for(o=e;o<=i;o++){s+=r[o]}for(o=e;o<=i;o++){n+=r[o]*o}n/=s}else{for(o=e;o<a;o++){s+=r[o]}for(o=0;o<=i;o++){s+=r[o]}for(o=e;o<a;o++){n+=r[o]*(o-e)}for(o=0;o<=i;o++){n+=r[o]*(o+a-e)}n/=s;n+=e;n=n>=a?n-a:n}this.norm=s;this.phase=n/t;return this};root.Mode=t})(root);(function(r){"use strict";var t=function(r){var t,a;for(t=1,a=r.length;t<a;t++){r[t]+=r[t-1]}};var a=function(r,t){t=1/t;var a,e;for(a=0,e=r.length;a<e;a++){r[a]*=t}};var e=function(r,t,a){var e,i,n,o,s=r.length;var f=new Float32Array(s*s);for(o=0;o<s;o++){f[o]=r[o]}for(e=1,i=s;e<s;e++,i+=s){if(t){for(n=0,o=i;n<e;n++,o++){f[o]=r[n]+a-r[e-1]}}for(n=e,o=i+n;n<s;n++,o++){f[o]=r[n]-r[e-1]}}return f};var i=function(r,t,a,e,i){var n,o,s,f=Math.sqrt(r.length),u,g;var v=new Float32Array(f*f);var l=new Float32Array(f*f);for(n=0,o=0,u=f*f;o<u;n++,o+=f){if(i){for(s=o,g=o+n;s<g;s++){v[s]=a(r[s],t[s]);l[s]=a(e-r[s],1-t[s])}}for(s=o+n,g=o+f;s<g;s++){v[s]=a(r[s],t[s]);l[s]=a(e-r[s],1-t[s])}}return[v,l]};var n=function(r){var t=new Float32Array(r.length);var a,e=r.length,i=1/e;for(a=0;a<e;a++){t[a]=i}return t};var o=function(r,t,a){var e=Math.log,i=Math.sqrt,n=Math.lerfc;var o=1/e(10),s=e(.5);var f=Number.MIN_VALUE;if(t!==undefined&&a!==undefined){var u=-1/r*o,g=r*t,v=a/t;return function(a,e){if(e<=f){return 0}var o=e*g;var l=o*(t*(1-e)+v);var h=(r*a-o)/i(2*l);return(s+n(h))*u}}else{return function(r,t){if(r<=t||t<=f){return 0}if(r===1){return-e(t)*o}return(r*e(r/t)+(1-r)*e((1-r)/(1-t)))*o}}};var s=function(r,t,a,e){if(e){return(Math.log(r*(r-1))/Math.log(10)+a)/t}else{return(Math.log(r*(r-1)/2)/Math.log(10)+a)/t}};var f=function(r,t,a){if(r>t){if(r>a){return r}else{return a}}else{if(t>a){return t}else{return a}}};var u=function(r,t,a){if(r<t){if(r<a){return r}else{return a}}else{if(t<a){return t}else{return a}}};var g=function(r,t,a){var e,i,n,o,s;var u=new Float32Array(t*t);for(e=0,i=t*t;e<i;e+=t+1){u[e]=r[e]}for(e=t-2;e>=0;e--){for(n=e*t+e+1,o=(e+1)*t;n<o;n++){u[n]=f(u[n+t],u[n-1],r[n])}}if(a){u[(t-1)*t]=f(u[0],u[(t-1)*t+t-1],r[(t-1)*t]);for(s=1,n=(t-1)*t+s;s<t-1;++s,++n){u[n]=f(r[n],u[s],u[n-1])}for(e=(t-2)*t;e>0;e-=t){u[e]=f(r[e],u[e+t-1],u[e+t])}for(e=t-2;e>0;e--){for(n=e*t+1,o=e*t+e;n<o;++n){u[n]=f(r[n],u[n-1],u[n+t])}}}return u};var v=function(r,t,a){var e,i,n,o,s;var u=new Float32Array(t*t);if(a){for(e=t,i=t*t;e<i;e+=t+1){u[e]=r[e]}for(e=2;e<t;++e){for(o=e*t-1,n=e*t+e-2;n>o;--n){u[n]=f(r[n],u[n-t],u[n+1])}}}u[t-1]=r[t-1];for(n=t-2,s=(t-1)*t+n;n>=0;--n,--s){u[n]=f(r[n],u[n+1],u[s])}for(e=1*t,i=t*t;e<i;e+=t){u[e+t-1]=f(u[e-1],u[e],r[e+t-1])}for(e=1;e<t-1;e++){for(n=e*t+t-2,o=e*t+e;n>=o;n--){u[n]=f(u[n-t],u[n+1],r[n])}}return u};var l=function(r,t,a,e,i){var n,o,s,f,u,g,v;var l=new Float32Array(a*a);for(g=0,v=l.length;g<v;++g){l[g]=t[g]>=e?1:0}for(n=a-2;n>=0;n--){for(f=n*a+n+1,u=(n+1)*a;f<u;f++){l[f]+=l[f-1]+l[f+a]}}if(i){l[(a-1)*a]+=l[0]+l[(a-1)*a+a-1];for(f=1;f<a-1;++f){l[(a-1)*a+f]+=l[f]+l[(a-1)*a+f-1]}for(s=a-2,n=s*a,o=0;n>o;n-=a,--s){l[n]+=l[n+a]+l[n+a-1];for(f=n+1,u=n+s;f<u;++f){l[f]+=l[f-1]+l[f+a]}}}for(g=0,v=l.length;g<v;++g){l[g]=l[g]?0:r[g]}return l};var h=function(r,t,a,e,i,n){var o=[];var s,f,u,g,v=Math.sqrt(a.length),l,h;for(s=0,f=0,l=v*v;f<l;s++,f+=v){for(u=t?0:s,g=f+u,h=f+v;g<h;u++,g++){if(a[g]>=n&&e[g]<=a[g]&&i[g]<=a[g]){o.push(new Mode(s,u,a[g],r))}}}return o.sort(Mode.prototype.compar)};var c=function(r,f,u,g,v,l,h){var c=r.length;var p=new Float32Array(r);f=f===undefined?false:f;u=u===undefined?0:u;h=h===undefined?n(r):new Float32Array(h);t(h);t(p);var m=p[c-1];g=g===undefined?m:g;a(h,h[c-1]);a(p,g);var x=e(h,f,1);var w,M,y;if(g&&v&&l){w=e(p,f,m/g);M=o(g,v,l);y=i(w,x,M,m/g,f)}else{w=e(p,f,1);M=o(g,v,l);y=i(w,x,M,1,f)}var d=s(c,g,u,f);var D=y[0],b=y[1];return{Hmod:D,Hgap:b,thresh:d}};var p=function(r,t,a,e,i,n,o){var s=c(r,t,a,e,i,n,o);var f=l(s.Hgap,s.Hmod,r.length,s.thresh,t);var u=v(f,r.length,t);var p=g(f,r.length,t);var m=h(r,t,f,u,p,s.thresh);var x=l(s.Hmod,s.Hgap,r.length,s.thresh,t);var w=v(x,r.length,t);var M=g(x,r.length,t);var y=h(r,t,x,w,M,s.thresh);return{modes:y,gaps:m}};var m=function(r,t,a,e,i,n,o){var s=c(r,t,a,e,i,n,o);var f=l(s.Hmod,s.Hgap,r.length,s.thresh,t);var u=v(f,r.length,t);var p=g(f,r.length,t);var m=h(r,t,f,u,p,s.thresh);return m};var x=function(r,t,a,e,i,n,o){var s=c(r,t,a,e,i,n,o);var f=l(s.Hgap,s.Hmod,r.length,s.thresh,t);var u=v(f,r.length,t);var p=g(f,r.length,t);var m=h(r,t,f,u,p,s.thresh);return m};Matrix.prototype.getModesAndGaps=function(r,t,a,e,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return p(o,r,t,a,e,i,n)};Matrix.getModesAndGaps=function(r,t,a,e,i,n,o){r=Matrix.toMatrix(r);return r.getModesAndGaps(t,a,e,i,n,o)};Matrix.prototype.getModes=function(r,t,a,e,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return m(o,r,t,a,e,i,n)};Matrix.getModes=function(r,t,a,e,i,n,o){r=Matrix.toMatrix(r);return r.getModes(t,a,e,i,n,o)};Matrix.prototype.getGaps=function(r,t,a,e,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return x(o,r,t,a,e,i,n)};Matrix.getGaps=function(r,t,a,e,i,n,o){r=Matrix.toMatrix(r);return r.getGaps(t,a,e,i,n,o)};if(typeof window!=="undefined"){root.extractModes=m;root.extractModes=x;root.extravctModesAndGaps=p}})(Matrix);function getHistograms(r,t,a,e,i,n){"use strict";var o=0,s=0,f=0;var u,g;var v,l,h,c;var p=Math.floor,m=1/(i-e),x;v=new Float32Array(a);if(t){l=new Float32Array(a);if(n){for(u=0,g=r.length;u<g;u++){x=p((r[u]-e)*m*a);x=x<0?a+x%a:x%a;l[x]+=t[u];v[x]++;s+=t[u];o++}s/=o;for(u=0,g=r.length;u<g;u++){h=t[u]-s;f+=h*h}f=f/(o-1)}else{for(u=0,g=r.length;u<g;u++){c=r[u];if(c<e||c>i){continue}x=p((r[u]-e)*m*a);l[x]+=t[u];v[x]++;s+=t[u];o++}s/=o;for(u=0,g=r.length;u<g;u++){c=r[u];if(c<e||c>i){continue}h=t[u]-s;f+=h*h}f=f/(o-1)}}else{if(n){for(u=0,g=r.length;u<g;u++){x=p((r[u]-e)*m*a);x=x<0?a+x%a:x%a;v[x]++;o++}}else{for(o=0,u=0,g=r.length;u<g;u++){x=p((r[u]-e)*m*a);if(x<0||x>a){continue}v[x]++;o++}}}return{histw:l,hist:v,mu:s,sigma:f,M:o}}(function(r,t){"use strict";var a=function(r){var t=r.getSize(0),a=r.getSize(1),e=r.getData(),i=[];for(var n=0,o=0;n<a;n++,o+=t){i[n]=e.subarray(o,t+o)}return i};var e=function(r){var t=r.getSize(0),a=r.getSize(1);var e=r.getImagData(),i=[];for(var n=0,o=0;n<a;n++,o+=t){i[n]=e.subarray(o,t+o)}return i};var i=function(t,e,i){var n=Math.min(t.getSize(1),i);var o=new r([e,i]);var s=a(o);var f=a(t);for(var u=0;u<n;u++){s[u].set(f[u].subarray(0,e))}return o};var n=function(t,i,n){var o=Math.min(t.getSize(1),n);var s=new r([i,n],undefined,true);var f=a(s);var u=e(s);var g=a(t);var v=e(t);for(var l=0;l<o;l++){f[l].set(g[l].subarray(0,i));u[l].set(v[l].subarray(0,i))}return s};var o=function(r,t,a){var e=r[t];r[t]=r[a];r[a]=e};var s=function(r,t,a,e){e.set(r[t]);r[t].set(r[a]);r[a].set(e)};var f=function(r,t){var a,e,i;i=r[t];for(a=t+1,e=r.length;a<e;a++){if(r[a]>i){t=a;i=r[a]}}return t};var u=function(r,t){var a,e,i=0;for(a=t,e=r.length;a<e;a++){i+=r[a]}return Math.sqrt(i)};var g=function(r,t){var a,e=r.length,i=new Array(e);for(a=0;a<e;a++){i[a]=r[a][t]}return i};var v=function(r,t,a){for(var e=0,i=r.length;e<i;e++){r[e][t]=a[e]}};var l=function(r,t,a,e,i,n,o){for(var s=0;s<t;s++){var f=r[s];for(var u=0,g=e;g<i;g++){u+=f[g]*a[g]}f[n]-=u;f[n]*=o}};var h=function(r,t,a,e,i,n){var o,s,f,u,g,v,l;var h=new Float64Array(i);for(o=0;o<e;o++){for(s=0,u=o;s<i;s++,u+=e){h[s]=r[u]}for(g=o,f=0;f<n;g+=e,f++){v=t[f];for(l=0,s=0;s<i;s++){l+=h[s]*v[s]}a[g]=l}}};var c=function(r,t,a,e,i,n,o,s){var f,u,g,v,l,h,c,p,m,x;var w=new Float64Array(o);for(f=0;f<n;f++){for(u=0,v=f;u<o;u++,v+=n){w[u]=r[v]}for(l=f,g=0;g<s;l+=n,g++){h=t[g];c=a[g];for(p=0,m=0,u=0;u<o;u++){x=w[u];p+=x*h[u];m+=x*c[u]}e[l]=p;i[l]=m}}};var p=function(r,t,a,e,i,n,o,s){var f,u,g,v,l,h,c,p,m;var x=new Float64Array(o);var w=new Float64Array(o);for(f=0;f<n;f++){for(u=0,v=f;u<o;u++,v+=n){x[u]=r[v];w[u]=t[v]}for(g=0,l=f;g<s;g++,l+=n){h=a[g];for(c=0,p=0,u=0;u<o;u++){m=h[u];c+=x[u]*m;p+=w[u]*m}e[l]=c;i[l]=p}}};var m=function(t,a,e,i,n,o,s,f,u){var g,v,l,h,c,p,m,x,w,M,y,d,D;var b=new r.dataType(f);var S=new r.dataType(f);for(g=0;g<s;g++){for(v=0,h=g;v<f;v++,h+=s){b[v]=t[h];S[v]=a[h]}for(c=g,l=0;l<u;c+=s,l++){p=e[l];m=i[l];for(x=0,w=0,v=0;v<f;v++){M=b[v];y=S[v];d=p[v];D=m[v];x+=M*d-y*D;w+=M*D+y*d}n[c]=x;o[c]=w}}};var x=function(r,t,e,i){var n=t.getView();var o=n.getSize(0),s=n.getSize(1),f=n.getStep(1);var u=Math.min(o,s);var g=Tools.checkType(t.getDataType());var v=e.getView();var h=v.getSize(1);var c=a(e);var p=t.getData();var m,x;var w,M;var y,d,D;var b=new g(u);var S=r?0:u-1;y=r?u:-1;var I=r?1:-1;var z=r?f+1:-f-1;for(m=S,M=m+m*f;m!==y;m+=I,M+=z){var R=i===undefined?p[M]:i[m];var E=1/R;var T=r?0:m+1;d=r?m+1:u;var L=r?0:m;var C=r?m:M;D=r?M:m+u*f;for(x=L,w=C;w<D;x++,w+=f){b[x]=p[w]}l(c,h,b,T,d,m,E)}};var w=function(r,t,i,n){var o=t.getView();var s=o.getSize(0),f=o.getSize(1),u=o.getStep(1);var g=Math.min(s,f);var v=Tools.checkType(t.getDataType());var l=i.getView();var h=l.getSize(1);var c=a(i);var p=e(i);var m=t.getData();var x,w,M,y;var d,D;var b,S,I;var z=r?0:g-1;b=r?g:-1;var R=r?1:-1;var E=r?u+1:-u-1;var T,L;var C=new v(g);for(x=z,D=x+x*u;x!==b;x+=R,D+=E){var B=n===undefined?m[D]:n[x];var A=1/B;var Y=r?0:x+1;S=r?x+1:g;var G=r?0:x;var k=r?x:D;I=r?D:x+g*u;for(w=G,d=k;d<I;w++,d+=u){C[w]=m[d]}for(y=0;y<h;y++){var q=c[y];var V=p[y];for(T=0,L=0,M=Y;M<S;M++){var _=C[M];T+=q[M]*_;L+=V[M]*_}q[x]-=T;V[x]-=L;q[x]*=A;V[x]*=A}}};var M=function(r,t,i,n,o){var s=t.getView();var f=s.getSize(0),u=s.getSize(1),g=s.getStep(1);var v=Math.min(f,u);var l=Tools.checkType(t.getDataType());var h=i.getView();var c=h.getSize(1);if(i.isreal()){i.toComplex()}var p=t.getRealData(),m=t.getImagData();var x=a(i),w=e(i);var M,y,d,D;var b,S;var I,z,R;var E,T,L;E=r?0:v-1;I=r?v:-1;T=r?1:-1;L=r?g+1:-g-1;var C=new l(v),B=new l(v);var A,Y,G,k,q,V;for(M=E,S=M+M*g;M!==I;M+=T,S+=L){var _=n===undefined?p[S]:n[M];var F=o===undefined?m[S]:o[M];var X=1/(_*_+F*F);var Z=r?0:M+1;z=r?M+1:v;var U=r?0:M;var N=r?M:S;R=r?S:M+v*g;for(y=U,b=N;b<R;y++,b+=g){C[y]=p[b];B[y]=m[b]}for(D=0;D<c;D++){var H=x[D];var O=w[D];for(A=0,Y=0,d=Z;d<z;d++){G=H[d];k=O[d];q=C[d];V=B[d];A+=G*q-k*V;Y+=k*q+G*V}G=H[M]-A;k=O[M]-Y;H[M]=(G*_+k*F)*X;O[M]=(k*_-G*F)*X}}};var y=function(r,t,a,e,i){if(t.isreal()){if(a.isreal()){x(r,t,a,e)}else{w(r,t,a,e)}}else{M(r,t,a,e,i)}return a};var d=function(r,t){var a,e,i,n,o,s,f;for(a=0;a<t;a++){n=r[a];for(s=0,e=0;e<a;e++){s+=n[e]*n[e]}if(n[a]-s<0){throw new Error("Matrix.chol: Input must be positive definite.")}n[a]=Math.sqrt(n[a]-s);f=1/n[a];for(e=a+1;e<t;e++){n[e]=0}for(i=a+1;i<t;i++){o=r[i];for(s=0,e=0;e<a;e++){s+=o[e]*n[e]}o[a]-=s;o[a]*=f}}};var D=function(r,t,a){var e,i,n,o;var s,f,u,g,v,l;var h,c,p,m;for(h=0;h<a;h++){e=r[h];i=t[h];for(s=0,c=0;c<h;c++){v=e[c];l=i[c];s+=v*v+l*l}if(e[h]-s<0){throw new Error("Matrix.chol: Input must be positive definite.")}if(i[h]!==0){throw new Error("Matrix.chol: Diagonal must be real positive.")}e[h]=Math.sqrt(e[h]-s);i[h]=0;m=1/(e[h]*e[h]);for(c=h+1;c<a;c++){e[c]=0;i[c]=0}for(p=h+1;p<a;p++){n=r[p];o=t[p];for(s=0,f=0,c=0;c<h;c++){u=n[c];g=o[c];v=e[c];l=i[c];s+=u*v+g*l;f+=g*v-u*l}n[h]-=s;o[h]-=f;u=n[c];g=o[c];v=e[c];l=i[c];n[h]=(u*v+g*l)*m;o[h]=(g*v-u*l)*m}}};var b=function(r,t,a,e){var i,n,s,f=Math.abs,u=1;for(s=0;s<a;s++){var g=r[s];var v=s;for(i=s+1;i<t;i++){if(f(g[i])>f(g[v])){v=i}}if(v!==s){for(n=0;n<a;n++){o(r[n],v,s)}o(e,v,s);u=-u}var l=1/g[s];for(i=s+1;i<t;i++){g[i]*=l}for(n=s+1;n<a;n++){var h=r[n];l=h[s];for(i=s+1;i<t;i++){h[i]-=g[i]*l}}}};var S=function(r){var t=r.getCopy();var a=t.getView();var e=a.getStep(1),i=a.getSize(0),n=a.getSize(1);var s,f,u,g,v;var l=Tools.checkType(r.getDataType());var h=new l(r.getSize(0)),c=1;for(u=0;u<i;u++){h[u]=u}if(t.isreal()){var p=t.getData(),m=[];for(s=0,f=0;s<n;f+=e,s++){m[s]=p.subarray(f,i+f)}b(m,i,n,h)}else{var x=t.getRealData(),w=[],M,y,d;var D=t.getImagData(),S=[],I,z,R;for(s=0,f=0;s<n;f+=e,s++){w[s]=x.subarray(f,i+f);S[s]=D.subarray(f,i+f)}var E,T,L,C,B;for(s=0;s<n;s++){M=w[s];I=S[s];v=s;for(u=s+1;u<i;u++){T=M[u];L=I[u];C=M[v];B=I[v];if(T*T+L*L>C*C+B*B){v=u}}if(v!==s){for(g=0;g<n;g++){o(w[g],v,s);o(S[g],v,s)}o(h,v,s);c=-c}d=M[s];R=I[s];E=d*d+R*R;d=d/E;R=-R/E;for(u=s+1;u<i;u++){T=M[u];L=I[u];M[u]=T*d-L*R;I[u]=T*R+L*d}for(g=s+1;g<n;g++){y=w[g];z=S[g];d=y[s];R=z[s];for(u=s+1;u<i;u++){T=M[u];L=I[u];y[u]-=T*d-L*R;z[u]-=L*d+T*R}}}}return{LU:t,piv:h,pivsign:c}};var I=function(r){var t=r.getView(),a=r.getData();var e=t.getSize(0);var i,n,o;for(i=0,n=e*e,o=e+1;i<n;i+=o){if(a[i]===0){return false}}return true};var z=function(t,a){var e,i;var n=t.LU.getSize(0);var o=t.LU.getSize(1);if(n===o){e=t.LU.getCopy();i=t.LU.getCopy()}else if(n<o){e=t.LU.select([],[0,n-1]);i=t.LU.select([0,n-1],[])}else{e=t.LU.select([],[0,o-1]);i=t.LU.select([0,o-1],[])}var s,f;var u,g;var v,l,h;var c;var p,m,x;s=e.getView();f=s.getEnd(0);u=s.getStep(1);g=s.getEnd(1);if(t.LU.isreal()){var w=e.getData();for(l=0,h=0,m=g,l=0;h<m;l++,h+=u){for(c=h,x=l+h;c<x;c++){w[c]=0}w[c]=1}}else{var M=e.getRealData(),y=e.getImagData();for(l=0,h=0,m=g,l=0;h<m;l++,h+=u){for(c=h,x=l+h;c<x;c++){M[c]=0;y[c]=0}M[c]=1;y[c]=0}}s=i.getView();f=s.getEnd(0);u=s.getStep(1);g=s.getEnd(1);if(t.LU.isreal()){var d=i.getData();for(l=0,h=0,m=g,l=0;h<m;l++,h+=u){for(c=l+1+h,x=f+h;c<x;c++){d[c]=0}}}else{var D=i.getRealData(),b=i.getImagData();for(l=0,h=0,m=g,l=0;h<m;l++,h+=u){for(c=l+1+h,x=f+h;c<x;c++){D[c]=0;b[c]=0}}}var S=t.piv;if(a===false){var I=Tools.checkType(e.getDataType());var z=new I(n);for(v=0,p=S.length;v<p;v++){z[S[v]]=v}e=e.select([z]);return[e,i]}a=new r([n,n]);var R=a.getData();s=a.getView();f=s.getEnd(0);u=s.getStep(1);g=s.getEnd(1);for(v=0;v<n;v++){R[v+S[v]*u]=1}return[e,i,a]};var R=function(t,a){var e=S(t);var i=e.LU,n=e.piv;if(!I(i)){throw new Error("Matrix.mldivide: Matrix is singular.")}a=a.select([n]);var o=r.ones(i.getSize(0)).getData();var s=r.zeros(i.getSize(0)).getData();y(true,i,a,o,s);return y(false,i,a)};var E=function(r,t){var a,e=r.length;var i=-Infinity,n;for(a=t;a<e;a++){n=Math.abs(r[a]);if(n>i){i=n}}var o=i!==0?1/i:0;var s=0,f=r[t]*o;for(r[t]=1,a=t+1;a<e;a++){r[a]*=o;s+=r[a]*r[a]}var u=Math.sqrt(f*f+s);var g=f>0?1:-1;var v=f+g*u;var l=v*v;var h=2*l/(s+l);var c=1/v;for(a=t+1;a<e;a++){r[a]*=c}r[t]=-g*u*i;return h};var T=function(r,t,a,e,i){var n,o,s=t.length,f=t[0].length;var u,g;for(o=i;o<s;o++){g=t[o];for(u=g[e],n=e+1;n<f;n++){u+=r[n]*g[n]}u*=a;for(g[e]-=u,n=e+1;n<f;n++){g[n]-=r[n]*u}}};var L=function(r,t,a){var e,i=r.length,n,o;var s=-Infinity,f;for(e=a;e<i;e++){f=Math.abs(r[e])+Math.abs(t[e]);if(f>s){s=f}}var u=s!==0?1/s:0;var g=0,v=r[a]*u,l=t[a]*u;for(r[a]=1,t[a]=0,e=a+1;e<i;e++){r[e]*=u;t[e]*=u;n=r[e];o=t[e];g+=n*n+o*o}var h=Math.sqrt(v*v+l*l+g),c=Math.atan2(l,v);var p=v+h*Math.cos(c),m=l+h*Math.sin(c);var x=p*p+m*m;var w=2*x/(g+x);f=1/(p*p+m*m);var M=p*f,y=-m*f;for(e=a+1;e<i;e++){n=r[e];o=t[e];r[e]=n*M-o*y;t[e]=o*M+n*y}r[a]=-h*s*Math.cos(c);t[a]=-h*s*Math.sin(c);return w};var C=function(r,t,a,e,i,n,o){var s,f;var u,g,v=a.length,l=a[0].length;var h,c;for(g=o;g<v;g++){h=a[g];c=e[g];for(s=h[n],f=c[n],u=n+1;u<l;u++){s+=r[u]*h[u]+t[u]*c[u];f+=r[u]*c[u]-t[u]*h[u]}s*=i;f*=i;for(h[n]-=s,c[n]-=f,u=n+1;u<l;u++){h[u]-=r[u]*s-t[u]*f;c[u]-=t[u]*s+r[u]*f}}};var B=function(r,t,a,e,i){var n,o,s,f=t.length,u=t[0].length;for(o=i;o<u;o++){for(n=t[e][o],s=e+1;s<f;s++){n+=r[s]*t[s][o]}n*=a;for(t[e][o]-=n,s=e+1;s<f;s++){t[s][o]-=r[s]*n}}};var A=function(r,t,a,e,i,n,o){var s,f;var u,g,v=a.length,l=a[0].length;for(u=o;u<l;u++){for(s=a[n][u],f=e[n][u],g=n+1;g<v;g++){s+=r[g]*a[g][u]+t[g]*e[g][u];f+=r[g]*e[g][u]-t[g]*a[g][u]}s*=i;f*=i;for(a[n][u]-=s,e[n][u]-=f,g=n+1;g<v;g++){a[g][u]-=r[g]*s-t[g]*f;e[g][u]-=t[g]*s+r[g]*f}}};var Y=function(r){r=r.getCopy();var t=Tools.checkType(r.getDataType());var i=r.getView();var n=i.getSize(1);var o;var s=new t(n),f=new t(n);if(r.isreal()){var u=a(r);for(o=0;o<n;o++){s[o]=E(u[o],o);T(u[o],u,s[o],o,o+1);if(o<n-2){var l=g(u,o);f[o]=E(l,o+1);v(u,o,l);B(l,u,f[o],o+1,o+1)}}}else{var h=a(r),c=e(r);for(o=0;o<n;o++){s[o]=L(h[o],c[o],o);C(h[o],c[o],h,c,s[o],o,o+1);if(o<n-2){var p=g(h,o);var m=g(c,o);f[o]=L(p,m,o+1);v(h,o,p);v(c,o,m);A(p,m,h,c,f[o],o+1,o+1)}}}return[r,s,f]};var G=function(t){var i=t[1];t=t[0];var n=t.getSize(0),o=t.getSize(1);var s=r.eye(n);var f=s.getView(),u=f.getStep(1);var g,v;if(t.isreal()){var l=a(s);var h=t.getData();for(g=o-1,v=u*g;g>=0;g--,v-=u){var c=h.subarray(v,n+v);T(c,l,i[g],g,g)}}else{s.toComplex();var p=a(s),m=e(s);var x=t.getRealData(),w=t.getImagData();for(g=o-1,v=u*g;g>=0;g--,v-=u){var M=x.subarray(v,n+v);var y=w.subarray(v,n+v);C(M,y,p,m,i[g],g,g)}}return s};var k=function(r){return r[0].triu().tril(1)};var q=function(t){var i=t[2];t=t[0].transpose();var n=t.getSize(0),o=t.getSize(1);var s=r.eye(n);var f=s.getView(),u=f.getStep(1);var g,v;if(t.isreal()){var l=a(s);var h=t.getData();for(g=o-1,v=u*g;g>=0;g--,v-=u){var c=h.subarray(v,n+v);T(c,l,i[g],g+1,g+1)}}else{s.toComplex();var p=a(s),m=e(s);var x=t.getRealData(),w=t.getImagData();for(g=n-3,v=u*g;g>=0;g--,v-=u){var M=x.subarray(v,n+v);var y=w.subarray(v,n+v);C(M,y,p,m,i[g],g+1,g+1)}}return s.transpose()};var V=function(r){return[G(r),k(r),q(r)]};r.golubStep=function(r,t){var a=t11-r;var e=t12;for(var i=0,n=t-1;i<n;i++){}};var _=function(r){var t=r[0].getCopy();var a=t.getView();var e=a.getStep(1),i=a.getEnd(0);var n=a.getSize(0),o=a.getSize(1);var s,f,u,g,v;if(t.isreal()){var l=t.getData();for(s=0,f=0,g=0;s<n;s++,f+=e,g=s+f){for(u=g+1,v=i+f;u<v;u++){l[u]=0}}for(;s<o;s++,f+=e,g=s+f){for(u=g+1,v=i+f;u<v;u++){l[u]=0}}}else{var h=t.getRealData(),c=t.getImagData();for(s=0,f=0,g=0;s<n;s++,f+=e,g=s+f){for(u=g+1,v=i+f;u<v;u++){h[u]=0;c[u]=0}}for(;s<o;s++,f+=e,g=s+f){for(u=g+1,v=i+f;u<v;u++){h[u]=0;c[u]=0}}}return t};var F=function(t){var i=t[1];t=t[0];var n=t.getSize(0),o=t.getSize(1);var s=r.eye(n);var f=s.getView(),u=f.getStep(1);var g,v;if(t.isreal()){var l=a(s);var h=t.getData();for(g=o-1,v=u*g;g>=0;g--,v-=u){var c=h.subarray(v,n+v);T(c,l,i[g],g,g)}}else{s.toComplex();var p=a(s);var m=e(s);var x=t.getRealData(),w=t.getImagData();for(g=o-1,v=u*g;g>=0;g--,v-=u){var M=x.subarray(v,n+v);var y=w.subarray(v,n+v);C(M,y,p,m,i[g],g,g)}}return s};var X=function(t){var a=t[2];var e=a.length;var i=new r([e,e]);var n=i.getView(),o=i.getData();var s=n.getStep(1);var f=e;var u,g;for(u=0,g=0;u<f;u++,g+=s){o[a[u]+g]=1}return i};var Z=function(r,t){var i;var n=2.220446049250313e-16||1.19209289550781e-7;var g=r.getCopy();var v=g.getView();var l=v.getSize(0),h=v.getSize(1);var c,p,m;var x=Tools.checkType(r.getDataType());var w=new x(l);var M=new x(h);var y=new x(h);var d=new x(h),D,b;if(g.isreal()){var S=a(g);if(t){for(p=0;p<h;p++){var I=S[p];for(m=0,c=0;c<l;c++){m+=I[c]*I[c]}M[p]=m;y[p]=p}i=u(M,0)}for(D=0;D<h;D++){if(t){b=f(M,D);if(u(M,D)<=i*n){return[g,d,y,D]}else if(D!==b){s(S,D,b,w);o(M,D,b);o(y,D,b)}}d[D]=E(S[D],D);T(S[D],S,d[D],D,D+1);if(t){for(c=D+1;c<h;c++){M[c]-=S[c][D]*S[c][D]}}}}else{var z=a(g);var R=e(g);if(t){for(p=0;p<h;p++){var B=z[p],A=R[p];for(m=0,c=0;c<l;c++){m+=B[c]*B[c]+A[c]*A[c]}M[p]=m;y[p]=p}i=u(M,0)}for(D=0;D<h;D++){if(t){b=f(M,D);if(u(M,D)<=i*n){return[g,d,y,D+1]}else if(D!==b){s(z,D,b,w);s(R,D,b,w);o(M,D,b);o(y,D,b)}}d[D]=L(z[D],R[D],D);C(z[D],R[D],z,R,d[D],D,D+1);if(t){for(c=D+1;c<h;c++){M[c]-=z[c][D]*z[c][D]+R[c][D]*R[c][D]}}}}return[g,d,y,D]};var U=function(r,t){var o=Z(r,true);var s=o[1];var f=o[2];o=o[0];var u=r.getSize(0),g=r.getSize(1),v=t.getSize(1);var l=Math.min(u,g);t=t.getCopy();var h,c;if(o.isreal()&&t.isreal()){var p=a(t);var m=a(o);for(h=0;h<g;h++){T(m[h],p,s[h],h,0)}y(false,o,t);c=i(t,l,v)}else{if(o.isreal()){o.toComplex()}if(t.isreal()){t.toComplex()}var x=a(t);var w=e(t);var M=a(o);var d=e(o);for(h=0;h<g;h++){C(M[h],d[h],x,w,s[h],h,0)}y(false,o,t);c=n(t,l,v)}var D=new Uint32Array(l);var b,S;for(b=0,S=f.length;b<S;b++){D[f[b]]=b}return c.select([D])};var N=function(r,t){var o=Z(r.ctranspose(),true);var s=o[1];var f=o[2];o=o[0];var u;var g=o.getSize(0),v=o.getSize(1),l=t.getSize(1);var h=Math.min(g,v);var c=new Uint32Array(h);for(var p=0,m=f.length;p<m;p++){c[f[p]]=p}t=t.select([c]);var x=y(true,o.ctranspose(),t);if(o.isreal()&&t.isreal()){x=i(x,g,l);var w=a(x);var M=a(o);for(u=v-1;u>=0;u--){T(M[u],w,s[u],u,0)}}else{if(o.isreal()){o.toComplex()}if(x.isreal()){x.toComplex()}x=n(x,g,l);var d=a(x);var D=e(x);var b=a(o);var S=e(o);for(u=v-1;u>=0;u--){C(b[u],S[u],d,D,s[u],u,0)}}return x};var H=function(r,t){if(r.getSize(0)<r.getSize(1)){return N(r,t)}return U(r,t)};t.mtimes=function(t){t=r.toMatrix(t);if(!this.ismatrix()||!t.ismatrix()){throw new Error("Matrix.mtimes: mtimes is undefined for ND array.")}var i=this.getSize(0);var n=this.getSize(1);var o=t.getSize(1);if(i!==t.getSize(0)){throw new Error("Matrix.mtimes: Matrix sizes must match.")}var s=this.isreal()&t.isreal()?false:true;var f=Tools.checkType(this.getDataType());var u=new r([i,o],f,s);if(this.isreal()){if(t.isreal()){h(this.getData(),a(t),u.getData(),i,n,o)}else{c(this.getData(),a(t),e(t),u.getRealData(),u.getImagData(),i,n,o)}}else{if(t.isreal()){p(this.getRealData(),this.getImagData(),a(t),u.getRealData(),u.getImagData(),i,n,o)}else{m(this.getRealData(),this.getImagData(),a(t),e(t),u.getRealData(),u.getImagData(),i,n,o)}}return u};r.mtimes=function(t,a){return r.toMatrix(t).mtimes(a)};t["*"]=t.mtimes;t.chol=function(r){if(!this.ismatrix()){throw new Error("Matrix.chol: Input must be a matrix.")}if(!this.issquare()){throw new Error("Matrix.chol: Matrix must be square.")}if(r==="lower"){r=true}else if(r==="upper"||r===undefined){r=false}else{throw new Error("Matrix.chol: Invalid parameters.")}var t=this.getCopy();if(t.isreal()){d(a(t),t.getSize(1))}else{D(a(t),e(t),t.getSize(1))}return r?t.ctranspose(t):t};t.inv=function(){return this.mldivide(r.eye(this.getSize()))};t.det=function(){if(!this.issquare()){throw new Error("Matrix.det: Matrix must be square.")}var t=S(this);var a=t.LU;var e,i,n;var o=a.getView();var s=o.getSize(0);if(this.isreal()){var f=t.pivsign;var u=a.getData();for(e=0,i=s*s,n=s+1;e<i;e+=n){f*=u[e]}return new r([1,1],[f])}var g=a.getRealData();var v=a.getImagData();var l=t.pivsign,h=0;for(e=0,i=s*s,n=s+1;e<i;e+=n){l=l*g[e]-h*v[e];h=l*v[e]+h*g[e]}return new r([1,1],[l,h],true)};t.rank=function(){var r=Z(this,true);return r[3]};t.lu=function(){return z(S(this),false)};t.lup=function(){return z(S(this),true)};t.qrp=function(){var r=Z(this,true);return[F(r),_(r),X(r)]};t.qr=function(){var r=Z(this,false);return[F(r),_(r)]};t.mldivide=function(r){if(!this.ismatrix()||!r.ismatrix()){throw new Error("1 Matrix.mldivide: Both arguments must be Matrix.")}if(r.getSize(0)!==this.getSize(0)){throw new Error("2 Matrix.mldivide: Row dimensions must agree.")}return H(this,r.getCopy())};t.mrdivide=function(r){if(!this.ismatrix()||!r.ismatrix()){throw new Error("Matrix.mrdivide: Both arguments must be Matrix.")}if(r.getSize(0)!==this.getSize(0)){throw new Error("Matrix.mrdivide: Row dimensions must agree.")}return H(r.ctranspose(),this.ctranspose()).ctranspose()};t.bidiag=function(){var r=Y(this.getCopy());return V(r)};t.svd=function(){var t;var a=Math.pow(2,-52);var e=1e-64/a;var i=50;var n=0,o=0,s=0,f=0,u=0;var g=this.toArray();var v=g.length;var l=g[0].length;if(v<l){throw"Matrix.svd: Need more rows than columns"}var h=new Array(l);var c=new Array(l);for(o=0;o<l;o++){h[o]=0;c[o]=0}var p=r.zeros(l).toArray();var m=function(r,t){r=Math.abs(r);t=Math.abs(t);if(r>t){return r*Math.sqrt(1+t*t/r/r)}else if(t===0){return r}return t*Math.sqrt(1+r*r/t/t)};var x=0,w=0,M=0,y=0,d=0,D=0,b=0;for(o=0;o<l;o++){h[o]=w;b=0;u=o+1;for(s=o;s<v;s++){b+=g[s][o]*g[s][o]}if(b<=e){w=0}else{x=g[o][o];w=Math.sqrt(b);if(x>=0){w=-w}M=x*w-b;g[o][o]=x-w;for(s=u;s<l;s++){b=0;for(f=o;f<v;f++){b+=g[f][o]*g[f][s]}x=b/M;for(f=o;f<v;f++){g[f][s]+=x*g[f][o]}}}c[o]=w;b=0;for(s=u;s<l;s++){b=b+g[o][s]*g[o][s]}if(b<=e){w=0}else{x=g[o][o+1];w=Math.sqrt(b);if(x>=0){w=-w}M=x*w-b;g[o][o+1]=x-w;for(s=u;s<l;s++){h[s]=g[o][s]/M}for(s=u;s<v;s++){b=0;for(f=u;f<l;f++){b+=g[s][f]*g[o][f]}for(f=u;f<l;f++){g[s][f]+=b*h[f]}}}d=Math.abs(c[o])+Math.abs(h[o]);if(d>y){y=d}}for(o=l-1;o!=-1;o+=-1){if(w!==0){M=w*g[o][o+1];for(s=u;s<l;s++){p[s][o]=g[o][s]/M}for(s=u;s<l;s++){b=0;for(f=u;f<l;f++){b+=g[o][f]*p[f][s]}for(f=u;f<l;f++){p[f][s]+=b*p[f][o]}}}for(s=u;s<l;s++){p[o][s]=0;p[s][o]=0}p[o][o]=1;w=h[o];u=o}for(o=l-1;o!=-1;o+=-1){u=o+1;w=c[o];for(s=u;s<l;s++){g[o][s]=0}if(w!==0){M=g[o][o]*w;for(s=u;s<l;s++){b=0;for(f=u;f<v;f++){b+=g[f][o]*g[f][s]}x=b/M;for(f=o;f<v;f++){g[f][s]+=x*g[f][o]}}for(s=o;s<v;s++){g[s][o]=g[s][o]/w}}else{for(s=o;s<v;s++){g[s][o]=0}}g[o][o]+=1}a=a*y;var S;for(f=l-1;f!=-1;f+=-1){for(S=0;S<i;S++){var I=false;for(u=f;u!=-1;u+=-1){if(Math.abs(h[u])<=a){I=true;break}if(Math.abs(c[u-1])<=a){break}}if(!I){n=0;b=1;var z=u-1;for(o=u;o<f+1;o++){x=b*h[o];h[o]=n*h[o];if(Math.abs(x)<=a){break}w=c[o];M=m(x,w);c[o]=M;n=w/M;b=-x/M;for(s=0;s<v;s++){d=g[s][z];D=g[s][o];g[s][z]=d*n+D*b;g[s][o]=-d*b+D*n}}}D=c[f];if(u===f){if(D<0){c[f]=-D;for(s=0;s<l;s++){p[s][f]=-p[s][f]}}break}if(S>=i-1){throw"Error: no convergence."}y=c[u];d=c[f-1];w=h[f-1];M=h[f];x=((d-D)*(d+D)+(w-M)*(w+M))/(2*M*d);w=m(x,1);if(x<0){x=((y-D)*(y+D)+M*(d/(x-w)-M))/y}else{x=((y-D)*(y+D)+M*(d/(x+w)-M))/y}n=1;b=1;for(o=u+1;o<f+1;o++){w=h[o];d=c[o];M=b*w;w=n*w;D=m(x,M);h[o-1]=D;n=x/D;b=M/D;x=y*n+w*b;w=-y*b+w*n;M=d*b;d=d*n;for(s=0;s<l;s++){y=p[s][o-1];D=p[s][o];p[s][o-1]=y*n+D*b;p[s][o]=-y*b+D*n}D=m(x,M);c[o-1]=D;n=x/D;b=M/D;x=n*w+b*d;y=-b*w+n*d;for(s=0;s<v;s++){d=g[s][o-1];D=g[s][o];g[s][o-1]=d*n+D*b;g[s][o]=-d*b+D*n}}h[u]=0;h[f]=x;c[f]=y}}for(o=0;o<c.length;o++){if(c[o]<a){c[o]=0}}for(o=0;o<l;o++){for(s=o-1;s>=0;s--){if(c[s]<c[o]){n=c[s];c[s]=c[o];c[o]=n;for(f=0;f<g.length;f++){t=g[f][o];g[f][o]=g[f][s];g[f][s]=t}for(f=0;f<p.length;f++){t=p[f][o];p[f][o]=p[f][s];p[f][s]=t}o=s}}}return[r.fromArray(g).transpose(),r.diag(r.toMatrix(c)),r.fromArray(p).transpose()]}})(Matrix,Matrix.prototype);