/**
 * This program is free software: you can redistribute it and/or modify    
 * it under the terms of the GNU General Public License as published by        
 * the Free Software Foundation, either version 3 of the License, or 
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * 
 * @author Baptiste Mazin     <baptiste.mazin@telecom-paristech.fr> 
 * @author Guillaume Tartavel <guillaume.tartavel@telecom-paristech.fr> 
 */
function Matrix(t,r,e,a){"use strict";var i;var n,o,s;var l=false;var f;var g;var u;var h;var c;var p;var m=function(r){if(r instanceof Matrix){r=r.getCopy().getData()}t=Tools.checkSize(r);i=new MatrixView(t);f=i.getIndex;g=i.getDimLength;u=i.getLength;h=i.getSize;p=i.displayView;c=i.getIterator.bind(i);this.getIndex=f;this.getDimLength=g;this.getLength=u;this.getSize=h;this.displayView=p;this.getIterator=c}.bind(this);var v=function(t,e,f){m(t);var g=Tools.isSet(f)?f:false;if(!Tools.isBoolean(g)){throw new Error('Matrix: "complex" argument must be a boolean')}if(Tools.isArrayLike(e)){n=e instanceof Array?new Matrix.dataType(e):e;r=e.constructor;if(n.length!==i.getLength()*(g?2:1)){throw new Error("Matrix: data and size are incompatible.")}if(g){o=n.subarray(0,i.getLength());s=n.subarray(i.getLength())}}else{r=Tools.checkType(e);if(typeof e==="string"){switch(e.toLowerCase()){case"logical":case"bool":case"boolean":l=true;break;default:l=false}}var u=i.getLength();if(!g){n=new r(u)}else{n=new r(2*u);o=n.subarray(0,u);s=n.subarray(u)}}if(Tools.isSet(a)){if(!Tools.isBoolean(a)){throw new Error('Matrix: "bool" argument must be a boolean')}if(a){l=true}}return this}.bind(this);this.initialize=v;var x=function(){if(!Tools.isSet(s)){return true}var t,r;for(t=0,r=s.length;t<r;t++){if(s[t]!==0){return false}}n=o;o=undefined;s=undefined;return true};var M=function(){return u()===1};var w=function(){return n.length===0};var y=function(t,r){t=Tools.isArrayLike(t)?f(t):t;if(!Tools.isSet(r)){return x()?n[t]:[o[t],s[t]]}if(!x()){n[t]=r}else{o[t]=r[0];s[t]=r[1]}return r}.bind(this);var D=function(){return n};var d=function(){if(!x()){throw new Error("Matrix.getDataScalar: Data must be real.")}if(u()!==1){throw new Error("Matrix.getDataScalar: Data length must be 1.")}return n[0]};var b=function(){if(!Tools.isSet(s)){throw new Error("Matrix.getRealData: expected a complex Matrix.")}return o};var I=function(){if(!Tools.isSet(s)){throw new Error("Matrix.getImagData: expected a complex Matrix.")}return s};var S=function(t){if(!x()){throw new Error("Matrix.toComplex: expected a non-complex Matrix.")}var r=new n.constructor(n.length*2);o=r.subarray(0,n.length);s=r.subarray(n.length);o.set(n);if(t instanceof Matrix){Tools.checkSizeEquals(this,t,Matrix.ignoreTrailingDims);if(!t.isreal()){throw new Error("Matrix.toComplex: imaginary part cannot be complex.")}t=t.getData()}if(Tools.isArrayLike(t)){if(t.length!==n.length){throw new Error("Matrix.toComplex: imaginary part has invalid length.")}s.set(t)}else if(Tools.isSet(t)){throw new Error("Matrix.toComplex: invalid argument.")}n=r;return this}.bind(this);var E=function(){return l?"logical":n.constructor.name};var z=function(){return new MatrixView(i)};this.value=y;this.getData=D;this.getDataScalar=d;this.getRealData=b;this.getImagData=I;this.getDataType=E;this.getView=z;this.isreal=x;this.isscalar=M;this.isempty=w;this.toComplex=S;var T=function(){var t=Array.prototype.slice.apply(arguments);if(Tools.isArrayLike(t[0])){t=t[0]}if(t.length===0){t=this.getLength()}t=Tools.checkSize(t,"column");var r,e,a=1;for(r=0,e=t.length;r<e;r++){a*=t[r]}if(a!==this.getLength()){throw new Error("Matrix.reshape: number of elements must not change.")}m(t);return this}.bind(this);this.reshape=T;var A=function(){var r=!x();var e=n instanceof Array?n.slice():new n.constructor(n);return new Matrix(t,e,r,l)};this.getCopy=A;return v(t,r,e)}Matrix.dataType=Float64Array;Matrix.ignoreTrailingDims=true;if(typeof window==="undefined"){module.exports.Matrix=Matrix}(function(t,r){"use strict";r.toArray=function(){var t="Matrix.toArray: function only available for ";if(this.ndims()>2){throw new Error(t+"2D matrix.")}var r;if(this.isreal()){r=this.getData()}else{throw new Error(t+"for real matrix.")}var e=this.getView();var a=e.getFirst(0),i=e.getStep(0),n=e.getEnd(0);var o=e.getFirst(1),s=e.getStep(1),l=e.getEnd(1);var f,g,u,h,c,p;for(c=[],f=a,g=n;f!==g;f+=i){for(p=[],u=f+o,h=f+l;u!==h;u+=s){p.push(r[u])}c.push(p)}return c};t.fromArray=function(r){var e,a;if(r[0].length){if(r[0][0].length){throw new Error("Matrix.fromArray: Only work with Array up to 2 dimensions.")}e=[r[0].length,r.length];a=[];var i,n;for(i=0,n=r.length;i<n;i++){var o=Array.prototype.slice.apply(r[i]);a=a.concat(o)}}else{e=r.length;a=r}return new t(e,a)};r.dlmwrite=function(t){if(t!==undefined&&typeof t!=="string"){throw new Error("Matrix.dlmread: Wrong delimiter specification.")}if(this.ndims()>2){throw new Error("Matrix.dlmwrite: function only available for 2D matrix.")}var r=this.getView(),e=this.getData();var a=r.getStep(1),i=r.getEnd(1);var n=r.getSize(0);var o,s,l,f;var g="";for(o=0,l=n;o<l;o++){for(s=o,f=o+i-a;s<f;s+=a){g+=e[s]+t}g+=e[s]+"\n"}return g};t.dlmread=function(r,e){if(e!==undefined&&typeof e!=="string"){throw new Error("Matrix.dlmread: Wrong delimiter specification.")}r=r.split("\n");if(r[r.length-1]===""){r.pop()}var a,i,n,o;var s=[];var l=/[\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?/g;for(a=0,i=r.length;a<i;a++){var f=e?r[a].split(e):r[a].match(l);for(n=0,o=f.length;n<o;n++){f[n]=parseFloat(f[n])}s.push(f)}return t.fromArray(s).transpose()};r.toMatlab=function(){if(this.ndims()>2){throw new Error("Matrix.toMatlab: function available only for 2D matrix.")}var t=function(t,r){var e=t.toString();if(typeof r==="number"){e+=r>0?" + ":" - ";e+=Math.abs(r).toString();e+=" * i"}return e};var r="",e,a,i;if(this.isreal()){e=this.getData()}else{a=this.getRealData();i=this.getImagData()}var n=this.getView();var o=n.getFirst(0),s=n.getStep(0),l=n.getEnd(0);var f=n.getFirst(1),g=n.getStep(1),u=n.getEnd(1);var h,c,p,m;r+="[";for(h=o,c=l;h!==c;h+=s){if(h!==o){r+=" "}if(this.isreal()){for(p=h+f,m=h+u;p!==m;p+=g){r+=t(e[p]);if(p!==m-g){r+=","}}}else{for(p=h+f,m=h+u;p!==m;p+=g){r+=t(a[p],i[p]);if(p!==m-g){r+=","}}}if(h!==c-s){r+=";"}}r+="]";return r};r.toString=function(t,r){var e,a="";if(t===undefined){e=4}else if(typeof t==="string"){a=t;e=4}else{e=t}if(typeof r==="string"){a=r}var i=e+5;var n=function(t,r){var a="";if(typeof t==="number"){if(t%1===0){a+=t}else{a+=t.toFixed(e)}while(a.length<i){a=" "+a}}else{a+=t.toString()}if(r===undefined){return a}if(r===0){while(a.length<2*i+1){a=a+" "}return a}if(typeof r==="number"){a+=r>0?" + ":" - ";if(t%1===0){a+=Math.abs(r)}else{a+=Math.abs(r).toFixed(e)}while(a.length<i){a=" "+a}}else{a+=r.toString()}a+="i";return a};var o,s,l="",f;if(this.isempty()){l+="Empty array: ";f=this.getSize();for(o=0,s=f.length-1;o<s;o++){l+=f[o]+"-by-"}l+=f[o];return l}if(this.getLength()>1e4){l+="Array: ";f=this.getSize();for(o=0,s=f.length-1;o<s;o++){l+=f[o]+"-by-"}l+=f[o];return l}var g,u,h;if(this.isreal()){g=this.getData()}else{u=this.getRealData();h=this.getImagData()}var c=this.getIterator(2);var p=c.iterator,m=c.begin,v=c.isEnd;var x=this.getSize(2);var M=this.getView();var w=M.getFirst(0),y=M.getStep(0),D=M.getEnd(0);var d=M.getFirst(1),b=M.getStep(1),I=M.getEnd(1);var S,E,z,T;for(o=m();!v();o=p()){l+=a;if(x>1){l+="(:,:,"+c.getPosition()+") = [\n"}else{l+=" = [\n"}for(S=o+w,E=o+D;S!==E;S+=y){l+="	";if(this.isreal()){for(z=S+d,T=S+I;z!==T;z+=b){l+=n(g[z])+" "}}else{for(z=S+d,T=S+I;z!==T;z+=b){l+=n(u[z],h[z])+" "}}l+="\n"}l+="]\n"}return l};t.toMatrix=function(r,e){if(r instanceof t){return r}if(r.constructor===Number){r=[r]}var a=Array.prototype.concat.apply([],r);var i=false,n;if(Tools.isArrayOfBooleans(a)){i=true}else if(!Tools.isArrayOfNumbers(a)){throw new Error("Matrix.toMatrix: Array must only contain numbers or booleans.")}if(a.length===1){n=1}else if(a.length===r.length){n=[a.length,1]}else{n=[];var o=r;while(o.length){n.push(o.length);o=o[0]}n=n.reverse()}return new t(n,a,false,i)};r.display=function(t,r){console.log(this.toString(t,r));return this}})(Matrix,Matrix.prototype);(function(t,r){"use strict";r.extractViewFrom=function(r){if(this.isreal()){var e=this.getData();return new t(r.getSize(),r.extractFrom(e))}var a=new t(r.getSize(),this.getDataType(),true);r.extractFrom(this.getRealData(),a.getRealData());r.extractFrom(this.getImagData(),a.getImagData());return a};r.extractViewTo=function(t,r){if(this.isreal()&&r.isreal()){t.extractTo(this.getData(),r.getData());return r}if(this.isreal()){t.extractTo(this.getData(),r.getRealData());return r}if(r.isreal()){r.toComplex()}t.extractTo(this.getRealData(),r.getRealData());t.extractTo(this.getImagData(),r.getImagData());return r};var e=function(t){t=Array.prototype.slice.apply(t);var r,e;for(r=0,e=t.length;r<e;r++){t[r]=t[r]?true:false}return t};r.selectView=function(r){r=Array.prototype.slice.apply(r);var a=Tools,i=a.checkSizeEquals,n=t.ignoreTrailingDims;var o=r[0];var s,l;if(o instanceof t&&r.length===1){var f=o.getData();var g=new MatrixView([this.getLength(),1]);if(o.islogical()&&i(this.getSize(),o.getSize(),n)){return g.selectBooleanDimension(0,f)}if(a.isArrayOfNumbers(f,0,this.numel(0)-1)){return g.selectIndicesDimension(0,f)}throw new Error("Matrix.selectView: Invalid Matrix selection.")}for(s=0,l=r.length;s<l;s++){o=r[s];if(o instanceof t){if(o.isvector()){if(o.islogical()){o=e(o.getData())}else{o=[o.getData()]}}else{throw new Error("Matrix.selectView: Invalid Matrix selection:",o)}}r[s]=o}return MatrixView.prototype.select.apply(this.getView(),r)};r.get=function(){if(arguments.length===0){return this.getCopy()}var r=this.selectView(arguments);if(arguments.length===1&&arguments[0]instanceof t){if(r.getLength()===arguments[0].getLength()){return this.extractViewFrom(r).reshape(arguments[0].getSize())}return this.extractViewFrom(r)}return this.extractViewFrom(r)};r.set=function(){var r=Array.prototype.slice.apply(arguments);var e=t.toMatrix(r.pop());var a=this.selectView(r);if(r.length===1&&r[0]instanceof t){var i=e.getSize(),n=r[0].getSize();var o=e.reshape().extractViewTo(a,this.reshape());e.reshape(i);return o.reshape(n)}return e.extractViewTo(a,this)};t.set=function(){var e=Array.prototype.shift.apply(arguments);if(!(e instanceof t)){throw new Error("Matrix.set: Matrix to modify must be provided.")}return r.set.apply(e.getCopy(),arguments)};t.reshape=function(){var r=Array.prototype.shift.apply(arguments);if(!(r instanceof t)){throw new Error("Matrix.reshape: Matrix to modify must be provided.")}r=r.getCopy();return r.reshape.apply(r,arguments)};r.repmat=function(){var r=Tools.checkSize(arguments,"square");var e,a=this.getView();var i=this.size();var n,o=1,s=[];for(e=0,n=Math.max(i.length,r.length);e<n;e++){s[e]=(i[e]||1)*(r[e]||1);o*=s[e]}var l=new t(s,this.getDataType(),!this.isreal());var f=l.getView();var g,u,h,c;if(this.isreal()){h=l.getData();g=this.getData()}else{h=l.getRealData();c=l.getImagData();g=this.getRealData();u=this.getImagData()}for(e=0,n=i.length;e<n;e++){f.selectDimension(e,[0,i[e],-1])}var p=f.getIterator(0);var m,v=p.iterator,x=p.begin,M=p.isEnd;for(m=x();!M();m=v()){var w=l.getView(),y=p.getPosition();for(e=0,n=r.length;e<n;e++){var D=i[e]||1,d=y[e]*D;w.selectDimension(e,[d,1,d+D-1])}a.extract(g,w,h);if(!this.isreal()){a.extract(u,w,c)}}return l};r.permute=function(t){var r=this.getView().permute(t);return this.extractViewFrom(r)};r.ipermute=function(t){var r=this.getView().ipermute(t);return this.extractViewFrom(r)};r.shiftdim=function(t){var r=this.getView();t=r.shiftDimension(t);return[this.extractViewFrom(r),t]};r.circshift=function(t,r){var e=this.getView().circshift(t,r);return this.extractViewFrom(e)};r.rot90=function(t){var r=this.getView().rot90(t);return this.extractViewFrom(r)};r.flipdim=function(t){var r=this.getView().selectDimension(t,[-1,0]);return this.extractViewFrom(r)};r.fliplr=function(){return this.flipdim(1)};r.flipud=function(){return this.flipdim(0)};r.cat=function(){var r=arguments[0];var e=this.getSize();if(e[r]===undefined){e[r]=1}var a;for(a=1;a<arguments.length;a++){e[r]+=arguments[a].getSize(r)}var i=new t(e);var n=i.getView();var o=this.getSize(r)-1;n.selectDimension(r,[0,o]);this.extractViewTo(n,i);n.restore();for(a=1;a<arguments.length;a++){n.selectDimension(r,[o+1,o+=arguments[a].getSize(r)]);arguments[a].extractViewTo(n,i);n.restore()}return i}})(Matrix,Matrix.prototype);(function(t,r){"use strict";r.numel=function(){return this.getLength()};r.ndims=function(){return this.getDimLength()};r.size=function(t){switch(typeof t){case"number":if(!Tools.isInteger(t,0)){throw new Error("Matrix.size: invalid argument.")}return this.getSize(t)||1;case"undefined":return this.getSize();default:throw new Error("Matrix.size: Wrong argument type.")}};r.type=function(){switch(this.getDataType().toLowerCase()){case"boolean":case"logical":return"logical";case"array":case"float64array":return"double";case"float32array":return"single";case"int32array":return"int32";case"uint32array":return"uint32";case"int16array":return"int16";case"uint16array":return"uint16";case"int8array":return"int8";case"uint8clampedarray":return"uint8c";case"uint8array":return"uint8";default:return new Error("Matrix.type: Unknown data type.")}};r.isrow=function(){var t=this.size();return t.length===2&&t[0]===1};r.iscolumn=function(){var t=this.size();return t.length===2&&t[1]===1};r.isvector=function(){var t=this.size();return t.length===2&&(t[1]===1||t[0]===1)};r.ismatrix=function(){return this.getSize().length<=2};r.issquare=function(){if(this.getSize(0)!==this.getSize(1)){throw false}return true};r.isinteger=function(){switch(this.getDataType().toLowerCase()){case"uint8array":case"uint8clampedarray":case"uint16array":case"uint32array":case"int8array":case"int16array":case"int32array":return true;default:return false}};r.isfloat=function(){switch(this.getDataType().toLowerCase()){case"float32array":case"float64array":return true;default:return false}};r.islogical=function(){var t=this.getDataType().toLowerCase();if(t==="logical"||t==="boolean"||t==="bool"){return true}return false};t.intmin=function(t){switch(t){case"uint8c":case"uint8":case"uint16":case"uint32":return 0;case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648;default:throw new Error("Matrix.intmin: Unknown data type.")}};t.intmax=function(t){switch(t){case"int8":return 127;case"uint8c":case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295;default:throw new Error("Matrix.intmax: Unknown data type.")}};t.realmin=function(t){switch(t){case undefined:case"double":return Number.MIN_VALUE;case"single":return 1.1755e-38;default:throw new Error("Matrix.realmin: Unknown data type.")}};t.realmax=function(t){switch(t){case undefined:case"double":return Number.MAX_VALUE;case"single":return 3.4028e38;default:throw new Error("Matrix.realmin: Unknown data type.")}}})(Matrix,Matrix.prototype);(function(t,r){"use strict";var e=typeof module!=="undefined"&&module.exports?true:false;var a,i,n;if(e){a=require("fs");i=require("canvas");n=i.Image}else{n=Image}var o=function(t,r){var a;if(e){a=new i}else{a=document.createElement("canvas")}a.width=t||0;a.height=r||0;return a};t.colon=function(){var r=Tools.checkColon(arguments);var e=r[0],a=r[1],i=r[2];if(!isFinite(e)||!isFinite(a)||!isFinite(i)){throw new Error("Parameters are invalid number (Infitity or NaN).")}var n=2.2204e-16;var o=2*n*Math.max(Math.abs(e),Math.abs(i));var s=a>0?1:-1;var l;var f=Tools.isInteger;if(f(e)&&a===1){l=Math.floor(i)-e}else if(f(e)&&f(a)){var g=Math.floor(e/a);var u=e-g*a;l=Math.floor((i-u)/a)-g}else{l=Math.round((i-e)/a);if(s*(e+l*a-i)>o){l=l-1}}var h=e+l*a;if(s*(h-i)>-o){h=i}var c=new t(l+1);var p=c.getData();var m,v=Math.floor(l/2)+1;var x=e,M=h;for(m=0;m<v;m++,x+=a,M-=a){p[m]=x;p[l-m]=M}if(l%2===0){p[l/2]=(e+h)/2}return c};t.linspace=function(r,e,a){if(!Tools.isNumber(r)){throw new Error}if(!Tools.isNumber(e)){throw new Error}if(a===undefined){a=100}else if(!Tools.isInteger(a,1)){throw new Error("Matrix.linspace: Bins shoulb be an integer > 1.")}var i=a-1;return t.colon(r,(e-r)/i,e)};t.zeros=function(){var r,e;if(typeof arguments[arguments.length-1]==="string"){e=Array.prototype.pop.apply(arguments)}r=Tools.checkSize(arguments,"square");return new t(r,e)};t.ones=function(){var r;if(typeof arguments[arguments.length-1]==="string"){r=Array.prototype.pop.apply(arguments)}var e=Tools.checkSize(arguments,"square");var a=new t(e,r),i=a.getData();var n,o;for(n=0,o=i.length;n<o;++n){i[n]=1}return a};t.rand=function(){var r,e;if(typeof arguments[arguments.length-1]==="string"){e=Array.prototype.pop.apply(arguments)}r=Tools.checkSize(arguments,"square");var a=new t(r,e),i=a.getData();var n,o,s=Math.random;for(n=0,o=i.length;n<o;++n){i[n]=s()}return a};t.randn=function(){var r,e;if(typeof arguments[arguments.length-1]==="string"){e=Array.prototype.pop.apply(arguments)}r=Tools.checkSize(arguments,"square");var a=new t(r,e),i=a.getData();var n,o;var s=Math.random,l=Math.PI*2;var f=Math.sqrt,g=Math.sin,u=Math.log;for(n=0,o=i.length;n<o;++n){var h=l*s();var c=f(-2*u(1-s()));i[n]=c*g(h)}return a};t.randi=function(){var r,e,a;r=Array.prototype.shift.apply(arguments);r=Tools.checkRange(r);if(typeof arguments[arguments.length-1]==="string"){a=Array.prototype.pop.apply(arguments)}e=arguments.length===0?[1]:arguments;e=Tools.checkSize(e,"square");var i=new t(e,a),n=i.getData();var o,s,l=r[0],f=r[1]-l+1;var g=Math.random,u=Math.floor;for(o=0,s=n.length;o<s;++o){n[o]=u(g()*f)+l}return i};t.eye=function(){var r,e;if(typeof arguments[arguments.length-1]==="string"){e=Array.prototype.pop.apply(arguments)}r=Tools.checkSize(arguments,"square");var a=new t(r,e);var i=a.getData();var n=a.getView(),o=a.getIterator(2);var s=o.iterator,l=o.begin,f=o.isEnd;var g=n.getFirst(1),u=n.getStep(1);var h=n.getFirst(0),c=n.getStep(0);var p=Math.min(n.getSize(1),n.getSize(0));var m,v,x;for(m=l();!f();m=s()){for(v=m+g+h,x=0;x<p;v+=u,x++){i[v+x*c]=1}}return a};t.complex=function(r,e){r=t.toMatrix(r);e=t.toMatrix(e);if(!(r instanceof t)){throw new Error("Matrix.complex: real argument must be a matrix.")}if(!r.isreal()){throw new Error("Matrix.complex: real argument must be a real matrix.")}if(!(e instanceof t)){throw new Error("Matrix.complex: imag argument must be a matrix.")}if(!e.isreal()){throw new Error("Matrix.complex: imag argument must be a real matrix.")}if(!Tools.checkSizeEquals(r.getSize(),e.getSize(),t.ignoreTrailingDims)){throw new Error("Matrix.complex: imag and real Matrix must "+"have the same size.")}var a=r.getData(),i=e.getData();var n=new t.dataType(a.length*2);n.subarray(0,a.length).set(a);n.subarray(a.length).set(i);return new t(r.getSize(),n,true)};t.imread=function(r,s,l){var f="Matrix.imread: ";var g=new t;if(!e&&typeof r==="string"&&document.getElementById(r)){r=document.getElementById(r)}var u=function(t){var r,e=t.getContext("2d");var a=t.width,i=t.height;try{r=e.getImageData(0,0,a,i)}catch(n){if(l!==undefined){l.call(this,n);return}throw n}var o=new Uint8ClampedArray(r.data);var f=new MatrixView([4,a,i]).select([0,2],[0,-1],[0,-1]).permute([2,1,0]);this.initialize(f.getSize(),f.extractFrom(o));if(s){s.call(this,this)}}.bind(g);var h=function(t){if(!e){t=t instanceof Event?this:t}var r=o(t.width,t.height);r.getContext("2d").drawImage(t,0,0,t.width,t.height);u(r)};var c=function(t){var r=new n;r.onerror=l||function(){throw new Error(f+"Error occuring while loading image.")};if(e){r.src=a.readFileSync(t);h(r)}else{r.src=t;r.onload=h}};if(typeof r==="string"){c(r)}else if(!e&&r instanceof Image){h(r)}else if(!e&&r instanceof HTMLCanvasElement){u(r)}else if(e&&r instanceof i){u(r)}else{throw new Error(f+"invalid source argument")}return g};t.diag=function(r){r=t.toMatrix(r);var e=r.numel();r=r.getData();var a=t.zeros(e);var i=a.getData();var n,o,s;for(n=0,o=i.length,s=0;n<o;n+=e+1,s++){i[n]=r[s]}return a};t.loadImages=function s(r,e){var a=[],i,n;e=e.bind(a);var o=function(t){return function(){a[t]=this;for(var i=0,n=r.length;i<n;i++){if(!a[i]||a[i].isempty()){return}}e()}};for(i=0,n=r.length;i<n;i++){if(r[i]instanceof Image){t.imread(r[i],o(i))}}return a}})(Matrix,Matrix.prototype);(function(t,r){"use strict";var e=function(t,r,e,a){for(var i=r+e,n=r+a,o=t[r];i<n;i+=e){if(t[i]<o){o=t[i]}}return o};var a=function(t,r,e,a){for(var i=r+e,n=r+a,o=t[r],s=r;i<n;i+=e){if(t[i]<o){o=t[i];s=i}}return s};var i=function(t,r,e,a){for(var i=r+e,n=r+a,o=t[r];i<n;i+=e){if(t[i]>o){o=t[i]}}return o};var n=function(t,r,e,a){for(var i=r+e,n=r+a,o=t[r],s=r;i<n;i+=e){if(t[i]>o){o=t[i];s=i}}return s};var o=function(t,r,e,a){for(var i=r,n=r+a,o=0;i<n;i+=e){o+=t[i]}return o};var s=function(t,r,e,a){for(var i=r,n=r+a,o=0;i<n;i+=e){o+=t[i]}return o*e/a};var l=function(t,r,e,a){for(var i=r,n=r+a,o=1;i<n;i+=e){o*=t[i]}return o};var f=function(t,r,e,a){var i=s(t,r,e,a);for(var n=r,o=r+a,l=0;n<o;n+=e){var f=t[n]-i;l+=f*f}return l*e/(a-1)};var g=function(t,r,e,a){return f(t,r,e,a)*(a-1)/a};var u=function(t,r,e,a){for(var i=r+e,n=r+a;i<n;i+=e){t[i]+=t[i-e]}};var h=function(t,r,e,a){for(var i=r+e,n=r+a;i<n;i+=e){t[i]*=t[i-e]}};var c=function(t,r){var e=t.ndims(),a=[r];for(var i=0;i<e;i++){if(i!==r){a.push(i)}}return a};var p=function(r,e,a,i,n){i=i||false;if(!Tools.isSet(a)){if(i){e(r.getData(),0,1,r.numel());return r}var o=e(r.getCopy().getData(),0,1,r.numel());return t.toMatrix(o)}if(!Tools.isInteger(a,0)){throw new Error("Matrix.applyDim: Invalid dimension.")}var s=r.getView(),l=c(s,a);s.permute(l);var f=r.getData(),g=s.getIterator(1);var u=g.iterator,h=g.begin,p=g.isEnd;var m=s.getStep(0),v=s.getEnd(0);var x,M;if(!i){var w=r.getSize();w[a]=1;var y=new t(w,n),D=new y.getData;for(x=h(),M=0;!p();x=u(),M++){D[M]=e(f,x,m,v)}return y}if(n!==undefined){r=n;n=n.getData()}for(x=h();!p();x=u()){e(f,x,m,v,n)}return r};r.amin=function(r){var e=this.isreal()?this:t.abs(this);return p(e,a,r,undefined,"uint32")};r.min=function(t){if(this.isreal()){return p(this,e,t)}return this.get(this.amin(t))};r.amax=function(r){var e=this.isreal()?this:t.abs(this);return p(e,n,r,undefined,"uint32")};r.max=function(t){if(this.isreal()){return p(this,i,t)}return this.get(this.amax(t))};r.sum=function(r){if(this.isreal()){return p(this,o,r)}var e=this.getSize();return t.complex(p(new t(e,this.getRealData()),o,r),p(new t(e,this.getImagData()),o,r))};r.prod=function(t){if(this.isreal){return p(this,l,t)}throw new Error("Matrix.prod: Is not yet implement for complex values.")};r.mean=function(r){if(this.isreal()){return p(this,s,r)}var e=this.getSize();return t.complex(p(new t(e,this.getRealData()),s,r),p(new t(e,this.getImagData()),s,r))};r.variance=function(t,r){switch(typeof r){case"undefined":r=-1;break;case"boolean":r=r===false?-1:0;break;case"number":if(r===0){r=-1}else if(r===1){r=0}else{throw new Error("Matrix.variance: Invalid argument.")}break;default:throw new Error("Matrix.variance: Invalid argument.")}if(!this.isreal()){throw new Error("Matrix.variance: Is not yet implement for complex values.")}if(r===-1){return p(this,f,t)}return p(this,g,t)};r.std=function(t,r){if(!this.isreal()){throw new Error("Matrix.std: Is not yet implement for complex values.")}var e=this.variance(t,r);if(typeof e==="number"){return Math.sqrt(e)}return e.arrayfun(Math.sqrt)};r.cumsum=function(r){var e=u;if(this.isreal()){return p(this,e,r,true)}var a=this.getSize();return t.complex(p(new t(a,this.getRealData()),e,r,true),p(new t(a,this.getImagData()),e,r,true))};r.cumprod=function(t){if(!this.isreal()){throw new Error("Matrix.cumprod: Is not yet implement for complex values.")}return p(this,h,t,true)};(function(){var e=function(t,r){var e=Math.exp(-r),a=Math.random;for(var i=0,n=t.length;i<n;i++){var o=1,s=0;do{s++;o*=a()}while(o>e);t[i]=s-1}};var a=function(t){var r=Math.exp,e=Math.random;for(var a=0,i=t.length;a<i;a++){var n=1,o=0,s=r(-t[a]);do{o++;n*=e()}while(n>s);t[a]=o-1}};var i=function(t,r){r=-r;var e=Math.random,a=Math.log;for(var i=0,n=t.length;i<n;++i){t[i]=r*a(e())}};t.poissrnd=function(){var r=Array.prototype.shift.apply(arguments);if(typeof r==="number"){var a=Tools.checkSize(arguments,"square");var i=new t(a),n=i.getData();e(n,r);return i}if(r instanceof t){return r.getCopy().poissrnd()}};r.poissrnd=function(){a(this.getData());return this};t.exprnd=function(){var r=Array.prototype.shift.apply(arguments);var e=Tools.checkSize(arguments,"square");var a=new t(e),n=a.getData();i(n,r);return a}})();(function(){var e,a,i;var n=function(t,r){return e[t]-e[r]};var o=function(t,r){return e[r]-e[t]};var s=function(t,r){return t-r};var l=function(t,r){return r-t};var f=function(t,r,a,n){var o,s,l;for(o=r,s=0,l=r+n;o<l;o+=a,s++){e[s]=t[o]}Array.prototype.sort.call(e,i);for(o=r,s=0,l=r+n;o<l;o+=a,s++){t[o]=e[s]}};var g=function(t,r,n,o,s){var l,f,g;for(l=r,f=0,g=r+o;l<g;l+=n,f++){e[f]=t[l];a[f]=f}Array.prototype.sort.call(a,i);for(l=r,f=0,g=r+o;l<g;l+=n,f++){s[l]=a[f]*n+r}};var u=function(t,r,a,n){var o,s,l;for(o=r,s=0,l=r+n;o<l;o+=a,s++){e[s]=t[o]}Array.prototype.sort.call(e,i);var f=Math.floor(e.length/2);return e.length%2===0?.5*(e[f]+e[f-1]):e[f]};r.sort=function(t,r){var a=typeof t==="number"?this.getSize(t):this.numel();e=new Float64Array(a);if(r==="ascend"){i=s}else if(r==="descend"){i=l}else{throw new Error("Matrix.sort: Wrong mode selection")}return p(this,f,t,true)};t.sort=function(t,r,e){return t.getCopy().sort(r,e)};r.asort=function(r,s){var l=typeof r==="number"?this.getSize(r):this.numel();e=new Float64Array(l);a=new Uint32Array(l);if(s==="ascend"){i=n}else if(s==="descend"){i=o}else{throw new Error("Matrix.sort: Wrong mode selection")}var f=new t(this.getSize(),"uint32");return p(this,g,r,true,f)};t.asort=function(t,r,e){return t.getCopy().asort(r,e)};r.med=function(t){var r=typeof t==="number"?this.getSize(t):this.numel();e=new Float64Array(r);i=s;return p(this,u,t)};t.med=function(t,r,e){return t.getCopy().med(r)}})();t.accumarray=function(r,e,a){if(!this.isreal()){throw new Error("Matrix.accumarray: Is not yet implement for complex values.")}r=t.toMatrix(r);if(!Tools.isArrayOfIntegers(r.getData(),0)){throw new Error("Matrix.accumarray: Subs should be an array of positive integers.")}var i=r.max(0).getData();var n,o,s=[1];if(Tools.isSet(a)){for(n=0,o=i.length;n<o;n++){if(a[n]<i[n]+1){throw new Error("Matrix.accumarray: Size and Subs values are unconsistent.")}}}else{a=[];for(n=0,o=i.length;n<o;n++){a[n]=i[n]+1}}for(n=0,o=a.length-1;n<o;n++){s[n+1]=s[n]*a[n]}if(r.ndims()>2){throw new Error("Matrix.accumarray: Subs must be a 2D Array.")}var l=r.getData(),f=r.numel(),g=r.getSize(0);var u,h,c,p,m;var v=new Uint32Array(g);for(h=0,c=0;c<f;h++,c+=g){for(u=0,p=c,m=s[h];u<g;u++,p++){v[u]+=l[p]*m}}if(e instanceof t){e=e.getData()}var x=new t(a),M=x.getData();if(Tools.isArrayLike(e)&&e.length===v.length){for(n=0,o=v.length;n<o;n++){M[v[n]]+=e[n]}}else if(typeof e==="number"){for(n=0,o=v.length;n<o;n++){M[v[n]]+=e}}else{throw new Error("Matrix.accumarray: Wrong val argument.")}return x}})(Matrix,Matrix.prototype);(function(t,r){"use strict";r.cast=function(r){var e;switch(r.toLowerCase()){case"boolean":case"bool":case"logical":e=true;break;default:e=false}r=Tools.checkType(r);var a=new r(this.getData());return new t(this.getSize(),a,!this.isreal(),e)};r.double=function(){return this.cast("double")};r.single=function(){return this.cast("single")};r.int8=function(){return this.cast("int8")};r.int16=function(){return this.cast("int16")};r.int32=function(){return this.cast("int32")};r.uint8=function(){return this.cast("uint8")};r.logical=function(){return this.cast("logical")};r.uint8c=function(){return this.cast("uint8c")};r.uint16=function(){return this.cast("uint16")};r.uint32=function(){return this.cast("uint32")};r.isnan=function(){var r=new t(this.getSize(),"logical");var e=r.getData();var a,i;if(this.isreal()){var n=this.getData();for(a=0,i=e.length;a<i;a++){e[a]=isNaN(n[a])}}else{var o=this.getRealData(),s=this.getImagData();for(a=0,i=e.length;a<i;a++){e[a]=isNaN(o[a])||isNaN(s[a])}}return r};r.isinf=function(){var r=new t(this.getSize(),"logical");var e=r.getData();var a,i;if(this.isreal()){var n=this.getData();for(a=0,i=e.length;a<i;a++){var o=n[a];e[a]=o===Infinity||o===-Infinity?1:0}}else{var s=this.getRealData(),l=this.getImagData();for(a=0,i=e.length;a<i;a++){var f=s[a],g=l[a];e[a]=f===Infinity||f===-Infinity||g===Infinity||g===-Infinity?1:0}}return r};r.isfinite=function(){var r=new t(this.getSize(),"logical");var e=r.getData();var a,i;if(this.isreal()){var n=this.getData();for(a=0,i=e.length;a<i;a++){e[a]=isFinite(n[a])?1:0}}else{var o=this.getRealData(),s=this.getImagData();for(a=0,i=e.length;a<i;a++){e[a]=isFinite(o[a])||isFinite(s[a])?1:0}}return r}})(Matrix,Matrix.prototype);(function(t,r){"use strict";r.real=function(){if(this.isreal()){throw new Error("Matrix.real: This function can be only"+" used with a complex Matrix. ")}var r=this.getRealData();return new t(this.getSize(),new r.constructor(r))};r.imag=function(){if(this.isreal()){throw new Error("Matrix.imag: This function can be only"+" used with a complex Matrix. ")}var r=this.getImagData();return new t(this.getSize(),new r.constructor(r))};(function(){var e=function(t){for(var r=0,e=t.length;r<e;r++){t[r]=0}};var a=function(t,r){for(var e=0,a=t.length;e<a;e++){t[e]=Math.atan2(r[e],t[e]);r[e]=0}};r.angle=function(){if(this.isreal()){e(this.getData())}else{a(this.getRealData(),this.getImagData())}return this};t.angle=function(t){return t.getCopy().angle()}})();(function(){var e=function(t){for(var r=0,e=t.length;r<e;r++){t[r]=t[r]>0?t[r]:-t[r]}};var a=function(t,r){for(var e=0,a=t.length;e<a;e++){var i=r[e],n=t[e];t[e]=Math.sqrt(i*i+n*n);r[e]=0}};r.abs=function(){if(this.isreal()){e(this.getData())}else{a(this.getRealData(),this.getImagData())}return this};t.abs=function(t){return t.getCopy().abs()}})();r.conj=function(){if(this.isreal()===true){return this}var t,r,e=this.getImagData();for(t=0,r=e.length;t<r;t++){e[t]=-e[t]}return this};t.conj=function(t){return t.getCopy().conj()}})(Matrix,Matrix.prototype);(function(Matrix,Matrix_prototype){"use strict";(function(t){var r=function(t){for(var r=0,e=t.length;r<e;r++){t[r]=Math.sqrt(t[r])}};var e=function(t,r){for(var e=0,a=t.length;e<a;e++){var i=t[e],n=r[e];var o=Math.sqrt(i*i+n*n);t[e]=Math.sqrt((i+o)*.5);r[e]=n<0?-Math.sqrt((o-i)*.5):Math.sqrt((o-i)*.5)}};t.sqrt=function(){if(this.isreal()){r(this.getData())}else{e(this.getRealData(),this.getImagData())}return this}})(Matrix_prototype);Matrix_prototype.cos=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.cos(t[r])}return this};Matrix_prototype.sin=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.sin(t[r])}return this};Matrix_prototype.tan=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.tan(t[r])}return this};(function(t){var r=function(t){for(var r=0,e=t.length;r<e;r++){t[r]=Math.exp(t[r])}};var e=function(t,r){for(var e=0,a=t.length;e<a;e++){var i=Math.exp(t[e]),n=r[e];t[e]=i*Math.cos(n);r[e]=i*Math.sin(n)}};t.exp=function(){if(this.isreal()){r(this.getData())}else{e(this.getRealData(),this.getImagData())}return this}})(Matrix_prototype);Matrix_prototype.log=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.log(t[r])}return this};Matrix_prototype.log10=function(){var t=this.getData(),r,e;var a=Math.log(10);for(r=0,e=t.length;r<e;r++){t[r]=Math.log(t[r])*a}return this};Matrix_prototype.log2=function(){var t=this.getData(),r,e;var a=Math.log(2);for(r=0,e=t.length;r<e;r++){t[r]=Math.log(t[r])*a}return this};Matrix_prototype.floor=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.floor(t[r])}return this};Matrix_prototype.ceil=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.ceil(t[r])}return this};Matrix_prototype.round=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.round(t[r])}return this};Matrix_prototype.acos=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.acos(t[r])}return this};Matrix_prototype.asin=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.asin(t[r])}return this};Matrix_prototype.atan=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.acos(t[r])}return this};Matrix_prototype.atan2=function(t){var r=this.getCopy();if(!Tools.checkSizeEquals(r.size(),t.size(),Matrix.ignoreTrailingDims)){
throw new Error("Matrix.atan2: Side of of elements must be equal.")}var e=r.getData(),a=t.getData();var i,n;for(i=0,n=e.length;i<n;i++){e[i]=Math.atan2(e[i],a[i])}return r};var booleanOperators=function(t,r,e){if(!r.isreal()||e instanceof Matrix&&!e.isreal()){throw new Error("Matrix.booleanOperators: This function doesn't "+"work with complex numbers.")}var a=r.getData(),i=a.length;var n,o,s;if(typeof e==="number"){n=new Matrix(r.size(),"boolean");o=n.getData();if(t==="==="||t==="=="){for(s=0;s<i;s++){o[s]=a[s]===e?1:0}}else if(t==="!=="||t==="!="){for(s=0;s<i;s++){o[s]=a[s]!==e?1:0}}else if(t==="&&"){for(s=0;s<i;s++){o[s]=a[s]&&e?1:0}}else if(t==="||"){for(s=0;s<i;s++){o[s]=a[s]||e?1:0}}else if(t==="<"){for(s=0;s<i;s++){o[s]=a[s]<e?1:0}}else if(t==="<="){for(s=0;s<i;s++){o[s]=a[s]<=e?1:0}}else if(t===">"){for(s=0;s<i;s++){o[s]=a[s]>e?1:0}}else if(t===">="){for(s=0;s<i;s++){o[s]=a[s]>=e?1:0}}else{throw new Error("Matrix: Unknown operator '"+t+"'.")}}else if(e instanceof Matrix){var l=Tools.checkSizeEquals(r.size(),e.size(),Matrix.ignoreTrailingDims);n=new Matrix(l,"boolean");o=n.getData();var f=e.getData();if(t==="==="||t==="=="){for(s=0;s<i;s++){o[s]=a[s]===f[s]?1:0}}else if(t==="!=="||t==="!="){for(s=0;s<i;s++){o[s]=a[s]!==f[s]?1:0}}else if(t==="&&"){for(s=0;s<i;s++){o[s]=a[s]&&f[s]?1:0}}else if(t==="||"){for(s=0;s<i;s++){o[s]=a[s]||f[s]?1:0}}else if(t==="<"){for(s=0;s<i;s++){o[s]=a[s]<f[s]?1:0}}else if(t==="<="){for(s=0;s<i;s++){o[s]=a[s]<=f[s]?1:0}}else if(t===">"){for(s=0;s<i;s++){o[s]=a[s]>=f[s]?1:0}}else if(t===">="){for(s=0;s<i;s++){o[s]=a[s]>=f[s]?1:0}}else{throw new Error("Unknown operator '"+t+"'.")}}else{throw new Error("Argument must be a Matrix or a number")}return n};Matrix_prototype.eq=function(t){return booleanOperators("===",this,t)};Matrix_prototype["==="]=Matrix_prototype.eq;Matrix_prototype.ne=function(t){return booleanOperators("!==",this,t)};Matrix_prototype["!=="]=Matrix_prototype.ne;Matrix_prototype.gt=function(t){return booleanOperators(">",this,t)};Matrix_prototype[">"]=Matrix_prototype.gt;Matrix_prototype.ge=function(t){return booleanOperators(">=",this,t)};Matrix_prototype[">="]=Matrix_prototype.ge;Matrix_prototype.lt=function(t){return booleanOperators("<",this,t)};Matrix_prototype["<"]=Matrix_prototype.lt;Matrix_prototype.le=function(t){return booleanOperators("<=",this,t)};Matrix_prototype["<="]=Matrix_prototype.le;Matrix_prototype.and=function(t){return booleanOperators("&&",this,t)};Matrix_prototype["&&"]=Matrix_prototype.and;Matrix_prototype.or=function(t){return booleanOperators("||",this,t)};Matrix_prototype["||"]=Matrix_prototype.or;Matrix_prototype.neg=function(){var t=this.getCopy();var r=t.getData();var e,a;for(e=0,a=r.length;e<a;e++){r[e]=!r[e]?1:0}return t};var generateArithmeticOperators=function(){var operators={"+":{name:"plus","real/real":{scalar:"a[x] += b;",matrix:"a[x] += b[x];"},"real/imag":{scalar:"ar[x] += br;    ai[x] = bi;",matrix:"ar[x] += br[x]; ai[x] = bi[x];"},"imag/real":{scalar:"ar[x] += b;",matrix:"ar[x] += b[x];"},"imag/imag":{scalar:"ar[x] += br;    ai[x] += bi;",matrix:"ar[x] += br[x]; ai[x] += bi[x];"},AIsScalar:"B.getCopy().plus(A);",AIsMatrix:"A.getCopy().plus(B);"},"-":{name:"minus","real/real":{scalar:"a[x] -= b;",matrix:"a[x] -= b[x];"},"real/imag":{scalar:"ar[x] -= br;    ai[x] = -bi;",matrix:"ar[x] -= br[x]; ai[x] = -bi[x];"},"imag/real":{scalar:"ar[x] -= b;",matrix:"ar[x] -= b[x];"},"imag/imag":{scalar:"ar[x] -= br;    ai[x] -= bi;",matrix:"ar[x] -= br[x]; ai[x] -= bi[x];"},AIsScalar:"B.getCopy().plus(A.uminus());",AIsMatrix:"A.getCopy().minus(B);"},".*":{name:"times","real/real":{scalar:"a[x] *= b;",matrix:"a[x] *= b[x];"},"real/imag":{scalar:"ai[x] = ar[x] * bi;    ar[x] *= br;",matrix:"ai[x] = ar[x] * bi[x]; ar[x] *= br[x];"},"imag/real":{scalar:"ar[x] *= b;    ai[x] *= b;",matrix:"ar[x] *= b[x]; ai[x] *= b[x];"},"imag/imag":{scalar:"var r = ar[x], i = ai[x];"+"ar[x] = r * br - i * bi;"+"ai[x] = r * bi + i * br;",matrix:"var r1 = ar[x], i1 = ai[x], r2 = br[x], i2 = bi[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().times(A);",AIsMatrix:"A.getCopy().times(B);"},"./":{name:"rdivide","real/real":{scalar:"a[x] /= b;",matrix:"a[x] /= b[x];"},"real/imag":{scalar_before:"ai.set(ar);"+"tmp = 1 / (br * br + bi * bi);"+"br = br * tmp;"+"bi = -bi * tmp;",scalar:"ai[x] *= bi;           ar[x] *= br;",matrix:"ai[x] = ar[x] * bi[x]; ar[x] *= br[x];"},"imag/real":{scalar_before:"var b = 1 / b;",scalar:"ar[x] *= b;    ai[x] *= b;",matrix:"ar[x] /= b[x]; ai[x] /= b[x];"},"imag/imag":{scalar_before:"var tmp = 1 / (br * br + bi * bi);"+"br *= tmp;"+"bi *= tmp;",scalar:"var r = ar[x], i = ai[x];"+"ar[x] = r * br + i * bi;"+"ai[x] = i * bi - r * br;",matrix:"var r1 = ar[x], i1 = ai[x], r2 = br[x], i2 = bi[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().rdivide(A);",AIsMatrix:"A.getCopy().ldivide(B);"},".\\":{name:"ldivide","real/real":{scalar:"a[x] = b / a[x];",matrix:"a[x] = b[x] / a[x];"},"real/imag":{scalar:"ai[x] = bi / ar[x];    ar[x] = br / ar[x];",matrix:"ai[x] = bi[x] / ar[x]; ar[x] = br[x] / ar[x];"},"imag/real":{scalar:"var tmp = 1 / (ar[x] * ar[x] + ai[x] * ai[x]);"+"ai[x] = bi * tmp; ar[x] = br * tmp;",matrix:"var tmp = 1 / (ar[x] * ar[x] + ai[x] * ai[x]);"+"ai[x] = bi[x] * tmp; ar[x] = br[x] * tmp;"},"imag/imag":{scalar:"var r = br[x], i = bi[x];"+"ar[x] = r * ar + i * ai;"+"ai[x] = i * ai - r * ar;",matrix:"var r1 = br[x], i1 = bi[x], r2 = ar[x], i2 = ai[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().ldivide(A);",AIsMatrix:"A.getCopy().rdivide(B);"},".^":{name:"power","real/real":{scalar:"a[x] = Math.pow(a[x], b);",matrix:"a[x] = Math.pow(a[x], b[x]);"},"real/imag":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},"imag/real":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},"imag/imag":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},AIsScalar:"B.isscalar() ? A.getCopy().power(B) : undefined;",AIsMatrix:"A.getCopy().power(B);"}};var fct=function(t){t=Matrix.toMatrix(t);var r,e=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();"real/real-scalar"}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];"real/imag-scalar"}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();"imag/real-scalar"}else{o=t.getRealData()[0];s=t.getImagData()[0];"imag/imag-scalar"}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();"real/real-matrix"}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();"real/imag-matrix"}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();"imag/real-matrix"}else{o=t.getRealData();s=t.getImagData();"imag/imag-matrix"}}}return this}.toString();var fct2=function(t,r){t=Matrix.toMatrix(t);r=Matrix.toMatrix(r);if(t.isscalar()){return"AIsScalar"}else{return"AIsMatrix"}}.toString();var addLoop=function(t){return"for (x = 0; x < n; x++) {"+t+"}"};var replace=function(t,r,e){var a=r[e].scalar_before?r[e].scalar_before:"";var i=r[e].matrix_before?r[e].matrix_before:"";a+=addLoop(r[e].scalar);i+=addLoop(r[e].matrix);t=t.replace('"'+e+'-matrix";',i);t=t.replace('"'+e+'-scalar";',a);return t};var o,op,fun;for(o in operators){if(operators.hasOwnProperty(o)){op=operators[o];fun=replace(fct,op,"real/real");fun=replace(fun,op,"real/imag");fun=replace(fun,op,"imag/real");fun=replace(fun,op,"imag/imag");eval("Matrix.prototype."+op.name+" = "+fun);fun=fct2.replace('"AIsScalar";',op.AIsScalar);fun=fun.replace('"AIsMatrix";',op.AIsMatrix);eval("Matrix."+op.name+" = "+fun)}}};Matrix_prototype.plus=function(t){t=Matrix.toMatrix(t);var r,e=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();for(r=0;r<e;r++){a[r]+=t}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){i[r]+=o;n[r]=s}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(r=0;r<e;r++){i[r]+=t}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){i[r]+=o;n[r]+=s}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(r=0;r<e;r++){a[r]+=t[r]}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){i[r]+=o[r];n[r]=s[r]}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){i[r]+=t[r]}}else{o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){i[r]+=o[r];n[r]+=s[r]}}}}return this};Matrix_prototype["+="]=function(t){return this.plus(t)};Matrix_prototype["+"]=function(t){return this.getCopy().plus(t)};Matrix.plus=function(t,r){return t["+"](r)};Matrix_prototype.minus=function(t){t=Matrix.toMatrix(t);var r,e=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();for(r=0;r<e;r++){a[r]-=t}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){i[r]-=o;n[r]=-s}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(r=0;r<e;r++){i[r]-=t}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){i[r]-=o;n[r]-=s}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(r=0;r<e;r++){a[r]-=t[r]}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){i[r]-=o[r];n[r]=-s[r]}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){i[r]-=t[r]}}else{o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){i[r]-=o[r];n[r]-=s[r]}}}}return this};Matrix_prototype["-="]=function(t){return this.minus(t)};Matrix_prototype["-"]=function(t){return this.getCopy().minus(t)};Matrix.minus=function(t,r){return t["-"](r)};Matrix_prototype.uminus=function(){var t,r=this.numel();if(this.isreal()){var e=this.getData();for(t=0;t<r;t++){e[t]=-e[t]}}else{var a=this.getRealData(),i=this.getImagData();for(t=0;t<r;t++){a[t]=-a[t];i[t]=-i[t]}}return this};Matrix.uminus=function(t){return t.getCopy().uminus()};Matrix_prototype.times=function(t){t=Matrix.toMatrix(t);var r,e=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();for(r=0;r<e;r++){a[r]*=t}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){n[r]=i[r]*s;i[r]*=o}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(r=0;r<e;r++){i[r]*=t;n[r]*=t}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){var l=i[r],f=n[r];i[r]=l*o-f*s;n[r]=l*s+f*o}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(r=0;r<e;r++){a[r]*=t[r]}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){n[r]=i[r]*s[r];i[r]*=o[r]}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){i[r]*=t[r];n[r]*=t[r]}}else{o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){var g=i[r],u=n[r],h=o[r],c=s[r];var p=1/(h*h+c*c);i[r]=(g*h+u*c)*p;n[r]=(u*h-g*c)*p}}}}return this};Matrix_prototype["*="]=function(t){return this.times(t)};Matrix_prototype[".*"]=function(t){return this.getCopy().times(t)};Matrix.times=function(t,r){return t[".*"](r)};Matrix_prototype.rdivide=function(t){t=Matrix.toMatrix(t);var r,e=this.numel(),a;var i=this,n,o,s,l;if(t.isscalar()){if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getDataScalar();for(r=0;r<e;r++){i[r]/=t}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData()[0];l=t.getImagData()[0];o.set(n);a=1/(s*s+l*l);s=s*a;l=-l*a;for(r=0;r<e;r++){o[r]*=l;n[r]*=s}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getDataScalar();t=1/t;for(r=0;r<e;r++){n[r]*=t;o[r]*=t}}else{s=t.getRealData()[0];l=t.getImagData()[0];a=1/(s*s+l*l);s*=a;l*=a;for(r=0;r<e;r++){var f=n[r],g=o[r];n[r]=f*s+g*l;o[r]=g*l-f*s}}}}else{Tools.checkSizeEquals(i.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getData();for(r=0;r<e;r++){i[r]/=t[r]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData();l=t.getImagData();for(r=0;r<e;r++){o[r]=n[r]*l[r];n[r]*=s[r]}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){n[r]/=t[r];o[r]/=t[r]}}else{s=t.getRealData();l=t.getImagData();for(r=0;r<e;r++){var u=n[r],h=o[r],c=s[r],p=l[r];var m=1/(c*c+p*p);n[r]=(u*c+h*p)*m;o[r]=(h*c-u*p)*m}}}}return this};Matrix_prototype["/="]=function(t){return this.rdivide(t)};Matrix_prototype["./"]=function(t){return this.getCopy().rdivide(t)};Matrix.rdivide=function(t,r){return t["./"](r)};Matrix_prototype.ldivide=function(t){t=Matrix.toMatrix(t);var r,e=this.numel(),a;var i=this,n,o,s,l;if(t.isscalar()){if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getDataScalar();for(r=0;r<e;r++){i[r]=t/i[r]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData()[0];l=t.getImagData()[0];for(r=0;r<e;r++){o[r]=l/n[r];n[r]=s/n[r]}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getDataScalar();for(r=0;r<e;r++){a=1/(n[r]*n[r]+o[r]*o[r]);o[r]=l*a;n[r]=s*a}}else{s=t.getRealData()[0];l=t.getImagData()[0];for(r=0;r<e;r++){var f=s[r],g=l[r];n[r]=f*n+g*o;o[r]=g*o-f*n}}}}else{Tools.checkSizeEquals(i.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getData();for(r=0;r<e;r++){i[r]=t[r]/i[r]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData();l=t.getImagData();for(r=0;r<e;r++){o[r]=l[r]/n[r];n[r]=s[r]/n[r]}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){a=1/(n[r]*n[r]+o[r]*o[r]);o[r]=l[r]*a;n[r]=s[r]*a}}else{s=t.getRealData();l=t.getImagData();for(r=0;r<e;r++){var u=s[r],h=l[r],c=n[r],p=o[r];var m=1/(c*c+p*p);n[r]=(u*c+h*p)*m;o[r]=(h*c-u*p)*m}}}}return this};Matrix_prototype["\\="]=function(t){return this.ldivide(t)};Matrix_prototype[".\\"]=function(t){return this.getCopy().ldivide(t)};Matrix.ldivide=function(t,r){return t[".\\"](r)};Matrix_prototype.power=function(t){t=Matrix.toMatrix(t);var r,e=this.numel();var a=this,i,n,o,s,l,f;var g=Math.pow,u=Math.sqrt,h=Math.cos,c=Math.sin,p=Math.atan2;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();for(r=0;r<e;r++){a[r]=g(a[r],t)}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(r=0;r<e;r++){l=g(u(i[r]*i[r]+n[r]*n[r]),t);f=t*p(n[r],i[r]);i[r]=l*h(f);n[r]=l*c(f)}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(r=0;r<e;r++){a[r]=g(a[r],t[r])}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){l=g(u(i[r]*i[r]+n[r]*n[r]),t[r]);f=t[r]*p(n[r],i[r]);i[r]=l*h(f);n[r]=l*c(f)}}else{o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}}return this};Matrix_prototype[".^"]=function(t){return this.getCopy().power(t)};Matrix.power=function(t,r){return t[".^"](r)};(function(t){var r=function(t,r){var e,a;for(e=0,a=t.length;e<a;e++){t[e]=r(t[e])}};t.arrayfun=function(t){if(!this.isreal()){throw new Error("Matrix.arrayfun: This function doesn't "+"work with complex numbers.")}if(typeof t!=="function"){throw new Error("Matrix.arrayfun: Argument must be a function.")}r(this.getData(),t.bind(this));return this}})(Matrix_prototype);Matrix_prototype.transpose=function(){if(!this.ismatrix()){throw new Error("Matrix.transpose: "+"Transposition is only defined for matrix.")}var t=this.getView().swapDimensions(0,1);return this.extractViewFrom(t)};Matrix_prototype.ctranspose=function(){return this.transpose().conj()};(function(t){var r=function(t,r){for(var e=0,a=0;e<r;e++){var i=t[e];a+=i>0?i:-i}return a};var e=function(t,r){for(var e=0,a=0;e<r;e++){var i=t[e];a+=i*i}return a};var a=function(t,r,e){var a=Math.pow,i=Math.abs;for(var n=0,o=0;n<r;n++){o+=a(i(t[n]),e)}return o};t.norm=function(t){if(t===undefined){t=2}else if(!Tools.isNumber(t)){throw new Error("Matrix.norm: Argument p must be a number.")}var i=this.getData(),n=i.length;var o;if(t===1){o=r(i,n)}else if(t===2){o=e(i,n)}else{o=a(i,n,t)}return Math.pow(o,1/t)}})(Matrix_prototype);Matrix_prototype.triu=function(t){if(t===undefined){t=0}var r=this.getView();var e=r.getStep(1),a=r.getSize(0),i=r.getSize(1);var n,o,s,l;if(this.isreal()){var f=this.getData();for(n=0,o=0;n<i;o+=e,n++){for(s=o+n+1-t,l=o+a;s<l;s++){f[s]=0}}}else{var g=this.getRealData(),u=this.getImagData();for(n=0,o=0;n<i;o+=e,n++){for(s=o+n+1-t,l=o+a;s<l;s++){g[s]=0;u[s]=0}}}return this};Matrix_prototype.tril=function(t){var r=this.getCopy();if(t===undefined){t=0}var e=r.getView();var a=e.getStep(1),i=e.getSize(0),n=e.getSize(1);var o,s,l,f,g;g=Math.min(i,n);if(this.isreal()){var u=r.getData();for(o=0,s=0;o<n;s+=a,o++){for(l=s,f=s+o-t;l<f;l++){u[l]=0}}}else{var h=r.getRealData(),c=r.getImagData();for(o=0,s=0;o<n;s+=a,o++){for(l=s,f=s+o-t;l<f;l++){h[l]=0;c[l]=0}}}return r};Matrix_prototype.diag=function(t){if(t===undefined){t=0}var r=this.getView();var e=r.getStep(0),a=r.getSize(0);var i=r.getStep(1),n=r.getSize(1);var o,s;if(t>0){t=Math.abs(t);o=i;s=Math.min(a,n-t)}else{t=Math.abs(t);o=e;s=Math.min(a-t,n)}if(s<=0){throw new Error("Matrix.diag: Invalid diagonal requirement.")}var l=new Matrix([1,s],this.type(),!this.isreal());var f,g;var u=i+e;g=t*o;if(this.isreal()){var h=this.getData();var c=l.getData();for(f=0;f<s;f++,g+=u){c[f]=h[g]}}else{var p=this.getRealData(),m=this.getImagData();var v=l.getRealData(),x=l.getImagData();for(f=0;f<s;f++,g+=u){v[f]=p[g];x[f]=m[g]}}return l};Matrix.bsxfun=function(t,r,e){r=Matrix.toMatrix(r);e=Matrix.toMatrix(e);if(!r.isreal()||!e.isreal()){throw new Error("Matrix.bsxfun: This function doesn't "+"work with complex numbers.")}var a=r.getView(),i=e.getView();var n,o=Math.max(a.ndims(),i.ndims());for(n=0;n<o;n++){var s=r.getSize(n),l=e.getSize(n);if(s===1&&l>1){a.selectIndicesDimension(n,new Uint8Array(l))}else if(l===1&&s>1){i.selectIndicesDimension(n,new Uint8Array(s))}else if(l!==s){throw new Error("Matrix.bsxfun: Incompatiblity on dimension: "+n)}}var f=Matrix.zeros(a.getSize());var g=f.getData(),u=r.getData(),h=e.getData();var c=a.getIterator(0),p=i.getIterator(0);var m=c.iterator,v=c.begin,x=c.isEnd;var M=p.iterator,w=p.begin;var y,D,d;if(t instanceof Function){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=t(u[D],h[d])}}else if(t==="plus"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]+h[d]}}else if(t==="minus"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]-h[d]}}else if(t==="times"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]*h[d]}}else if(t==="rdivide"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]/h[d]}}else if(t==="ldivide"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=h[d]/u[D]}}else if(t==="min"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=h[d]>u[D]?u[D]:h[d]}}else if(t==="power"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=Math.pow(u[D],h[d])}}else if(t==="hypot"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=Math.sqrt(h[d]*h[d]+u[D]*u[D])}}else if(t==="atan2"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=Math.atan2(u[D],h[d])}}else if(t==="eq"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]===h[d]?1:0}}else if(t==="ne"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]!==h[d]?1:0}}else if(t==="lt"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]<h[d]?1:0}}else if(t==="le"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]<=h[d]?1:0}}else if(t==="gt"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]>h[d]?1:0}}else if(t==="ge"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]>=h[d]?1:0}}else if(t==="and"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]&&h[d]?1:0}}else if(t==="or"){for(D=v(),d=w(),y=0;!x();D=m(),d=M(),y++){g[y]=u[D]||h[d]?1:0}}else{throw new Error("Matrix.bsxfun: Wrong function argument.")}return f};Matrix.prototype.sign=function(){var t=this.getData();var r=new Matrix(this.getSize());var e=r.getData();for(var a=0,i=t.length;a<i;a++){e[a]=t[a]>0?1:t[a]<0?-1:0}return r}})(Matrix,Matrix.prototype);(function(t){"use strict";var r=function(t,r){if(!Tools.isInteger(r)||!Tools.isInRange(r,0,2)){throw new Error("Matrix.calerf: Invalid argument.")}var e=3.97886080735226;var a=.2753747415973768;var i=.49016508058531844;var n=.7743681991195386;var o=1.0792551515585667;var s=1.313146538310231;var l=1.3704021768233816;var f=1.1890298290927332;var g=.8052764087529106;var u=.35752427444953105;var h=.016620792496936737;var c=-.11946395996432542;var p=-.0838864557023002;var m=.002493672000535033;var v=.039097684558848406;var x=.016131532973325226;var M=-.013382364453346007;var w=-.012722381378212275;var y=.003833351262648873;var D=.007736725283135267;var d=-.0008707796353172959;var b=-.003963850973605135;var I=.00011931402283834095;var S=.0012710976495261409;var E=new Float64Array([5.958930743e-11,-1.13739022964e-9,1.466005199839e-8,-1.635035446196e-7,16461004480962e-19,-1492559551950604e-20,.00012055331122299264,-.0008548326981129666,.005223977624823223,-.026866170645077334,.11283791670954882,-.3761263890318375,1.1283791670955126,2.372510631e-11,-4.5493253732e-10,5.90362766598e-9,-6.642090827576e-8,6.7595634268133e-7,-621188515924e-17,510388300970969e-19,-.00037015410692956176,.00233307631218881,-.012549884771821921,.05657061146827042,-.21379664776456006,.8427007929497149,9.49905026e-12,-1.8310229805e-10,2.39463074e-9,-2.721444369609e-8,2.8045522331686e-7,-261830022482897e-20,2195455056768781e-20,-.00016358986921372656,.0010705215356411031,-.006082847181135901,.029869784652462584,-.13055593046562267,.674933236039655,3.82722073e-12,-7.421598602e-11,9.793057408e-10,-1.126008898854e-8,1.1775134830784e-7,-11199275838265e-19,962023443095201e-20,-7404402135070773e-20,.0005068999365414488,-.003075530514392729,.016689778925531657,-.08548534594781312,.5690907664239364,1.55296588e-12,-3.032205868e-11,4.0424830707e-10,-4.71135111493e-9,5.011915876293e-8,-4.8722516178974e-7,430683284629395e-20,-3445026145385764e-20,.00024879276133931664,-.0016294094174807928,.009887863739323505,-.05962426839442304,.49766113250947636]);var z=new Float64Array([-2.9734388465e-10,2.69776334046e-9,-6.40788827665e-9,-1.6678201321e-8,-2.1854388148686e-7,266246030457984e-20,1612722157047886e-20,-.00025616361025506627,.00015380842432375364,.00815533022524928,-.014022836638963193,-.19746892495383023,.7151172032884284,-1.951073787e-11,-3.2302692214e-10,5.22461866919e-9,3.42940918551e-9,-3.5772874310272e-7,1.9999935792654e-7,2687044575042908e-20,-.00011843240273775776,-.0008099172895603227,.006610629705022412,.009095309223548273,-.20160072778491014,.5116969671872764,3.147682272e-11,-4.8465972408e-10,6.3675740242e-10,3.377623323271e-8,-1.5451139637086e-7,-203340624738438e-20,1947204525295057e-20,2854147231653228e-20,-.0010156506315220028,.0027118700352009566,.023280950354228107,-.16725021123116876,.32490054966649434,2.31936337e-11,-6.303206648e-11,-2.64888267434e-9,2.050708040581e-8,1.1371857327578e-7,-211211337219663e-20,368797328322935e-20,9823686253424796e-20,-.0006586024399045536,-.0007528581489523087,.025854344242029606,-.11637092784486193,.1826733677529661,-3.67789363e-12,2.0876046746e-10,-1.93319027226e-9,-4.35953392472e-9,1.8006992266137e-7,-7.8441223763969e-7,-675407647949153e-20,8428418334440096e-20,-.00017604388937031816,-.002397296114350716,.02064129023876023,-.06905562880005864,.09084526782065479]);var T=t.getData(),A,R;var _,C,F,V,k;var q=Math.abs,L=Math.floor,N=Math.exp;if(r===0){for(A=0,R=t.getLength();A<R;A++){_=q(T[A]);if(_<2.2){C=_*_;F=L(C);C=C-F;F=F*13;V=((((((((((((E[F]*C+E[F+1])*C+E[F+2])*C+E[F+3])*C+E[F+4])*C+E[F+5])*C+E[F+6])*C+E[F+7])*C+E[F+8])*C+E[F+9])*C+E[F+10])*C+E[F+11])*C+E[F+12])*_}else if(_<6.9){F=L(_);C=_-F;F=13*(F-2);V=(((((((((((z[F]*C+z[F+1])*C+z[F+2])*C+z[F+3])*C+z[F+4])*C+z[F+5])*C+z[F+6])*C+z[F+7])*C+z[F+8])*C+z[F+9])*C+z[F+10])*C+z[F+11])*C+z[F+12];V=V*V;V=V*V;V=V*V;V=1-V*V}else{V=1}if(T[A]<0){V=-V}T[A]=V}}else if(r===1){for(A=0,R=t.getLength();A<R;A++){C=e/(e+q(T[A]));k=C-.5;V=(((((((((S*k+I)*k+b)*k+d)*k+D)*k+y)*k+w)*k+M)*k+x)*k+v)*k+m;V=((((((((((((V*k+p)*k+c)*k+h)*k+u)*k+g)*k+f)*k+l)*k+s)*k+o)*k+n)*k+i)*k+a)*C*N(-T[A]*T[A]);if(T[A]<0){V=2-V}T[A]=V}}else if(r===2){for(A=0,R=t.getLength();A<R;A++){C=e/(e+q(T[A]));k=C-.5;V=(((((((((S*k+I)*k+b)*k+d)*k+D)*k+y)*k+w)*k+M)*k+x)*k+v)*k+m;V=((((((((((((V*k+p)*k+c)*k+h)*k+u)*k+g)*k+f)*k+l)*k+s)*k+o)*k+n)*k+i)*k+a)*C*N(-T[A]*T[A]);if(T[A]<0){V=2-V}T[A]=N(T[A]*T[A])*V}}return t};t.erf=function(){return r(this,0)};t.erfc=function(){return r(this,1)};t.erfcx=function(){return r(this,2)};(function(t){var r=171.624;var e=new Float64Array([-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054]),a=new Float64Array([-30.840230011973897,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.25967555349]),i=new Float64Array([-.001910444077728,.00084171387781295,-.0005952379913043012,.0007936507935003503,-.0027777777777776816,.08333333333333333,.0057083835261]);var n=function(t){return t>0?Math.floor(t):Math.ceil(t)};t.gamma=function(){if(!this.isreal()){throw"Matrix.gamma: Do not work on complex numbers."}var t=Number.POSITIVE_INFINITY,o=.9189385332046728,s=2.22507e-308,l=2.220446049250313e-16;var f,g,u,h,c,p,m,v,x;var M=this.getData(),w,y;for(w=0,y=M.length;w<y;w++){f=M[w];var D=0,d=1,b=0,I=f;if(I<=0){I=-f;p=n(I);m=I-p;if(m!==0){if(p!==n(p*.5)*2){D=1}d=-Math.PI/Math.sin(Math.PI*m);I+=1}else{M[w]=t;continue}}if(I<l){if(I>=s){m=1/I}else{M[w]=t;continue}}else if(I<12){p=I;if(I<1){c=I;I+=1}else{b=parseInt(I,10)-1;I-=parseFloat(b);c=I-1}h=0;u=1;for(g=0;g<8;++g){h=(h+e[g])*c;u=u*c+a[g]}m=h/u+1;if(p<I){m/=p}else if(p>I){for(g=0;g<b;++g){m*=I;I+=1}}}else{if(I<=r){x=I*I;v=i[6];for(g=0;g<6;g++){v=v/x+i[g]}v=v/I-I+o;v+=(I-.5)*Math.log(I);m=Math.exp(v)}else{M[w]=t;continue}}if(D){m=-m}if(d!==1){m=d/m}M[w]=m}return this}})(t)})(Matrix.prototype);var root=typeof window==="undefined"?module.exports:window;(function(t){function r(t,r,e,a){"use strict";this.bins=[t,r];this.mesure=e;if(a){this.baryCenter(a)}}r.prototype.toString=function(){"use strict";return"["+this.bins.toString()+"]"};r.prototype.getCopy=function(){"use strict";var t=new r(this.bins[0],this.bins[1],this.mesure);t.norm=this.norm;t.phase=this.phase;return t};r.prototype.compar=function(t,r){"use strict";return t.mesure<r.mesure};r.prototype.baryCenter=function(t,r){"use strict";var e=t.length;var a=this.bins[0],i=this.bins[1];r=r||e;var n=0,o,s=0;if(i>=a){for(o=a;o<=i;o++){s+=t[o]}for(o=a;o<=i;o++){n+=t[o]*o}n/=s}else{for(o=a;o<e;o++){s+=t[o]}for(o=0;o<=i;o++){s+=t[o]}for(o=a;o<e;o++){n+=t[o]*(o-a)}for(o=0;o<=i;o++){n+=t[o]*(o+e-a)}n/=s;n+=a;n=n>=e?n-e:n}this.norm=s;this.phase=n/r;return this};root.Mode=r})(root);(function(t){"use strict";var r=function(t){var r,e;for(r=1,e=t.length;r<e;r++){t[r]+=t[r-1]}};var e=function(t,r){r=1/r;var e,a;for(e=0,a=t.length;e<a;e++){t[e]*=r}};var a=function(t,r,e){var a,i,n,o,s=t.length;var l=new Float32Array(s*s);for(o=0;o<s;o++){l[o]=t[o]}for(a=1,i=s;a<s;a++,i+=s){if(r){for(n=0,o=i;n<a;n++,o++){l[o]=t[n]+e-t[a-1]}}for(n=a,o=i+n;n<s;n++,o++){l[o]=t[n]-t[a-1]}}return l};var i=function(t,r,e,a,i){var n,o,s,l=Math.sqrt(t.length),f,g;var u=new Float32Array(l*l);var h=new Float32Array(l*l);for(n=0,o=0,f=l*l;o<f;n++,o+=l){if(i){for(s=o,g=o+n;s<g;s++){u[s]=e(t[s],r[s]);h[s]=e(a-t[s],1-r[s])}}for(s=o+n,g=o+l;s<g;s++){u[s]=e(t[s],r[s]);h[s]=e(a-t[s],1-r[s])}}return[u,h]};var n=function(t){var r=new Float32Array(t.length);var e,a=t.length,i=1/a;for(e=0;e<a;e++){r[e]=i}return r};var o=function(t,r,e){var a=Math.log,i=Math.sqrt,n=Math.lerfc;var o=1/a(10),s=a(.5);var l=Number.MIN_VALUE;if(r!==undefined&&e!==undefined){var f=-1/t*o,g=t*r,u=e/r;return function(e,a){if(a<=l){return 0}var o=a*g;var h=o*(r*(1-a)+u);var c=(t*e-o)/i(2*h);return(s+n(c))*f}}else{return function(t,r){if(t<=r||r<=l){return 0}if(t===1){return-a(r)*o}return(t*a(t/r)+(1-t)*a((1-t)/(1-r)))*o}}};var s=function(t,r,e,a){if(a){return(Math.log(t*(t-1))/Math.log(10)+e)/r}else{return(Math.log(t*(t-1)/2)/Math.log(10)+e)/r}};var l=function(t,r,e){if(t>r){if(t>e){return t}else{return e}}else{if(r>e){return r}else{return e}}};var f=function(t,r,e){if(t<r){if(t<e){return t}else{return e}}else{if(r<e){return r}else{return e}}};var g=function(t,r,e){var a,i,n,o,s;var f=new Float32Array(r*r);for(a=0,i=r*r;a<i;a+=r+1){f[a]=t[a]}for(a=r-2;a>=0;a--){for(n=a*r+a+1,o=(a+1)*r;n<o;n++){f[n]=l(f[n+r],f[n-1],t[n])}}if(e){f[(r-1)*r]=l(f[0],f[(r-1)*r+r-1],t[(r-1)*r]);for(s=1,n=(r-1)*r+s;s<r-1;++s,++n){f[n]=l(t[n],f[s],f[n-1])}for(a=(r-2)*r;a>0;a-=r){f[a]=l(t[a],f[a+r-1],f[a+r])}for(a=r-2;a>0;a--){for(n=a*r+1,o=a*r+a;n<o;++n){f[n]=l(t[n],f[n-1],f[n+r])}}}return f};var u=function(t,r,e){var a,i,n,o,s;var f=new Float32Array(r*r);if(e){for(a=r,i=r*r;a<i;a+=r+1){f[a]=t[a]}for(a=2;a<r;++a){for(o=a*r-1,n=a*r+a-2;n>o;--n){f[n]=l(t[n],f[n-r],f[n+1])}}}f[r-1]=t[r-1];for(n=r-2,s=(r-1)*r+n;n>=0;--n,--s){f[n]=l(t[n],f[n+1],f[s])}for(a=1*r,i=r*r;a<i;a+=r){f[a+r-1]=l(f[a-1],f[a],t[a+r-1])}for(a=1;a<r-1;a++){for(n=a*r+r-2,o=a*r+a;n>=o;n--){f[n]=l(f[n-r],f[n+1],t[n])}}return f};var h=function(t,r,e,a,i){var n,o,s,l,f,g,u;var h=new Float32Array(e*e);for(g=0,u=h.length;g<u;++g){h[g]=r[g]>=a?1:0}for(n=e-2;n>=0;n--){for(l=n*e+n+1,f=(n+1)*e;l<f;l++){h[l]+=h[l-1]+h[l+e]}}if(i){h[(e-1)*e]+=h[0]+h[(e-1)*e+e-1];for(l=1;l<e-1;++l){h[(e-1)*e+l]+=h[l]+h[(e-1)*e+l-1]}for(s=e-2,n=s*e,o=0;n>o;n-=e,--s){h[n]+=h[n+e]+h[n+e-1];for(l=n+1,f=n+s;l<f;++l){h[l]+=h[l-1]+h[l+e]}}}for(g=0,u=h.length;g<u;++g){h[g]=h[g]?0:t[g]}return h};var c=function(t,r,e,a,i,n){var o=[];var s,l,f,g,u=Math.sqrt(e.length),h,c;for(s=0,l=0,h=u*u;l<h;s++,l+=u){for(f=r?0:s,g=l+f,c=l+u;g<c;f++,g++){if(e[g]>=n&&a[g]<=e[g]&&i[g]<=e[g]){o.push(new Mode(s,f,e[g],t))}}}return o.sort(Mode.prototype.compar)};var p=function(t,l,f,g,u,h,c){var p=t.length;var m=new Float32Array(t);l=l===undefined?false:l;f=f===undefined?0:f;c=c===undefined?n(t):new Float32Array(c);r(c);r(m);var v=m[p-1];g=g===undefined?v:g;e(c,c[p-1]);e(m,g);var x=a(c,l,1);var M,w,y;if(g&&u&&h){M=a(m,l,v/g);w=o(g,u,h);y=i(M,x,w,v/g,l)}else{M=a(m,l,1);w=o(g,u,h);y=i(M,x,w,1,l)}var D=s(p,g,f,l);var d=y[0],b=y[1];

return{Hmod:d,Hgap:b,thresh:D}};var m=function(t,r,e,a,i,n,o){var s=p(t,r,e,a,i,n,o);var l=h(s.Hgap,s.Hmod,t.length,s.thresh,r);var f=u(l,t.length,r);var m=g(l,t.length,r);var v=c(t,r,l,f,m,s.thresh);var x=h(s.Hmod,s.Hgap,t.length,s.thresh,r);var M=u(x,t.length,r);var w=g(x,t.length,r);var y=c(t,r,x,M,w,s.thresh);return{modes:y,gaps:v}};var v=function(t,r,e,a,i,n,o){var s=p(t,r,e,a,i,n,o);var l=h(s.Hmod,s.Hgap,t.length,s.thresh,r);var f=u(l,t.length,r);var m=g(l,t.length,r);var v=c(t,r,l,f,m,s.thresh);return v};var x=function(t,r,e,a,i,n,o){var s=p(t,r,e,a,i,n,o);var l=h(s.Hgap,s.Hmod,t.length,s.thresh,r);var f=u(l,t.length,r);var m=g(l,t.length,r);var v=c(t,r,l,f,m,s.thresh);return v};Matrix.prototype.getModesAndGaps=function(t,r,e,a,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return m(o,t,r,e,a,i,n)};Matrix.getModesAndGaps=function(t,r,e,a,i,n,o){t=Matrix.toMatrix(t);return t.getModesAndGaps(r,e,a,i,n,o)};Matrix.prototype.getModes=function(t,r,e,a,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return v(o,t,r,e,a,i,n)};Matrix.getModes=function(t,r,e,a,i,n,o){t=Matrix.toMatrix(t);return t.getModes(r,e,a,i,n,o)};Matrix.prototype.getGaps=function(t,r,e,a,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return x(o,t,r,e,a,i,n)};Matrix.getGaps=function(t,r,e,a,i,n,o){t=Matrix.toMatrix(t);return t.getGaps(r,e,a,i,n,o)};root.extractModes=v;root.extractGaps=x;root.extravctModesAndGaps=m})(Matrix);function getHistograms(t,r,e,a,i,n){"use strict";var o=0,s=0,l=0;var f,g;var u,h,c,p;var m=Math.floor,v=1/(i-a),x;u=new Float32Array(e);if(r){h=new Float32Array(e);if(n){for(f=0,g=t.length;f<g;f++){x=m((t[f]-a)*v*e);x=x<0?e+x%e:x%e;h[x]+=r[f];u[x]++;s+=r[f];o++}s/=o;for(f=0,g=t.length;f<g;f++){c=r[f]-s;l+=c*c}l=l/(o-1)}else{for(f=0,g=t.length;f<g;f++){p=t[f];if(p<a||p>i){continue}x=m((t[f]-a)*v*e);h[x]+=r[f];u[x]++;s+=r[f];o++}s/=o;for(f=0,g=t.length;f<g;f++){p=t[f];if(p<a||p>i){continue}c=r[f]-s;l+=c*c}l=l/(o-1)}}else{if(n){for(f=0,g=t.length;f<g;f++){x=m((t[f]-a)*v*e);x=x<0?e+x%e:x%e;u[x]++;o++}}else{for(o=0,f=0,g=t.length;f<g;f++){x=m((t[f]-a)*v*e);if(x<0||x>e){continue}u[x]++;o++}}}return{histw:h,hist:u,mu:s,sigma:l,M:o}}