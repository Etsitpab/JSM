/**
 * This program is free software: you can redistribute it and/or modify    
 * it under the terms of the GNU General Public License as published by        
 * the Free Software Foundation, either version 3 of the License, or 
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * 
 * @author Baptiste Mazin     <baptiste.mazin@telecom-paristech.fr> 
 * @author Guillaume Tartavel <guillaume.tartavel@telecom-paristech.fr> 
 */
function MatrixView(i){"use strict";var t;var e;var r;var n;var s=[];var o={};var a=function(i){r=Tools.checkSize(i);n=[];var s,a=r.length;for(t=[],e=[],s=0;s<a;s++){t[s]=0;e[s]=(r[s-1]||1)*(e[s-1]||1)}o={first:t.slice(),step:e.slice(),size:r.slice(),indices:[]};return this}.bind(this);var h=function(i){var s,o=i.getDimLength();t=[];e=[];r=[];n=[];for(s=0;s<o;s++){t.push(i.getFirst(s));e.push(i.getStep(s));r.push(i.getSize(s));if(i.isIndicesIndexed(s)){n.push(i.getIndices(s))}}return this}.bind(this);this.save=function(){s.push(new MatrixView(this));return this}.bind(this);this.restore=function(){var i=s.pop();if(Tools.isSet(i)){h(i)}else{t=o.first.slice();e=o.step.slice();r=o.size.slice();n=[]}return this}.bind(this);var f=function(){return r.length};var u=function(){var i,t=f(),e;for(i=0,e=1;i<t;i++){e*=r[i]}return e};var l=function(i){if(!Tools.isSet(i)){return r.slice()}if(!Tools.isInteger(i,0)){throw new Error("MatrixView.getSize: invalid dimension.")}return Tools.isSet(r[i])?r[i]:1};var c=function(i){if(!Tools.isInteger(i,0)){throw new Error("MatrixView.isIndicesIndexed: invalid dimension.")}return Tools.isSet(n[i])};var g=function(i){if(!Tools.isInteger(i,0)){throw new Error("MatrixView.getIndices: invalid dimension.")}if(!c(i)){throw new Error("MatrixView.getIndices: "+"dimension isn't indexed by indices.")}return n[i].slice()};var d=function(i){if(!Tools.isInteger(i,0)){throw new Error("MatrixView.getSteps: invalid dimension.")}if(!c(i)){throw new Error("MatrixView.getSteps: "+"Dimension isn't indexed with indices.")}var t=n[i].slice();var e;for(e=t.length-1;e>0;e--){t[e]-=t[e-1]}var r=n[i][n[i].length-1];t.push(-(r+1));t[0]=0;return t};var w=function(){var i,t=o.size.length,e;for(i=0,e=1;i<t;i++){e*=o.size[i]}return e};var v=function(){return o.size.slice()};var x=function(i){var n=f();var s=i.length;if(s>1&&s!==n){throw new Error("MatrixView.getIndex: invalid ND-index.")}var o,a;for(o=0,a=0;o<s;o++){if(i[o]<0||i[o]>=r[o]){throw new Error("MatrixView.getIndex: invalid index.")}a+=t[o]+i[o]*e[o]}return a};var p=function(i){if(!Tools.isInteger(i,0)){throw new Error("MatrixView.getFirst: invalid dimension.")}return Tools.isSet(t[i])?t[i]:0};var m=function(i){if(!Tools.isInteger(i,0)){throw new Error("MatrixView.getStep: invalid dimension.")}if(c(i)){throw new Error("MatrixView.getStep: dimension is indexed by indices.")}return Tools.isSet(e[i])?e[i]:1};var I=function(i){if(!Tools.isInteger(i,0)){throw new Error("MatrixView.getEnd: invalid dimension.")}if(c(i)){return-1}var n=Tools.isSet(r[i])?r[i]:1;return(t[i]||0)+n*(e[i]||1)};this.getDimLength=f;this.getLength=u;this.getInitialLength=w;this.getInitialSize=v;this.getIndex=x;this.getFirst=p;this.getStep=m;this.getSteps=d;this.getEnd=I;this.getSize=l;this.isIndicesIndexed=c;this.getIndices=g;var E=function(i){if(!Tools.isInteger(i,0)){throw new Error("MatrixView.pushSingletonDimensions: invalid dimension.")}var n;for(n=0;n<i;n++){t.push(0);e.push(1);r.push(1)}return this}.bind(this);var M=function(i,s){if(!Tools.isInteger(i,0)){throw new Error("MatrixView.select: invalid dimension.")}s=Tools.checkColon(s,l(i));if(!c(i)){t[i]+=s[0]*e[i];e[i]*=s[1];r[i]=Math.floor(Math.abs((s[2]-s[0])/s[1]))+1}else{var o,a,h,f=n[i],u=[];for(o=s[0],a=s[2],h=s[1];o<=a;o+=h){u.push(f[o])}t[i]=u[0];n[i]=u;r[i]=u.length}return this}.bind(this);var V=function(i,s){if(!Tools.isInteger(i,0)){throw new Error("MatrixView.selectIndicesDimension: Dimension "+"must be a positive integer.")}if(!Tools.isArrayOfIntegers(s,0,l(i)-1)){throw new Error("MatrixView.selectIndicesDimension: Invalid index.")}s=Array.prototype.slice.apply(s);var o,a;if(!c(i)){var h=p(i),f=m(i);for(o=0,a=s.length;o<a;o++){s[o]*=f;s[o]+=h}}else{for(o=0,a=s.length;o<a;o++){s[o]=n[s[o]]}}if(s[0]===undefined){s[0]=-1}t[i]=s[0];e[i]=1;r[i]=s.length;n[i]=s;return this}.bind(this);var T=function(i,t){if(!Tools.isInteger(i,0)){throw new Error("MatrixView.selectBooleanDimension: invalid dimension.")}if(t.length!==l(i)){throw new Error("MatrixView.selectBooleanDimension: array dimensions mismatch.")}var e,r,n,s=new Array(t.length);for(e=0,n=0,r=t.length;e<r;e++){if(t[e]){s[n]=e;n+=1}}return this.selectIndicesDimension(i,s.slice(0,n))}.bind(this);var S=function(i,t,e){var r=i[t];i[t]=i[e];i[e]=r};var b=function(i,s){var o=f();if(!Tools.isInteger(i,0)){throw new Error("MatrixView.swapDimensions: invalid dimensions.")}if(!Tools.isInteger(s,0)){throw new Error("MatrixView.swapDimensions: invalid dimensions.")}var a=Math.max(i,s)+1-o;if(a>0){E(a)}S(t,i,s);S(e,i,s);S(r,i,s);S(n,i,s);return this}.bind(this);var D=function(i){var n;if(!Tools.isSet(i)){for(n=0;r.length>0&&r[0]===1;n++){t.shift();e.shift();r.shift()}if(f()===1){t.push(0);e.push(1);r.push(1)}}else{var s=f();if(!Tools.isInteger(i,1-s,s-1)){throw new Error("MatrixView.shiftDimension: invalid shift.")}for(n=0;n<i;n++){t.push(t.shift());e.push(e.shift());r.push(r.shift())}for(n=i;n<0;n++){t.unshift(0);e.unshift(1);r.unshift(1)}}}.bind(this);this.selectDimension=M;this.selectIndicesDimension=V;this.selectBooleanDimension=T;this.swapDimensions=b;this.shiftDimension=D;this.display=function(){var i,t;for(i=0,t=f();i<t;i++){if(c(i)){console.log(true,g(i))}else{console.log(false,p(i),m(i),l(i))}}return this}.bind(this);if(Tools.isArrayLike(i)){return a(i)}if(i instanceof MatrixView){h(i);o.first=t.slice();o.step=e.slice();o.size=r.slice();return this}throw new Error("MatrixView: invalid argument.")}(function(i,t){"use strict";function e(i,t){var e,r=i.length;var n=i.slice();for(e=r-1;e>0;e--){n[e]-=n[e-1];n[e]*=t}n[0]=0;n.push(-i[r-1]*t-1);return n}function r(i,t){var r,n,s;var o=i[0],a=e(i,t||1);this.iterator=function(){return r+=a[++n]};this.begin=function(i){i=i||0;n=0;s=i-1;return r=i+o};this.end=function(){return s};this.isEnd=function(){return r===s};this.getPosition=function(){return n};this.getIndex=function(){return r}}function n(i,t,e){var r,n,s;this.iterator=function(){return s+=t};this.begin=function(t){t=t||0;r=t+i;n=t+e;return s=r};this.end=function(){return n};this.isEnd=function(){return s===n};this.getPosition=function(){return(s-r)/t};this.getIndex=function(){return s}}function s(i,t){var e,r,n,s,o,a,h;function f(i){if(i>=n){return-1}var t=e[i],r=t.iterator();if(t.isEnd()){r=f(i+1);return r!==-1?t.begin(r):-1}return r}this.iterator=function(){r+=o;if(r===h){var i=f(t+1);r=i===-1?-1:i+s;h=i+a}return r};this.begin=function(){s=i.getFirst(t);o=i.getStep(t);a=i.getEnd(t);n=i.getDimLength();var f,u;e=new Array(n);for(f=n-1;f>t;f--){e[f]=i.getSubIterator(f);u=e[f].begin(u||0)}for(r=0,f=t+1;f<n;f++){r+=i.getFirst(f)}h=r+a;r+=s;return r};this.isEnd=function(){return r===-1};this.end=function(){return-1};this.getPosition=function(){var i,n,a=[],h;if(e[t+1]){h=e[t+1].getIndex()}else{h=0}a[0]=(r-h-s)/o;for(i=t+1,n=e.length;i<n;i++){a[i-t]=e[i].getPosition()}return a}}function o(i,t){var e,r,n,s,o,a,h;var f=i.getIndices(t);var u=i.getSteps(t);var l=function(i){var t=e[i];if(!t){return-1}var r=t.iterator();if(t.isEnd()){r=l(i+1);return r!==-1?t.begin(r):-1}return r};this.iterator=function(){n++;if(n===h){var i=l(t+1);if(i===-1){return r=-1}r=i+o;n=0}r+=u[n];return r};this.begin=function(){o=i.getFirst(t);a=i.getEnd(t);s=i.getDimLength();var u,l;e=new Array(s);for(u=s-1;u>t;u--){e[u]=i.getSubIterator(u);l=e[u].begin(l||0)}for(n=0,r=0,u=t;u<s;u++){r+=i.getFirst(u)}h=f.length;return r};this.isEnd=function(){return r===-1};this.end=function(){return-1};this.getPosition=function(){var i,r,s=[];s[0]=n;for(i=t+1,r=e.length;i<r;i++){s[i-t]=e[i].getPosition()}return s}}t.getIterator=function(i){if(!Tools.isSet(i)){i=0}else if(!Tools.isInteger(i,0)){throw new Error("MatrixView.getIterator: invalid dimension.")}if(this.isIndicesIndexed(i)){return new o(this,i)}var t=new s(this,i);return t};t.getSubIterator=function(i){if(!Tools.isInteger(i,0)){throw new Error("MatrixView.getSubIterator: invalid dimension.")}if(this.isIndicesIndexed(i)){return new r(this.getIndices(i),1)}var t=this.getFirst(i);var e=this.getStep(i);var s=this.getEnd(i);return new n(t,e,s)};t.extractTo=function(i,t){if(!Tools.isArrayLike(t)){throw new Error("MatrixView.extractTo: invalid output data.")}if(t.length!==this.getInitialLength()){throw new Error("MatrixView.extractTo: Output data length is invalid.")}var e=this.getIterator(1);var r,n,s=e.iterator,o=e.begin,a=e.end;var h,f,u=this.getFirst(0),l=this.getEnd(0);var c,g,d,w;var v;if(Tools.isArrayLike(i)&&i.length===this.getLength()){if(t===i){throw new Error("MatrixView.extractTo: cannot perform on-place extraction.")}if(this.isIndicesIndexed(0)){c=this.getSteps(0);for(r=o(),n=a(),v=0;r!==n;r=s()){for(w=0,h=r+u,f=r+l;h!==f;v++,h+=c[++w]){t[h]=i[v]}}}else{d=this.getStep(0);for(r=o(),n=a(),v=0;r!==n;r=s()){for(h=r+u,g=r+l;h!==g;h+=d,v++){t[h]=i[v]}}}}else if(i.length===1||typeof i==="number"){if(i.length===1){i=i[0]}if(this.isIndicesIndexed(0)){c=this.getSteps(0);for(r=o(),n=a(),v=0;r!==n;r=s()){for(w=0,h=r+u,f=r+l;h!==f;h+=c[++w]){t[h]=i}}}else{d=this.getStep(0);for(r=o(),n=a(),v=0;r!==n;r=s()){for(h=r+u,g=r+l;h!==g;h+=d){t[h]=i}}}}else{throw new Error("MatrixView.extractTo: invalid input length.")}return t};t.extractFrom=function(i,t){if(!Tools.isArrayLike(i)){throw new Error("MatrixView.extractFrom: invalid input data.")}if(i.length!==this.getInitialLength()){throw new Error("MatrixView.extractFrom: input data dimensions mismatch.")}t=t||new i.constructor(this.getLength());if(!Tools.isArrayLike(t)){throw new Error("MatrixView.extractFrom: invalid output data.")}if(t.length!==this.getLength()){throw new Error("MatrixView.extractFrom: output data dimensions mismatch.")}if(t===i){throw new Error("MatrixView.extractFrom: cannot perform on-place extraction.")}var e=this.getIterator(1);var r,n,s=e.iterator,o=e.begin,a=e.end;var h,f,u=this.getFirst(0),l=this.getEnd(0);var c;if(this.isIndicesIndexed(0)){var g=this.getSteps(0),d;for(r=o(),n=a(),c=0;r!==n;r=s()){for(d=0,h=r+u,f=r+l;h!==f;c++,h+=g[++d]){t[c]=i[h]}}}else{var w,v=this.getStep(0);for(r=o(),n=a(),c=0;r!==n;r=s()){for(h=r+u,w=r+l,f=r+l;h!==f;h+=v,c++){t[c]=i[h]}}}return t};t.extract=function(t,e,r){if(!Tools.isArrayLike(t)){throw new Error("MatrixView.extract: invalid input data.")}if(!(e instanceof i)){throw new Error("MatrixView.extract: invalid output view.")}if(!Tools.isArrayLike(r)){throw new Error("MatrixView.extract: invalid output data.")}if(t.length!==this.getInitialLength()){throw new Error("MatrixView.extract: invalid input data length.")}if(r.length!==e.getInitialLength()){throw new Error("MatrixView.extract: invalid output data length.")}if(r===t){throw new Error("MatrixView.extract: cannot perform on-place extraction.")}var n,s,o,a;var h,f,u,l;var c,g;if(this.isIndicesIndexed(0)&&e.isIndicesIndexed(0)){c=this.getIterator(1);n=c.iterator;o=c.begin;a=c.isEnd;var d,w,v,x=n.getFirst(0),p=n.getEnd(0);var m=n.getSteps(0),I;for(s=o(),v=0;!a();s=n()){for(I=1,d=s+x,w=s+p;I!==w;v++,d+=m[I],I++){r[v]=t[d]}}}else{c=this.getIterator(0);n=c.iterator;o=c.begin;a=c.end;g=e.getIterator(0);u=g.begin;h=g.iterator;for(s=o(),f=u(),l=a();s!==l;s=n(),f=h()){r[f]=t[s]}}return r}})(MatrixView,MatrixView.prototype);if(typeof window==="undefined"){module.exports.MatrixView=MatrixView}(function(i,t){"use strict";t.ndims=function(){return this.getDimLength()};t.isrow=function(){var i=this.getSize();return i.length===2&&i[0]===1};t.iscolumn=function(){var i=this.getSize();return i.length===2&&i[1]===1};t.isvector=function(){var i=this.getSize();return i.length===2&&(i[1]===1||i[0]===1)};t.ismatrix=function(){return this.getSize().length===2}})(MatrixView,MatrixView.prototype);(function(i,t){"use strict";t.select=function(){var i=Tools;var t,e;for(t=0,e=arguments.length;t<e;t++){var r=arguments[t];if(i.isArrayLike(r)){if(i.isArrayLike(r[0])){this.selectIndicesDimension(t,r[0])}else if(i.isArrayOfBooleans(r)){this.selectBooleanDimension(t,r)}else if(r.length!==0){this.selectDimension(t,r)}}else if(i.isInteger(r)){this.selectDimension(t,r)}else{throw new Error("MatrixView.select: Invalid selection.")}}return this};t.permute=function(i){var t=this.constructor.name+".permute: ";if(i.length<this.getDimLength()){throw new Error(t+"Dimension permutation is invalid.")}i=i.slice();var e=i.length;var r,n,s;for(r=0;r<e;r++){var o=false;for(s=0;s<e;s++){if(i[s]===r){o=true}}if(o===false){throw new Error(t+"Dimension permutation is invalid.")}}for(r=0,n=e;r<n;r++){s=r;while(true){var a=i[s];i[s]=s;if(a===r){break}else{this.swapDimensions(s,a)}s=a}}return this};t.ipermute=function(i){var t,e,r=[];for(t=0,e=i.length;t<e;t++){r[t]=t}var n=function(t,e){return i[t]-i[e]};return this.permute(r.sort(n))};t.rot90=function(i){var t=this.constructor.name+".rot90: ";switch(typeof i){case"number":if(!Tools.isInteger(i)){throw new Error(t+"Argument must be an integer.")}i%=4;if(i<0){i+=4}break;case"undefined":i=1;break;default:throw new Error(t+"Wrong argument type.")}switch(i){case 1:return this.swapDimensions(0,1).flipud();case 2:return this.flipud().fliplr();case 3:return this.swapDimensions(0,1).fliplr()}return this};t.flipdim=function(i){return this.selectDimension(i,[-1,0])};t.fliplr=function(){return this.select([0,-1],[-1,0])};t.flipud=function(){return this.select([-1,0],[0,-1])};t.setWorkingDimension=function(i){if(i>=this.getDimLength()){throw new Error("Invalid dimension.")}var t=[];var e,r=this.getDimLength();for(e=0;e<r;e++){t[e]=e}t=t.splice(i,1).concat(t);return this.permute(t)}})(MatrixView,MatrixView.prototype);