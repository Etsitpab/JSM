/**
 * This program is free software: you can redistribute it and/or modify    
 * it under the terms of the GNU General Public License as published by        
 * the Free Software Foundation, either version 3 of the License, or 
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * 
 * @author Baptiste Mazin     <baptiste.mazin@telecom-paristech.fr> 
 * @author Guillaume Tartavel <guillaume.tartavel@telecom-paristech.fr> 
 */
var global=typeof window==="undefined"?module.exports:window;(function(e){"use strict";function t(e,t,i,a){e=e||"plot 1";var n,s;if(typeof t===Number){n=t;s=t}else if(t instanceof Array&&t.length===2){n=t[0];s=t[1]}if(i){if(!(i instanceof HTMLElement)){i=document.getElementById(i);i=i||document.body}var o=this;if(!t){var l=function(){o.setWidth(i.clientWidth);o.setHeight(i.clientHeight);o.autoDisplay()};window.addEventListener("resize",l);n=i.clientWidth;s=i.clientHeight}}a=a||{};var h={width:n,height:s,id:e};var d=r.createSVGNode("svg",h);d.getPlot=function(){return this}.bind(this);this.getParentNode=function(){return i};this.getId=function(){return e};this.getWidth=function(){return parseFloat(d.getAttribute("width"))};this.setWidth=function(e){d.setAttributeNS(null,"width",e);this.autoDisplay();return this};this.getHeight=function(){return parseFloat(d.getAttribute("height"))};this.setHeight=function(e){d.setAttributeNS(null,"height",e);this.autoDisplay();return this};this.getDrawing=function(){return d};var u={x:0,y:0,width:1,height:1};this.getCurrentAxis=function(){var e,t={};for(e in u){if(u.hasOwnProperty(e)){t[e]=u[e]}}return t};this.setCurrentAxis=function(e){u.x=e.x;u.y=e.y;u.width=e.width;u.height=e.height;return this};var c=this.getProperties("ownProperties");this.getOwnProperty=function(e){return c[e]};this.setOwnProperty=function(e,t){c[e]=t;this.autoDisplay();return this};var g;for(g in a){if(a.hasOwnProperty(g)){c[g]=a[g]}}this.initialize();return this}t.prototype.properties={ownProperties:{"preserve-ratio":false,"ticks-display":true,"title-display":false,"xLabel-display":false,"yLabel-display":false,"legend-display":"none","compute-closest":true,"autoId-curves":0,"autoId-marker":0},title:{id:"title","font-size":"16pt","font-family":"Sans-Serif",fill:"gray",style:"text-anchor: middle;"},drawingArea:{id:"drawingArea",preserveAspectRatio:"none"},front:{id:"front",fill:"white","fill-opacity":0,stroke:"none",preserveAspectRatio:"none"},markers:{id:"markers"},curves:{id:"curves",preserveAspectRatio:"none","stroke-width":1,"stroke-linejoin":"round",stroke:"blue",fill:"blue"},axis:{id:"axis",stroke:"grey","stroke-width":1,"font-size":"10pt","font-family":"Sans-Serif"},grid:{id:"grid",stroke:"grey","stroke-width":1,"stroke-dasharray":"5 2"},xAxis:{id:"xAxis",style:"text-anchor: middle;"},yAxis:{id:"yAxis",style:"text-anchor: end;"},xAxisLine:{id:"xAxisLine","marker-mid":"url(#tickMarker)"},xAxisLineBis:{id:"xAxisLineBis","marker-mid":"url(#tickMarker)"},yAxisLine:{id:"yAxisLine","marker-mid":"url(#tickMarker)"},yAxisLineBis:{id:"yAxisLineBis","marker-mid":"url(#tickMarker)"},cursor:{id:"cursor","vector-effect":"non-scaling-stroke",marker:{shape:"circle",size:4,stroke:"grey","stroke-width":.25,fill:"none"}},xLabel:{id:"xLabel","font-size":"12pt","font-family":"Sans-Serif","font-style":"oblique",fill:"gray",style:"text-anchor: middle;"},yLabel:{id:"yLabel","font-size":"12pt","font-family":"Sans-Serif","font-style":"oblique",fill:"gray",style:"text-anchor: middle;"},ticks:{id:"tickMarker",x1:0,y1:-2,x2:0,y2:2,markerUnits:"strokeWidth",overflow:"visible",orient:"auto","stroke-width":1},xTextTicks:{id:"xTextTicks",fill:"gray",stroke:"none"},yTextTicks:{id:"yTextTicks",fill:"gray",stroke:"none"},textTicks:{fill:"gray",stroke:"none"},legend:{id:"legend","font-size":"10pt","font-family":"Sans-Serif",overflow:"visible",fill:"gray",stroke:"none"},selectArea:{id:"selectArea",stroke:"gray",fill:"none","stroke-width":1,"vector-effect":"non-scaling-stroke",preserveAspectRatio:"none",markerUnits:"userSpaceOnUse",overflow:"visible"},path:{"vector-effect":"non-scaling-stroke",fill:"none"},marker:{shape:"none",fill:"blue",size:1,viewBox:"-1 -1 2 2","class":"scatterMarker",preserveAspectRatio:"none",markerUnits:"userSpaceOnUse",overflow:"visible"},histogram:{stroke:"none","vector-effect":"non-scaling-stroke","stroke-linejoin":"round","bar-width":.9},image:{}};t.prototype.addPath=function(e,t,i){var a=this.getProperties("path");var n;for(n in i){if(i.hasOwnProperty(n)){a[n]=i[n]}}var s=this.createPath(e,t,a);var o=new r.Vector(e);var l=new r.Vector(t);s.BBox=[o.min().get(0),l.min().get(0),o.max().get(0),l.max().get(0)];this.add(s,e,t);return this};t.prototype.plot=function(e,r,i){var a=this.constructor.name+".plot: ";var n,s;if(typeof e!=="function"){if(r&&!r.length){throw new Error(a+"x must be an array")}else if(!(e&&e.length)){throw new Error(a+"y must be an array or a function")}else if(!e[0].length){e=[e]}}else if(!(r&&r.length)){throw new Error(a+"if y is a function, x must be an array")}else{var o=e;for(e=[[]],n=0;n<r.length;n++){e[0].push(o(r[n]))}}var l=e.length;var h=e[0].length;if(!r){for(r=[],n=0;n<h;n++){r.push(n+1)}}for(s=0;s<l;s++){if(e[s].length!==r.length){throw new Error(a+"y and x must have the same length")}}var d=t.stringToArgs(i);for(s=0;s<l;s++){this.addPath(r,e[s],d)}return this};t.prototype.addHistogram=function(e,t,i){e=e||new Vector(1,t.length);var a=this.getProperties("histogram");var n;for(n in i){if(i.hasOwnProperty(n)){a[n]=i[n]}}var s=r.createSVGNode("g",a);s.setAttributeNS(null,"class","histogram");var o="bar"+a.id;var l=new r.Vector(e);var h=l.derive().min().get(0);var d=h*a["bar-width"];var u=a.colormap;var c;for(c=t.length-1;c>=0;c--){var g=r.createSVGNode("rect",a);g.setAttributeNS(null,"r",1);g.setAttributeNS(null,"id",o);g.setAttributeNS(null,"class","histogramBar");g.setAttributeNS(null,"x",e[c]-d/2);g.setAttributeNS(null,"y",-t[c]);g.setAttributeNS(null,"height",t[c]);g.setAttributeNS(null,"width",d);if(u){var v="hsl("+360*c/(t.length-1)+",100%,50%)";g.setAttributeNS(null,"fill",v)}s.appendChild(g)}var f=new r.Vector(e);var p=new r.Vector(t);s.BBox=[f.min().get(0)-h,0,f.max().get(0)+h,p.max().get(0)];this.add(s,e,t);return this};t.prototype.addImage=function(e,t,i,a){t=t||0;i=i||0;var n=this;var s=function(){var e=n.getProperties("image");var s;for(s in a){if(a.hasOwnProperty(s)){e[s]=a[s]}}e.width=this.width;e.height=this.height;e.x=t;e.y=-i;var o=r.createSVGNode("image",e);o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.src);o.BBox=[t,-this.height+i,t+this.width,i];n.add(o,t,i)};if(typeof e==="string"){var o=new Image;o.src=e;o.onload=s}else if(e instanceof HTMLImageElement){s.bind(e)()}return this};t.prototype.add=function(e,t,r){if(!e.getAttribute("id")){var i=this.getOwnProperty("autoId-curves");e.setAttributeNS(null,"id","curve-"+i);this.setOwnProperty("autoId-curves",i+1)}this.getDrawing().getElementById("curves").appendChild(e);this.setAxis();if(this.getOwnProperty("legend-display")!=="none"){this.setLegend()}if(this.getOwnProperty("compute-closest")){var a,n=this.tree,s=t.length,o=e.id;for(a=0;a<s;a++){n.add(t[a],r[a],a,e)}}return this};t.prototype.remove=function(e){var t=this.getDrawing().getElementById("curves");var r=false;if(t.hasChildNodes()){var i;var a=t.childNodes;for(i=0;i<a.length;i++){if(a[i].id===e){if(this.getOwnProperty("compute-closest")){this.tree.remove(a[i])}t.removeChild(a[i]);r=true;break}}}this.setAxis();this.setLegend();return r};t.prototype.clear=function(){if(this.getOwnProperty("compute-closest")){this.tree.clear()}var e=this.getDrawing().getElementById("curves");if(e.hasChildNodes()){while(e.childNodes.length>0){e.removeChild(e.firstChild)}}this.setOwnProperty("autoId-curves",0);this.setAxis();this.setLegend();return this};t.prototype.getProperties=function(e){var r={};var i=t.prototype.properties[e];var a;for(a in i){if(i.hasOwnProperty(a)){r[a]=i[a]}}return r};t.prototype.createPath=function(e,t,i){var a="";var n,s=e.length;for(n=0;n<s;n++){a+=e[n]+","+-t[n]+" "}var o=r.createSVGNode("polyline",i);o.setAttributeNS(null,"class","path");o.setAttributeNS(null,"points",a);this.setMarkerPath(o,i.marker);return o};t.prototype.setMarkerPath=function(e,t){var i=this.getDrawing();var a=i.getElementById("drawingArea");var n=i.getElementById("markers");var s=this.getProperties("marker");var o;for(o in t){if(t.hasOwnProperty(o)){s[o]=t[o]}}var l=this.getOwnProperty("autoId-marker");this.setOwnProperty("autoId-marker",l+1);var h=this.getId()+"marker_"+l.toString();h=h.replace(/ /g,"_");s.id=h;var d=r.createSVGNode("marker",s);n.appendChild(d);this.setMarkerShape(d,s.shape);e.setAttribute("marker-id",h);var u="url(#"+h+")";e.setAttribute("marker-start",u);e.setAttribute("marker-mid",u);e.setAttribute("marker-end",u);return this};t.prototype.setMarkerShape=function(e,t){var i;for(i=0;i<e.childNodes.length;i++){e.removeChild(e.childNodes[i])}var a;var n;switch(t.toLowerCase()){case"rect":case"rectangle":a={x:-1,y:-1,width:2,height:2};n=r.createSVGNode("rect",a);break;case"circle":a={r:1};n=r.createSVGNode("circle",a);break;case"triangle":a={points:"1.5, 0 -0.5, 1 -0.75, -1",viewBox:"-0.5 -0.866 1 0.866"};n=r.createSVGNode("polygon",a);break;case"none":return this;default:throw new Error("Plot.setMarkerShape: Unknown shape.")}e.appendChild(n);return this};t.prototype.setAxis=function(e){var t=this.getDrawing();var r=t.getElementById("drawingArea");var i=t.getElementById("curves");var a=r.width.baseVal.value,n=r.height.baseVal.value;var s,o,l;if(e instanceof Array){var h=Math.min(e[0],e[2]);var d=Math.min(-e[1],-e[3]);var u=Math.max(e[0],e[2])-h;var c=Math.max(-e[1],-e[3])-d;s={x:h,y:d,width:u,height:c}}else if(e instanceof Object){s=e}else if(typeof e==="string"){var g;var v=i.childNodes;for(g=0;g<v.length;g++){if(v[g].id===e){this.setAxis(v[g].BBox);return this}}}else{s=this.getCurvesBBox()}if(this.getOwnProperty("preserve-ratio")){var f=s.width/a,p=s.height/n;var y;switch(Math.max(f,p)){case f:y=s.height;s.height*=f/p;s.y+=(y-s.height)/2;break;case p:y=s.width;s.width/=f/p;s.x+=(y-s.width)/2;break}}if(!s.width){s.width=1;s.x-=.5}if(!s.height){s.height=1;s.y-=.5}this.setCurrentAxis(s);var w=s.x+" "+s.y+" "+s.width+" "+s.height;r.setAttributeNS(null,"viewBox",w);this.scaleElements();var m=t.getElementById("front");m.setAttributeNS(null,"x",s.x);m.setAttributeNS(null,"y",s.y);m.setAttributeNS(null,"width",s.width);m.setAttributeNS(null,"height",s.height);this.setXAxis();this.setYAxis();this.setLegendLocation();return this};t.prototype.setXAxis=function(){var e=this.getDrawing();var t=e.getElementById("xAxis");var i=e.getElementById("xAxisLine");var a=e.getElementById("xAxisLineBis");var n=e.getElementById("drawingArea");var s=this.getCurrentAxis();var o={x:n.x.baseVal.value,y:n.y.baseVal.value,width:n.width.baseVal.value,height:n.height.baseVal.value};var l=e.getElementById("xTextTicks");while(l.childNodes.length>0){l.removeChild(l.firstChild)}var h;var d=o.x+","+(o.y+o.height)+" ";var u=o.x+","+o.y+" ";if(this.getOwnProperty("ticks-display")){var c=o.width/s.width;var g=this.getAxisLimits(s.x,s.width,2);var v=r.Vector.linearSpace;var f=v(o.x+(g.min-s.x)*c,o.x+(g.min-s.x+(g.nTicks-1)*g.dTick)*c,g.nTicks).data;for(h=0;h<f.length;h++){d+=f[h]+","+(o.y+o.height)+" ";u+=f[h]+","+o.y+" "}var p=g.e10;var y,w=this.getProperties("textTicks");w.y=o.y+o.height+20;if(Math.abs(p)<2){p=0}else{w.x=o.x+o.width+20;y=r.createSVGTextNode("10^"+p,w);y.setAttributeNS(null,"font-weight","bold");l.appendChild(y)}var m=v(g.min,g.min+(g.nTicks-1)*g.dTick,g.nTicks).data;for(h=0;h<f.length;h++){w.x=f[h];m[h]=parseFloat((m[h]*Math.pow(10,-p)).toFixed(2));y=r.createSVGTextNode(m[h],w);l.appendChild(y)}}d+=o.x+o.width+","+(o.y+o.height)+" ";i.setAttributeNS(null,"points",d);u+=o.x+o.width+","+o.y+" ";a.setAttributeNS(null,"points",u);return this};t.prototype.setYAxis=function(){var e=this.getDrawing();var t=e.getElementById("yAxis");var i=e.getElementById("yAxisLine");var a=e.getElementById("yAxisLineBis");var n=e.getElementById("drawingArea");var s=this.getCurrentAxis();var o={x:n.x.baseVal.value,y:n.y.baseVal.value,width:n.width.baseVal.value,height:n.height.baseVal.value};var l=e.getElementById("yTextTicks");while(l.childNodes.length>0){l.removeChild(l.firstChild)}var h;var d=o.x+","+o.y+" ";var u=o.x+o.width+","+o.y+" ";if(this.getOwnProperty("ticks-display")){var c=o.height/s.height;var g=this.getAxisLimits(s.y,s.height,2);var v=r.Vector.linearSpace;var f=v(o.y+(g.min-s.y)*c,o.y+(g.min-s.y+(g.nTicks-1)*g.dTick)*c,g.nTicks).data;for(h=0;h<f.length;h++){d+=o.x+","+f[h]+" ";u+=o.x+o.width+","+f[h]+" "}var p=g.e10;var y,w=this.getProperties("textTicks");w.x=o.x-15;if(Math.abs(p)<2){p=0}else{w.y=o.y-10;y=r.createSVGTextNode("10^"+p,w);y.setAttributeNS(null,"font-weight","bold");l.appendChild(y)}var m=v(-g.min,-(g.min+(g.nTicks-1)*g.dTick),g.nTicks).data;var x=parseFloat(this.getProperties("axis")["font-size"]);for(h=0;h<f.length;h++){w.y=f[h]+x/2;m[h]=parseFloat((m[h]*Math.pow(10,-p)).toFixed(2));y=r.createSVGTextNode(m[h],w);l.appendChild(y)}}d+=o.x+","+(o.y+o.height)+" ";u+=o.x+o.width+","+(o.y+o.height)+" ";i.setAttributeNS(null,"points",d);a.setAttributeNS(null,"points",u);return this};t.prototype.getAxisLimits=function(e,t){var r=10;var i=[1,2,5];var a,n;var s=function(e){return Math.log(e)/Math.LN10};var o=function(e){return Math.pow(10,e)};var l=s(t/r);var h=l+2;for(a=0;a<i.length;a++){var d=s(i[a]);var u=Math.ceil(l-d)+d;if(u<h){h=u;n=a}}var c=Math.floor(h);var g=i[n]*o(c);var v=Math.ceil(e/g)*g;var f=Math.floor((e+t)/g)*g;var p=1+Math.round((f-v)/g);return{min:v,dTick:g,nTicks:p,e10:c}};t.prototype.getCurvesBBox=function(){var e=this.getDrawing().getElementById("curves");var t=[0,0,1,1];if(e.hasChildNodes()){t=e.childNodes[0].BBox;var r;var i=e.childNodes;for(r=1;r<i.length;r++){var a=i[r].BBox;t[0]=a[0]<t[0]?a[0]:t[0];t[1]=a[1]<t[1]?a[1]:t[1];t[2]=a[2]>t[2]?a[2]:t[2];t[3]=a[3]>t[3]?a[3]:t[3]}}var n={x:t[0],y:-t[3],width:t[2]-t[0],height:t[3]-t[1]};return n};t.prototype.scaleElements=function(){var e=this.getDrawing();var t=e.getElementById("drawingArea");var r=t.width.baseVal.value;var i=t.height.baseVal.value;var a=e.getElementById("markers").childNodes;var n=2*this.getCurrentAxis().width/r;var s=2*this.getCurrentAxis().height/i;var o;for(o=0;o<a.length;o++){a[o].setAttributeNS(null,"markerWidth",n*a[o].getAttribute("size"));a[o].setAttributeNS(null,"markerHeight",s*a[o].getAttribute("size"))}};t.prototype.setTitle=function(e,t,r){e=e||"";var i=this.getDrawing();var a=i.getElementById("title");if(a.hasChildNodes()){while(a.childNodes.length>0){a.removeChild(a.firstChild)}}if(e!==""){this.setOwnProperty("title-display",true);a.appendChild(document.createTextNode(e))}else{this.setOwnProperty("title-display",false)}if(t!==undefined){this.setXLabel(t)}if(r!==undefined){this.setYLabel(r)}this.autoDisplay();return this};t.prototype.setLabels=function(e,t){this.setXLabel(e);this.setYLabel(t);return this};t.prototype.setXLabel=function(e){e=e||"";var t=this.getDrawing();var r=t.getElementById("xLabel");if(r.hasChildNodes()){while(r.childNodes.length>0){r.removeChild(r.firstChild)}}if(e!==""){this.setOwnProperty("xLabel-display",true);r.appendChild(document.createTextNode(e))}else{this.setOwnProperty("xLabel-display",false)}this.autoDisplay();return this};t.prototype.setYLabel=function(e){e=e||"";var t=this.getDrawing();var r=t.getElementById("yLabel");if(r.hasChildNodes()){while(r.childNodes.length>0){r.removeChild(r.firstChild)}}if(e!==""){this.setOwnProperty("yLabel-display",true);var i=document.createTextNode(e);r.appendChild(i);this.rotateYLabel()}else{this.setOwnProperty("yLabel-display",false)}this.autoDisplay();return this};t.prototype.rotateYLabel=function(){var e=this.getDrawing();var t=e.getElementById("yLabel");var r=t.getBBox();var i=r.x+r.width/2;var a=r.y+r.height/2;t.setAttributeNS(null,"transform","rotate(-90, "+i+", "+a+")");return this};t.prototype.setLegend=function(){var e=this.getDrawing();var t=e.getElementById("legend");while(t.childNodes.length>0){t.removeChild(t.firstChild)}t.setAttributeNS(null,"display","inline");var i=e.getElementById("curves");var a=e.getElementById("drawingArea");var n=r.createSVGNode("defs",{id:"legendMarkers"});var s;t.appendChild(n);var o=5;var l={width:20,height:20};if(i.hasChildNodes()){var h=i.childNodes;var d=0,u=0;for(s=0;s<h.length;s++){if(h[s].getAttribute("legend")!=="none"){var c=h[s].getAttribute("legend")||h[s].getAttribute("id");var g="legendTextId_"+s;var v=r.createSVGTextNode(c,{id:g});t.appendChild(v);var f=v.getBBox();v.setAttributeNS(null,"x",d+l.width+5);var p;switch(h[s].tagName){case"image":var y={x:d,y:u-2*l.height/3,width:l.width,height:l.height};p=r.createSVGNode("image",y);var w="http://www.w3.org/1999/xlink";var m=h[s].getAttributeNS(w,"href");p.setAttributeNS(w,"xlink:href",m);break;case"polyline":g="legendCurveId_"+s;p=h[s].cloneNode();p.removeAttributeNS(null,"marker-end");p.removeAttributeNS(null,"marker-start");if(p.getAttribute("marker-mid")){var x=p.getAttribute("marker-mid").split("#")[1].split(")")[0];var b=e.getElementById(x).cloneNode(true);var A=b.getAttribute("size");n.appendChild(b);b.removeAttributeNS(null,"transform");b.setAttributeNS(null,"markerWidth",A*2);b.setAttributeNS(null,"markerHeight",A*2);b.setAttributeNS(null,"id",x+"_legend");p.setAttributeNS(null,"marker-mid","url(#"+x+"_legend"+")")}var k=u-f.height/3;var N=d+","+k+" "+(d+l.width/2)+","+k+" "+(d+l.width)+","+k+" ";p.setAttributeNS(null,"points",N);t.appendChild(p);break;default:p=r.createSVGNode("rect");break}t.appendChild(p);v.setAttributeNS(null,"y",u);u+=f.height}}}else{return this}var S=t.getBBox();var P={fill:"white",x:S.x-o,y:S.y-o,width:S.width+2*o,height:S.height+2*o,stroke:"gray","stroke-width":2};var C=r.createSVGNode("rect",P);t.insertBefore(C,t.firstChild);S=t.getBBox();var B=S.x+" "+S.y+" "+S.width+" "+S.height;t.setAttributeNS(null,"viewBox",B);t.setAttributeNS(null,"width",S.width);t.setAttributeNS(null,"height",S.height);this.setLegendLocation();return this};t.prototype.getLegendLocation=function(e){var t=this.getDrawing();var r=t.getElementById("legend");var i;try{i=r.getBBox()}catch(a){return}var n=t.getElementById("drawingArea");var s={x:n.x.baseVal.value,y:n.y.baseVal.value,width:n.width.baseVal.value,height:n.height.baseVal.value};var o=.02*Math.min(s.width,s.height);var l=[s.x+o,s.x+(s.width-i.width)/2,s.x+s.width-i.width-o];var h=[s.y+o,s.y+(s.height-i.height)/2,s.y+s.height-i.height-o];var d=i.width,u=i.height;switch(e.toLowerCase()){case"nw":case"north-west":return[l[0],h[0],l[0]+d,h[0]+u];case"n":case"north":return[l[1],h[0],l[1]+d,h[0]+u];case"none":case"ne":case"north-east":return[l[2],h[0],l[2]+d,h[0]+u];case"w":case"west":return[l[0],h[1],l[0]+d,h[1]+u];case"c":case"center":return[l[1],h[1],l[1]+d,h[1]+u];case"e":case"east":return[l[2],h[1],l[2]+d,h[1]+u];case"sw":case"sud-west":return[l[0],h[2],l[0]+d,h[2]+u];case"s":case"sud":return[l[1],h[2],l[1]+d,h[2]+u];case"se":case"sud-east":return[l[2],h[2],l[2]+d,h[2]+u];case"auto":return this.getLegendLocation(this.getLegendAutoLocation());default:throw new Error("Plot.getLegendLocation: Wrong location request.")}};t.prototype.getLegendAutoLocation=function(){if(!this.getOwnProperty("compute-closest")){return"ne"}var e=["ne","se","nw","w","n","e","s","w","c"];var t=[];var r;var i=this.getLegendLocation(e[0]);var a,n;try{a=this.getCoordinates(i[0],i[1],false);n=this.getCoordinates(i[2],i[3],false)}catch(s){return"none"}t[0]=this.tree.count(a.x,a.y,n.x-a.x,n.y-a.y);var o=0;for(r=1;r<e.length;r++){i=this.getLegendLocation(e[r]);a=this.getCoordinates(i[0],i[1],false);n=this.getCoordinates(i[2],i[3],false);t[r]=this.tree.count(a.x,a.y,n.x-a.x,n.y-a.y);if(t[r]<t[o]){o=r}}return e[o]};t.prototype.setLegendLocation=function(){var e=this.getOwnProperty("legend-display");var t=this.getDrawing();var r=t.getElementById("legend");if(e==="none"){r.setAttributeNS(null,"display","none")}else{r.setAttributeNS(null,"display","inline");e=this.getLegendLocation(e);r.setAttributeNS(null,"x",e[0]);r.setAttributeNS(null,"y",e[1])}return this};t.prototype.initialize=function(){var e=this.getDrawing();var t=this.getParentNode();t.appendChild(e);var i=this.getProperties("drawingArea");var a=r.createSVGNode("svg",i);e.appendChild(a);var n=this.getProperties("curves");var s=r.createSVGNode("g",n);a.appendChild(s);var o=this.getProperties("markers");var l=r.createSVGNode("defs",o);a.appendChild(l);var h=this.getProperties("cursor");var d=r.createSVGNode("polyline",h);this.setMarkerPath(d,h.marker);a.appendChild(d);var u=this.getProperties("front");var c=r.createSVGNode("rect",u);a.appendChild(c);var g=this.getProperties("axis");var v=r.createSVGNode("g",g);e.appendChild(v);var f=this.getProperties("ticks");var p=r.createSVGNode("marker",f);var y=r.createSVGNode("line",f);p.appendChild(y);v.appendChild(p);var w=this.getProperties("xAxis");var m=r.createSVGNode("g",w);var x=this.getProperties("xAxisLine");var b=r.createSVGNode("polyline",x);var A=this.getProperties("xAxisLineBis");var k=r.createSVGNode("polyline",A);var N=this.getProperties("xTextTicks");var S=r.createSVGNode("g",N);m.appendChild(b);m.appendChild(k);m.appendChild(S);v.appendChild(m);var P=this.getProperties("yAxis");var C=r.createSVGNode("g",P);var B=this.getProperties("yAxisLine");var E=r.createSVGNode("polyline",B);var L=this.getProperties("yAxisLineBis");var I=r.createSVGNode("polyline",L);var V=this.getProperties("yTextTicks");var D=r.createSVGNode("g",V);C.appendChild(E);C.appendChild(I);C.appendChild(D);v.appendChild(C);var M=this.getProperties("title");var T=r.createSVGTextNode("",M);e.appendChild(T);var z=this.getProperties("xLabel");var O=r.createSVGTextNode("",z);e.appendChild(O);var G=this.getProperties("yLabel");var Y=r.createSVGTextNode("",G);e.appendChild(Y);var R=this.getProperties("legend");var W=r.createSVGNode("svg",R);e.appendChild(W);this.initializeEvents();this.autoDisplay();this.setAxis();return this};t.prototype.initializeEvents=function(){var e=this.getDrawing();var t=e.getElementById("drawingArea").getElementById("front");var r=this;var a=function(e){e.stopPropagation();e.preventDefault();r.coordDown=r.getCoordinates(e.clientX,e.clientY);r.coordDown.clientX=e.clientX;r.coordDown.clientY=e.clientY;r.mousedown(r.coordDown,e)};var n=function(e){e.stopPropagation();e.preventDefault();var t=r.getCoordinates(e.clientX,e.clientY);r.mousemove(t,e)};var s=function(e){e.stopPropagation();e.preventDefault();var t=r.getCoordinates(e.clientX,e.clientY);var i=r.coordDown;if(i===undefined){return}if(i.clientX===e.clientX&&i.clientY===e.clientY){if(r.click&&typeof r.click==="function"){r.click(t,e)}}else{if(r.mouseup&&typeof r.mouseup==="function"){r.mouseup(t,e)}}delete r.coordDown};var o=function(e){e.stopPropagation();e.preventDefault();var t=r.getCoordinates(e.clientX,e.clientY);var i=0;if(e.hasOwnProperty("wheelDelta")){i=-e.wheelDelta/120}else{i=e.detail/3}switch(e.target.parentNode.id){case"xAxis":if(!r.getOwnProperty("preserve-ratio")){r.zoomAxis(t,1+i*.1,1)}break;case"yAxis":if(!r.getOwnProperty("preserve-ratio")){r.zoomAxis(t,1,1+i*.1)}break;default:if(r.mousewheel&&typeof r.mousewheel==="function"){r.mousewheel(i,t,e)}}};var l=function(e){e.stopPropagation();e.preventDefault();delete r.coordDown;var t=r.getDrawing().getElementById("selectArea");if(t){t.parentNode.removeChild(t)}};t.addEventListener("mousedown",a,false);t.addEventListener("mousemove",n,false);t.addEventListener("mouseup",s,false);t.addEventListener("DOMMouseScroll",o,false);t.addEventListener("mousewheel",o,false);t.addEventListener("mouseout",l,false);var h=e.getElementById("xAxis");h.addEventListener("mousewheel",o,false);h.addEventListener("DOMMouseScroll",o,false);var d=e.getElementById("yAxis");d.addEventListener("mousewheel",o,false);h.addEventListener("DOMMouseScroll",o,false);if(this.getOwnProperty("compute-closest")){this.tree=new i}return this};t.prototype.autoDisplay=function(){var e=this.getDrawing();var t=e.getElementById("drawingArea");t.setAttributeNS(null,"x",0);t.setAttributeNS(null,"y",0);t.setAttributeNS(null,"width",e.width.baseVal.value);t.setAttributeNS(null,"height",e.height.baseVal.value);var r={x:t.x.baseVal.value,y:t.y.baseVal.value,width:t.width.baseVal.value,height:t.height.baseVal.value};var i=e.getElementById("axis");var a=e.getElementById("xAxis");var n=e.getElementById("yAxis");var s=e.getElementById("title");var o=e.getElementById("xLabel");var l=e.getElementById("yLabel");var h,d,u,c,g;try{h=e.getElementById("title").getBBox();d=e.getElementById("xAxis").getBBox();u=e.getElementById("yAxis").getBBox();c=e.getElementById("xLabel").getBBox();g=e.getElementById("yLabel").getBBox()}catch(v){return this}var f;if(this.getOwnProperty("title-display")){r.y=h.height;r.height-=h.height;r.y+=5;r.height-=5}if(this.getOwnProperty("ticks-display")){r.x+=40;r.width-=80;r.height-=50;r.y+=20}var p,y;if(this.getOwnProperty("yLabel-display")){y=g.height+10;r.x+=y;r.width-=y}if(this.getOwnProperty("xLabel-display")){p=c.height+10;r.height-=p}t.setAttributeNS(null,"x",r.x);t.setAttributeNS(null,"y",r.y);t.setAttributeNS(null,"width",r.width);t.setAttributeNS(null,"height",r.height);g.y=r.y;g.y+=r.height/2;g.y-=g.height/2;g.x=10;c.x=r.x+r.width/2;c.y=e.height.baseVal.value-5;s.setAttributeNS(null,"x",c.x);s.setAttributeNS(null,"y",h.height);o.setAttributeNS(null,"x",c.x);o.setAttributeNS(null,"y",c.y);l.setAttributeNS(null,"y",g.y);l.setAttributeNS(null,"x",g.x);this.rotateYLabel();this.setAxis(this.getCurrentAxis());return this};t.stringToArgs=function(e){var t="Plot.stringToArgs: ";var r=function(e){if(!e){throw new Error(t+"invalid argument string")}};if(e===undefined){return{}}if(typeof e!=="string"){throw new Error(t+"argument must be a string")}e=e.split(" ").join("");var i=".#";var a="-=:;!";var n="kwrgb";var s=["black","white","red","green","blue"];var o="(["+n+"]{0,2})";o+="([0-9.,]*)";o="^((["+i+"])"+o+")?((["+a+"])"+o+")?$";var l=function(e,t,i){var a=t.indexOf(e);r(a>=0);return i[a]};var h=function(e){if(!e){return"none"}var t=e[0];var i=t===t.toUpperCase();var a=l(t.toLowerCase(),n,s);if(e.length>1){r(e[1]===t);a=(i?"dark":"light")+a}else if(i){a="medium"+a}return a};var d=function(e){var t;var i=!e?[]:e.split(",");for(t=0;t<i.length;t++){i[t]=parseFloat(i[t]);r(!isNaN(i[t]))}return i};var u={stroke:"none"};var c=e.match(new RegExp(o,"i"));r(c);var g=6;var v=c[g];if(!v){u.stroke="none";u["stroke-width"]=0}else{var f=h(c[g+1]);var p=d(c[g+2]);p[0]=typeof p[0]==="number"?p[0]:1;u["stroke-width"]=p[0];u.stroke=f;if(u.marker){u.marker.stroke=f}var y="";switch(c[g]){case"-":break;case"=":p[1]=p[1]||8*p[0];p[2]=p[2]||Math.floor(p[1]*2/3);y+=p[1]+" "+p[2];break;case":":p[1]=p[0];p[2]=2*p[1];y+=p[1]+" "+p[2];break;case";":p[1]=p[1]||8*p[0];p[2]=p[2]||Math.floor(p[1]/2);p[3]=p[3]||Math.floor(p[1]/2);p[4]=p[4]||p[2];y+=p[1]+" "+p[2]+" ";y+=p[3]+" "+p[4];break;case"!":p[1]=p[1]||12*p[0];p[2]=p[2]||Math.floor(p[1]/2);p[3]=2*p[0];y+=p[1]+" "+p[2]+" ";y+=p[3]+" "+p[2];break;default:r(false)}if(y){u["stroke-dasharray"]=y}}var w=2;var m=c[w];if(m){var x=h(c[w+1]);var b=d(c[w+2]);u.marker={};u.marker.fill=x;u.marker.stroke=u.stroke;u.marker.size=b[0]||2;u.marker["stroke-width"]=(b[1]||u["stroke-width"])/u.marker.size;switch(c[w]){case".":u.marker.shape="circle";break;case"#":u.marker.shape="rect";break;default:r(false)}if(u.marker.fill==="none"&&u.stroke!=="none"){u.marker.fill="white"}}if(!u["stroke-width"]){u.stroke="none"}return u};t.prototype.getClosestPoint=function(e,t,r){if(!this.getOwnProperty("compute-closest")){throw new Error("Property 'compute-closest' is disabled.")}if(r===undefined){r=true}var i=this.getDrawing().getElementById("drawingArea");var a=this.getCurrentAxis();var n={width:i.width.baseVal.value,height:i.height.baseVal.value};var s=1,o=1;if(!r){s=a.width/n.width;o=a.height/n.height}return this.tree.closest(e,t,-1,s,o)};t.prototype.setCursor=function(e,t){var r=this.getDrawing();var i=r.getElementById("cursor");if(e!==undefined&&t!==undefined){i.setAttributeNS(null,"display","inline");i.setAttributeNS(null,"points",e+","+-t)}else{i.setAttributeNS(null,"display","none")}};t.prototype.translateAxis=function(e,t){var r=this.getCurrentAxis();r.x-=e;r.y+=t;this.setAxis(r)};t.prototype.zoomAxis=function(e,t,r){t=t||1;r=r||t;var i=this.getCurrentAxis();var a=i.width*t;var n=i.height*r;var s=(e.x-i.x)/i.width;i.x=e.x-s*a;var o=(e.y+i.y)/i.height;i.y=-e.y+o*n;i.width=a;i.height=n;this.setAxis(i)};t.prototype.startSelectArea=function(e){var t=this.getProperties("selectArea");t.x=e.x;t.y=-e.y;t.width=0;t.height=0;var i=r.createSVGNode("rect",t);this.getDrawing().getElementById("curves").appendChild(i)};t.prototype.updateSelectArea=function(e,t){var r=this.getDrawing().getElementById("selectArea");var i=Math.min(e.x,t.x);var a=Math.min(-e.y,-t.y);var n=Math.max(e.x,t.x)-i;var s=Math.max(-e.y,-t.y)-a;r.setAttributeNS(null,"x",i);r.setAttributeNS(null,"y",a);r.setAttributeNS(null,"width",n);r.setAttributeNS(null,"height",s)};t.prototype.endSelectArea=function(e,t){var r=this.getDrawing().getElementById("selectArea");r.parentNode.removeChild(r);this.selectarea(e.x,e.y,t.x,t.y)};t.prototype.cancelSelectArea=function(){var e=this.getDrawing().getElementById("selectArea");if(e){e.parentNode.removeChild(e)}};t.prototype.getCoordinates=function(e,t,r,i){if(i===undefined){i=true}if(r===undefined){r=true}var a=this.getDrawing();var n=a.createSVGPoint();n.x=e;n.y=t;var s=a.getElementById("curves");var o=r?s.getScreenCTM():s.getCTM();o=i?o.inverse():o;n=n.matrixTransform(o);n.y=-n.y;return n};t.loadCsv=function(e,t){var i="Plot.loadCsv: ";var a=r.parseCsv(e,/\s*\n\s*/,/\s+/,false);var n=r.Array.mapRec(a,parseFloat);if(!r.Array.isRectangle(n)){throw new Error(i+"invalid csv string")}if(t===undefined){if(n.length>n[0].length){n=r.Array.transpose(n)}}else if(t===true){n=r.Array.transpose(n)}else if(t!==false){throw new Error(i+"invalid 'transpose' parameter")}return n};t.prototype.displayCsv=function(e,r,i,a){var n=this.constructor.name+"displayCsv: ";var s=t.loadCsv(e,r);if(i===undefined){i=true}else if(typeof i!=="boolean"){throw new Error(n+"invalid 'auto' parameter")}var o=["red","green","blue","fuchsia","lime","aqua","purple","olive","teal","yellow","navy","maroon","black","sylver","gray"];var l,h,d=[];if(s.length>1){d=s.shift()}else{for(h=0;h<s[0].length;h++){d.push(h+1)}}for(h=0;h<s.length;h++){var u=this.getOwnProperty("autoId-curves");if(i===true){var c=o[u%o.length];if(a){if(a.stroke!=="none"){a.stroke=c}if(a.marker){a.marker.fill=c}}else{a={stroke:c}}}this.addPath(d,s[h],a)}return this};t.prototype.getCurvesIds=function(){var e=[];var t=this.getDrawing().getElementById("curves");if(t.hasChildNodes()){var r;for(r=0;r<t.childNodes.length;r++){e.push(t.childNodes[r].id)}}return e};t.prototype.setCurveProperty=function(e,t,r){var i=this.getDrawing().getElementById("curves");if(i.hasChildNodes()){var a;var n=i.childNodes;for(a=0;a<n.length;a++){if(n[a].id===e){n[a].setAttributeNS(null,t,r);this.setLegend();break}}}return this};t.prototype.setCurveMarkerProperty=function(e,t,r){var i=this.getDrawing();var a=i.getElementById("curves");if(a.hasChildNodes()){var n;var s=a.childNodes;for(n=0;n<s.length;n++){if(s[n].id===e){var o=s[n];var l=o.getAttributeNS(null,"marker-id");var h=i.getElementById(l);if(t==="shape"){this.setMarkerShape(h,r)}h.setAttributeNS(null,t,r);this.scaleElements();this.setLegend();break}}}return this};t.prototype.toWindow=function(e,t){var r=this.getWidth(),i=this.getHeight();e=e||i;t=t||r;var a;this.setWidth(t).setHeight(e).setAxis(a);var n=window.open("","","width="+(t+30)+", height="+(e+30));n.document.body.appendChild(this.setAxis(a).getDrawing().cloneNode(true));this.setWidth(r).setHeight(i).setAxis(a);return n};t.prototype.print=function(e,t){var r=this.toWindow(e,t);r.print();r.close();return this};t.prototype.mousedown=function(e,t){if(t.shiftKey){this.startSelectArea(e)}};t.prototype.mousemove=function(e,t){if(this.coordDown===undefined){return}var r=this.coordDown;var i=e;if(t.shiftKey){this.updateSelectArea(r,i)}else{this.cancelSelectArea();this.translateAxis(i.x-r.x,i.y-r.y)}};t.prototype.mouseup=function(e,t){var r=this.coordDown;var i=e;if(t.shiftKey){this.endSelectArea(r,i)}else{this.translateAxis(i.x-r.x,i.y-r.y)}};t.prototype.mousewheel=function(e,t,r){var i=1+e*.1;this.zoomAxis(t,i)};t.prototype.click=function(e,t){var r=this.getClosestPoint(e.x,e.y,false);

if(r){this.setCursor(r.x,r.y)}};t.prototype.selectarea=function(e,t,r,i){this.setAxis([e,t,r,i])};var r={};r.createSVGNode=function(e,t){e=e.toLowerCase();var r=document.createElementNS("http://www.w3.org/2000/svg",e);var i;for(i in t){if(t.hasOwnProperty(i)){r.setAttributeNS(null,i,t[i])}}return r};r.createSVGTextNode=function(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg","text");var i;for(i in t){if(t.hasOwnProperty(i)){r.setAttributeNS(null,i,t[i])}}r.appendChild(document.createTextNode(e));return r};r.getPosition=function(e,t){var r=0;var i=0;while(e.offsetParent!==undefined&&e.offsetParent!==null){r+=e.offsetLeft+(e.clientLeft!==null?e.clientLeft:0);i+=e.offsetTop+(e.clientTop!==null?e.clientTop:0);e=e.offsetParent}r=-r+t.pageX;i=-i+t.pageY;return[r,i]};r.isArrayLike=function(e){return e&&typeof e==="object"&&e.length!==undefined};r.Vector=function(e,t,i,a){var n,s,o,l,h,d,u;if(r.isArrayLike(e)){n=e.length;this.data=this.zeros(n,a);this.index=this.zeros(n,Uint32Array);for(h=0;h<n;h++){this.data[h]=e[h];this.index[h]=h}}else if(e instanceof r.Vector){n=e.index.length;this.data=this.zeros(n);this.index=this.zeros(n,Uint32Array);h=this.index;var c=this.data;var g=e.index;var v=e.data;for(u=0;u<n;u++){c[u]=v[g[u]];h[u]=u}}else{if(e!==undefined&&t!==undefined&&i!==undefined){s=e;o=t;l=i}else if(e!==undefined&&t!==undefined&&i===undefined){s=e;o=e<t?1:-1;l=t}else if(e!==undefined&&t===undefined&&i===undefined){s=0;o=0;l=e}if(o!==0){n=Math.abs(Math.floor((l-s)/o)+1)}else{n=Math.abs(Math.floor(l-s))}this.data=this.zeros(n,a);this.index=this.zeros(n,Uint32Array);d=s;for(h=0;h<n;h++,d+=o){this.data[h]=d.toPrecision(15);this.index[h]=h}}return this};r.Vector.prototype.zeros=function(e,t){var r;if(!t){r=new Float64Array(e)}else{r=new t(e)}return r};r.Vector.linearSpace=function(e,t,i){var a=Math.floor(i)-1;var n=(t-e)*(i-2);var s=new r.Vector(e,(t-e)/a,t);s.data[i-1]=t;return s};r.Vector.prototype.derive=function(e){e=e||1;var t,r,i,a;t=this.data;r=this.index;a=r.length;for(i=1;i<a;i++){t[r[i-1]]=t[r[i]]-t[r[i-1]]}this.data=this.data.subarray(0,a-1);this.index=this.index.subarray(0,a-1);if(e>1){this.derive(e-1)}return this};r.Vector.prototype.max=function(){var e,t,i,a,n;e=this.data;a=this.index;n=a.length;var s=-Infinity;var o=NaN;for(i=0;i<n;i++){if(e[a[i]]>s){s=e[a[i]];o=a[i]}}return new r.Vector([s,o])};r.Vector.prototype.min=function(){var e,t,i,a,n;e=this.data;a=this.index;n=a.length;var s=+Infinity;var o=NaN;for(i=0;i<n;i++){if(e[a[i]]<s){s=e[a[i]];o=a[i]}}return new r.Vector([s,o])};r.Vector.prototype.get=function(e){return this.data[this.index[e]]};r.Vector.prototype.set=function(e,t){this.data[this.index[e]]=t;return this};r.makeDraggable=function(e,t,r){r=(r||"none").toLowerCase();switch(r){case"dataurl":case"url":r="url";break;case"text":case"txt":r="txt";break;case"arraybuffer":case"binary":case"bin":r="bin";break;default:r="none"}if(typeof e==="string"){e=document.getElementById(e)||e}var i,a,n;i=a=n=function(e){e.stopPropagation();e.preventDefault()};var s=function(e){e.stopPropagation();e.preventDefault();var i,a;if(r!=="none"){a=function(e){if(t){t(e.target.result,e)}};i=function(e){var t=new FileReader;t.onload=a;switch(r){case"url":t.readAsDataURL(e);break;case"txt":t.readAsText(e);break;case"bin":t.readAsArrayBuffer(e);break}}}else{i=function(e){if(t){t(e)}}}if(e.dataTransfer.files.length){var n;for(n=0;n<e.dataTransfer.files.length;n++){i(e.dataTransfer.files[n])}}};e.addEventListener("dragenter",i,false);e.addEventListener("dragleave",a,false);e.addEventListener("dragover",n,false);e.addEventListener("drop",s,false)};r.parseCsv=function(e,t,i,a){a=a||false;t=t||"\n";var e=e.split(t);if(e[e.length-1]===""){e.pop()}var n,s;var o=[];for(n=0,s=e.length;n<s;n++){o.push(e[n].match(/[\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?/g))}return a?r.Array.transpose(o):o};r.Array=r.Array||{};r.Array.opposite=function(e){var t;for(t=0;t<e.length;t++){if(e[t]instanceof Array){r.Array.opposite(e[t])}else{e[t]=-e[t]}}return e};t.prototype.appendTo=function(e){if(typeof e==="string"){e=document.getElementById(e)}else{e=e||document.body}e.appendChild(this.getDrawing());this.autoDisplay();return this};r.Array.mapRec=function(e,t){var i,a=e.length;var n=new e.constructor(a);for(i=0;i<a;i++){if(e[i].length!==undefined&&typeof e[i]!=="string"){n[i]=r.Array.mapRec(e[i],t)}else{n[i]=t(e[i])}}return n};r.Array.isRectangle=function(e){if(!e||!e.length||e[0].length===undefined){return false}var t,r=e.length;var i=e[0].length;for(t=1;t<r;t++){if(e[t].length!==i){return false}}return true};r.Array.transpose=function(e){var t="Tools.Array.transpose: ";if(!r.Array.isRectangle(e)){throw new Error(t+"cannot transpose a non-rectangular array")}var i,a=e.length;var n,s=e[0].length;var o=new e.constructor(s);for(n=0;n<s;n++){o[n]=new e[0].constructor(a);for(i=0;i<a;i++){o[n][i]=e[i][n]}}return o};function i(){this.root=null}i.prototype.clear=function(){this.root=null};i.prototype.add=function(e,t,r,a){if(!this.root){var n=1;while(!(Math.abs(e)<n&&Math.abs(t)<n)){n*=2}while(e&&t&&Math.abs(e)<n&&Math.abs(t)<n){n/=2}var s=e>=0?n:-n;var o=t>=0?n:-n;this.root=new i.Node(s,o,null,null,n)}while(this.root.size&&!this.root.hasInBBox(e,t)){var l=this.root.size,h=2*l;var d=this.root.x;var u=this.root.y;d+=d<e?l:-l;u+=u<t?l:-l;var c=new i.Node(d,u,null,null,h);var g=this.root.x<c.x?"w":"e";var v=this.root.y<c.y?"s":"n";c[v+g]=this.root;c.length=this.root.length;this.root=c}var f=new i.Node(e,t,r,a);this.root=i.Node.add(this.root,f,null)};i.prototype.remove=function(e){if(typeof e!=="function"){var t=e;e=function(e){return e===t}}this.root=i.Node.remove(this.root,e)};i.prototype.count=function(e,t,r,i){if(!this.root){return 0}if(e===undefined){return this.root.length}if(i===undefined){var a=this.constructor.name+".count: ";throw new Error(a+"expected 0 or 4 arguments")}var n=Math.min(e,e+r),s=Math.max(e,e+r);var o=Math.min(t,t+i),l=Math.max(t,t+i);return this.root.count(n,o,s,l)};i.prototype.closest=function(e,t,r,i,a){if(typeof e!=="number"||typeof t!=="number"){throw new Error(this.constructor.name+".closest: invalid x, y.")}var n=r&&r>0?r*r:-1;var s=i?i*i:1;var o=a?a*a:s;var l=function(e,t){return e*e/s+t*t/o};var h=function(r){if(!r){return null}if(r.data!==null){var i=l(e-r.x,t-r.y);if(n<0||i<n){n=i;return r}return null}var a=Math.min(Math.max(e,r.x-r.size),r.x+r.size);var s=Math.min(Math.max(t,r.y-r.size),r.y+r.size);if(n>=0&&l(e-a,t-s)>n){return null}var o=e<r.x?"we":"ew";var d=t<r.y?"sn":"ns";var u=h(r[d[0]+o[0]]);if(l(e-r.x,0)<l(0,t-r.y)){u=h(r[d[0]+o[1]])||u;u=h(r[d[1]+o[0]])||u}else{u=h(r[d[1]+o[0]])||u;u=h(r[d[0]+o[1]])||u}u=h(r[d[1]+o[1]])||u;return u};var d=h(this.root);return d};i.prototype.plot=function(e,t,r,i){var a=function(t,r,i,n){if(!t||!(r||i||n)){return}a(t.nw,r,i,n);a(t.ne,r,i,n);a(t.sw,r,i,n);a(t.se,r,i,n);if(t.data!==null&&r){e.addPath([t.x,t.x],[t.y,t.y],r)}if(t.size&&i){var s=t.x;var o=t.y;var l=t.size;e.addPath([s,s],[o-l,o+l],n);e.addPath([s-l,s+l],[o,o],n);e.addPath([s-l,s+l,s+l,s-l,s-l],[o-l,o-l,o+l,o+l,o-l],i)}};t=t||!(r||i);t=typeof t==="object"?t:{marker:{shape:"circle"}};r=!r?false:typeof r==="object"?r:{stroke:"red"};i=r&&typeof i==="object"?i:r;e.clear();a(this.root,false,r,i);a(this.root,t)};i.Node=function(e,t,r,i,a){this.x=e;this.y=t;this.number=r;this.data=i;this.length=1;if(i===null){this.length=0;this.size=a;this.nw=this.ne=null;this.sw=this.se=null}};i.Node.add=function(e,t,r){if(e===null||t===null){return t||e}if(e.data!==null){if(e.x===t.x&&e.y===t.y){e.datas=e.datas||[e.data];e.datas.push(t.data);e.length++;return e}var a=r.size/2;var n=new i.Node(r.x,r.y,null,null,a);n.x+=e.x<r.x?-n.size:+n.size;n.y+=e.y<r.y?-n.size:+n.size;i.Node.add(n,e,r);i.Node.add(n,t,r);return n}var s=t.x<e.x?"w":"e";var o=t.y<e.y?"s":"n";e[o+s]=i.Node.add(e[o+s],t,e);e.length++;return e};i.Node.remove=function(e,t){if(e===null){return null}if(e.data!==null){var r=[],a=e.datas||[e.data];var n,s=a.length;for(n=0;n<s;n++){if(!t(a[n])){r.push(a[n])}}if(!r.length){return null}e.datas=r.length>1?r:[];e.data=r[0];e.length=r.length;return e}e.nw=i.Node.remove(e.nw,t);e.ne=i.Node.remove(e.ne,t);e.sw=i.Node.remove(e.sw,t);e.se=i.Node.remove(e.se,t);e.length=0;e.length+=e.nw?e.nw.length:0;e.length+=e.ne?e.ne.length:0;e.length+=e.sw?e.sw.length:0;e.length+=e.se?e.se.length:0;if(!e.length){return null}return e};i.Node.prototype.hasInBBox=function(e,t){return e>=this.x-this.size&&t>=this.y-this.size&&e<this.x+this.size&&t<this.y+this.size};i.Node.prototype.count=function(e,t,r,i){if(this.data!==null){var a=this.x,n=this.y;var s=e<=a&&a<=r&&t<=n&&n<=i;return s?this.length:0}var o=this.x-this.size,l=this.x+this.size;var h=this.y-this.size,d=this.y+this.size;if(r<o||i<h||e>=l||t>=d){return 0}if(e<=o&&t<=h&&r>=l&&i>=d){return this.length}var u=0;u+=this.nw?this.nw.count(e,t,r,i):0;u+=this.ne?this.ne.count(e,t,r,i):0;u+=this.sw?this.sw.count(e,t,r,i):0;u+=this.se?this.se.count(e,t,r,i):0;return u};t.prototype.addChromaticityDiagram=function(e,t){var r={"Planckian locus":true,"Daylight locus":true,"Spectrum locus":true,"Standards illuminants":true,Gamut:true};var i;for(i in t){if(t.hasOwnProperty(i)){r[i]=t[i]}}if(e==="rgY"){this.setTitle("CIE rg Diagram","r chromaticity","g chromaticity")}else if(e==="xyY"){this.setTitle("CIE xy Diagram","x chromaticity","y chromaticity")}else if(e==="1960 uvY"){this.setTitle("CIE 1960 uv Diagram","u chromaticity","v chromaticity")}else if(e==="1976 u'v'Y"){this.setTitle("CIE 1976 u'v' Diagram","u' chromaticity","v' chromaticity")}else{throw new Error("Plot.drawChromaticityDiagram: "+e+" is not a chromaticity diagram.")}var a={id:"Planckian locus",stroke:"blue","stroke-width":1};var n={id:"Spectrum locus",stroke:"lightseagreen","stroke-width":2,"stroke-dasharray":"5 2"};var s={id:"Gamut",stroke:"red","stroke-width":1};var o={id:"Standards illuminants",stroke:"none",fill:"none",marker:{shape:"circle",fill:"orange",size:2,stroke:"none"}};var l=Matrix.CIE.getPrimaries("current",e);var h=Matrix.CIE.getIlluminantList();var d=[],u=[];var i;for(i=h.length;i--;i){var c=Matrix.CIE.getIlluminant(h[i],e);d.push(c[0]);u.push(c[1])}if(r["Spectrum locus"]===true){var g=Matrix.CIE.getSpectrumLocus(e);this.addPath(g[0],g[1],n)}if(r["Planckian locus"]===true){var v=Matrix.CIE.getPlanckianLocus(e);this.addPath(v[0],v[1],a)}if(r["Gamut"]===true){var f=[l[0],l[3],l[6],l[0]];var p=[l[1],l[4],l[7],l[1]];this.addPath(f,p,s)}if(r["Standards illuminants"]===true){this.addPath(d,u,o)}return this};t.prototype.properties.chromaticityPath={id:"scatter",fill:"none",stroke:"none",marker:{shape:"circle",size:.25,fill:"blue"}};t.prototype.addChromaticitiesFromRgb=function(e,t,r,i,a){a=a||"xyY";var n=this.getProperties("chromaticityPath");var s,o;for(s in i){if(i.hasOwnProperty(s)){n[s]=i[s]}}var l=e.length;var h=new Float32Array(l*3),d=h.subarray(0,l),u=h.subarray(l,l*2),c=h.subarray(l*2);d.set(e);u.set(t);c.set(r);Matrix.Colorspaces["RGB to "+a](h,l,l,1);this.addPath(d,u,n);return this};t.prototype.viewPatch=function(e,t,r,i){"use strict";var a=this;a.clear();var n=e.keypoints[t];var s=n.descriptorsData[r].patch;if(i==="norm"){s=s[i];s=s.rdivide(s.max2())}else if(i==="RGB"){s=s[i]}else if(i===undefined){s=phaseNormImage(s.phase,s.norm,true,n.orientation)}s.toImage(function(){a.remove("patch");a.addImage(this,0,0,{id:"patch"});a.setAxis();a.setTitle(r)})};t.prototype.showKeypoints=function(e){"use strict";var t=this;t.clear();e.image.toImage(function(){t.addImage(this,0,0);var r={stroke:"none",marker:{shape:"circle",fill:"red",size:2}};var i=[],a=[];var n,s;for(n=0,s=e.keypoints.length;n<s;n++){i[n]=e.keypoints[n].x;a[n]=-e.keypoints[n].y}t.addPath(i,a,r);t.setTitle(e.keypoints.length+" Keypoints")});return this};t.prototype.showMatchs=function(e,t,r,i){"use strict";i=i||"v";var a=this,n;a.clear();if(i==="v"){n=e.getSize(0);e.toImage(function(){a.addImage(this,0,0);t.toImage(function(){a.addImage(this,0,-n);var e=r;for(var t=0;t<e.length;t++){var i=e[t].k1,s=e[t].k2;if(e[t].isValid){a.addPath([i.x,s.x],[-i.y,-n-s.y],{id:t,stroke:"lime"})}else{a.addPath([i.x,s.x],[-i.y,-n-s.y],{id:t,stroke:"red"})}}})})}else{n=e.getSize(1);e.toImage(function(){a.addImage(this,0,0);t.toImage(function(){a.addImage(this,n,0);var e=r;for(var t=0;t<e.length;t++){var i=e[t].k1,s=e[t].k2;if(e[t].isValid){a.addPath([i.x,s.x+n],[-i.y,-s.y],{id:t,stroke:"lime"})}else{a.addPath([i.x,s.x+n],[-i.y,-s.y],{id:t,stroke:"red"})}}})})}};e.Plot=t})(global);