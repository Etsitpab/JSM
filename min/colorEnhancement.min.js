/**
 * This program is free software: you can redistribute it and/or modify    
 * it under the terms of the GNU General Public License as published by        
 * the Free Software Foundation, either version 3 of the License, or 
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * 
 * @author Baptiste Mazin     <baptiste.mazin@telecom-paristech.fr> 
 * @author Guillaume Tartavel <guillaume.tartavel@telecom-paristech.fr> 
 */
(function(){"use strict";var a=function(a,r,e,t,v){var i=a[0]>0?a[0]:-a[0];for(var s=1,o=a.length;s<o;s++){var u=a[s]>0?a[s]:-a[s];if(u>i){i=u}}var n=Math.max(1.01/255,i/e);var f,c,h=Math.pow;var l=1/h(255,v-1);for(var s=0;s<o;s++){var p=a[s]>0?1:-1,x=p===1?a[s]:-a[s];if(x<=n){continue}var M=r[s]>0?r[s]:-r[s],m=x;for(var y=0;y<5;y++){f=m-x-t*v*h(M/m,v);c=1+t*v*v*M/h(m,1+v)*l;m=m-f/c}a[s]=m*p}return a};Matrix.prototype.colorEnhancement=function(r,e,t,v,i){var i=i||.1,r=r||1,e=e||.5/255,v=v||"sym4",t=t||10;var s=this.im2double();var o=Matrix.zeros(s.size());var u=Matrix.dwtmaxlev([this.size(0),this.size(1)],v);for(var n=0;n<s.size(2);n++){var f=s.get([],[],n);var c=Matrix.wavedec2(f,u,v);var h=Matrix.appcoef2(c,v,u-1);h=h[".*"](1-i)["+"](h.mean()[".*"](i));var l=c[1].value([0,0])*c[1].value([0,1]);c[0].set([0,l-1],h.reshape());for(var p=u-1;p>=0;p--){var x=c[0].getData();l=c[1].value([0,0])*c[1].value([0,1]);h=x.subarray(0,l);a(x.subarray(2*l,3*l),h,t,e,r);a(x.subarray(l,2*l),h,t,e,r);a(x.subarray(3*l,4*l),h,t,e,r);c=Matrix.upwlev2(c,v)}var f=c[0].reshape(c[1].get(0).getData());o.set([],[],n,f)}return o}})();