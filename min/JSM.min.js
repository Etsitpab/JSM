/**
 * This program is free software: you can redistribute it and/or modify    
 * it under the terms of the GNU General Public License as published by        
 * the Free Software Foundation, either version 3 of the License, or 
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * 
 * @author Baptiste Mazin     <baptiste.mazin@telecom-paristech.fr> 
 * @author Guillaume Tartavel <guillaume.tartavel@telecom-paristech.fr> 
 */
var Tools={};if(typeof window==="undefined"){module.exports.Tools=Tools}(function(t){"use strict";t.isSet=function(t){return t!==null&&t!==undefined}.bind(t);t.isInRange=function(t,e,r){e=this.isSet(e)?e:-Infinity;r=this.isSet(r)?r:+Infinity;return e<=t&&t<=r}.bind(t);t.isNumber=function(t,e,r){return typeof t==="number"&&this.isInRange(t,e,r)}.bind(t);t.isInteger=function(t,e,r){return this.isNumber(t,e,r)&&t%1===0}.bind(t);t.isBoolean=function(t){return t===true||t===false}.bind(t);t.isArrayLike=function(t){return typeof t==="object"&&t.length!==undefined}.bind(t);t.isArrayInRange=function(t,e,r){var a,i;if(!this.isArrayLike(t)){return false}for(a=0,i=t.length;a<i;a++){if(!this.isInRange(t[a],e,r)){return false}}return true}.bind(t);t.isArrayOfNumbers=function(t,e,r){var a,i;if(!this.isArrayLike(t)){return false}e=this.isSet(e)?e:-Infinity;r=this.isSet(r)?r:+Infinity;for(a=0,i=t.length;a<i;a++){var n=t[a];if(!(typeof n==="number"&&e<=n&&n<=r)){return false}}return true}.bind(t);t.isArrayOfIntegers=function(t,e,r){var a,i;switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:if(e===undefined&&r===undefined){return true}for(a=0,i=t.length;a<i;a++){if(t[a]<e||t[a]>r){return false}}return true;case Uint8ClampedArray:case Uint8Array:case Uint16Array:case Uint32Array:if((e===0||e===undefined)&&r===undefined){return true}if(r!==undefined){for(a=0,i=t.length;a<i;a++){if(t[a]<e||t[a]>r){return false}}}return true;default:if(!this.isArrayLike(t)){return false}}e=this.isSet(e)?e:-Infinity;r=this.isSet(r)?r:+Infinity;for(a=0,i=t.length;a<i;a++){var n=t[a];if(!(typeof n==="number"&&(e<=n&&n<=r)&&n%1===0)){return false}}return true}.bind(t);t.isArrayOfBooleans=function(t){var e,r;if(!this.isArrayLike(t)||t.length<1){return false}for(e=0,r=t.length;e<r;e++){if(t[e]!==true&&t[e]!==false){return false}}return true}.bind(t);t.checkOpts=function(t,e){var r;e=e||{};for(r in e){if(e.hasOwnProperty(r)){if(t[r]===undefined){throw new Error("checkOpts: unknown option: "+r)}}}for(r in t){if(t.hasOwnProperty(r)){if(!this.isSet(e[r])){e[r]=t[r]}}}return e};t.checkSize=function(t,e){t=this.isSet(t)?t:[0,0];if(this.isNumber(t)){t=[t]}if(this.isArrayLike(t)&&t.length===1&&this.isArrayLike(t[0])){t=t[0]}if(!this.isArrayLike(t)||t.length<1){throw new Error("checkSize: Invalid size argument.")}if(!this.isArrayOfIntegers(t,0)){throw new Error("checkSize: Size must be a positive integer.")}t=Array.prototype.slice.apply(t);while(t[t.length-1]===1&&t.length>2){t.pop()}if(t.length===1){switch(e){case"square":t=[t[0],t[0]];break;case"row":t=[1,t[0]];break;case"column":case"vector":case undefined:t=[t[0],1];break;default:throw new Error('checkSize: Invalid value for "unidim".')}}return t}.bind(t);t.checkSizeEquals=function(t,e,r){t=this.checkSize(t);e=this.checkSize(e);r=r||true;var a=t.length<e.length?t:e;var i,n=Math.min(t.length,e.length);var o=Math.max(t.length,e.length);for(i=0;i<n;i++){if(t[i]!==e[i]){throw new Error("checkSizeEquals: dimensions must be equals.")}}if(r){for(i=n;i<o;i++){if(t[i]!==undefined&&t[i]!==1){throw new Error("checkSizeEquals: dimensions must be equals.")}if(e[i]!==undefined&&e[i]!==1){throw new Error("checkSizeEquals: dimensions must be equals.")}}}else if(!r){throw new Error("checkSizeEquals: "+"dimensions differ by trailing 1's, ","and ignoreTrailingDims is False.")}return a}.bind(t);t.checkRange=function(t){if(typeof t==="number"){t=[t]}if(!this.isArrayOfIntegers(t)){throw new Error("checkRange: range must be made of integers.")}if(t.length===1){t=[0,t[0]]}if(t.length!==2){throw new Error("checkRange: range must have 1 or 2 bounds.")}if(t[0]>t[1]){throw new Error("checkRange: range must be [min, max] in this order.")}t=[t[0],t[1]];return t}.bind(t);t.checkColon=function(t,e){if(this.isArrayLike(t)&&t.length===1&&this.isArrayLike(t[0])){t=t[0]}if(this.isNumber(t)){t=[t]}if(!this.isArrayOfNumbers(t)){throw new Error("checkColon: colon operator must be non-negative integers.")}var r,a,i=null;switch(t.length){case 0:throw new Error("checkColon: colon operator cannot be empty.");case 1:r=a=t[0];break;case 2:r=t[0];a=t[1];break;case 3:r=t[0];i=t[1];a=t[2];break;default:throw new Error("checkColon: colon operator expected 1, 2, or 3 values.")}if(!this.isSet(e)){e=Infinity}else if(this.isInteger(e,0)){r=r>=0?r:r+e;a=a>=0?a:a+e}else{throw new Error("checkColon: if specified, length must be a non-negative integer.")}if(!this.isArrayOfIntegers([r,a])){throw new Error("checkColon: first and last elements must be integers")}if(!this.isArrayOfIntegers([r,a],0,e-1)){throw new Error("checkColon: first or last elements out of bounds")}if(!this.isSet(i)){i=r<=a?+1:-1}else if((a-r)*i<0){throw new Error("checkColon: invalid step.")}return[r,i,a]}.bind(t);t.checkArrayEquals=function(t,e){var r=t.length,a;if(r!==e.length){return false}for(a=0;a<r;a++){if(t[a]!==e[a]){return false}}return true};t.checkType=function(t){if(typeof t==="function"){t=t.name}if(typeof t==="string"){switch(t.toLowerCase()){case"array":return Array;case"float64array":case"float64":case"double":return Float64Array;case"float32array":case"float32":case"float":case"single":return Float32Array;case"int8array":case"int8":return Int8Array;case"bool":case"boolean":case"logical":case"uint8clampedarray":case"canvaspixelarray":case"uint8c":return Uint8ClampedArray;case"uint8array":case"uint8":return Uint8Array;case"int16array":case"int16":return Int16Array;case"uint16array":case"uint16":return Uint16Array;case"int32array":case"int32":return Int32Array;case"uint32array":case"uint32":return Uint32Array;case"int64":case"uint64":throw new Error("checkType: int64 and uint64 aren't supported.");default:throw new Error("checkType: Type must be a valid numeric class name.")}}if(t===undefined){return Matrix.dataType}throw new Error("checkType: Wrong data type argument.")};t.includeJS=function(t,e){var r=document.createElement("script");r.setAttribute("type","text/javascript");r.setAttribute("src",t);if(this.isSet(e)){r.onload=e}document.head.appendChild(r)}.bind(t);t.assert=function(t){if(!t){throw new Error("Assertion failed.")}return true}.bind(t);(function(){var e=function(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:t===43?62:t===47?63:0};var r=function(t){return t<26?t+65:t<52?t+71:t<62?t-4:t===62?43:t===63?47:65};t.arrayFromBase64=function(t,r){var a=t.replace(/[^A-Za-z0-9\+\/]/g,"");var i=a.length;var n=i*3+1>>2;var o=new Uint8Array(n);for(var s,f,l=0,u=0,g=0;g<i;g++){f=g&3;l|=e(a.charCodeAt(g))<<18-6*f;if(f===3||i-g===1){for(s=0;s<3&&u<n;s++,u++){o[u]=l>>>(16>>>s&24)&255}l=0}}return r?new r(o.buffer):o};t.arrayToBase64=function(t){t=new Uint8Array(t.buffer);var e=2,a="";for(var i=t.length,n=0,o=0;o<i;o++){e=o%3;if(o>0&&o*4/3%76===0){a+="\r\n"}n|=t[o]<<(16>>>e&24);if(e===2||t.length-o===1){a+=String.fromCharCode(r(n>>>18&63),r(n>>>12&63),r(n>>>6&63),r(n&63));n=0}}return a.substr(0,a.length-2+e)+(e===2?"":e===1?"=":"==")}})();t.stringToDownload=function(t,e){var r=new Blob([t],{type:"text/plain"});var a=document.createElement("a");a.download=e||"file.txt";a.href=URL.createObjectURL(r);a.click()};(function(){var e=[],r={};t.tic=function(t){if(t){r[t]=(new Date).getTime()}else{e.push((new Date).getTime())}};t.toc=function(t){var a=(new Date).getTime();if(t){return a-r[t]||0}return a-e.pop()||0}})()})(Tools);function MatrixView(t){"use strict";var e;var r;var a;var i;var n=[];var o={};var s=function(t){a=Tools.checkSize(t);i=[];var n,s=a.length;for(e=[],r=[],n=0;n<s;n++){e[n]=0;r[n]=(a[n-1]||1)*(r[n-1]||1)}o={first:e.slice(),step:r.slice(),size:a.slice(),indices:[]};return this}.bind(this);var f=function(t){var n,o=t.getDimLength();e=[];r=[];a=[];i=[];for(n=0;n<o;n++){e.push(t.getFirst(n));r.push(t.getStep(n));a.push(t.getSize(n));if(t.isIndicesIndexed(n)){i.push(t.getIndices(n))}}return this}.bind(this);this.save=function(){n.push(new MatrixView(this));return this}.bind(this);this.restore=function(){var t=n.pop();if(Tools.isSet(t)){f(t)}else{e=o.first.slice();r=o.step.slice();a=o.size.slice();i=[]}return this}.bind(this);var l=function(){return a.length};var u=function(){var t,e=l(),r;for(t=0,r=1;t<e;t++){r*=a[t]}return r};var g=function(t){if(!Tools.isSet(t)){return a.slice()}if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getSize: invalid dimension.")}return Tools.isSet(a[t])?a[t]:1};var h=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.isIndicesIndexed: invalid dimension.")}return Tools.isSet(i[t])};var c=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getIndices: invalid dimension.")}if(!h(t)){throw new Error("MatrixView.getIndices: "+"dimension isn't indexed by indices.")}return i[t].slice()};var v=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getSteps: invalid dimension.")}if(!h(t)){throw new Error("MatrixView.getSteps: "+"Dimension isn't indexed with indices.")}var e=i[t].slice();var r;for(r=e.length-1;r>0;r--){e[r]-=e[r-1]}var a=i[t][i[t].length-1];e.push(-(a+1));e[0]=0;return e};var p=function(){var t,e=o.size.length,r;for(t=0,r=1;t<e;t++){r*=o.size[t]}return r};var m=function(){return o.size.slice()};var x=function(t){var i=l();var n=t.length;if(n>1&&n!==i){throw new Error("MatrixView.getIndex: invalid ND-index.")}var o,s;for(o=0,s=0;o<n;o++){if(t[o]<0||t[o]>=a[o]){throw new Error("MatrixView.getIndex: invalid index.")}s+=e[o]+t[o]*r[o]}return s};var w=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getFirst: invalid dimension.")}return Tools.isSet(e[t])?e[t]:0};var d=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getStep: invalid dimension.")}if(h(t)){throw new Error("MatrixView.getStep: dimension is indexed by indices.")}return Tools.isSet(r[t])?r[t]:1};var y=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getEnd: invalid dimension.")}if(h(t)){return-1}var i=Tools.isSet(a[t])?a[t]:1;return(e[t]||0)+i*(r[t]||1)};this.getDimLength=l;this.getLength=u;this.getInitialLength=p;this.getInitialSize=m;this.getIndex=x;this.getFirst=w;this.getStep=d;this.getSteps=v;this.getEnd=y;this.getSize=g;this.isIndicesIndexed=h;this.getIndices=c;var M=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.pushSingletonDimensions: invalid dimension.")}var i;for(i=0;i<t;i++){e.push(0);r.push(1);a.push(1)}return this}.bind(this);var D=function(t,n){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.select: invalid dimension.")}n=Tools.checkColon(n,g(t));if(!h(t)){e[t]=w(t)+n[0]*d(t);r[t]=d(t)*n[1];a[t]=Math.floor(Math.abs((n[2]-n[0])/n[1]))+1}else{var o,s,f,l=i[t],u=[];for(o=n[0],s=n[2],f=n[1];o<=s;o+=f){u.push(l[o])}e[t]=u[0];i[t]=u;a[t]=u.length}return this}.bind(this);var b=function(t,n){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.selectIndicesDimension: Dimension "+"must be a positive integer.")}if(!Tools.isArrayOfIntegers(n,0,g(t)-1)){throw new Error("MatrixView.selectIndicesDimension: Invalid index.")}n=Array.prototype.slice.apply(n);var o,s;if(!h(t)){var f=w(t),l=d(t);for(o=0,s=n.length;o<s;o++){n[o]*=l;n[o]+=f}}else{for(o=0,s=n.length;o<s;o++){n[o]=i[n[o]]}}if(n[0]===undefined){n[0]=-1}e[t]=n[0];r[t]=1;a[t]=n.length;i[t]=n;return this}.bind(this);var I=function(t,e){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.selectBooleanDimension: invalid dimension.")}if(e.length!==g(t)){throw new Error("MatrixView.selectBooleanDimension: array dimensions mismatch.")}var r,a,i,n=new Array(e.length);for(r=0,i=0,a=e.length;r<a;r++){if(e[r]){n[i]=r;i+=1}}return this.selectIndicesDimension(t,n.slice(0,i))}.bind(this);var S=function(t,e,r){var a=t[e];t[e]=t[r];t[r]=a};var E=function(t,n){var o=l();if(!Tools.isInteger(t,0)){throw new Error("MatrixView.swapDimensions: invalid dimensions.")}if(!Tools.isInteger(n,0)){throw new Error("MatrixView.swapDimensions: invalid dimensions.")}var s=Math.max(t,n)+1-o;if(s>0){M(s)}S(e,t,n);S(r,t,n);S(a,t,n);S(i,t,n);return this}.bind(this);var T=function(t){var i;if(!Tools.isSet(t)){for(i=0;a.length>0&&a[0]===1;i++){e.shift();r.shift();a.shift()}if(l()===1){e.push(0);r.push(1);a.push(1)}}else{var n=l();if(!Tools.isInteger(t,1-n,n-1)){throw new Error("MatrixView.shiftDimension: invalid shift.")}for(i=0;i<t;i++){e.push(e.shift());r.push(r.shift());a.push(a.shift())}for(i=t;i<0;i++){e.unshift(0);r.unshift(1);a.unshift(1)}}}.bind(this);this.selectDimension=D;this.selectIndicesDimension=b;this.selectBooleanDimension=I;this.swapDimensions=E;this.shiftDimension=T;this.display=function(){var t,e;for(t=0,e=l();t<e;t++){if(h(t)){console.log(true,c(t))}else{console.log(false,w(t),d(t),g(t))}}return this}.bind(this);if(Tools.isArrayLike(t)){return s(t)}if(t instanceof MatrixView){f(t);o.first=e.slice();o.step=r.slice();o.size=a.slice();return this}throw new Error("MatrixView: invalid argument.")}(function(t,e){"use strict";function r(t,e){var r,a=t.length;var i=t.slice();for(r=a-1;r>0;r--){i[r]-=i[r-1];i[r]*=e}i[0]=0;i.push(-t[a-1]*e-1);return i}function a(t,e){var a,i,n;var o=t[0],s=r(t,e||1);this.iterator=function(){return a+=s[++i]};this.begin=function(t){t=t||0;i=0;n=t-1;return a=t+o};this.end=function(){return n};this.isEnd=function(){return a===n};this.getPosition=function(){return i};this.getIndex=function(){return a}}function i(t,e,r){var a,i,n;this.iterator=function(){return n+=e};this.begin=function(e){e=e||0;a=e+t;i=e+r;return n=a};this.end=function(){return i};this.isEnd=function(){return n===i};this.getPosition=function(){return(n-a)/e};this.getIndex=function(){return n}}function n(t,e){var r,a,i,n,o,s,f;function l(t){if(t>=i){return-1}var e=r[t],a=e.iterator();if(e.isEnd()){a=l(t+1);return a!==-1?e.begin(a):-1}return a}this.iterator=function(){a+=o;if(a===f){var t=l(e+1);a=t===-1?-1:t+n;f=t+s}return a};this.begin=function(){n=t.getFirst(e);o=t.getStep(e);s=t.getEnd(e);i=t.getDimLength();var l,u;r=new Array(i);for(l=i-1;l>e;l--){r[l]=t.getSubIterator(l);u=r[l].begin(u||0)}for(a=0,l=e+1;l<i;l++){a+=t.getFirst(l)}f=a+s;a+=n;return a};this.isEnd=function(){return a===-1};this.end=function(){return-1};this.getPosition=function(){var t,i,s=[],f;if(r[e+1]){f=r[e+1].getIndex()}else{f=0}s[0]=(a-f-n)/o;for(t=e+1,i=r.length;t<i;t++){s[t-e]=r[t].getPosition()}return s}}function o(t,e){var r,a,i,n,o,s,f;var l=t.getIndices(e);var u=t.getSteps(e);var g=function(t){var e=r[t];if(!e){return-1}var a=e.iterator();if(e.isEnd()){a=g(t+1);return a!==-1?e.begin(a):-1}return a};this.iterator=function(){i++;if(i===f){var t=g(e+1);if(t===-1){return a=-1}a=t+o;i=0}a+=u[i];return a};this.begin=function(){o=t.getFirst(e);s=t.getEnd(e);n=t.getDimLength();var u,g;r=new Array(n);for(u=n-1;u>e;u--){r[u]=t.getSubIterator(u);g=r[u].begin(g||0)}for(i=0,a=0,u=e;u<n;u++){a+=t.getFirst(u)}f=l.length;return a};this.isEnd=function(){return a===-1};this.end=function(){return-1};this.getPosition=function(){var t,a,n=[];n[0]=i;for(t=e+1,a=r.length;t<a;t++){n[t-e]=r[t].getPosition()}return n}}e.getIterator=function(t){if(!Tools.isSet(t)){t=0}else if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getIterator: invalid dimension.")}if(this.isIndicesIndexed(t)){return new o(this,t)}var e=new n(this,t);return e};e.getSubIterator=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getSubIterator: invalid dimension.")}if(this.isIndicesIndexed(t)){return new a(this.getIndices(t),1)}var e=this.getFirst(t);var r=this.getStep(t);var n=this.getEnd(t);return new i(e,r,n)};e.extractTo=function(t,e){if(!Tools.isArrayLike(e)){throw new Error("MatrixView.extractTo: invalid output data.")}if(e.length!==this.getInitialLength()){throw new Error("MatrixView.extractTo: Output data length is invalid.")}var r=this.getIterator(1);var a,i,n=r.iterator,o=r.begin,s=r.end;var f,l,u=this.getFirst(0),g=this.getEnd(0);var h,c,v,p;var m;if(Tools.isArrayLike(t)&&t.length===this.getLength()){if(e===t){throw new Error("MatrixView.extractTo: cannot perform on-place extraction.")}if(this.isIndicesIndexed(0)){h=this.getSteps(0);for(a=o(),i=s(),m=0;a!==i;a=n()){for(p=0,f=a+u,l=a+g;f!==l;m++,f+=h[++p]){e[f]=t[m]}}}else{v=this.getStep(0);for(a=o(),i=s(),m=0;a!==i;a=n()){for(f=a+u,c=a+g;f!==c;f+=v,m++){e[f]=t[m]}}}}else if(t.length===1||typeof t==="number"){if(t.length===1){t=t[0]}if(this.isIndicesIndexed(0)){h=this.getSteps(0);for(a=o(),i=s(),m=0;a!==i;a=n()){for(p=0,f=a+u,l=a+g;f!==l;f+=h[++p]){e[f]=t}}}else{v=this.getStep(0);for(a=o(),i=s(),m=0;a!==i;a=n()){for(f=a+u,c=a+g;f!==c;f+=v){e[f]=t}}}}else{throw new Error("MatrixView.extractTo: invalid input length.")}return e};e.extractFrom=function(t,e){if(!Tools.isArrayLike(t)){throw new Error("MatrixView.extractFrom: invalid input data.")}if(t.length!==this.getInitialLength()){throw new Error("MatrixView.extractFrom: input data dimensions mismatch.")}e=e||new t.constructor(this.getLength());if(!Tools.isArrayLike(e)){throw new Error("MatrixView.extractFrom: invalid output data.")}if(e.length!==this.getLength()){throw new Error("MatrixView.extractFrom: output data dimensions mismatch.")}if(e===t){throw new Error("MatrixView.extractFrom: cannot perform on-place extraction.")}var r=this.getIterator(1);var a,i,n=r.iterator,o=r.begin,s=r.end;var f,l,u=this.getFirst(0),g=this.getEnd(0);var h;if(this.isIndicesIndexed(0)){var c=this.getSteps(0),v;for(a=o(),i=s(),h=0;a!==i;a=n()){for(v=0,f=a+u,l=a+g;f!==l;h++,f+=c[++v]){e[h]=t[f]}}}else{var p,m=this.getStep(0);for(a=o(),i=s(),h=0;a!==i;a=n()){for(f=a+u,p=a+g,l=a+g;f!==l;f+=m,h++){e[h]=t[f]}}}return e};e.extract=function(e,r,a){if(!Tools.isArrayLike(e)){throw new Error("MatrixView.extract: invalid input data.")}if(!(r instanceof t)){throw new Error("MatrixView.extract: invalid output view.")}if(!Tools.isArrayLike(a)){throw new Error("MatrixView.extract: invalid output data.")}if(e.length!==this.getInitialLength()){throw new Error("MatrixView.extract: invalid input data length.")}if(a.length!==r.getInitialLength()){throw new Error("MatrixView.extract: invalid output data length.")}if(a===e){throw new Error("MatrixView.extract: cannot perform on-place extraction.")}var i,n,o,s;var f,l,u,g;var h,c;if(this.isIndicesIndexed(0)&&r.isIndicesIndexed(0)){h=this.getIterator(1);i=h.iterator;o=h.begin;s=h.isEnd;var v,p,m,x=i.getFirst(0),w=i.getEnd(0);var d=i.getSteps(0),y;for(n=o(),m=0;!s();n=i()){for(y=1,v=n+x,p=n+w;y!==p;m++,v+=d[y],y++){a[m]=e[v]}}}else{h=this.getIterator(0);i=h.iterator;o=h.begin;s=h.end;c=r.getIterator(0);u=c.begin;f=c.iterator;for(n=o(),l=u(),g=s();n!==g;n=i(),l=f()){a[l]=e[n]}}return a}})(MatrixView,MatrixView.prototype);if(typeof window==="undefined"){module.exports.MatrixView=MatrixView}(function(t,e){"use strict";e.ndims=function(){return this.getDimLength()};e.isrow=function(){var t=this.getSize();return t.length===2&&t[0]===1};e.iscolumn=function(){var t=this.getSize();return t.length===2&&t[1]===1};e.isvector=function(){var t=this.getSize();return t.length===2&&(t[1]===1||t[0]===1)};e.ismatrix=function(){return this.getSize().length===2}})(MatrixView,MatrixView.prototype);(function(t,e){"use strict";e.select=function(){var t=Tools;var e,r;for(e=0,r=arguments.length;e<r;e++){var a=arguments[e];if(t.isArrayLike(a)){if(t.isArrayLike(a[0])){this.selectIndicesDimension(e,a[0])}else if(t.isArrayOfBooleans(a)){this.selectBooleanDimension(e,a)}else if(a.length!==0){this.selectDimension(e,a)}}else if(t.isInteger(a)){this.selectDimension(e,a)}else{throw new Error("MatrixView.select: Invalid selection.")}}return this};e.permute=function(t){var e=this.constructor.name+".permute: ";if(t.length<this.getDimLength()){throw new Error(e+"Dimension permutation is invalid.")}t=t.slice();var r=t.length;var a,i,n;for(a=0;a<r;a++){var o=false;for(n=0;n<r;n++){if(t[n]===a){o=true}}if(o===false){throw new Error(e+"Dimension permutation is invalid.")}}for(a=0,i=r;a<i;a++){n=a;while(true){var s=t[n];t[n]=n;if(s===a){break}else{this.swapDimensions(n,s)}n=s}}return this};e.ipermute=function(t){var e,r,a=[];for(e=0,r=t.length;e<r;e++){a[e]=e}var i=function(e,r){return t[e]-t[r]};return this.permute(a.sort(i))};e.rot90=function(t){var e=this.constructor.name+".rot90: ";switch(typeof t){case"number":if(!Tools.isInteger(t)){throw new Error(e+"Argument must be an integer.")}t%=4;if(t<0){t+=4}break;case"undefined":t=1;break;default:throw new Error(e+"Wrong argument type.")}switch(t){case 1:return this.swapDimensions(0,1).flipud();case 2:return this.flipud().fliplr();case 3:return this.swapDimensions(0,1).fliplr()}return this};e.flipdim=function(t){return this.selectDimension(t,[-1,0])};e.fliplr=function(){return this.select([0,-1],[-1,0])};e.flipud=function(){return this.select([-1,0],[0,-1])};(function(){var t=function(t,e,r){var a=t.getSize(r),i=new Array(a);e%=a;var n=e>0?a-e:-e;var o=e>0?e:a+e;var s,f;for(s=n,f=0;f<o;s++,f++){i[f]=s}for(s=0,f=o;f<a;s++,f++){i[f]=s}t.selectIndicesDimension(r,i)};e.circshift=function(e,r){var a="MatrixView.circshift: Invalid arguments.";if(Tools.isArrayLike(e)&&!Tools.isSet(r)){if(e.length>this.getDimLength()){console.log(e.length,this.getDimLength());throw new Error(a)}for(var i=0,n=e.length;i<n;i++){t(this,e[i],i)}return this}if(Tools.isInteger(e)&&Tools.isInteger(r,0)){t(this,e,r);return this}throw new Error(a)}})()})(MatrixView,MatrixView.prototype);function Matrix(t,e,r,a){"use strict";var i;var n,o,s;var f=false;var l;var u;var g;var h;var c;var v;var p=function(e){if(e instanceof Matrix){e=e.getCopy().getData()}t=Tools.checkSize(e);i=new MatrixView(t);l=i.getIndex;u=i.getDimLength;g=i.getLength;h=i.getSize;v=i.displayView;c=i.getIterator.bind(i);this.getIndex=l;this.getDimLength=u;this.getLength=g;this.getSize=h;this.displayView=v;this.getIterator=c}.bind(this);var m=function(t,r,l){p(t);var u=Tools.isSet(l)?l:false;if(!Tools.isBoolean(u)){throw new Error('Matrix: "complex" argument must be a boolean')}if(Tools.isArrayLike(r)){n=r instanceof Array?new Matrix.dataType(r):r;e=r.constructor;if(n.length!==i.getLength()*(u?2:1)){throw new Error("Matrix: data and size are incompatible.")}if(u){o=n.subarray(0,i.getLength());s=n.subarray(i.getLength())}}else{e=Tools.checkType(r);if(typeof r==="string"){switch(r.toLowerCase()){case"logical":case"bool":case"boolean":f=true;break;default:f=false}}var g=i.getLength();if(!u){n=new e(g)}else{n=new e(2*g);o=n.subarray(0,g);s=n.subarray(g)}}if(Tools.isSet(a)){if(!Tools.isBoolean(a)){throw new Error('Matrix: "bool" argument must be a boolean')}if(a){f=true}}return this}.bind(this);this.initialize=m;var x=function(){if(!Tools.isSet(s)){return true}var t,e;for(t=0,e=s.length;t<e;t++){if(s[t]!==0){return false}}n=o;o=undefined;s=undefined;return true};var w=function(){return g()===1};var d=function(){return n.length===0};var y=function(t,e){t=Tools.isArrayLike(t)?l(t):t;if(!Tools.isSet(e)){return x()?n[t]:[o[t],s[t]]}if(!x()){n[t]=e}else{o[t]=e[0];s[t]=e[1]}return e}.bind(this);var M=function(){return n};var D=function(){if(!x()){throw new Error("Matrix.getDataScalar: Data must be real.")}if(g()!==1){throw new Error("Matrix.getDataScalar: Data length must be 1.")}return n[0]};var b=function(){if(!Tools.isSet(s)){throw new Error("Matrix.getRealData: expected a complex Matrix.")}return o};var I=function(){if(!Tools.isSet(s)){throw new Error("Matrix.getImagData: expected a complex Matrix.")}return s};var S=function(t){if(!x()){throw new Error("Matrix.toComplex: expected a non-complex Matrix.")}var e=new n.constructor(n.length*2);o=e.subarray(0,n.length);s=e.subarray(n.length);o.set(n);if(t instanceof Matrix){Tools.checkSizeEquals(this,t,Matrix.ignoreTrailingDims);if(!t.isreal()){throw new Error("Matrix.toComplex: imaginary part cannot be complex.")}t=t.getData()}if(Tools.isArrayLike(t)){if(t.length!==n.length){throw new Error("Matrix.toComplex: imaginary part has invalid length.")}s.set(t)}else if(Tools.isSet(t)){throw new Error("Matrix.toComplex: invalid argument.")}n=e;return this}.bind(this);var E=function(){return f?"logical":n.constructor.name};var T=function(){return new MatrixView(i)};this.value=y;this.getData=M;this.getDataScalar=D;this.getRealData=b;this.getImagData=I;this.getDataType=E;this.getView=T;this.isreal=x;this.isscalar=w;this.isempty=d;this.toComplex=S;var A=function(){var t=Array.prototype.slice.apply(arguments);if(Tools.isArrayLike(t[0])){t=t[0]}if(t.length===0){t=this.getLength()}t=Tools.checkSize(t,"column");var e,r,a=1;for(e=0,r=t.length;e<r;e++){a*=t[e]}if(a!==this.getLength()){throw new Error("Matrix.reshape: number of elements must not change.")}p(t);return this}.bind(this);this.reshape=A;var z=function(){var e=!x();var r=n instanceof Array?n.slice():new n.constructor(n);return new Matrix(t,r,e,f)};this.getCopy=z;return m(t,e,r)}Matrix.dataType=Float64Array;Matrix.ignoreTrailingDims=true;if(typeof window==="undefined"){module.exports.Matrix=Matrix}(function(t,e){"use strict";e.toArray=function(){var t="Matrix.toArray: function only available for ";if(this.ndims()>2){throw new Error(t+"2D matrix.")}var e;if(this.isreal()){e=this.getData()}else{throw new Error(t+"for real matrix.")}var r=this.getView();var a=r.getFirst(0),i=r.getStep(0),n=r.getEnd(0);var o=r.getFirst(1),s=r.getStep(1),f=r.getEnd(1);var l,u,g,h,c,v;for(c=[],l=a,u=n;l!==u;l+=i){for(v=[],g=l+o,h=l+f;g!==h;g+=s){v.push(e[g])}c.push(v)}return c};t.fromArray=function(e){var r,a;if(e[0].length){if(e[0][0].length){throw new Error("Matrix.fromArray: Only work with Array up to 2 dimensions.")}r=[e[0].length,e.length];a=[];var i,n;for(i=0,n=e.length;i<n;i++){var o=Array.prototype.slice.apply(e[i]);a=a.concat(o)}}else{r=e.length;a=e}return new t(r,a)};e.dlmwrite=function(t){if(t!==undefined&&typeof t!=="string"){throw new Error("Matrix.dlmread: Wrong delimiter specification.")}if(this.ndims()>2){throw new Error("Matrix.dlmwrite: function only available for 2D matrix.")}var e=this.getView(),r=this.getData();var a=e.getStep(1),i=e.getEnd(1);var n=e.getSize(0);var o,s,f,l;var u="";for(o=0,f=n;o<f;o++){for(s=o,l=o+i-a;s<l;s+=a){u+=r[s]+t}u+=r[s]+"\n"}return u};t.dlmread=function(e,r){if(r!==undefined&&typeof r!=="string"){throw new Error("Matrix.dlmread: Wrong delimiter specification.")}e=e.split("\n");if(e[e.length-1]===""){e.pop()}var a,i,n,o;var s=[];var f=/[\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?/g;for(a=0,i=e.length;a<i;a++){var l=r?e[a].split(r):e[a].match(f);for(n=0,o=l.length;n<o;n++){l[n]=parseFloat(l[n])}s.push(l)}return t.fromArray(s).transpose()};e.toMatlab=function(){if(this.ndims()>2){throw new Error("Matrix.toMatlab: function available only for 2D matrix.")}var t=function(t,e){var r=t.toString();if(typeof e==="number"){r+=e>0?" + ":" - ";r+=Math.abs(e).toString();r+=" * i"}return r};var e="",r,a,i;if(this.isreal()){r=this.getData()}else{a=this.getRealData();i=this.getImagData()}var n=this.getView();var o=n.getFirst(0),s=n.getStep(0),f=n.getEnd(0);var l=n.getFirst(1),u=n.getStep(1),g=n.getEnd(1);var h,c,v,p;e+="[";for(h=o,c=f;h!==c;h+=s){if(h!==o){e+=" "}if(this.isreal()){for(v=h+l,p=h+g;v!==p;v+=u){e+=t(r[v]);if(v!==p-u){e+=","}}}else{for(v=h+l,p=h+g;v!==p;v+=u){e+=t(a[v],i[v]);if(v!==p-u){e+=","}}}if(h!==c-s){e+=";"}}e+="]";return e};e.toString=function(t,e){var r,a="";if(t===undefined){r=4}else if(typeof t==="string"){a=t;r=4}else{r=t}if(typeof e==="string"){a=e}var i=r+5;var n=function(t,e){var a="";if(typeof t==="number"){if(t%1===0){a+=t}else{a+=t.toFixed(r)}while(a.length<i){a=" "+a}}else{a+=t.toString()}if(e===undefined){return a}if(e===0){while(a.length<2*i+1){a=a+" "}return a}if(typeof e==="number"){a+=e>0?" + ":" - ";if(t%1===0){a+=Math.abs(e)}else{a+=Math.abs(e).toFixed(r)}while(a.length<i){a=" "+a}}else{a+=e.toString()}a+="i";return a};var o,s,f="",l;if(this.isempty()){f+="Empty array: ";l=this.getSize();for(o=0,s=l.length-1;o<s;o++){f+=l[o]+"-by-"}f+=l[o];return f}if(this.getLength()>1e4){f+="Array: ";l=this.getSize();for(o=0,s=l.length-1;o<s;o++){f+=l[o]+"-by-"}f+=l[o];return f}var u,g,h;if(this.isreal()){u=this.getData()}else{g=this.getRealData();h=this.getImagData()}var c=this.getIterator(2);var v=c.iterator,p=c.begin,m=c.isEnd;var x=this.getSize(2);var w=this.getView();var d=w.getFirst(0),y=w.getStep(0),M=w.getEnd(0);var D=w.getFirst(1),b=w.getStep(1),I=w.getEnd(1);var S,E,T,A;for(o=p();!m();o=v()){f+=a;if(x>1){f+="(:,:,"+c.getPosition()+") = [\n"}else{f+=" = [\n"}for(S=o+d,E=o+M;S!==E;S+=y){f+="	";if(this.isreal()){for(T=S+D,A=S+I;T!==A;T+=b){f+=n(u[T])+" "}}else{for(T=S+D,A=S+I;T!==A;T+=b){f+=n(g[T],h[T])+" "}}f+="\n"}f+="]\n"}return f};t.toMatrix=function(e,r){if(e instanceof t){return e}if(e.constructor===Number){e=[e]}var a=Array.prototype.concat.apply([],e);var i=false,n;if(Tools.isArrayOfBooleans(a)){i=true}else if(!Tools.isArrayOfNumbers(a)){throw new Error("Matrix.toMatrix: Array must only contain numbers or booleans.")}if(a.length===1){n=1}else if(a.length===e.length){n=[a.length,1]}else{n=[];var o=e;while(o.length){n.push(o.length);o=o[0]}n=n.reverse()}return new t(n,a,false,i)};e.display=function(t,e){console.log(this.toString(t,e));return this}})(Matrix,Matrix.prototype);(function(t,e){"use strict";e.extractViewFrom=function(e){if(this.isreal()){var r=this.getData();return new t(e.getSize(),e.extractFrom(r))}var a=new t(e.getSize(),this.getDataType(),true);e.extractFrom(this.getRealData(),a.getRealData());e.extractFrom(this.getImagData(),a.getImagData());return a};e.extractViewTo=function(t,e){if(this.isreal()&&e.isreal()){t.extractTo(this.getData(),e.getData());return e}if(this.isreal()){t.extractTo(this.getData(),e.getRealData());return e}if(e.isreal()){e.toComplex()}t.extractTo(this.getRealData(),e.getRealData());t.extractTo(this.getImagData(),e.getImagData());return e};var r=function(t){t=Array.prototype.slice.apply(t);var e,r;for(e=0,r=t.length;e<r;e++){t[e]=t[e]?true:false}return t};e.selectView=function(e){e=Array.prototype.slice.apply(e);var a=Tools,i=a.checkSizeEquals,n=t.ignoreTrailingDims;var o=e[0];var s,f;if(o instanceof t&&e.length===1){var l=o.getData();var u=new MatrixView([this.getLength(),1]);if(o.islogical()&&i(this.getSize(),o.getSize(),n)){return u.selectBooleanDimension(0,l)}if(a.isArrayOfNumbers(l,0,this.numel(0)-1)){return u.selectIndicesDimension(0,l)}throw new Error("Matrix.selectView: Invalid Matrix selection.")}for(s=0,f=e.length;s<f;s++){o=e[s];if(o instanceof t){if(o.isvector()){if(o.islogical()){o=r(o.getData())}else{o=[o.getData()]}}else{throw new Error("Matrix.selectView: Invalid Matrix selection:",o)}}e[s]=o}return MatrixView.prototype.select.apply(this.getView(),e)};e.get=function(){if(arguments.length===0){return this.getCopy()}var e=this.selectView(arguments);if(arguments.length===1&&arguments[0]instanceof t){if(e.getLength()===arguments[0].getLength()){return this.extractViewFrom(e).reshape(arguments[0].getSize())}return this.extractViewFrom(e)}return this.extractViewFrom(e)};e.set=function(){var e=Array.prototype.slice.apply(arguments);var r=t.toMatrix(e.pop());var a=this.selectView(e);if(e.length===1&&e[0]instanceof t){var i=r.getSize(),n=e[0].getSize();var o=r.reshape().extractViewTo(a,this.reshape());r.reshape(i);return o.reshape(n)}return r.extractViewTo(a,this)};t.set=function(){var r=Array.prototype.shift.apply(arguments);if(!(r instanceof t)){throw new Error("Matrix.set: Matrix to modify must be provided.")}return e.set.apply(r.getCopy(),arguments)};t.reshape=function(){var e=Array.prototype.shift.apply(arguments);if(!(e instanceof t)){throw new Error("Matrix.reshape: Matrix to modify must be provided.")}e=e.getCopy();return e.reshape.apply(e,arguments)};e.repmat=function(){var e=Tools.checkSize(arguments,"square");var r,a=this.getView();var i=this.size();var n,o=1,s=[];for(r=0,n=Math.max(i.length,e.length);r<n;r++){s[r]=(i[r]||1)*(e[r]||1);o*=s[r]}var f=new t(s,this.getDataType(),!this.isreal());var l=f.getView();var u,g,h,c;if(this.isreal()){h=f.getData();u=this.getData()}else{h=f.getRealData();c=f.getImagData();u=this.getRealData();g=this.getImagData()}for(r=0,n=i.length;r<n;r++){l.selectDimension(r,[0,i[r],-1])}var v=l.getIterator(0);var p,m=v.iterator,x=v.begin,w=v.isEnd;for(p=x();!w();p=m()){var d=f.getView(),y=v.getPosition();for(r=0,n=e.length;r<n;r++){var M=i[r]||1,D=y[r]*M;d.selectDimension(r,[D,1,D+M-1])}a.extract(u,d,h);

if(!this.isreal()){a.extract(g,d,c)}}return f};e.permute=function(t){var e=this.getView().permute(t);return this.extractViewFrom(e)};e.ipermute=function(t){var e=this.getView().ipermute(t);return this.extractViewFrom(e)};e.shiftdim=function(t){var e=this.getView();t=e.shiftDimension(t);return[this.extractViewFrom(e),t]};e.circshift=function(t,e){var r=this.getView().circshift(t,e);return this.extractViewFrom(r)};e.rot90=function(t){var e=this.getView().rot90(t);return this.extractViewFrom(e)};e.flipdim=function(t){var e=this.getView().selectDimension(t,[-1,0]);return this.extractViewFrom(e)};e.fliplr=function(){return this.flipdim(1)};e.flipud=function(){return this.flipdim(0)};e.cat=function(){var e=arguments[0];var r=this.getSize();if(r[e]===undefined){r[e]=1}var a;for(a=1;a<arguments.length;a++){r[e]+=arguments[a].getSize(e)}var i=new t(r);var n=i.getView();var o=this.getSize(e)-1;n.selectDimension(e,[0,o]);this.extractViewTo(n,i);n.restore();for(a=1;a<arguments.length;a++){n.selectDimension(e,[o+1,o+=arguments[a].getSize(e)]);arguments[a].extractViewTo(n,i);n.restore()}return i}})(Matrix,Matrix.prototype);(function(t,e){"use strict";e.numel=function(){return this.getLength()};e.ndims=function(){return this.getDimLength()};e.size=function(t){switch(typeof t){case"number":if(!Tools.isInteger(t,0)){throw new Error("Matrix.size: invalid argument.")}return this.getSize(t)||1;case"undefined":return this.getSize();default:throw new Error("Matrix.size: Wrong argument type.")}};e.type=function(){switch(this.getDataType().toLowerCase()){case"boolean":case"logical":return"logical";case"array":case"float64array":return"double";case"float32array":return"single";case"int32array":return"int32";case"uint32array":return"uint32";case"int16array":return"int16";case"uint16array":return"uint16";case"int8array":return"int8";case"uint8clampedarray":return"uint8c";case"uint8array":return"uint8";default:return new Error("Matrix.type: Unknown data type.")}};e.isrow=function(){var t=this.size();return t.length===2&&t[0]===1};e.iscolumn=function(){var t=this.size();return t.length===2&&t[1]===1};e.isvector=function(){var t=this.size();return t.length===2&&(t[1]===1||t[0]===1)};e.ismatrix=function(){return this.getSize().length<=2};e.issquare=function(){if(this.getSize(0)!==this.getSize(1)){throw false}return true};e.isinteger=function(){switch(this.getDataType().toLowerCase()){case"uint8array":case"uint8clampedarray":case"uint16array":case"uint32array":case"int8array":case"int16array":case"int32array":return true;default:return false}};e.isfloat=function(){switch(this.getDataType().toLowerCase()){case"float32array":case"float64array":return true;default:return false}};e.islogical=function(){var t=this.getDataType().toLowerCase();if(t==="logical"||t==="boolean"||t==="bool"){return true}return false};t.intmin=function(t){switch(t){case"uint8c":case"uint8":case"uint16":case"uint32":return 0;case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648;default:throw new Error("Matrix.intmin: Unknown data type.")}};t.intmax=function(t){switch(t){case"int8":return 127;case"uint8c":case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295;default:throw new Error("Matrix.intmax: Unknown data type.")}};t.realmin=function(t){switch(t){case undefined:case"double":return Number.MIN_VALUE;case"single":return 1.1755e-38;default:throw new Error("Matrix.realmin: Unknown data type.")}};t.realmax=function(t){switch(t){case undefined:case"double":return Number.MAX_VALUE;case"single":return 3.4028e38;default:throw new Error("Matrix.realmin: Unknown data type.")}}})(Matrix,Matrix.prototype);(function(t,e){"use strict";var r=typeof module!=="undefined"&&module.exports?true:false;var a,i,n;if(r){a=require("fs");i=require("canvas");n=i.Image}else{n=Image}var o=function(t,e){var a;if(r){a=new i}else{a=document.createElement("canvas")}a.width=t||0;a.height=e||0;return a};t.colon=function(){var e=Tools.checkColon(arguments);var r=e[0],a=e[1],i=e[2];if(!isFinite(r)||!isFinite(a)||!isFinite(i)){throw new Error("Parameters are invalid number (Infitity or NaN).")}var n=2.2204e-16;var o=2*n*Math.max(Math.abs(r),Math.abs(i));var s=a>0?1:-1;var f;var l=Tools.isInteger;if(l(r)&&a===1){f=Math.floor(i)-r}else if(l(r)&&l(a)){var u=Math.floor(r/a);var g=r-u*a;f=Math.floor((i-g)/a)-u}else{f=Math.round((i-r)/a);if(s*(r+f*a-i)>o){f=f-1}}var h=r+f*a;if(s*(h-i)>-o){h=i}var c=new t(f+1);var v=c.getData();var p,m=Math.floor(f/2)+1;var x=r,w=h;for(p=0;p<m;p++,x+=a,w-=a){v[p]=x;v[f-p]=w}if(f%2===0){v[f/2]=(r+h)/2}return c};t.linspace=function(e,r,a){if(!Tools.isNumber(e)){throw new Error}if(!Tools.isNumber(r)){throw new Error}if(a===undefined){a=100}else if(!Tools.isInteger(a,1)){throw new Error("Matrix.linspace: Bins shoulb be an integer > 1.")}var i=a-1;return t.colon(e,(r-e)/i,r)};t.zeros=function(){var e,r;if(typeof arguments[arguments.length-1]==="string"){r=Array.prototype.pop.apply(arguments)}e=Tools.checkSize(arguments,"square");return new t(e,r)};t.ones=function(){var e;if(typeof arguments[arguments.length-1]==="string"){e=Array.prototype.pop.apply(arguments)}var r=Tools.checkSize(arguments,"square");var a=new t(r,e),i=a.getData();var n,o;for(n=0,o=i.length;n<o;++n){i[n]=1}return a};t.rand=function(){var e,r;if(typeof arguments[arguments.length-1]==="string"){r=Array.prototype.pop.apply(arguments)}e=Tools.checkSize(arguments,"square");var a=new t(e,r),i=a.getData();var n,o,s=Math.random;for(n=0,o=i.length;n<o;++n){i[n]=s()}return a};t.randn=function(){var e,r;if(typeof arguments[arguments.length-1]==="string"){r=Array.prototype.pop.apply(arguments)}e=Tools.checkSize(arguments,"square");var a=new t(e,r),i=a.getData();var n,o;var s=Math.random,f=Math.PI*2;var l=Math.sqrt,u=Math.sin,g=Math.log;for(n=0,o=i.length;n<o;++n){var h=f*s();var c=l(-2*g(1-s()));i[n]=c*u(h)}return a};t.randi=function(){var e,r,a;e=Array.prototype.shift.apply(arguments);e=Tools.checkRange(e);if(typeof arguments[arguments.length-1]==="string"){a=Array.prototype.pop.apply(arguments)}r=arguments.length===0?[1]:arguments;r=Tools.checkSize(r,"square");var i=new t(r,a),n=i.getData();var o,s,f=e[0],l=e[1]-f+1;var u=Math.random,g=Math.floor;for(o=0,s=n.length;o<s;++o){n[o]=g(u()*l)+f}return i};t.eye=function(){var e,r;if(typeof arguments[arguments.length-1]==="string"){r=Array.prototype.pop.apply(arguments)}e=Tools.checkSize(arguments,"square");var a=new t(e,r);var i=a.getData();var n=a.getView(),o=a.getIterator(2);var s=o.iterator,f=o.begin,l=o.isEnd;var u=n.getFirst(1),g=n.getStep(1);var h=n.getFirst(0),c=n.getStep(0);var v=Math.min(n.getSize(1),n.getSize(0));var p,m,x;for(p=f();!l();p=s()){for(m=p+u+h,x=0;x<v;m+=g,x++){i[m+x*c]=1}}return a};t.complex=function(e,r){e=t.toMatrix(e);r=t.toMatrix(r);if(!(e instanceof t)){throw new Error("Matrix.complex: real argument must be a matrix.")}if(!e.isreal()){throw new Error("Matrix.complex: real argument must be a real matrix.")}if(!(r instanceof t)){throw new Error("Matrix.complex: imag argument must be a matrix.")}if(!r.isreal()){throw new Error("Matrix.complex: imag argument must be a real matrix.")}if(!Tools.checkSizeEquals(e.getSize(),r.getSize(),t.ignoreTrailingDims)){throw new Error("Matrix.complex: imag and real Matrix must "+"have the same size.")}var a=e.getData(),i=r.getData();var n=new t.dataType(a.length*2);n.subarray(0,a.length).set(a);n.subarray(a.length).set(i);return new t(e.getSize(),n,true)};t.imread=function(e,s,f){var l="Matrix.imread: ";var u=new t;if(!r&&typeof e==="string"&&document.getElementById(e)){e=document.getElementById(e)}var g=function(t){var e,r=t.getContext("2d");var a=t.width,i=t.height;try{e=r.getImageData(0,0,a,i)}catch(n){if(f!==undefined){f.call(this,n);return}throw n}var o=new Uint8ClampedArray(e.data);var l=new MatrixView([4,a,i]).select([0,2],[0,-1],[0,-1]).permute([2,1,0]);this.initialize(l.getSize(),l.extractFrom(o));if(s){s.call(this,this)}}.bind(u);var h=function(t){if(!r){t=t instanceof Event?this:t}var e=o(t.width,t.height);e.getContext("2d").drawImage(t,0,0,t.width,t.height);g(e)};var c=function(t){var e=new n;e.onerror=f||function(){throw new Error(l+"Error occuring while loading image.")};if(r){e.src=a.readFileSync(t);h(e)}else{e.src=t;e.onload=h}};if(typeof e==="string"){c(e)}else if(!r&&e instanceof Image){h(e)}else if(!r&&e instanceof HTMLCanvasElement){g(e)}else if(r&&e instanceof i){g(e)}else{throw new Error(l+"invalid source argument")}return u};t.diag=function(e){e=t.toMatrix(e);var r=e.numel();e=e.getData();var a=t.zeros(r);var i=a.getData();var n,o,s;for(n=0,o=i.length,s=0;n<o;n+=r+1,s++){i[n]=e[s]}return a};t.loadImages=function s(e,r){var a=[],i,n;r=r.bind(a);var o=function(t){return function(){a[t]=this;for(var i=0,n=e.length;i<n;i++){if(!a[i]||a[i].isempty()){return}}r()}};for(i=0,n=e.length;i<n;i++){if(e[i]instanceof Image){t.imread(e[i],o(i))}}return a}})(Matrix,Matrix.prototype);(function(t,e){"use strict";var r=function(t,e,r,a){for(var i=e+r,n=e+a,o=t[e];i<n;i+=r){if(t[i]<o){o=t[i]}}return o};var a=function(t,e,r,a){for(var i=e+r,n=e+a,o=t[e],s=e;i<n;i+=r){if(t[i]<o){o=t[i];s=i}}return s};var i=function(t,e,r,a){for(var i=e+r,n=e+a,o=t[e];i<n;i+=r){if(t[i]>o){o=t[i]}}return o};var n=function(t,e,r,a){for(var i=e+r,n=e+a,o=t[e],s=e;i<n;i+=r){if(t[i]>o){o=t[i];s=i}}return s};var o=function(t,e,r,a){for(var i=e,n=e+a,o=0;i<n;i+=r){o+=t[i]}return o};var s=function(t,e,r,a){for(var i=e,n=e+a,o=0;i<n;i+=r){o+=t[i]}return o*r/a};var f=function(t,e,r,a){for(var i=e,n=e+a,o=1;i<n;i+=r){o*=t[i]}return o};var l=function(t,e,r,a){var i=s(t,e,r,a);for(var n=e,o=e+a,f=0;n<o;n+=r){var l=t[n]-i;f+=l*l}return f*r/(a-1)};var u=function(t,e,r,a){return l(t,e,r,a)*(a-1)/a};var g=function(t,e,r,a){for(var i=e+r,n=e+a;i<n;i+=r){t[i]+=t[i-r]}};var h=function(t,e,r,a){for(var i=e+r,n=e+a;i<n;i+=r){t[i]*=t[i-r]}};var c=function(t,e){var r=t.ndims(),a=[e];for(var i=0;i<r;i++){if(i!==e){a.push(i)}}return a};var v=function(e,r,a,i,n){i=i||false;if(!Tools.isSet(a)){if(i){r(e.getData(),0,1,e.numel());return e}var o=r(e.getCopy().getData(),0,1,e.numel());return t.toMatrix(o)}if(!Tools.isInteger(a,0)){throw new Error("Matrix.applyDim: Invalid dimension.")}var s=e.getView(),f=c(s,a);s.permute(f);var l=e.getData(),u=s.getIterator(1);var g=u.iterator,h=u.begin,v=u.isEnd;var p=s.getStep(0),m=s.getEnd(0);var x,w;if(!i){var d=e.getSize();d[a]=1;var y=new t(d,n),M=new y.getData;for(x=h(),w=0;!v();x=g(),w++){M[w]=r(l,x,p,m)}return y}if(n!==undefined){e=n;n=n.getData()}for(x=h();!v();x=g()){r(l,x,p,m,n)}return e};e.amin=function(e){var r=this.isreal()?this:t.abs(this);return v(r,a,e,undefined,"uint32")};e.min=function(t){if(this.isreal()){return v(this,r,t)}return this.get(this.amin(t))};e.amax=function(e){var r=this.isreal()?this:t.abs(this);return v(r,n,e,undefined,"uint32")};e.max=function(t){if(this.isreal()){return v(this,i,t)}return this.get(this.amax(t))};e.sum=function(e){if(this.isreal()){return v(this,o,e)}var r=this.getSize();return t.complex(v(new t(r,this.getRealData()),o,e),v(new t(r,this.getImagData()),o,e))};e.prod=function(t){if(this.isreal){return v(this,f,t)}throw new Error("Matrix.prod: Is not yet implement for complex values.")};e.mean=function(e){if(this.isreal()){return v(this,s,e)}var r=this.getSize();return t.complex(v(new t(r,this.getRealData()),s,e),v(new t(r,this.getImagData()),s,e))};e.variance=function(t,e){switch(typeof e){case"undefined":e=-1;break;case"boolean":e=e===false?-1:0;break;case"number":if(e===0){e=-1}else if(e===1){e=0}else{throw new Error("Matrix.variance: Invalid argument.")}break;default:throw new Error("Matrix.variance: Invalid argument.")}if(!this.isreal()){throw new Error("Matrix.variance: Is not yet implement for complex values.")}if(e===-1){return v(this,l,t)}return v(this,u,t)};e.std=function(t,e){if(!this.isreal()){throw new Error("Matrix.std: Is not yet implement for complex values.")}var r=this.variance(t,e);if(typeof r==="number"){return Math.sqrt(r)}return r.arrayfun(Math.sqrt)};e.cumsum=function(e){var r=g;if(this.isreal()){return v(this,r,e,true)}var a=this.getSize();return t.complex(v(new t(a,this.getRealData()),r,e,true),v(new t(a,this.getImagData()),r,e,true))};e.cumprod=function(t){if(!this.isreal()){throw new Error("Matrix.cumprod: Is not yet implement for complex values.")}return v(this,h,t,true)};(function(){var r=function(t,e){var r=Math.exp(-e),a=Math.random;for(var i=0,n=t.length;i<n;i++){var o=1,s=0;do{s++;o*=a()}while(o>r);t[i]=s-1}};var a=function(t){var e=Math.exp,r=Math.random;for(var a=0,i=t.length;a<i;a++){var n=1,o=0,s=e(-t[a]);do{o++;n*=r()}while(n>s);t[a]=o-1}};var i=function(t,e){e=-e;var r=Math.random,a=Math.log;for(var i=0,n=t.length;i<n;++i){t[i]=e*a(r())}};t.poissrnd=function(){var e=Array.prototype.shift.apply(arguments);if(typeof e==="number"){var a=Tools.checkSize(arguments,"square");var i=new t(a),n=i.getData();r(n,e);return i}if(e instanceof t){return e.getCopy().poissrnd()}};e.poissrnd=function(){a(this.getData());return this};t.exprnd=function(){var e=Array.prototype.shift.apply(arguments);var r=Tools.checkSize(arguments,"square");var a=new t(r),n=a.getData();i(n,e);return a}})();(function(){var r,a,i;var n=function(t,e){return r[t]-r[e]};var o=function(t,e){return r[e]-r[t]};var s=function(t,e){return t-e};var f=function(t,e){return e-t};var l=function(t,e,a,n){var o,s,f;for(o=e,s=0,f=e+n;o<f;o+=a,s++){r[s]=t[o]}Array.prototype.sort.call(r,i);for(o=e,s=0,f=e+n;o<f;o+=a,s++){t[o]=r[s]}};var u=function(t,e,n,o,s){var f,l,u;for(f=e,l=0,u=e+o;f<u;f+=n,l++){r[l]=t[f];a[l]=l}Array.prototype.sort.call(a,i);for(f=e,l=0,u=e+o;f<u;f+=n,l++){s[f]=a[l]*n+e}};e.sort=function(t,e){var a=typeof t==="number"?this.getSize(t):this.numel();r=new Float64Array(a);if(e==="ascend"){i=s}else if(e==="descend"){i=f}else{throw new Error("Matrix.sort: Wrong mode selection")}return v(this,l,t,true)};t.sort=function(t,e,r){return t.getCopy().sort(e,r)};e.asort=function(e,s){var f=typeof e==="number"?this.getSize(e):this.numel();r=new Float64Array(f);a=new Uint32Array(f);if(s==="ascend"){i=n}else if(s==="descend"){i=o}else{throw new Error("Matrix.sort: Wrong mode selection")}var l=new t(this.getSize(),"uint32");return v(this,u,e,true,l)};t.asort=function(t,e,r){return t.getCopy().asort(e,r)}})();t.accumarray=function(e,r,a){if(!this.isreal()){throw new Error("Matrix.accumarray: Is not yet implement for complex values.")}e=t.toMatrix(e);if(!Tools.isArrayOfIntegers(e.getData(),0)){throw new Error("Matrix.accumarray: Subs should be an array of positive integers.")}var i=e.max(0).getData();var n,o,s=[1];if(Tools.isSet(a)){for(n=0,o=i.length;n<o;n++){if(a[n]<i[n]+1){throw new Error("Matrix.accumarray: Size and Subs values are unconsistent.")}}}else{a=[];for(n=0,o=i.length;n<o;n++){a[n]=i[n]+1}}for(n=0,o=a.length-1;n<o;n++){s[n+1]=s[n]*a[n]}if(e.ndims()>2){throw new Error("Matrix.accumarray: Subs must be a 2D Array.")}var f=e.getData(),l=e.numel(),u=e.getSize(0);var g,h,c,v,p;var m=new Uint32Array(u);for(h=0,c=0;c<l;h++,c+=u){for(g=0,v=c,p=s[h];g<u;g++,v++){m[g]+=f[v]*p}}if(r instanceof t){r=r.getData()}var x=new t(a),w=x.getData();if(Tools.isArrayLike(r)&&r.length===m.length){for(n=0,o=m.length;n<o;n++){w[m[n]]+=r[n]}}else if(typeof r==="number"){for(n=0,o=m.length;n<o;n++){w[m[n]]+=r}}else{throw new Error("Matrix.accumarray: Wrong val argument.")}return x}})(Matrix,Matrix.prototype);(function(t,e){"use strict";e.cast=function(e){var r;switch(e.toLowerCase()){case"boolean":case"bool":case"logical":r=true;break;default:r=false}e=Tools.checkType(e);var a=new e(this.getData());return new t(this.getSize(),a,!this.isreal(),r)};e.double=function(){return this.cast("double")};e.single=function(){return this.cast("single")};e.int8=function(){return this.cast("int8")};e.int16=function(){return this.cast("int16")};e.int32=function(){return this.cast("int32")};e.uint8=function(){return this.cast("uint8")};e.logical=function(){return this.cast("logical")};e.uint8c=function(){return this.cast("uint8c")};e.uint16=function(){return this.cast("uint16")};e.uint32=function(){return this.cast("uint32")};e.isnan=function(){var e=new t(this.getSize(),"logical");var r=e.getData();var a,i;if(this.isreal()){var n=this.getData();for(a=0,i=r.length;a<i;a++){r[a]=isNaN(n[a])}}else{var o=this.getRealData(),s=this.getImagData();for(a=0,i=r.length;a<i;a++){r[a]=isNaN(o[a])||isNaN(s[a])}}return e};e.isinf=function(){var e=new t(this.getSize(),"logical");var r=e.getData();var a,i;if(this.isreal()){var n=this.getData();for(a=0,i=r.length;a<i;a++){var o=n[a];r[a]=o===Infinity||o===-Infinity?1:0}}else{var s=this.getRealData(),f=this.getImagData();for(a=0,i=r.length;a<i;a++){var l=s[a],u=f[a];r[a]=l===Infinity||l===-Infinity||u===Infinity||u===-Infinity?1:0}}return e};e.isfinite=function(){var e=new t(this.getSize(),"logical");var r=e.getData();var a,i;if(this.isreal()){var n=this.getData();for(a=0,i=r.length;a<i;a++){r[a]=isFinite(n[a])?1:0}}else{var o=this.getRealData(),s=this.getImagData();for(a=0,i=r.length;a<i;a++){r[a]=isFinite(o[a])||isFinite(s[a])?1:0}}return e}})(Matrix,Matrix.prototype);(function(t,e){"use strict";e.real=function(){if(this.isreal()){throw new Error("Matrix.real: This function can be only"+" used with a complex Matrix. ")}var e=this.getRealData();return new t(this.getSize(),new e.constructor(e))};e.imag=function(){if(this.isreal()){throw new Error("Matrix.imag: This function can be only"+" used with a complex Matrix. ")}var e=this.getImagData();return new t(this.getSize(),new e.constructor(e))};(function(){var r=function(t){for(var e=0,r=t.length;e<r;e++){t[e]=0}};var a=function(t,e){for(var r=0,a=t.length;r<a;r++){t[r]=Math.atan2(e[r],t[r]);e[r]=0}};e.angle=function(){if(this.isreal()){r(this.getData())}else{a(this.getRealData(),this.getImagData())}return this};t.angle=function(t){return t.getCopy().angle()}})();(function(){var r=function(t){for(var e=0,r=t.length;e<r;e++){t[e]=t[e]>0?t[e]:-t[e]}};var a=function(t,e){for(var r=0,a=t.length;r<a;r++){var i=e[r],n=t[r];t[r]=Math.sqrt(i*i+n*n);e[r]=0}};e.abs=function(){if(this.isreal()){r(this.getData())}else{a(this.getRealData(),this.getImagData())}return this};t.abs=function(t){return t.getCopy().abs()}})();e.conj=function(){if(this.isreal()===true){return this}var t,e,r=this.getImagData();for(t=0,e=r.length;t<e;t++){r[t]=-r[t]}return this};t.conj=function(t){return t.getCopy().conj()}})(Matrix,Matrix.prototype);(function(Matrix,Matrix_prototype){"use strict";(function(t){var e=function(t){for(var e=0,r=t.length;e<r;e++){t[e]=Math.sqrt(t[e])}};var r=function(t,e){for(var r=0,a=t.length;r<a;r++){var i=t[r],n=e[r];var o=Math.sqrt(i*i+n*n);t[r]=Math.sqrt((i+o)*.5);e[r]=n<0?-Math.sqrt((o-i)*.5):Math.sqrt((o-i)*.5)}};t.sqrt=function(){if(this.isreal()){e(this.getData())}else{r(this.getRealData(),this.getImagData())}return this}})(Matrix_prototype);Matrix_prototype.cos=function(){var t=this.getData(),e,r;for(e=0,r=t.length;e<r;e++){t[e]=Math.cos(t[e])}return this};Matrix_prototype.sin=function(){var t=this.getData(),e,r;for(e=0,r=t.length;e<r;e++){t[e]=Math.sin(t[e])}return this};Matrix_prototype.tan=function(){var t=this.getData(),e,r;for(e=0,r=t.length;e<r;e++){t[e]=Math.tan(t[e])}return this};(function(t){var e=function(t){for(var e=0,r=t.length;e<r;e++){t[e]=Math.exp(t[e])}};var r=function(t,e){for(var r=0,a=t.length;r<a;r++){var i=Math.exp(t[r]),n=e[r];t[r]=i*Math.cos(n);e[r]=i*Math.sin(n)}};t.exp=function(){if(this.isreal()){e(this.getData())}else{r(this.getRealData(),this.getImagData())}return this}})(Matrix_prototype);Matrix_prototype.log=function(){var t=this.getData(),e,r;for(e=0,r=t.length;e<r;e++){t[e]=Math.log(t[e])}return this};Matrix_prototype.log10=function(){var t=this.getData(),e,r;var a=Math.log(10);for(e=0,r=t.length;e<r;e++){t[e]=Math.log(t[e])*a}return this};Matrix_prototype.log2=function(){var t=this.getData(),e,r;var a=Math.log(2);for(e=0,r=t.length;e<r;e++){t[e]=Math.log(t[e])*a}return this};Matrix_prototype.floor=function(){var t=this.getData(),e,r;for(e=0,r=t.length;e<r;e++){t[e]=Math.floor(t[e])}return this};Matrix_prototype.ceil=function(){var t=this.getData(),e,r;for(e=0,r=t.length;e<r;e++){t[e]=Math.ceil(t[e])}return this};Matrix_prototype.round=function(){var t=this.getData(),e,r;for(e=0,r=t.length;e<r;e++){t[e]=Math.round(t[e])}return this};Matrix_prototype.acos=function(){var t=this.getData(),e,r;for(e=0,r=t.length;e<r;e++){t[e]=Math.acos(t[e])}return this};Matrix_prototype.asin=function(){var t=this.getData(),e,r;for(e=0,r=t.length;e<r;e++){t[e]=Math.asin(t[e])}return this};Matrix_prototype.atan=function(){var t=this.getData(),e,r;for(e=0,r=t.length;e<r;e++){t[e]=Math.acos(t[e])}return this};Matrix_prototype.atan2=function(t){var e=this.getCopy();if(!Tools.checkSizeEquals(e.size(),t.size(),Matrix.ignoreTrailingDims)){throw new Error("Matrix.atan2: Side of of elements must be equal.")}var r=e.getData(),a=t.getData();var i,n;for(i=0,n=r.length;i<n;i++){r[i]=Math.atan2(r[i],a[i])}return e};var booleanOperators=function(t,e,r){if(!e.isreal()||r instanceof Matrix&&!r.isreal()){throw new Error("Matrix.booleanOperators: This function doesn't "+"work with complex numbers.")}var a=e.getData(),i=a.length;var n,o,s;if(typeof r==="number"){n=new Matrix(e.size(),"boolean");o=n.getData();if(t==="==="||t==="=="){for(s=0;s<i;s++){o[s]=a[s]===r?1:0}}else if(t==="!=="||t==="!="){for(s=0;s<i;s++){o[s]=a[s]!==r?1:0}}else if(t==="&&"){for(s=0;s<i;s++){o[s]=a[s]&&r?1:0}}else if(t==="||"){for(s=0;s<i;s++){o[s]=a[s]||r?1:0}}else if(t==="<"){for(s=0;s<i;s++){o[s]=a[s]<r?1:0}}else if(t==="<="){for(s=0;s<i;s++){o[s]=a[s]<=r?1:0}}else if(t===">"){for(s=0;s<i;s++){o[s]=a[s]>r?1:0}}else if(t===">="){for(s=0;s<i;s++){o[s]=a[s]>=r?1:0}}else{throw new Error("Matrix: Unknown operator '"+t+"'.")}}else if(r instanceof Matrix){var f=Tools.checkSizeEquals(e.size(),r.size(),Matrix.ignoreTrailingDims);n=new Matrix(f,"boolean");o=n.getData();var l=r.getData();if(t==="==="||t==="=="){for(s=0;s<i;s++){o[s]=a[s]===l[s]?1:0}}else if(t==="!=="||t==="!="){for(s=0;s<i;s++){o[s]=a[s]!==l[s]?1:0}}else if(t==="&&"){for(s=0;s<i;s++){o[s]=a[s]&&l[s]?1:0}}else if(t==="||"){for(s=0;s<i;s++){o[s]=a[s]||l[s]?1:0}}else if(t==="<"){for(s=0;s<i;s++){o[s]=a[s]<l[s]?1:0}}else if(t==="<="){for(s=0;s<i;s++){o[s]=a[s]<=l[s]?1:0}}else if(t===">"){for(s=0;s<i;s++){o[s]=a[s]>=l[s]?1:0}}else if(t===">="){for(s=0;s<i;s++){o[s]=a[s]>=l[s]?1:0}}else{throw new Error("Unknown operator '"+t+"'.")}}else{throw new Error("Argument must be a Matrix or a number")}return n};Matrix_prototype.eq=function(t){return booleanOperators("===",this,t)};Matrix_prototype["==="]=Matrix_prototype.eq;Matrix_prototype.ne=function(t){return booleanOperators("!==",this,t)};Matrix_prototype["!=="]=Matrix_prototype.ne;Matrix_prototype.gt=function(t){return booleanOperators(">",this,t)};Matrix_prototype[">"]=Matrix_prototype.gt;Matrix_prototype.ge=function(t){return booleanOperators(">=",this,t)};Matrix_prototype[">="]=Matrix_prototype.ge;Matrix_prototype.lt=function(t){return booleanOperators("<",this,t)};Matrix_prototype["<"]=Matrix_prototype.lt;Matrix_prototype.le=function(t){return booleanOperators("<=",this,t)};Matrix_prototype["<="]=Matrix_prototype.le;Matrix_prototype.and=function(t){return booleanOperators("&&",this,t)};Matrix_prototype["&&"]=Matrix_prototype.and;Matrix_prototype.or=function(t){return booleanOperators("||",this,t)};Matrix_prototype["||"]=Matrix_prototype.or;Matrix_prototype.neg=function(){var t=this.getCopy();var e=t.getData();var r,a;for(r=0,a=e.length;r<a;r++){e[r]=!e[r]?1:0}return t};var generateArithmeticOperators=function(){var operators={"+":{name:"plus","real/real":{scalar:"a[x] += b;",matrix:"a[x] += b[x];"},"real/imag":{scalar:"ar[x] += br;    ai[x] = bi;",matrix:"ar[x] += br[x]; ai[x] = bi[x];"},"imag/real":{scalar:"ar[x] += b;",matrix:"ar[x] += b[x];"},"imag/imag":{scalar:"ar[x] += br;    ai[x] += bi;",matrix:"ar[x] += br[x]; ai[x] += bi[x];"},AIsScalar:"B.getCopy().plus(A);",AIsMatrix:"A.getCopy().plus(B);"},"-":{name:"minus","real/real":{scalar:"a[x] -= b;",matrix:"a[x] -= b[x];"},"real/imag":{scalar:"ar[x] -= br;    ai[x] = -bi;",matrix:"ar[x] -= br[x]; ai[x] = -bi[x];"},"imag/real":{scalar:"ar[x] -= b;",matrix:"ar[x] -= b[x];"},"imag/imag":{scalar:"ar[x] -= br;    ai[x] -= bi;",matrix:"ar[x] -= br[x]; ai[x] -= bi[x];"},AIsScalar:"B.getCopy().plus(A.uminus());",AIsMatrix:"A.getCopy().minus(B);"},".*":{name:"times","real/real":{scalar:"a[x] *= b;",matrix:"a[x] *= b[x];"},"real/imag":{scalar:"ai[x] = ar[x] * bi;    ar[x] *= br;",matrix:"ai[x] = ar[x] * bi[x]; ar[x] *= br[x];"},"imag/real":{scalar:"ar[x] *= b;    ai[x] *= b;",matrix:"ar[x] *= b[x]; ai[x] *= b[x];"},"imag/imag":{scalar:"var r = ar[x], i = ai[x];"+"ar[x] = r * br - i * bi;"+"ai[x] = r * bi + i * br;",matrix:"var r1 = ar[x], i1 = ai[x], r2 = br[x], i2 = bi[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().times(A);",AIsMatrix:"A.getCopy().times(B);"},"./":{name:"rdivide","real/real":{scalar:"a[x] /= b;",matrix:"a[x] /= b[x];"},"real/imag":{scalar_before:"ai.set(ar);"+"tmp = 1 / (br * br + bi * bi);"+"br = br * tmp;"+"bi = -bi * tmp;",scalar:"ai[x] *= bi;           ar[x] *= br;",matrix:"ai[x] = ar[x] * bi[x]; ar[x] *= br[x];"},"imag/real":{scalar_before:"var b = 1 / b;",scalar:"ar[x] *= b;    ai[x] *= b;",matrix:"ar[x] /= b[x]; ai[x] /= b[x];"},"imag/imag":{scalar_before:"var tmp = 1 / (br * br + bi * bi);"+"br *= tmp;"+"bi *= tmp;",scalar:"var r = ar[x], i = ai[x];"+"ar[x] = r * br + i * bi;"+"ai[x] = i * bi - r * br;",matrix:"var r1 = ar[x], i1 = ai[x], r2 = br[x], i2 = bi[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().rdivide(A);",AIsMatrix:"A.getCopy().ldivide(B);"},".\\":{name:"ldivide","real/real":{scalar:"a[x] = b / a[x];",matrix:"a[x] = b[x] / a[x];"},"real/imag":{scalar:"ai[x] = bi / ar[x];    ar[x] = br / ar[x];",matrix:"ai[x] = bi[x] / ar[x]; ar[x] = br[x] / ar[x];"},"imag/real":{scalar:"var tmp = 1 / (ar[x] * ar[x] + ai[x] * ai[x]);"+"ai[x] = bi * tmp; ar[x] = br * tmp;",matrix:"var tmp = 1 / (ar[x] * ar[x] + ai[x] * ai[x]);"+"ai[x] = bi[x] * tmp; ar[x] = br[x] * tmp;"},"imag/imag":{scalar:"var r = br[x], i = bi[x];"+"ar[x] = r * ar + i * ai;"+"ai[x] = i * ai - r * ar;",matrix:"var r1 = br[x], i1 = bi[x], r2 = ar[x], i2 = ai[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().ldivide(A);",AIsMatrix:"A.getCopy().rdivide(B);"},".^":{name:"power","real/real":{scalar:"a[x] = Math.pow(a[x], b);",matrix:"a[x] = Math.pow(a[x], b[x]);"},"real/imag":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},"imag/real":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},"imag/imag":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},AIsScalar:"B.isscalar() ? A.getCopy().power(B) : undefined;",AIsMatrix:"A.getCopy().power(B);"}};var fct=function(t){t=Matrix.toMatrix(t);var e,r=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();"real/real-scalar"}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];"real/imag-scalar"}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();"imag/real-scalar"}else{o=t.getRealData()[0];s=t.getImagData()[0];"imag/imag-scalar"}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();"real/real-matrix"}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();"real/imag-matrix"}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();"imag/real-matrix"}else{o=t.getRealData();s=t.getImagData();"imag/imag-matrix"}}}return this}.toString();var fct2=function(t,e){t=Matrix.toMatrix(t);e=Matrix.toMatrix(e);if(t.isscalar()){return"AIsScalar"}else{return"AIsMatrix"}}.toString();var addLoop=function(t){return"for (x = 0; x < n; x++) {"+t+"}"};var replace=function(t,e,r){var a=e[r].scalar_before?e[r].scalar_before:"";var i=e[r].matrix_before?e[r].matrix_before:"";a+=addLoop(e[r].scalar);i+=addLoop(e[r].matrix);t=t.replace('"'+r+'-matrix";',i);t=t.replace('"'+r+'-scalar";',a);return t};var o,op,fun;for(o in operators){if(operators.hasOwnProperty(o)){op=operators[o];fun=replace(fct,op,"real/real");fun=replace(fun,op,"real/imag");fun=replace(fun,op,"imag/real");fun=replace(fun,op,"imag/imag");eval("Matrix.prototype."+op.name+" = "+fun);fun=fct2.replace('"AIsScalar";',op.AIsScalar);fun=fun.replace('"AIsMatrix";',op.AIsMatrix);eval("Matrix."+op.name+" = "+fun)}}};Matrix_prototype.plus=function(t){t=Matrix.toMatrix(t);var e,r=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();for(e=0;e<r;e++){a[e]+=t}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(e=0;e<r;e++){i[e]+=o;n[e]=s}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(e=0;e<r;e++){i[e]+=t}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(e=0;e<r;e++){i[e]+=o;n[e]+=s}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(e=0;e<r;e++){a[e]+=t[e]}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(e=0;e<r;e++){i[e]+=o[e];n[e]=s[e]}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(e=0;e<r;e++){i[e]+=t[e]}}else{o=t.getRealData();s=t.getImagData();for(e=0;e<r;e++){i[e]+=o[e];n[e]+=s[e]}}}}return this};Matrix_prototype["+="]=function(t){return this.plus(t)};Matrix_prototype["+"]=function(t){return this.getCopy().plus(t)};Matrix.plus=function(t,e){return t["+"](e)};Matrix_prototype.minus=function(t){t=Matrix.toMatrix(t);var e,r=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();for(e=0;e<r;e++){a[e]-=t}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(e=0;e<r;e++){i[e]-=o;n[e]=-s}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(e=0;e<r;e++){i[e]-=t}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(e=0;e<r;e++){i[e]-=o;n[e]-=s}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(e=0;e<r;e++){a[e]-=t[e]}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(e=0;e<r;e++){i[e]-=o[e];n[e]=-s[e]}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(e=0;e<r;e++){i[e]-=t[e]}}else{o=t.getRealData();s=t.getImagData();for(e=0;e<r;e++){i[e]-=o[e];n[e]-=s[e]}}}}return this};Matrix_prototype["-="]=function(t){return this.minus(t)};Matrix_prototype["-"]=function(t){return this.getCopy().minus(t)};Matrix.minus=function(t,e){return t["-"](e)};Matrix_prototype.uminus=function(){var t,e=this.numel();if(this.isreal()){var r=this.getData();for(t=0;t<e;t++){r[t]=-r[t]}}else{var a=this.getRealData(),i=this.getImagData();for(t=0;t<e;t++){a[t]=-a[t];i[t]=-i[t]}}return this};Matrix.uminus=function(t){return t.getCopy().uminus()};Matrix_prototype.times=function(t){t=Matrix.toMatrix(t);var e,r=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();

t=t.getDataScalar();for(e=0;e<r;e++){a[e]*=t}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(e=0;e<r;e++){n[e]=i[e]*s;i[e]*=o}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(e=0;e<r;e++){i[e]*=t;n[e]*=t}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(e=0;e<r;e++){var f=i[e],l=n[e];i[e]=f*o-l*s;n[e]=f*s+l*o}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(e=0;e<r;e++){a[e]*=t[e]}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(e=0;e<r;e++){n[e]=i[e]*s[e];i[e]*=o[e]}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(e=0;e<r;e++){i[e]*=t[e];n[e]*=t[e]}}else{o=t.getRealData();s=t.getImagData();for(e=0;e<r;e++){var u=i[e],g=n[e],h=o[e],c=s[e];var v=1/(h*h+c*c);i[e]=(u*h+g*c)*v;n[e]=(g*h-u*c)*v}}}}return this};Matrix_prototype["*="]=function(t){return this.times(t)};Matrix_prototype[".*"]=function(t){return this.getCopy().times(t)};Matrix.times=function(t,e){return t[".*"](e)};Matrix_prototype.rdivide=function(t){t=Matrix.toMatrix(t);var e,r=this.numel(),a;var i=this,n,o,s,f;if(t.isscalar()){if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getDataScalar();for(e=0;e<r;e++){i[e]/=t}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData()[0];f=t.getImagData()[0];o.set(n);a=1/(s*s+f*f);s=s*a;f=-f*a;for(e=0;e<r;e++){o[e]*=f;n[e]*=s}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getDataScalar();t=1/t;for(e=0;e<r;e++){n[e]*=t;o[e]*=t}}else{s=t.getRealData()[0];f=t.getImagData()[0];a=1/(s*s+f*f);s*=a;f*=a;for(e=0;e<r;e++){var l=n[e],u=o[e];n[e]=l*s+u*f;o[e]=u*f-l*s}}}}else{Tools.checkSizeEquals(i.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getData();for(e=0;e<r;e++){i[e]/=t[e]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData();f=t.getImagData();for(e=0;e<r;e++){o[e]=n[e]*f[e];n[e]*=s[e]}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getData();for(e=0;e<r;e++){n[e]/=t[e];o[e]/=t[e]}}else{s=t.getRealData();f=t.getImagData();for(e=0;e<r;e++){var g=n[e],h=o[e],c=s[e],v=f[e];var p=1/(c*c+v*v);n[e]=(g*c+h*v)*p;o[e]=(h*c-g*v)*p}}}}return this};Matrix_prototype["/="]=function(t){return this.rdivide(t)};Matrix_prototype["./"]=function(t){return this.getCopy().rdivide(t)};Matrix.rdivide=function(t,e){return t["./"](e)};Matrix_prototype.ldivide=function(t){t=Matrix.toMatrix(t);var e,r=this.numel(),a;var i=this,n,o,s,f;if(t.isscalar()){if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getDataScalar();for(e=0;e<r;e++){i[e]=t/i[e]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData()[0];f=t.getImagData()[0];for(e=0;e<r;e++){o[e]=f/n[e];n[e]=s/n[e]}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getDataScalar();for(e=0;e<r;e++){a=1/(n[e]*n[e]+o[e]*o[e]);o[e]=f*a;n[e]=s*a}}else{s=t.getRealData()[0];f=t.getImagData()[0];for(e=0;e<r;e++){var l=s[e],u=f[e];n[e]=l*n+u*o;o[e]=u*o-l*n}}}}else{Tools.checkSizeEquals(i.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getData();for(e=0;e<r;e++){i[e]=t[e]/i[e]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData();f=t.getImagData();for(e=0;e<r;e++){o[e]=f[e]/n[e];n[e]=s[e]/n[e]}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getData();for(e=0;e<r;e++){a=1/(n[e]*n[e]+o[e]*o[e]);o[e]=f[e]*a;n[e]=s[e]*a}}else{s=t.getRealData();f=t.getImagData();for(e=0;e<r;e++){var g=s[e],h=f[e],c=n[e],v=o[e];var p=1/(c*c+v*v);n[e]=(g*c+h*v)*p;o[e]=(h*c-g*v)*p}}}}return this};Matrix_prototype["\\="]=function(t){return this.ldivide(t)};Matrix_prototype[".\\"]=function(t){return this.getCopy().ldivide(t)};Matrix.ldivide=function(t,e){return t[".\\"](e)};Matrix_prototype.power=function(t){t=Matrix.toMatrix(t);var e,r=this.numel();var a=this,i,n,o,s,f,l;var u=Math.pow,g=Math.sqrt,h=Math.cos,c=Math.sin,v=Math.atan2;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();for(e=0;e<r;e++){a[e]=u(a[e],t)}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(e=0;e<r;e++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(e=0;e<r;e++){f=u(g(i[e]*i[e]+n[e]*n[e]),t);l=t*v(n[e],i[e]);i[e]=f*h(l);n[e]=f*c(l)}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(e=0;e<r;e++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(e=0;e<r;e++){a[e]=u(a[e],t[e])}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(e=0;e<r;e++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(e=0;e<r;e++){f=u(g(i[e]*i[e]+n[e]*n[e]),t[e]);l=t[e]*v(n[e],i[e]);i[e]=f*h(l);n[e]=f*c(l)}}else{o=t.getRealData();s=t.getImagData();for(e=0;e<r;e++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}}return this};Matrix_prototype[".^"]=function(t){return this.getCopy().power(t)};Matrix.power=function(t,e){return t[".^"](e)};(function(t){var e=function(t,e){var r,a;for(r=0,a=t.length;r<a;r++){t[r]=e(t[r])}};t.arrayfun=function(t){if(!this.isreal()){throw new Error("Matrix.arrayfun: This function doesn't "+"work with complex numbers.")}if(typeof t!=="function"){throw new Error("Matrix.arrayfun: Argument must be a function.")}e(this.getData(),t.bind(this));return this}})(Matrix_prototype);Matrix_prototype.transpose=function(){if(!this.ismatrix()){throw new Error("Matrix.transpose: "+"Transposition is only defined for matrix.")}var t=this.getView().swapDimensions(0,1);return this.extractViewFrom(t)};Matrix_prototype.ctranspose=function(){return this.transpose().conj()};(function(t){var e=function(t,e){for(var r=0,a=0;r<e;r++){var i=t[r];a+=i>0?i:-i}return a};var r=function(t,e){for(var r=0,a=0;r<e;r++){var i=t[r];a+=i*i}return a};var a=function(t,e,r){var a=Math.pow,i=Math.abs;for(var n=0,o=0;n<e;n++){o+=a(i(t[n]),r)}return o};t.norm=function(t){if(t===undefined){t=2}else if(!Tools.isNumber(t)){throw new Error("Matrix.norm: Argument p must be a number.")}var i=this.getData(),n=i.length;var o;if(t===1){o=e(i,n)}else if(t===2){o=r(i,n)}else{o=a(i,n,t)}return Math.pow(o,1/t)}})(Matrix_prototype);Matrix_prototype.triu=function(t){if(t===undefined){t=0}var e=this.getView();var r=e.getStep(1),a=e.getSize(0),i=e.getSize(1);var n,o,s,f;if(this.isreal()){var l=this.getData();for(n=0,o=0;n<i;o+=r,n++){for(s=o+n+1-t,f=o+a;s<f;s++){l[s]=0}}}else{var u=this.getRealData(),g=this.getImagData();for(n=0,o=0;n<i;o+=r,n++){for(s=o+n+1-t,f=o+a;s<f;s++){u[s]=0;g[s]=0}}}return this};Matrix_prototype.tril=function(t){var e=this.getCopy();if(t===undefined){t=0}var r=e.getView();var a=r.getStep(1),i=r.getSize(0),n=r.getSize(1);var o,s,f,l,u;u=Math.min(i,n);if(this.isreal()){var g=e.getData();for(o=0,s=0;o<n;s+=a,o++){for(f=s,l=s+o-t;f<l;f++){g[f]=0}}}else{var h=e.getRealData(),c=e.getImagData();for(o=0,s=0;o<n;s+=a,o++){for(f=s,l=s+o-t;f<l;f++){h[f]=0;c[f]=0}}}return e};Matrix_prototype.diag=function(t){if(t===undefined){t=0}var e=this.getView();var r=e.getStep(0),a=e.getSize(0);var i=e.getStep(1),n=e.getSize(1);var o,s;if(t>0){t=Math.abs(t);o=i;s=Math.min(a,n-t)}else{t=Math.abs(t);o=r;s=Math.min(a-t,n)}if(s<=0){throw new Error("Matrix.diag: Invalid diagonal requirement.")}var f=new Matrix([1,s],this.type(),!this.isreal());var l,u;var g=i+r;u=t*o;if(this.isreal()){var h=this.getData();var c=f.getData();for(l=0;l<s;l++,u+=g){c[l]=h[u]}}else{var v=this.getRealData(),p=this.getImagData();var m=f.getRealData(),x=f.getImagData();for(l=0;l<s;l++,u+=g){m[l]=v[u];x[l]=p[u]}}return f};Matrix.bsxfun=function(t,e,r){e=Matrix.toMatrix(e);r=Matrix.toMatrix(r);if(!e.isreal()||!r.isreal()){throw new Error("Matrix.bsxfun: This function doesn't "+"work with complex numbers.")}var a=e.getView(),i=r.getView();var n,o=Math.max(a.ndims(),i.ndims());for(n=0;n<o;n++){var s=e.getSize(n),f=r.getSize(n);if(s===1&&f>1){a.selectIndicesDimension(n,new Uint8Array(f))}else if(f===1&&s>1){i.selectIndicesDimension(n,new Uint8Array(s))}else if(f!==s){throw new Error("Matrix.bsxfun: Incompatiblity on dimension: "+n)}}var l=Matrix.zeros(a.getSize());var u=l.getData(),g=e.getData(),h=r.getData();var c=a.getIterator(0),v=i.getIterator(0);var p=c.iterator,m=c.begin,x=c.isEnd;var w=v.iterator,d=v.begin;var y,M,D;if(t instanceof Function){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=t(g[M],h[D])}}else if(t==="plus"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]+h[D]}}else if(t==="minus"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]-h[D]}}else if(t==="times"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]*h[D]}}else if(t==="rdivide"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]/h[D]}}else if(t==="ldivide"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=h[D]/g[M]}}else if(t==="min"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=h[D]>g[M]?g[M]:h[D]}}else if(t==="power"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=Math.pow(g[M],h[D])}}else if(t==="hypot"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=Math.sqrt(h[D]*h[D]+g[M]*g[M])}}else if(t==="atan2"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=Math.atan2(g[M],h[D])}}else if(t==="eq"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]===h[D]?1:0}}else if(t==="ne"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]!==h[D]?1:0}}else if(t==="lt"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]<h[D]?1:0}}else if(t==="le"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]<=h[D]?1:0}}else if(t==="gt"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]>h[D]?1:0}}else if(t==="ge"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]>=h[D]?1:0}}else if(t==="and"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]&&h[D]?1:0}}else if(t==="or"){for(M=m(),D=d(),y=0;!x();M=p(),D=w(),y++){u[y]=g[M]||h[D]?1:0}}else{throw new Error("Matrix.bsxfun: Wrong function argument.")}return l};Matrix.prototype.sign=function(){var t=this.getData();var e=new Matrix(this.getSize());var r=e.getData();for(var a=0,i=t.length;a<i;a++){r[a]=t[a]>0?1:t[a]<0?-1:0}return e}})(Matrix,Matrix.prototype);(function(t){"use strict";var e=function(t,e){if(!Tools.isInteger(e)||!Tools.isInRange(e,0,2)){throw new Error("Matrix.calerf: Invalid argument.")}var r=3.97886080735226;var a=.2753747415973768;var i=.49016508058531844;var n=.7743681991195386;var o=1.0792551515585667;var s=1.313146538310231;var f=1.3704021768233816;var l=1.1890298290927332;var u=.8052764087529106;var g=.35752427444953105;var h=.016620792496936737;var c=-.11946395996432542;var v=-.0838864557023002;var p=.002493672000535033;var m=.039097684558848406;var x=.016131532973325226;var w=-.013382364453346007;var d=-.012722381378212275;var y=.003833351262648873;var M=.007736725283135267;var D=-.0008707796353172959;var b=-.003963850973605135;var I=.00011931402283834095;var S=.0012710976495261409;var E=new Float64Array([5.958930743e-11,-1.13739022964e-9,1.466005199839e-8,-1.635035446196e-7,16461004480962e-19,-1492559551950604e-20,.00012055331122299264,-.0008548326981129666,.005223977624823223,-.026866170645077334,.11283791670954882,-.3761263890318375,1.1283791670955126,2.372510631e-11,-4.5493253732e-10,5.90362766598e-9,-6.642090827576e-8,6.7595634268133e-7,-621188515924e-17,510388300970969e-19,-.00037015410692956176,.00233307631218881,-.012549884771821921,.05657061146827042,-.21379664776456006,.8427007929497149,9.49905026e-12,-1.8310229805e-10,2.39463074e-9,-2.721444369609e-8,2.8045522331686e-7,-261830022482897e-20,2195455056768781e-20,-.00016358986921372656,.0010705215356411031,-.006082847181135901,.029869784652462584,-.13055593046562267,.674933236039655,3.82722073e-12,-7.421598602e-11,9.793057408e-10,-1.126008898854e-8,1.1775134830784e-7,-11199275838265e-19,962023443095201e-20,-7404402135070773e-20,.0005068999365414488,-.003075530514392729,.016689778925531657,-.08548534594781312,.5690907664239364,1.55296588e-12,-3.032205868e-11,4.0424830707e-10,-4.71135111493e-9,5.011915876293e-8,-4.8722516178974e-7,430683284629395e-20,-3445026145385764e-20,.00024879276133931664,-.0016294094174807928,.009887863739323505,-.05962426839442304,.49766113250947636]);var T=new Float64Array([-2.9734388465e-10,2.69776334046e-9,-6.40788827665e-9,-1.6678201321e-8,-2.1854388148686e-7,266246030457984e-20,1612722157047886e-20,-.00025616361025506627,.00015380842432375364,.00815533022524928,-.014022836638963193,-.19746892495383023,.7151172032884284,-1.951073787e-11,-3.2302692214e-10,5.22461866919e-9,3.42940918551e-9,-3.5772874310272e-7,1.9999935792654e-7,2687044575042908e-20,-.00011843240273775776,-.0008099172895603227,.006610629705022412,.009095309223548273,-.20160072778491014,.5116969671872764,3.147682272e-11,-4.8465972408e-10,6.3675740242e-10,3.377623323271e-8,-1.5451139637086e-7,-203340624738438e-20,1947204525295057e-20,2854147231653228e-20,-.0010156506315220028,.0027118700352009566,.023280950354228107,-.16725021123116876,.32490054966649434,2.31936337e-11,-6.303206648e-11,-2.64888267434e-9,2.050708040581e-8,1.1371857327578e-7,-211211337219663e-20,368797328322935e-20,9823686253424796e-20,-.0006586024399045536,-.0007528581489523087,.025854344242029606,-.11637092784486193,.1826733677529661,-3.67789363e-12,2.0876046746e-10,-1.93319027226e-9,-4.35953392472e-9,1.8006992266137e-7,-7.8441223763969e-7,-675407647949153e-20,8428418334440096e-20,-.00017604388937031816,-.002397296114350716,.02064129023876023,-.06905562880005864,.09084526782065479]);var A=t.getData(),z,k;var V,R,C,L,_;var F=Math.abs,q=Math.floor,O=Math.exp;if(e===0){for(z=0,k=t.getLength();z<k;z++){V=F(A[z]);if(V<2.2){R=V*V;C=q(R);R=R-C;C=C*13;L=((((((((((((E[C]*R+E[C+1])*R+E[C+2])*R+E[C+3])*R+E[C+4])*R+E[C+5])*R+E[C+6])*R+E[C+7])*R+E[C+8])*R+E[C+9])*R+E[C+10])*R+E[C+11])*R+E[C+12])*V}else if(V<6.9){C=q(V);R=V-C;C=13*(C-2);L=(((((((((((T[C]*R+T[C+1])*R+T[C+2])*R+T[C+3])*R+T[C+4])*R+T[C+5])*R+T[C+6])*R+T[C+7])*R+T[C+8])*R+T[C+9])*R+T[C+10])*R+T[C+11])*R+T[C+12];L=L*L;L=L*L;L=L*L;L=1-L*L}else{L=1}if(A[z]<0){L=-L}A[z]=L}}else if(e===1){for(z=0,k=t.getLength();z<k;z++){R=r/(r+F(A[z]));_=R-.5;L=(((((((((S*_+I)*_+b)*_+D)*_+M)*_+y)*_+d)*_+w)*_+x)*_+m)*_+p;L=((((((((((((L*_+v)*_+c)*_+h)*_+g)*_+u)*_+l)*_+f)*_+s)*_+o)*_+n)*_+i)*_+a)*R*O(-A[z]*A[z]);if(A[z]<0){L=2-L}A[z]=L}}else if(e===2){for(z=0,k=t.getLength();z<k;z++){R=r/(r+F(A[z]));_=R-.5;L=(((((((((S*_+I)*_+b)*_+D)*_+M)*_+y)*_+d)*_+w)*_+x)*_+m)*_+p;L=((((((((((((L*_+v)*_+c)*_+h)*_+g)*_+u)*_+l)*_+f)*_+s)*_+o)*_+n)*_+i)*_+a)*R*O(-A[z]*A[z]);if(A[z]<0){L=2-L}A[z]=O(A[z]*A[z])*L}}return t};t.erf=function(){return e(this,0)};t.erfc=function(){return e(this,1)};t.erfcx=function(){return e(this,2)};(function(t){var e=171.624;var r=new Float64Array([-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054]),a=new Float64Array([-30.840230011973897,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.25967555349]),i=new Float64Array([-.001910444077728,.00084171387781295,-.0005952379913043012,.0007936507935003503,-.0027777777777776816,.08333333333333333,.0057083835261]);var n=function(t){return t>0?Math.floor(t):Math.ceil(t)};t.gamma=function(){if(!this.isreal()){throw"Matrix.gamma: Do not work on complex numbers."}var t=Number.POSITIVE_INFINITY,o=.9189385332046728,s=2.22507e-308,f=2.220446049250313e-16;var l,u,g,h,c,v,p,m,x;var w=this.getData(),d,y;for(d=0,y=w.length;d<y;d++){l=w[d];var M=0,D=1,b=0,I=l;if(I<=0){I=-l;v=n(I);p=I-v;if(p!==0){if(v!==n(v*.5)*2){M=1}D=-Math.PI/Math.sin(Math.PI*p);I+=1}else{w[d]=t;continue}}if(I<f){if(I>=s){p=1/I}else{w[d]=t;continue}}else if(I<12){v=I;if(I<1){c=I;I+=1}else{b=parseInt(I,10)-1;I-=parseFloat(b);c=I-1}h=0;g=1;for(u=0;u<8;++u){h=(h+r[u])*c;g=g*c+a[u]}p=h/g+1;if(v<I){p/=v}else if(v>I){for(u=0;u<b;++u){p*=I;I+=1}}}else{if(I<=e){x=I*I;m=i[6];for(u=0;u<6;u++){m=m/x+i[u]}m=m/I-I+o;m+=(I-.5)*Math.log(I);p=Math.exp(m)}else{w[d]=t;continue}}if(M){p=-p}if(D!==1){p=D/p}w[d]=p}return this}})(t)})(Matrix.prototype);var root=typeof window==="undefined"?module.exports:window;(function(t){function e(t,e,r,a){"use strict";this.bins=[t,e];this.mesure=r;if(a){this.baryCenter(a)}}e.prototype.toString=function(){"use strict";return"["+this.bins.toString()+"]"};e.prototype.getCopy=function(){"use strict";var t=new e(this.bins[0],this.bins[1],this.mesure);t.norm=this.norm;t.phase=this.phase;return t};e.prototype.compar=function(t,e){"use strict";return t.mesure<e.mesure};e.prototype.baryCenter=function(t,e){"use strict";var r=t.length;var a=this.bins[0],i=this.bins[1];e=e||r;var n=0,o,s=0;if(i>=a){for(o=a;o<=i;o++){s+=t[o]}for(o=a;o<=i;o++){n+=t[o]*o}n/=s}else{for(o=a;o<r;o++){s+=t[o]}for(o=0;o<=i;o++){s+=t[o]}for(o=a;o<r;o++){n+=t[o]*(o-a)}for(o=0;o<=i;o++){n+=t[o]*(o+r-a)}n/=s;n+=a;n=n>=r?n-r:n}this.norm=s;this.phase=n/e;return this};root.Mode=e})(root);(function(t){"use strict";var e=function(t){var e,r;for(e=1,r=t.length;e<r;e++){t[e]+=t[e-1]}};var r=function(t,e){e=1/e;var r,a;for(r=0,a=t.length;r<a;r++){t[r]*=e}};var a=function(t,e,r){var a,i,n,o,s=t.length;var f=new Float32Array(s*s);for(o=0;o<s;o++){f[o]=t[o]}for(a=1,i=s;a<s;a++,i+=s){if(e){for(n=0,o=i;n<a;n++,o++){f[o]=t[n]+r-t[a-1]}}for(n=a,o=i+n;n<s;n++,o++){f[o]=t[n]-t[a-1]}}return f};var i=function(t,e,r,a,i){var n,o,s,f=Math.sqrt(t.length),l,u;var g=new Float32Array(f*f);var h=new Float32Array(f*f);for(n=0,o=0,l=f*f;o<l;n++,o+=f){if(i){for(s=o,u=o+n;s<u;s++){g[s]=r(t[s],e[s]);h[s]=r(a-t[s],1-e[s])}}for(s=o+n,u=o+f;s<u;s++){g[s]=r(t[s],e[s]);h[s]=r(a-t[s],1-e[s])}}return[g,h]};var n=function(t){var e=new Float32Array(t.length);var r,a=t.length,i=1/a;for(r=0;r<a;r++){e[r]=i}return e};var o=function(t,e,r){var a=Math.log,i=Math.sqrt,n=Math.lerfc;var o=1/a(10),s=a(.5);var f=Number.MIN_VALUE;if(e!==undefined&&r!==undefined){var l=-1/t*o,u=t*e,g=r/e;return function(r,a){if(a<=f){return 0}var o=a*u;var h=o*(e*(1-a)+g);var c=(t*r-o)/i(2*h);return(s+n(c))*l}}else{return function(t,e){if(t<=e||e<=f){return 0}if(t===1){return-a(e)*o}return(t*a(t/e)+(1-t)*a((1-t)/(1-e)))*o}}};var s=function(t,e,r,a){if(a){return(Math.log(t*(t-1))/Math.log(10)+r)/e}else{return(Math.log(t*(t-1)/2)/Math.log(10)+r)/e}};var f=function(t,e,r){if(t>e){if(t>r){return t}else{return r}}else{if(e>r){return e}else{return r}}};var l=function(t,e,r){if(t<e){if(t<r){return t}else{return r}}else{if(e<r){return e}else{return r}}};var u=function(t,e,r){var a,i,n,o,s;var l=new Float32Array(e*e);for(a=0,i=e*e;a<i;a+=e+1){l[a]=t[a]}for(a=e-2;a>=0;a--){for(n=a*e+a+1,o=(a+1)*e;n<o;n++){l[n]=f(l[n+e],l[n-1],t[n])}}if(r){l[(e-1)*e]=f(l[0],l[(e-1)*e+e-1],t[(e-1)*e]);for(s=1,n=(e-1)*e+s;s<e-1;++s,++n){l[n]=f(t[n],l[s],l[n-1])}for(a=(e-2)*e;a>0;a-=e){l[a]=f(t[a],l[a+e-1],l[a+e])}for(a=e-2;a>0;a--){for(n=a*e+1,o=a*e+a;n<o;++n){l[n]=f(t[n],l[n-1],l[n+e])}}}return l};var g=function(t,e,r){var a,i,n,o,s;var l=new Float32Array(e*e);if(r){for(a=e,i=e*e;a<i;a+=e+1){l[a]=t[a]}for(a=2;a<e;++a){for(o=a*e-1,n=a*e+a-2;n>o;--n){l[n]=f(t[n],l[n-e],l[n+1])}}}l[e-1]=t[e-1];for(n=e-2,s=(e-1)*e+n;n>=0;--n,--s){l[n]=f(t[n],l[n+1],l[s])}for(a=1*e,i=e*e;a<i;a+=e){l[a+e-1]=f(l[a-1],l[a],t[a+e-1])}for(a=1;a<e-1;a++){for(n=a*e+e-2,o=a*e+a;n>=o;n--){l[n]=f(l[n-e],l[n+1],t[n])}}return l};var h=function(t,e,r,a,i){var n,o,s,f,l,u,g;var h=new Float32Array(r*r);for(u=0,g=h.length;u<g;++u){h[u]=e[u]>=a?1:0}for(n=r-2;n>=0;n--){for(f=n*r+n+1,l=(n+1)*r;f<l;f++){h[f]+=h[f-1]+h[f+r]}}if(i){h[(r-1)*r]+=h[0]+h[(r-1)*r+r-1];for(f=1;f<r-1;++f){h[(r-1)*r+f]+=h[f]+h[(r-1)*r+f-1]}for(s=r-2,n=s*r,o=0;n>o;n-=r,--s){h[n]+=h[n+r]+h[n+r-1];for(f=n+1,l=n+s;f<l;++f){h[f]+=h[f-1]+h[f+r]}}}for(u=0,g=h.length;u<g;++u){h[u]=h[u]?0:t[u]}return h};var c=function(t,e,r,a,i,n){var o=[];var s,f,l,u,g=Math.sqrt(r.length),h,c;for(s=0,f=0,h=g*g;f<h;s++,f+=g){for(l=e?0:s,u=f+l,c=f+g;u<c;l++,u++){if(r[u]>=n&&a[u]<=r[u]&&i[u]<=r[u]){o.push(new Mode(s,l,r[u],t))}}}return o.sort(Mode.prototype.compar)};var v=function(t,f,l,u,g,h,c){var v=t.length;var p=new Float32Array(t);f=f===undefined?false:f;l=l===undefined?0:l;c=c===undefined?n(t):new Float32Array(c);e(c);e(p);var m=p[v-1];u=u===undefined?m:u;r(c,c[v-1]);r(p,u);var x=a(c,f,1);var w,d,y;if(u&&g&&h){w=a(p,f,m/u);d=o(u,g,h);y=i(w,x,d,m/u,f)}else{w=a(p,f,1);d=o(u,g,h);y=i(w,x,d,1,f)}var M=s(v,u,l,f);var D=y[0],b=y[1];return{Hmod:D,Hgap:b,thresh:M}};var p=function(t,e,r,a,i,n,o){var s=v(t,e,r,a,i,n,o);var f=h(s.Hgap,s.Hmod,t.length,s.thresh,e);var l=g(f,t.length,e);var p=u(f,t.length,e);var m=c(t,e,f,l,p,s.thresh);var x=h(s.Hmod,s.Hgap,t.length,s.thresh,e);var w=g(x,t.length,e);var d=u(x,t.length,e);var y=c(t,e,x,w,d,s.thresh);return{modes:y,gaps:m}};var m=function(t,e,r,a,i,n,o){var s=v(t,e,r,a,i,n,o);var f=h(s.Hmod,s.Hgap,t.length,s.thresh,e);var l=g(f,t.length,e);var p=u(f,t.length,e);var m=c(t,e,f,l,p,s.thresh);return m};var x=function(t,e,r,a,i,n,o){var s=v(t,e,r,a,i,n,o);var f=h(s.Hgap,s.Hmod,t.length,s.thresh,e);var l=g(f,t.length,e);var p=u(f,t.length,e);var m=c(t,e,f,l,p,s.thresh);return m};Matrix.prototype.getModesAndGaps=function(t,e,r,a,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return p(o,t,e,r,a,i,n)};Matrix.getModesAndGaps=function(t,e,r,a,i,n,o){t=Matrix.toMatrix(t);return t.getModesAndGaps(e,r,a,i,n,o)};Matrix.prototype.getModes=function(t,e,r,a,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return m(o,t,e,r,a,i,n)};Matrix.getModes=function(t,e,r,a,i,n,o){t=Matrix.toMatrix(t);return t.getModes(e,r,a,i,n,o)};Matrix.prototype.getGaps=function(t,e,r,a,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return x(o,t,e,r,a,i,n)};Matrix.getGaps=function(t,e,r,a,i,n,o){t=Matrix.toMatrix(t);return t.getGaps(e,r,a,i,n,o)};root.extractModes=m;root.extractGaps=x;root.extravctModesAndGaps=p})(Matrix);function getHistograms(t,e,r,a,i,n){"use strict";var o=0,s=0,f=0;var l,u;var g,h,c,v;var p=Math.floor,m=1/(i-a),x;g=new Float32Array(r);if(e){h=new Float32Array(r);if(n){for(l=0,u=t.length;l<u;l++){x=p((t[l]-a)*m*r);x=x<0?r+x%r:x%r;h[x]+=e[l];g[x]++;s+=e[l];o++}s/=o;for(l=0,u=t.length;l<u;l++){c=e[l]-s;f+=c*c}f=f/(o-1)}else{for(l=0,u=t.length;l<u;l++){v=t[l];if(v<a||v>i){continue}x=p((t[l]-a)*m*r);h[x]+=e[l];g[x]++;s+=e[l];o++}s/=o;for(l=0,u=t.length;l<u;l++){v=t[l];if(v<a||v>i){continue}c=e[l]-s;f+=c*c}f=f/(o-1)}}else{if(n){for(l=0,u=t.length;l<u;l++){x=p((t[l]-a)*m*r);x=x<0?r+x%r:x%r;g[x]++;o++}}else{for(o=0,l=0,u=t.length;l<u;l++){x=p((t[l]-a)*m*r);if(x<0||x>r){continue}g[x]++;o++}}}return{histw:h,hist:g,mu:s,sigma:f,M:o}}