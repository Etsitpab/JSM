/**
 * This program is free software: you can redistribute it and/or modify    
 * it under the terms of the GNU General Public License as published by        
 * the Free Software Foundation, either version 3 of the License, or 
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * 
 * @author Baptiste Mazin     <baptiste.mazin@telecom-paristech.fr> 
 * @author Guillaume Tartavel <guillaume.tartavel@telecom-paristech.fr> 
 */
var Tools={};if(typeof window==="undefined"){module.exports.Tools=Tools}(function(t){"use strict";t.isSet=function(t){return t!==null&&t!==undefined}.bind(t);t.isInRange=function(t,r,e){r=this.isSet(r)?r:-Infinity;e=this.isSet(e)?e:+Infinity;return r<=t&&t<=e}.bind(t);t.isNumber=function(t,r,e){return typeof t==="number"&&this.isInRange(t,r,e)}.bind(t);t.isInteger=function(t,r,e){return this.isNumber(t,r,e)&&t%1===0}.bind(t);t.isBoolean=function(t){return t===true||t===false}.bind(t);t.isArrayLike=function(t){return typeof t==="object"&&t.length!==undefined}.bind(t);t.isArrayInRange=function(t,r,e){var a,i;if(!this.isArrayLike(t)){return false}for(a=0,i=t.length;a<i;a++){if(!this.isInRange(t[a],r,e)){return false}}return true}.bind(t);t.isArrayOfNumbers=function(t,r,e){var a,i;if(!this.isArrayLike(t)){return false}r=this.isSet(r)?r:-Infinity;e=this.isSet(e)?e:+Infinity;for(a=0,i=t.length;a<i;a++){var n=t[a];if(!(typeof n==="number"&&r<=n&&n<=e)){return false}}return true}.bind(t);t.isArrayOfIntegers=function(t,r,e){var a,i;switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:if(r===undefined&&e===undefined){return true}for(a=0,i=t.length;a<i;a++){if(t[a]<r||t[a]>e){return false}}return true;case Uint8ClampedArray:case Uint8Array:case Uint16Array:case Uint32Array:if((r===0||r===undefined)&&e===undefined){return true}if(e!==undefined){for(a=0,i=t.length;a<i;a++){if(t[a]<r||t[a]>e){return false}}}return true;default:if(!this.isArrayLike(t)){return false}}r=this.isSet(r)?r:-Infinity;e=this.isSet(e)?e:+Infinity;for(a=0,i=t.length;a<i;a++){var n=t[a];if(!(typeof n==="number"&&(r<=n&&n<=e)&&n%1===0)){return false}}return true}.bind(t);t.isArrayOfBooleans=function(t){var r,e;if(!this.isArrayLike(t)||t.length<1){return false}for(r=0,e=t.length;r<e;r++){if(t[r]!==true&&t[r]!==false){return false}}return true}.bind(t);t.checkOpts=function(t,r){var e;r=r||{};for(e in r){if(r.hasOwnProperty(e)){if(t[e]===undefined){throw new Error("checkOpts: unknown option: "+e)}}}for(e in t){if(t.hasOwnProperty(e)){if(!this.isSet(r[e])){r[e]=t[e]}}}return r};t.checkSize=function(t,r){t=this.isSet(t)?t:[0,0];if(this.isNumber(t)){t=[t]}if(this.isArrayLike(t)&&t.length===1&&this.isArrayLike(t[0])){t=t[0]}if(!this.isArrayLike(t)||t.length<1){throw new Error("checkSize: Invalid size argument.")}if(!this.isArrayOfIntegers(t,0)){throw new Error("checkSize: Size must be a positive integer.")}t=Array.prototype.slice.apply(t);while(t[t.length-1]===1&&t.length>2){t.pop()}if(t.length===1){switch(r){case"square":t=[t[0],t[0]];break;case"row":t=[1,t[0]];break;case"column":case"vector":case undefined:t=[t[0],1];break;default:throw new Error('checkSize: Invalid value for "unidim".')}}return t}.bind(t);t.checkSizeEquals=function(t,r,e){t=this.checkSize(t);r=this.checkSize(r);e=e||true;var a=t.length<r.length?t:r;var i,n=Math.min(t.length,r.length);var o=Math.max(t.length,r.length);for(i=0;i<n;i++){if(t[i]!==r[i]){throw new Error("checkSizeEquals: dimensions must be equals.")}}if(e){for(i=n;i<o;i++){if(t[i]!==undefined&&t[i]!==1){throw new Error("checkSizeEquals: dimensions must be equals.")}if(r[i]!==undefined&&r[i]!==1){throw new Error("checkSizeEquals: dimensions must be equals.")}}}else if(!e){throw new Error("checkSizeEquals: "+"dimensions differ by trailing 1's, ","and ignoreTrailingDims is False.")}return a}.bind(t);t.checkRange=function(t){if(typeof t==="number"){t=[t]}if(!this.isArrayOfIntegers(t)){throw new Error("checkRange: range must be made of integers.")}if(t.length===1){t=[0,t[0]]}if(t.length!==2){throw new Error("checkRange: range must have 1 or 2 bounds.")}if(t[0]>t[1]){throw new Error("checkRange: range must be [min, max] in this order.")}t=[t[0],t[1]];return t}.bind(t);t.checkColon=function(t,r){if(this.isArrayLike(t)&&t.length===1&&this.isArrayLike(t[0])){t=t[0]}if(this.isNumber(t)){t=[t]}if(!this.isArrayOfNumbers(t)){throw new Error("checkColon: colon operator must be non-negative integers.")}var e,a,i=null;switch(t.length){case 0:throw new Error("checkColon: colon operator cannot be empty.");case 1:e=a=t[0];break;case 2:e=t[0];a=t[1];break;case 3:e=t[0];i=t[1];a=t[2];break;default:throw new Error("checkColon: colon operator expected 1, 2, or 3 values.")}if(!this.isSet(r)){r=Infinity}else if(this.isInteger(r,0)){e=e>=0?e:e+r;a=a>=0?a:a+r}else{throw new Error("checkColon: if specified, length must be a non-negative integer.")}if(!this.isArrayOfIntegers([e,a])){throw new Error("checkColon: first and last elements must be integers")}if(!this.isArrayOfIntegers([e,a],0,r-1)){throw new Error("checkColon: first or last elements out of bounds")}if(!this.isSet(i)){i=e<=a?+1:-1}else if((a-e)*i<0){throw new Error("checkColon: invalid step.")}return[e,i,a]}.bind(t);t.checkArrayEquals=function(t,r){var e=t.length,a;if(e!==r.length){return false}for(a=0;a<e;a++){if(t[a]!==r[a]){return false}}return true};t.checkType=function(t){if(typeof t==="function"){t=t.name}if(typeof t==="string"){switch(t.toLowerCase()){case"array":return Array;case"float64array":case"float64":case"double":return Float64Array;case"float32array":case"float32":case"float":case"single":return Float32Array;case"int8array":case"int8":return Int8Array;case"bool":case"boolean":case"logical":case"uint8clampedarray":case"canvaspixelarray":case"uint8c":return Uint8ClampedArray;case"uint8array":case"uint8":return Uint8Array;case"int16array":case"int16":return Int16Array;case"uint16array":case"uint16":return Uint16Array;case"int32array":case"int32":return Int32Array;case"uint32array":case"uint32":return Uint32Array;case"int64":case"uint64":throw new Error("checkType: int64 and uint64 aren't supported.");default:throw new Error("checkType: Type must be a valid numeric class name.")}}if(t===undefined){return Matrix.dataType}throw new Error("checkType: Wrong data type argument.")};t.includeJS=function(t,r){var e=document.createElement("script");e.setAttribute("type","text/javascript");e.setAttribute("src",t);if(this.isSet(r)){e.onload=r}document.head.appendChild(e)}.bind(t);t.assert=function(t){if(!t){throw new Error("Assertion failed.")}return true}.bind(t);(function(){var r=function(t){return t>64&&t<91?t-65:t>96&&t<123?t-71:t>47&&t<58?t+4:t===43?62:t===47?63:0};var e=function(t){return t<26?t+65:t<52?t+71:t<62?t-4:t===62?43:t===63?47:65};t.arrayFromBase64=function(t,e){var a=t.replace(/[^A-Za-z0-9\+\/]/g,"");var i=a.length;var n=i*3+1>>2;var o=new Uint8Array(n);for(var s,f,u=0,l=0,h=0;h<i;h++){f=h&3;u|=r(a.charCodeAt(h))<<18-6*f;if(f===3||i-h===1){for(s=0;s<3&&l<n;s++,l++){o[l]=u>>>(16>>>s&24)&255}u=0}}return e?new e(o.buffer):o};t.arrayToBase64=function(t){t=new Uint8Array(t.buffer);var r=2,a="";for(var i=t.length,n=0,o=0;o<i;o++){r=o%3;if(o>0&&o*4/3%76===0){a+="\r\n"}n|=t[o]<<(16>>>r&24);if(r===2||t.length-o===1){a+=String.fromCharCode(e(n>>>18&63),e(n>>>12&63),e(n>>>6&63),e(n&63));n=0}}return a.substr(0,a.length-2+r)+(r===2?"":r===1?"=":"==")}})();t.stringToDownload=function(t,r){var e=new Blob([t],{type:"text/plain"});var a=document.createElement("a");a.download=r||"file.txt";a.href=URL.createObjectURL(e);a.click()};(function(){var r=[],e={};t.tic=function(t){if(t){e[t]=(new Date).getTime()}else{r.push((new Date).getTime())}};t.toc=function(t){var a=(new Date).getTime();if(t){return a-e[t]||0}return a-r.pop()||0}})()})(Tools);function MatrixView(t){"use strict";var r;var e;var a;var i;var n=[];var o={};var s=function(t){a=Tools.checkSize(t);i=[];var n,s=a.length;for(r=[],e=[],n=0;n<s;n++){r[n]=0;e[n]=(a[n-1]||1)*(e[n-1]||1)}o={first:r.slice(),step:e.slice(),size:a.slice(),indices:[]};return this}.bind(this);var f=function(t){var n,o=t.getDimLength();r=[];e=[];a=[];i=[];for(n=0;n<o;n++){r.push(t.getFirst(n));e.push(t.getStep(n));a.push(t.getSize(n));if(t.isIndicesIndexed(n)){i.push(t.getIndices(n))}}return this}.bind(this);this.save=function(){n.push(new MatrixView(this));return this}.bind(this);this.restore=function(){var t=n.pop();if(Tools.isSet(t)){f(t)}else{r=o.first.slice();e=o.step.slice();a=o.size.slice();i=[]}return this}.bind(this);var u=function(){return a.length};var l=function(){var t,r=u(),e;for(t=0,e=1;t<r;t++){e*=a[t]}return e};var h=function(t){if(!Tools.isSet(t)){return a.slice()}if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getSize: invalid dimension.")}return Tools.isSet(a[t])?a[t]:1};var g=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.isIndicesIndexed: invalid dimension.")}return Tools.isSet(i[t])};var v=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getIndices: invalid dimension.")}if(!g(t)){throw new Error("MatrixView.getIndices: "+"dimension isn't indexed by indices.")}return i[t].slice()};var c=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getSteps: invalid dimension.")}if(!g(t)){throw new Error("MatrixView.getSteps: "+"Dimension isn't indexed with indices.")}var r=i[t].slice();var e;for(e=r.length-1;e>0;e--){r[e]-=r[e-1]}var a=i[t][i[t].length-1];r.push(-(a+1));r[0]=0;return r};var p=function(){var t,r=o.size.length,e;for(t=0,e=1;t<r;t++){e*=o.size[t]}return e};var m=function(){return o.size.slice()};var w=function(t){var i=u();var n=t.length;if(n>1&&n!==i){throw new Error("MatrixView.getIndex: invalid ND-index.")}var o,s;for(o=0,s=0;o<n;o++){if(t[o]<0||t[o]>=a[o]){throw new Error("MatrixView.getIndex: invalid index.")}s+=r[o]+t[o]*e[o]}return s};var d=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getFirst: invalid dimension.")}return Tools.isSet(r[t])?r[t]:0};var x=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getStep: invalid dimension.")}if(g(t)){throw new Error("MatrixView.getStep: dimension is indexed by indices.")}return Tools.isSet(e[t])?e[t]:1};var y=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getEnd: invalid dimension.")}if(g(t)){return-1}var i=Tools.isSet(a[t])?a[t]:1;return(r[t]||0)+i*(e[t]||1)};this.getDimLength=u;this.getLength=l;this.getInitialLength=p;this.getInitialSize=m;this.getIndex=w;this.getFirst=d;this.getStep=x;this.getSteps=c;this.getEnd=y;this.getSize=h;this.isIndicesIndexed=g;this.getIndices=v;var M=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.pushSingletonDimensions: invalid dimension.")}var i;for(i=0;i<t;i++){r.push(0);e.push(1);a.push(1)}return this}.bind(this);var b=function(t,n){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.select: invalid dimension.")}n=Tools.checkColon(n,h(t));if(!g(t)){r[t]+=n[0]*e[t];e[t]*=n[1];a[t]=Math.floor(Math.abs((n[2]-n[0])/n[1]))+1}else{var o,s,f,u=i[t],l=[];for(o=n[0],s=n[2],f=n[1];o<=s;o+=f){l.push(u[o])}r[t]=l[0];i[t]=l;a[t]=l.length}return this}.bind(this);var D=function(t,n){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.selectIndicesDimension: Dimension "+"must be a positive integer.")}if(!Tools.isArrayOfIntegers(n,0,h(t)-1)){throw new Error("MatrixView.selectIndicesDimension: Invalid index.")}n=Array.prototype.slice.apply(n);var o,s;if(!g(t)){var f=d(t),u=x(t);for(o=0,s=n.length;o<s;o++){n[o]*=u;n[o]+=f}}else{for(o=0,s=n.length;o<s;o++){n[o]=i[n[o]]}}if(n[0]===undefined){n[0]=-1}r[t]=n[0];e[t]=1;a[t]=n.length;i[t]=n;return this}.bind(this);var S=function(t,r){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.selectBooleanDimension: invalid dimension.")}if(r.length!==h(t)){throw new Error("MatrixView.selectBooleanDimension: array dimensions mismatch.")}var e,a,i,n=new Array(r.length);for(e=0,i=0,a=r.length;e<a;e++){if(r[e]){n[i]=e;i+=1}}return this.selectIndicesDimension(t,n.slice(0,i))}.bind(this);var I=function(t,r,e){var a=t[r];t[r]=t[e];t[e]=a};var E=function(t,n){var o=u();if(!Tools.isInteger(t,0)){throw new Error("MatrixView.swapDimensions: invalid dimensions.")}if(!Tools.isInteger(n,0)){throw new Error("MatrixView.swapDimensions: invalid dimensions.")}var s=Math.max(t,n)+1-o;if(s>0){M(s)}I(r,t,n);I(e,t,n);I(a,t,n);I(i,t,n);return this}.bind(this);var z=function(t){var i;if(!Tools.isSet(t)){for(i=0;a.length>0&&a[0]===1;i++){r.shift();e.shift();a.shift()}if(u()===1){r.push(0);e.push(1);a.push(1)}}else{var n=u();if(!Tools.isInteger(t,1-n,n-1)){throw new Error("MatrixView.shiftDimension: invalid shift.")}for(i=0;i<t;i++){r.push(r.shift());e.push(e.shift());a.push(a.shift())}for(i=t;i<0;i++){r.unshift(0);e.unshift(1);a.unshift(1)}}}.bind(this);this.selectDimension=b;this.selectIndicesDimension=D;this.selectBooleanDimension=S;this.swapDimensions=E;this.shiftDimension=z;this.display=function(){var t,r;for(t=0,r=u();t<r;t++){if(g(t)){console.log(true,v(t))}else{console.log(false,d(t),x(t),h(t))}}return this}.bind(this);if(Tools.isArrayLike(t)){return s(t)}if(t instanceof MatrixView){f(t);o.first=r.slice();o.step=e.slice();o.size=a.slice();return this}throw new Error("MatrixView: invalid argument.")}(function(t,r){"use strict";function e(t,r){var e,a=t.length;var i=t.slice();for(e=a-1;e>0;e--){i[e]-=i[e-1];i[e]*=r}i[0]=0;i.push(-t[a-1]*r-1);return i}function a(t,r){var a,i,n;var o=t[0],s=e(t,r||1);this.iterator=function(){return a+=s[++i]};this.begin=function(t){t=t||0;i=0;n=t-1;return a=t+o};this.end=function(){return n};this.isEnd=function(){return a===n};this.getPosition=function(){return i};this.getIndex=function(){return a}}function i(t,r,e){var a,i,n;this.iterator=function(){return n+=r};this.begin=function(r){r=r||0;a=r+t;i=r+e;return n=a};this.end=function(){return i};this.isEnd=function(){return n===i};this.getPosition=function(){return(n-a)/r};this.getIndex=function(){return n}}function n(t,r){var e,a,i,n,o,s,f;function u(t){if(t>=i){return-1}var r=e[t],a=r.iterator();if(r.isEnd()){a=u(t+1);return a!==-1?r.begin(a):-1}return a}this.iterator=function(){a+=o;if(a===f){var t=u(r+1);a=t===-1?-1:t+n;f=t+s}return a};this.begin=function(){n=t.getFirst(r);o=t.getStep(r);s=t.getEnd(r);i=t.getDimLength();var u,l;e=new Array(i);for(u=i-1;u>r;u--){e[u]=t.getSubIterator(u);l=e[u].begin(l||0)}for(a=0,u=r+1;u<i;u++){a+=t.getFirst(u)}f=a+s;a+=n;return a};this.isEnd=function(){return a===-1};this.end=function(){return-1};this.getPosition=function(){var t,i,s=[],f;if(e[r+1]){f=e[r+1].getIndex()}else{f=0}s[0]=(a-f-n)/o;for(t=r+1,i=e.length;t<i;t++){s[t-r]=e[t].getPosition()}return s}}function o(t,r){var e,a,i,n,o,s,f;var u=t.getIndices(r);var l=t.getSteps(r);var h=function(t){var r=e[t];if(!r){return-1}var a=r.iterator();if(r.isEnd()){a=h(t+1);return a!==-1?r.begin(a):-1}return a};this.iterator=function(){i++;if(i===f){var t=h(r+1);if(t===-1){return a=-1}a=t+o;i=0}a+=l[i];return a};this.begin=function(){o=t.getFirst(r);s=t.getEnd(r);n=t.getDimLength();var l,h;e=new Array(n);for(l=n-1;l>r;l--){e[l]=t.getSubIterator(l);h=e[l].begin(h||0)}for(i=0,a=0,l=r;l<n;l++){a+=t.getFirst(l)}f=u.length;return a};this.isEnd=function(){return a===-1};this.end=function(){return-1};this.getPosition=function(){var t,a,n=[];n[0]=i;for(t=r+1,a=e.length;t<a;t++){n[t-r]=e[t].getPosition()}return n}}r.getIterator=function(t){if(!Tools.isSet(t)){t=0}else if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getIterator: invalid dimension.")}if(this.isIndicesIndexed(t)){return new o(this,t)}var r=new n(this,t);return r};r.getSubIterator=function(t){if(!Tools.isInteger(t,0)){throw new Error("MatrixView.getSubIterator: invalid dimension.")}if(this.isIndicesIndexed(t)){return new a(this.getIndices(t),1)}var r=this.getFirst(t);var e=this.getStep(t);var n=this.getEnd(t);return new i(r,e,n)};r.extractTo=function(t,r){if(!Tools.isArrayLike(r)){throw new Error("MatrixView.extractTo: invalid output data.")}if(r.length!==this.getInitialLength()){throw new Error("MatrixView.extractTo: Output data length is invalid.")}var e=this.getIterator(1);var a,i,n=e.iterator,o=e.begin,s=e.end;var f,u,l=this.getFirst(0),h=this.getEnd(0);var g,v,c,p;var m;if(Tools.isArrayLike(t)&&t.length===this.getLength()){if(r===t){throw new Error("MatrixView.extractTo: cannot perform on-place extraction.")}if(this.isIndicesIndexed(0)){g=this.getSteps(0);for(a=o(),i=s(),m=0;a!==i;a=n()){for(p=0,f=a+l,u=a+h;f!==u;m++,f+=g[++p]){r[f]=t[m]}}}else{c=this.getStep(0);for(a=o(),i=s(),m=0;a!==i;a=n()){for(f=a+l,v=a+h;f!==v;f+=c,m++){r[f]=t[m]}}}}else if(t.length===1||typeof t==="number"){if(t.length===1){t=t[0]}if(this.isIndicesIndexed(0)){g=this.getSteps(0);for(a=o(),i=s(),m=0;a!==i;a=n()){for(p=0,f=a+l,u=a+h;f!==u;f+=g[++p]){r[f]=t}}}else{c=this.getStep(0);for(a=o(),i=s(),m=0;a!==i;a=n()){for(f=a+l,v=a+h;f!==v;f+=c){r[f]=t}}}}else{throw new Error("MatrixView.extractTo: invalid input length.")}return r};r.extractFrom=function(t,r){if(!Tools.isArrayLike(t)){throw new Error("MatrixView.extractFrom: invalid input data.")}if(t.length!==this.getInitialLength()){throw new Error("MatrixView.extractFrom: input data dimensions mismatch.")}r=r||new t.constructor(this.getLength());if(!Tools.isArrayLike(r)){throw new Error("MatrixView.extractFrom: invalid output data.")}if(r.length!==this.getLength()){throw new Error("MatrixView.extractFrom: output data dimensions mismatch.")}if(r===t){throw new Error("MatrixView.extractFrom: cannot perform on-place extraction.")}var e=this.getIterator(1);var a,i,n=e.iterator,o=e.begin,s=e.end;var f,u,l=this.getFirst(0),h=this.getEnd(0);var g;if(this.isIndicesIndexed(0)){var v=this.getSteps(0),c;for(a=o(),i=s(),g=0;a!==i;a=n()){for(c=0,f=a+l,u=a+h;f!==u;g++,f+=v[++c]){r[g]=t[f]}}}else{var p,m=this.getStep(0);for(a=o(),i=s(),g=0;a!==i;a=n()){for(f=a+l,p=a+h,u=a+h;f!==u;f+=m,g++){r[g]=t[f]}}}return r};r.extract=function(r,e,a){if(!Tools.isArrayLike(r)){throw new Error("MatrixView.extract: invalid input data.")}if(!(e instanceof t)){throw new Error("MatrixView.extract: invalid output view.")}if(!Tools.isArrayLike(a)){throw new Error("MatrixView.extract: invalid output data.")}if(r.length!==this.getInitialLength()){throw new Error("MatrixView.extract: invalid input data length.")}if(a.length!==e.getInitialLength()){throw new Error("MatrixView.extract: invalid output data length.")}if(a===r){throw new Error("MatrixView.extract: cannot perform on-place extraction.")}var i,n,o,s;var f,u,l,h;var g,v;if(this.isIndicesIndexed(0)&&e.isIndicesIndexed(0)){g=this.getIterator(1);i=g.iterator;o=g.begin;s=g.isEnd;var c,p,m,w=i.getFirst(0),d=i.getEnd(0);var x=i.getSteps(0),y;for(n=o(),m=0;!s();n=i()){for(y=1,c=n+w,p=n+d;y!==p;m++,c+=x[y],y++){a[m]=r[c]}}}else{g=this.getIterator(0);i=g.iterator;o=g.begin;s=g.end;v=e.getIterator(0);l=v.begin;f=v.iterator;for(n=o(),u=l(),h=s();n!==h;n=i(),u=f()){a[u]=r[n]}}return a}})(MatrixView,MatrixView.prototype);if(typeof window==="undefined"){module.exports.MatrixView=MatrixView}(function(t,r){"use strict";r.ndims=function(){return this.getDimLength()};r.isrow=function(){var t=this.getSize();return t.length===2&&t[0]===1};r.iscolumn=function(){var t=this.getSize();return t.length===2&&t[1]===1};r.isvector=function(){var t=this.getSize();return t.length===2&&(t[1]===1||t[0]===1)};r.ismatrix=function(){return this.getSize().length===2}})(MatrixView,MatrixView.prototype);(function(t,r){"use strict";r.select=function(){var t=Tools;var r,e;for(r=0,e=arguments.length;r<e;r++){var a=arguments[r];if(t.isArrayLike(a)){if(t.isArrayLike(a[0])){this.selectIndicesDimension(r,a[0])}else if(t.isArrayOfBooleans(a)){this.selectBooleanDimension(r,a)}else if(a.length!==0){this.selectDimension(r,a)}}else if(t.isInteger(a)){this.selectDimension(r,a)}else{throw new Error("MatrixView.select: Invalid selection.")}}return this};r.permute=function(t){var r=this.constructor.name+".permute: ";if(t.length<this.getDimLength()){throw new Error(r+"Dimension permutation is invalid.")}t=t.slice();var e=t.length;var a,i,n;for(a=0;a<e;a++){var o=false;for(n=0;n<e;n++){if(t[n]===a){o=true}}if(o===false){throw new Error(r+"Dimension permutation is invalid.")}}for(a=0,i=e;a<i;a++){n=a;while(true){var s=t[n];t[n]=n;if(s===a){break}else{this.swapDimensions(n,s)}n=s}}return this};r.ipermute=function(t){var r,e,a=[];for(r=0,e=t.length;r<e;r++){a[r]=r}var i=function(r,e){return t[r]-t[e]};return this.permute(a.sort(i))};r.rot90=function(t){var r=this.constructor.name+".rot90: ";switch(typeof t){case"number":if(!Tools.isInteger(t)){throw new Error(r+"Argument must be an integer.")}t%=4;if(t<0){t+=4}break;case"undefined":t=1;break;default:throw new Error(r+"Wrong argument type.")}switch(t){case 1:return this.swapDimensions(0,1).flipud();case 2:return this.flipud().fliplr();case 3:return this.swapDimensions(0,1).fliplr()}return this};r.flipdim=function(t){return this.selectDimension(t,[-1,0])};r.fliplr=function(){return this.select([0,-1],[-1,0])};r.flipud=function(){return this.select([-1,0],[0,-1])};r.setWorkingDimension=function(t){if(t>=this.getDimLength()){throw new Error("Invalid dimension.")}var r=[];var e,a=this.getDimLength();for(e=0;e<a;e++){r[e]=e}r=r.splice(t,1).concat(r);return this.permute(r)}})(MatrixView,MatrixView.prototype);function Matrix(t,r,e,a){"use strict";var i;var n,o,s;var f=false;var u;var l;var h;var g;var v;var c;var p=function(r){if(r instanceof Matrix){r=r.getCopy().getData()}t=Tools.checkSize(r);i=new MatrixView(t);u=i.getIndex;l=i.getDimLength;h=i.getLength;g=i.getSize;c=i.displayView;v=i.getIterator.bind(i);this.getIndex=u;this.getDimLength=l;this.getLength=h;this.getSize=g;this.displayView=c;this.getIterator=v}.bind(this);var m=function(t,e,u){p(t);var l=Tools.isSet(u)?u:false;if(!Tools.isBoolean(l)){throw new Error('Matrix: "complex" argument must be a boolean')}if(Tools.isArrayLike(e)){n=e instanceof Array?new Matrix.dataType(e):e;r=e.constructor;if(n.length!==i.getLength()*(l?2:1)){throw new Error("Matrix: data and size are incompatible.")}if(l){o=n.subarray(0,i.getLength());s=n.subarray(i.getLength())}}else{r=Tools.checkType(e);if(typeof e==="string"){switch(e.toLowerCase()){case"logical":case"bool":case"boolean":f=true;break;default:f=false}}var h=i.getLength();if(!l){n=new r(h)}else{n=new r(2*h);o=n.subarray(0,h);s=n.subarray(h)}}if(Tools.isSet(a)){if(!Tools.isBoolean(a)){throw new Error('Matrix: "bool" argument must be a boolean')}if(a){f=true}}return this}.bind(this);this.initialize=m;var w=function(){if(!Tools.isSet(s)){return true}var t,r;for(t=0,r=s.length;t<r;t++){if(s[t]!==0){return false}}n=o;o=undefined;s=undefined;return true};var d=function(){return h()===1};var x=function(){return n.length===0};var y=function(t,r){t=Tools.isArrayLike(t)?u(t):t;if(!Tools.isSet(r)){return w()?n[t]:[o[t],s[t]]}if(!w()){n[t]=r}else{o[t]=r[0];s[t]=r[1]}return r}.bind(this);var M=function(){return n};var b=function(){if(!w()){throw new Error("Matrix.getDataScalar: Data must be real.")}if(h()!==1){throw new Error("Matrix.getDataScalar: Data length must be 1.")}return n[0]};var D=function(){if(!Tools.isSet(s)){throw new Error("Matrix.getRealData: expected a complex Matrix.")}return o};var S=function(){if(!Tools.isSet(s)){throw new Error("Matrix.getImagData: expected a complex Matrix.")}return s};var I=function(t){if(!w()){throw new Error("Matrix.toComplex: expected a non-complex Matrix.")}var r=new n.constructor(n.length*2);o=r.subarray(0,n.length);s=r.subarray(n.length);o.set(n);if(t instanceof Matrix){Tools.checkSizeEquals(this,t,Matrix.ignoreTrailingDims);if(!t.isreal()){throw new Error("Matrix.toComplex: imaginary part cannot be complex.")}t=t.getData()}if(Tools.isArrayLike(t)){if(t.length!==n.length){throw new Error("Matrix.toComplex: imaginary part has invalid length.")}s.set(t)}else if(Tools.isSet(t)){throw new Error("Matrix.toComplex: invalid argument.")}n=r;return this}.bind(this);var E=function(){return f?"logical":n.constructor.name};var z=function(){return new MatrixView(i)};this.value=y;this.getData=M;this.getDataScalar=b;this.getRealData=D;this.getImagData=S;this.getDataType=E;this.getView=z;this.isreal=w;this.isscalar=d;this.isempty=x;this.toComplex=I;var L=function(){var t=Array.prototype.slice.apply(arguments);if(Tools.isArrayLike(t[0])){t=t[0]}if(t.length===0){t=this.getLength()}t=Tools.checkSize(t,"column");var r,e,a=1;for(r=0,e=t.length;r<e;r++){a*=t[r]}if(a!==this.getLength()){throw new Error("Matrix.reshape: number of elements must not change.")}p(t);return this}.bind(this);this.reshape=L;var R=function(){var r=!w();var e=n instanceof Array?n.slice():new n.constructor(n);return new Matrix(t,e,r,f)};this.getCopy=R;return m(t,r,e)}Matrix.dataType=Float64Array;Matrix.ignoreTrailingDims=true;if(typeof window==="undefined"){module.exports.Matrix=Matrix}(function(t,r){"use strict";r.toArray=function(){var t="Matrix.toArray: function only available for ";if(this.ndims()>2){throw new Error(t+"2D matrix.")}var r;if(this.isreal()){r=this.getData()}else{throw new Error(t+"for real matrix.")}var e=this.getView();var a=e.getFirst(0),i=e.getStep(0),n=e.getEnd(0);var o=e.getFirst(1),s=e.getStep(1),f=e.getEnd(1);var u,l,h,g,v,c;for(v=[],u=a,l=n;u!==l;u+=i){for(c=[],h=u+o,g=u+f;h!==g;h+=s){c.push(r[h])}v.push(c)}return v};t.fromArray=function(r){var e,a;if(r[0].length){if(r[0][0].length){throw new Error("Matrix.fromArray: Only work with Array up to 2 dimensions.")}e=[r[0].length,r.length];a=[];var i,n;for(i=0,n=r.length;i<n;i++){var o=Array.prototype.slice.apply(r[i]);a=a.concat(o)}}else{e=r.length;a=r}return new t(e,a)};r.dlmwrite=function(t){if(t!==undefined&&typeof t!=="string"){throw new Error("Matrix.dlmread: Wrong delimiter specification.")}if(this.ndims()>2){throw new Error("Matrix.dlmwrite: function only available for 2D matrix.")}var r=this.getView(),e=this.getData();var a=r.getStep(1),i=r.getEnd(1);var n=r.getSize(0);var o,s,f,u;var l="";for(o=0,f=n;o<f;o++){for(s=o,u=o+i-a;s<u;s+=a){l+=e[s]+t}l+=e[s]+"\n"}return l};t.dlmread=function(r,e){if(e!==undefined&&typeof e!=="string"){throw new Error("Matrix.dlmread: Wrong delimiter specification.")}r=r.split("\n");if(r[r.length-1]===""){r.pop()}var a,i,n,o;var s=[];var f=/[\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?/g;for(a=0,i=r.length;a<i;a++){var u=e?r[a].split(e):r[a].match(f);for(n=0,o=u.length;n<o;n++){u[n]=parseFloat(u[n])}s.push(u)}return t.fromArray(s).transpose()};r.toMatlab=function(){if(this.ndims()>2){throw new Error("Matrix.toMatlab: function available only for 2D matrix.")}var t=function(t,r){var e=t.toString();if(typeof r==="number"){e+=r>0?" + ":" - ";e+=Math.abs(r).toString();e+=" * i"}return e};var r="",e,a,i;if(this.isreal()){e=this.getData()}else{a=this.getRealData();i=this.getImagData()}var n=this.getView();var o=n.getFirst(0),s=n.getStep(0),f=n.getEnd(0);var u=n.getFirst(1),l=n.getStep(1),h=n.getEnd(1);var g,v,c,p;r+="[";for(g=o,v=f;g!==v;g+=s){if(g!==o){r+=" "}if(this.isreal()){for(c=g+u,p=g+h;c!==p;c+=l){r+=t(e[c]);if(c!==p-l){r+=","}}}else{for(c=g+u,p=g+h;c!==p;c+=l){r+=t(a[c],i[c]);if(c!==p-l){r+=","}}}if(g!==v-s){r+=";"}}r+="]";return r};r.toString=function(t,r){var e,a="";if(t===undefined){e=4}else if(typeof t==="string"){a=t;e=4}else{e=t}if(typeof r==="string"){a=r}var i=e+5;var n=function(t,r){var a="";if(typeof t==="number"){if(t%1===0){a+=t}else{a+=t.toFixed(e)}while(a.length<i){a=" "+a}}else{a+=t.toString()}if(r===undefined){return a}if(r===0){while(a.length<2*i+1){a=a+" "}return a}if(typeof r==="number"){a+=r>0?" + ":" - ";if(t%1===0){a+=Math.abs(r)}else{a+=Math.abs(r).toFixed(e)}while(a.length<i){a=" "+a}}else{a+=r.toString()}a+="i";return a};var o,s,f="",u;if(this.isempty()){f+="Empty array: ";u=this.getSize();for(o=0,s=u.length-1;o<s;o++){f+=u[o]+"-by-"}f+=u[o];return f}if(this.getLength()>1e4){f+="Array: ";u=this.getSize();for(o=0,s=u.length-1;o<s;o++){f+=u[o]+"-by-"}f+=u[o];return f}var l,h,g;if(this.isreal()){l=this.getData()}else{h=this.getRealData();g=this.getImagData()}var v=this.getIterator(2);var c=v.iterator,p=v.begin,m=v.isEnd;var w=this.getSize(2);var d=this.getView();var x=d.getFirst(0),y=d.getStep(0),M=d.getEnd(0);var b=d.getFirst(1),D=d.getStep(1),S=d.getEnd(1);var I,E,z,L;for(o=p();!m();o=c()){f+=a;if(w>1){f+="(:,:,"+v.getPosition()+") = [\n"}else{f+=" = [\n"}for(I=o+x,E=o+M;I!==E;I+=y){f+="	";if(this.isreal()){for(z=I+b,L=I+S;z!==L;z+=D){f+=n(l[z])+" "}}else{for(z=I+b,L=I+S;z!==L;z+=D){f+=n(h[z],g[z])+" "}}f+="\n"}f+="]\n"}return f};t.toMatrix=function(r,e){if(r instanceof t){return r}if(r.constructor===Number){r=[r]}var a=Array.prototype.concat.apply([],r);var i=false,n;if(Tools.isArrayOfNumbers(a)){}else if(Tools.isArrayOfBooleans(a)){i=true}else{throw new Error("Matrix.toMatrix: Array must only contain"+" numbers or booleans.")}if(a.length===1){n=1}else if(a.length===r.length){n=[a.length,1]}else{n=[];var o=r;while(o.length){n.push(o.length);o=o[0]}n=n.reverse()}return new t(n,a,false,i)};r.display=function(t,r){console.log(this.toString(t,r));return this}})(Matrix,Matrix.prototype);(function(t,r){"use strict";r.extractViewFrom=function(r){if(this.isreal()){var e=this.getData();return new t(r.getSize(),r.extractFrom(e))}var a=new t(r.getSize(),this.getDataType(),true);r.extractFrom(this.getRealData(),a.getRealData());r.extractFrom(this.getImagData(),a.getImagData());return a};r.extractViewTo=function(t,r){if(this.isreal()&&r.isreal()){t.extractTo(this.getData(),r.getData());return r}if(this.isreal()||r.isreal()){this.toComplex()}t.extractTo(this.getRealData(),r.getRealData());t.extractTo(this.getImagData(),r.getImagData());return r};var e=function(t){t=Array.prototype.slice.apply(t);var r,e;for(r=0,e=t.length;r<e;r++){t[r]=t[r]?true:false}return t};r.selectView=function(r){r=Array.prototype.slice.apply(r);var a=Tools,i=a.checkSizeEquals,n=t.ignoreTrailingDims;var o=r[0];var s,f;if(o instanceof t&&r.length===1){var u=o.getData();var l=new MatrixView([this.getLength(),1]);if(o.islogical()&&i(this.getSize(),o.getSize(),n)){return l.selectBooleanDimension(0,u)}else if(a.isArrayOfNumbers(u,0,this.numel(0)-1)){return l.selectIndicesDimension(0,u)}throw new Error("Matrix.selectView: Invalid Matrix selection.")}for(s=0,f=r.length;s<f;s++){o=r[s];if(o instanceof t){if(o.isvector()){if(o.islogical()){o=e(o.getData())}else{o=[o.getData()]}}else{throw new Error("Matrix.selectView: Invalid Matrix selection:",o)}}r[s]=o}return MatrixView.prototype.select.apply(this.getView(),r)};r.get=function(){if(arguments.length===0){return this.getCopy().reshape(this.getLength())}var r=this.selectView(arguments);if(arguments.length===1&&arguments[0]instanceof t){if(r.getLength()===arguments[0].getLength()){return this.extractViewFrom(r).reshape(arguments[0].getSize())}return this.extractViewFrom(r)}return this.extractViewFrom(r)};r.set=function(){var r=Array.prototype.slice.apply(arguments);var e=t.toMatrix(r.pop());var a=this.selectView(r);if(r.length===1&&r[0]instanceof t){var i=e.getSize(),n=r[0].getSize();var o=e.reshape().extractViewTo(a,this.reshape());o=o.reshape(n);e.reshape(i);return o}return e.extractViewTo(a,this)};t.set=function(){var e=Array.prototype.shift.apply(arguments);if(!(e instanceof t)){throw new Error("Matrix.set: Matrix to modify must be provided.")}return r.set.apply(e.getCopy(),arguments)};t.reshape=function(){var r=Array.prototype.shift.apply(arguments);if(!(r instanceof t)){throw new Error("Matrix.set: Matrix to modify must be provided.")}r=r.getCopy();return r.reshape.apply(r,arguments)};r.repmat=function(){var r=Tools.checkSize(arguments,"square");var e,a=this.getView();var i=this.size();var n,o=1,s=[];for(e=0,n=Math.max(i.length,r.length);e<n;e++){s[e]=(i[e]||1)*(r[e]||1);o*=s[e]}var f=new t(s,this.getDataType(),!this.isreal());var u=f.getView();var l,h,g,v;if(this.isreal()){g=f.getData();l=this.getData()}else{g=f.getRealData();v=f.getImagData();l=this.getRealData();h=this.getImagData()}for(e=0,n=i.length;e<n;e++){u.selectDimension(e,[0,i[e],-1])}var c=u.getIterator(0);var p,m=c.iterator,w=c.begin,d=c.isEnd;for(p=w();!d();p=m()){var x=f.getView(),y=c.getPosition();for(e=0,n=r.length;e<n;e++){var M=i[e]||1,b=y[e]*M;x.selectDimension(e,[b,1,b+M-1])}a.extract(l,x,g);if(!this.isreal()){a.extract(h,x,v)}}return f};r.permute=function(t){var r=this.getView().permute(t);return this.extractViewFrom(r)};r.ipermute=function(t){var r=this.getView().ipermute(t);return this.extractViewFrom(r)};r.shiftdim=function(t){var r=this.getView();t=r.shiftDimension(t);return[this.extractViewFrom(r),t]};r.rot90=function(t){var r=this.getView().rot90(t);
return this.extractViewFrom(r)};r.flipdim=function(t){var r=this.getView().selectDimension(t,[-1,0]);return this.extractViewFrom(r)};r.fliplr=function(){return this.flipdim(1)};r.flipud=function(){return this.flipdim(0)};r.cat=function(){var r=arguments[0];var e=this.getSize();if(e[r]===undefined){e[r]=1}var a;for(a=1;a<arguments.length;a++){e[r]+=arguments[a].getSize(r)}var i=new t(e);var n=i.getView();var o=this.getSize(r)-1;n.selectDimension(r,[0,o]);this.extractViewTo(n,i);n.restore();for(a=1;a<arguments.length;a++){n.selectDimension(r,[o+1,o+=arguments[a].getSize(r)]);arguments[a].extractViewTo(n,i);n.restore()}return i}})(Matrix,Matrix.prototype);(function(t,r){"use strict";r.numel=function(){return this.getLength()};r.ndims=function(){return this.getDimLength()};r.size=function(t){switch(typeof t){case"number":if(!Tools.isInteger(t,0)){throw new Error("Matrix.size: invalid argument.")}return this.getSize(t)||1;case"undefined":return this.getSize();default:throw new Error("Matrix.size: Wrong argument type.")}};r.type=function(){switch(this.getDataType().toLowerCase()){case"boolean":case"logical":return"logical";case"array":case"float64array":return"double";case"float32array":return"single";case"int32array":return"int32";case"uint32array":return"uint32";case"int16array":return"int16";case"uint16array":return"uint16";case"int8array":return"int8";case"uint8clampedarray":return"uint8c";case"uint8array":return"uint8";default:return new Error("Matrix.type: Unknown data type.")}};r.isrow=function(){var t=this.size();return t.length===2&&t[0]===1};r.iscolumn=function(){var t=this.size();return t.length===2&&t[1]===1};r.isvector=function(){var t=this.size();return t.length===2&&(t[1]===1||t[0]===1)};r.ismatrix=function(){return this.getSize().length<=2};r.issquare=function(){if(this.getSize(0)!==this.getSize(1)){throw false}return true};r.isinteger=function(){switch(this.getDataType().toLowerCase()){case"uint8array":case"uint8clampedarray":case"uint16array":case"uint32array":case"int8array":case"int16array":case"int32array":return true;default:return false}};r.isfloat=function(){switch(this.getDataType().toLowerCase()){case"float32array":case"float64array":return true;default:return false}};r.islogical=function(){var t=this.getDataType().toLowerCase();if(t==="logical"||t==="boolean"||t==="bool"){return true}return false};t.intmin=function(t){switch(t){case"uint8c":case"uint8":case"uint16":case"uint32":return 0;case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648;default:throw new Error("Matrix.intmin: Unknown data type.")}};t.intmax=function(t){switch(t){case"int8":return 127;case"uint8c":case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295;default:throw new Error("Matrix.intmax: Unknown data type.")}};t.realmin=function(t){switch(t){case undefined:case"double":return Number.MIN_VALUE;case"single":return 1.1755e-38;default:throw new Error("Matrix.realmin: Unknown data type.")}};t.realmax=function(t){switch(t){case undefined:case"double":return Number.MAX_VALUE;case"single":return 3.4028e38;default:throw new Error("Matrix.realmin: Unknown data type.")}}})(Matrix,Matrix.prototype);(function(t,r){"use strict";var e=typeof module!=="undefined"&&module.exports?true:false;var a,i,n;if(e){a=require("fs");i=require("canvas");n=i.Image}else{n=Image}var o=function(t,r){var a;if(e){a=new i}else{a=document.createElement("canvas")}a.width=t||0;a.height=r||0;return a};t.colon=function(){var r=Tools.checkColon(arguments);var e=r[0],a=r[1],i=r[2];if(!isFinite(e)||!isFinite(a)||!isFinite(i)){throw new Error("Parameters are invalid number (Infitity or NaN).")}var n=2.2204e-16;var o=2*n*Math.max(Math.abs(e),Math.abs(i));var s=a>0?1:-1;var f;var u=Tools.isInteger;if(u(e)&&a===1){f=Math.floor(i)-e}else if(u(e)&&u(a)){var l=Math.floor(e/a);var h=e-l*a;f=Math.floor((i-h)/a)-l}else{f=Math.round((i-e)/a);if(s*(e+f*a-i)>o){f=f-1}}var g=e+f*a;if(s*(g-i)>-o){g=i}var v=new t(f+1);var c=v.getData();var p,m=Math.floor(f/2)+1;var w=e,d=g;for(p=0;p<m;p++,w+=a,d-=a){c[p]=w;c[f-p]=d}if(f%2===0){c[f/2]=(e+g)/2}return v};t.linspace=function(r,e,a){if(!Tools.isNumber(r)){throw new Error}if(!Tools.isNumber(e)){throw new Error}if(a===undefined){a=100}else if(!Tools.isInteger(a,1)){throw new Error("Matrix.linspace: Bins shoulb be an integer > 1.")}var i=a-1;return t.colon(r,(e-r)/i,e)};t.zeros=function(){var r,e;if(typeof arguments[arguments.length-1]==="string"){e=Array.prototype.pop.apply(arguments)}r=Tools.checkSize(arguments,"square");return new t(r,e)};t.ones=function(){var r;if(typeof arguments[arguments.length-1]==="string"){r=Array.prototype.pop.apply(arguments)}var e=Tools.checkSize(arguments,"square");var a=new t(e,r),i=a.getData();var n,o;for(n=0,o=i.length;n<o;++n){i[n]=1}return a};t.rand=function(){var r,e;if(typeof arguments[arguments.length-1]==="string"){e=Array.prototype.pop.apply(arguments)}r=Tools.checkSize(arguments,"square");var a=new t(r,e),i=a.getData();var n,o,s=Math.random;for(n=0,o=i.length;n<o;++n){i[n]=s()}return a};t.randn=function(){var r,e;if(typeof arguments[arguments.length-1]==="string"){e=Array.prototype.pop.apply(arguments)}r=Tools.checkSize(arguments,"square");var a=new t(r,e),i=a.getData();var n,o;var s=Math.random,f=Math.PI*2;var u=Math.sqrt,l=Math.sin,h=Math.log;for(n=0,o=i.length;n<o;++n){var g=f*s();var v=u(-2*h(1-s()));i[n]=v*l(g)}return a};t.randi=function(){var r,e,a;r=Array.prototype.shift.apply(arguments);r=Tools.checkRange(r);if(typeof arguments[arguments.length-1]==="string"){a=Array.prototype.pop.apply(arguments)}e=arguments.length===0?[1]:arguments;e=Tools.checkSize(e,"square");var i=new t(e,a),n=i.getData();var o,s,f=r[0],u=r[1]-f+1;var l=Math.random,h=Math.floor;for(o=0,s=n.length;o<s;++o){n[o]=h(l()*u)+f}return i};t.eye=function(){var r,e;if(typeof arguments[arguments.length-1]==="string"){e=Array.prototype.pop.apply(arguments)}r=Tools.checkSize(arguments,"square");var a=new t(r,e);var i=a.getData();var n=a.getView(),o=a.getIterator(2);var s=o.iterator,f=o.begin,u=o.isEnd;var l=n.getFirst(1),h=n.getStep(1);var g=n.getFirst(0),v=n.getStep(0);var c=Math.min(n.getSize(1),n.getSize(0));var p,m,w;for(p=f();!u();p=s()){for(m=p+l+g,w=0;w<c;m+=h,w++){i[m+w*v]=1}}return a};t.complex=function(r,e){r=t.toMatrix(r);e=t.toMatrix(e);if(!(r instanceof t)){throw new Error("Matrix.complex: real argument must be a matrix.")}if(!r.isreal()){throw new Error("Matrix.complex: real argument must be a real matrix.")}if(!(e instanceof t)){throw new Error("Matrix.complex: imag argument must be a matrix.")}if(!e.isreal()){throw new Error("Matrix.complex: imag argument must be a real matrix.")}if(!Tools.checkSizeEquals(r.getSize(),e.getSize(),t.ignoreTrailingDims)){throw new Error("Matrix.complex: imag and real Matrix must "+"have the same size.")}var a=r.getData(),i=e.getData();var n=new t.dataType(a.length*2);n.subarray(0,a.length).set(a);n.subarray(a.length).set(i);return new t(r.getSize(),n,true)};t.imread=function(r,s,f){var u="Matrix.imread: ";var l=new t;if(!e&&typeof r==="string"&&document.getElementById(r)){r=document.getElementById(r)}var h=function(t){var r,e=t.getContext("2d");var a=t.width,i=t.height;try{r=e.getImageData(0,0,a,i)}catch(n){if(f!==undefined){f.call(this,n);return}throw n}var o=new Uint8ClampedArray(r.data);var u=new MatrixView([4,a,i]).select([0,2],[0,-1],[0,-1]).permute([2,1,0]);this.initialize(u.getSize(),u.extractFrom(o));if(s){s.call(this,this)}}.bind(l);var g=function(t){if(!e){t=t instanceof Event?this:t}var r=o(t.width,t.height);r.getContext("2d").drawImage(t,0,0,t.width,t.height);h(r)};var v=function(t){var r=new n;r.onerror=f||function(){throw new Error(u+"Error occuring while loading image.")};if(e){r.src=a.readFileSync(t);g(r)}else{r.src=t;r.onload=g}};if(typeof r==="string"){v(r)}else if(!e&&r instanceof Image){g(r)}else if(!e&&r instanceof HTMLCanvasElement){h(r)}else if(e&&r instanceof i){h(r)}else{throw new Error(u+"invalid source argument")}return l};t.diag=function(r){r=t.toMatrix(r);var e=r.numel();r=r.getData();var a=t.zeros(e);var i=a.getData();var n,o,s;for(n=0,o=i.length,s=0;n<o;n+=e+1,s++){i[n]=r[s]}return a};t.loadImages=function s(r,e){var a=[],i,n;e=e.bind(a);var o=function(t){return function(){a[t]=this;for(var i=0,n=r.length;i<n;i++){if(!a[i]||a[i].isempty()){return}}e()}};for(i=0,n=r.length;i<n;i++){if(r[i]instanceof Image){t.imread(r[i],o(i))}}return a}})(Matrix,Matrix.prototype);(function(t,r){"use strict";var e=function(t,r,e,a){for(var i=r+e,n=r+a,o=t[r];i<n;i+=e){if(t[i]<o){o=t[i]}}return o};var a=function(t,r,e,a){for(var i=r+e,n=r+a,o=t[r],s=r;i<n;i+=e){if(t[i]<o){o=t[i];s=i}}return s};var i=function(t,r,e,a){for(var i=r+e,n=r+a,o=t[r];i<n;i+=e){if(t[i]>o){o=t[i]}}return o};var n=function(t,r,e,a){for(var i=r+e,n=r+a,o=t[r],s=r;i<n;i+=e){if(t[i]>o){o=t[i];s=i}}return s};var o=function(t,r,e,a){for(var i=r,n=r+a,o=0;i<n;i+=e){o+=t[i]}return o};var s=function(t,r,e,a){for(var i=r,n=r+a,o=0;i<n;i+=e){o+=t[i]}return o*e/a};var f=function(t,r,e,a){for(var i=r,n=r+a,o=1;i<n;i+=e){o*=t[i]}return o};var u=function(t,r,e,a){var i=s(t,r,e,a);for(var n=r,o=r+a,f=0;n<o;n+=e){var u=t[n]-i;f+=u*u}return f*e/(a-1)};var l=function(t,r,e,a){return u(t,r,e,a)*(a-1)/a};var h=function(t,r,e,a){for(var i=r+e,n=r+a;i<n;i+=e){t[i]+=t[i-e]}};var g=function(t,r,e,a){for(var i=r+e,n=r+a;i<n;i+=e){t[i]*=t[i-e]}};var v=function(t,r){var e=t.ndims(),a=[r];for(var i=0;i<e;i++){if(i!==r){a.push(i)}}return a};var c=function(r,e,a,i,n){i=i||false;if(!Tools.isSet(a)){if(i){e(r.getData(),0,1,r.numel());return r}var o=e(r.getData(),0,1,r.numel());return t.toMatrix(o)}if(!Tools.isInteger(a,0)){throw new Error("Matrix.applyDim: Invalid dimension.")}var s=r.getView(),f=v(s,a);s.permute(f);var u=r.getData(),l=s.getIterator(1);var h=l.iterator,g=l.begin,c=l.isEnd;var p=s.getStep(0),m=s.getEnd(0);var w,d;if(!i){var x=r.getSize();x[a]=1;var y=new t(x,n),M=new y.getData;for(w=g(),d=0;!c();w=h(),d++){M[d]=e(u,w,p,m)}return y}if(n!==undefined){r=n;n=n.getData()}for(w=g();!c();w=h()){e(u,w,p,m,n)}return r};r.min=function(t){return c(this,e,t)};r.amin=function(t){return c(this,a,t,undefined,"uint32")};r.max=function(t){return c(this,i,t)};r.amax=function(t){return c(this,n,t,undefined,"uint32")};r.sum=function(t){return c(this,o,t)};r.prod=function(t){return c(this,f,t)};r.mean=function(t){return c(this,s,t)};r.variance=function(t,r){switch(typeof r){case"undefined":r=-1;break;case"boolean":r=r===false?-1:0;break;case"number":if(r===0){r=-1}else if(r===1){r=0}else{throw new Error("Matrix.variance: Invalid argument.")}break;default:throw new Error("Matrix.variance: Invalid argument.")}if(r===-1){return c(this,u,t)}return c(this,l,t)};r.std=function(t,r){var e=this.variance(t,r);if(typeof e==="number"){return Math.sqrt(e)}return e.arrayfun(Math.sqrt)};r.cumsum=function(t){return c(this,h,t,true)};r.cumprod=function(t){return c(this,g,t,true)};(function(){var e=function(t,r){var e=Math.exp(-r),a=Math.random;for(var i=0,n=t.length;i<n;i++){var o=1,s=0;do{s++;o*=a()}while(o>e);t[i]=s-1}};var a=function(t){var r=Math.exp,e=Math.random;for(var a=0,i=t.length;a<i;a++){var n=1,o=0,s=r(-t[a]);do{o++;n*=e()}while(n>s);t[a]=o-1}};var i=function(t,r){r=-r;var e=Math.random,a=Math.log;for(var i=0,n=t.length;i<n;++i){t[i]=r*a(e())}};t.poissrnd=function(){var r=Array.prototype.shift.apply(arguments);if(typeof r==="number"){var a=Tools.checkSize(arguments,"square");var i=new t(a),n=i.getData();e(n,r);return i}if(r instanceof t){return r.getCopy().poissrnd()}};r.poissrnd=function(){a(this.getData());return this};t.exprnd=function(){var r=Array.prototype.shift.apply(arguments);var e=Tools.checkSize(arguments,"square");var a=new t(e),n=a.getData();i(n,r);return a}})();(function(){var e,a,i;var n=function(t,r){return e[t]-e[r]};var o=function(t,r){return e[r]-e[t]};var s=function(t,r){return t-r};var f=function(t,r){return r-t};var u=function(t,r,a,n){var o,s,f;for(o=r,s=0,f=r+n;o<f;o+=a,s++){e[s]=t[o]}Array.prototype.sort.call(e,i);for(o=r,s=0,f=r+n;o<f;o+=a,s++){t[o]=e[s]}};var l=function(t,r,n,o,s){var f,u,l;for(f=r,u=0,l=r+o;f<l;f+=n,u++){e[u]=t[f];a[u]=u}Array.prototype.sort.call(a,i);for(f=r,u=0,l=r+o;f<l;f+=n,u++){s[f]=a[u]*n+r}};r.sort=function(t,r){var a=typeof t==="number"?this.getSize(t):this.numel();e=new Float64Array(a);if(r==="ascend"){i=s}else if(r==="descend"){i=f}else{throw new Error("Matrix.sort: Wrong mode selection")}return c(this,u,t,true)};t.sort=function(t,r,e){return t.getCopy().sort(r,e)};r.asort=function(r,s){var f=typeof r==="number"?this.getSize(r):this.numel();e=new Float64Array(f);a=new Uint32Array(f);if(s==="ascend"){i=n}else if(s==="descend"){i=o}else{throw new Error("Matrix.sort: Wrong mode selection")}var u=new t(this.getSize(),"uint32");return c(this,l,r,true,u)};t.asort=function(t,r,e){return t.getCopy().asort(r,e)}})();t.accumarray=function(r,e,a){r=t.toMatrix(r);if(!Tools.isArrayOfIntegers(r.getData(),0)){throw new Error("Matrix.accumarray: Subs should be an array of positive integers.")}var i=r.max(0).getData();var n,o,s=[1];if(Tools.isSet(a)){for(n=0,o=i.length;n<o;n++){if(a[n]<i[n]+1){throw new Error("Matrix.accumarray: Size and Subs values are unconsistent.")}}}else{a=[];for(n=0,o=i.length;n<o;n++){a[n]=i[n]+1}}for(n=0,o=a.length-1;n<o;n++){s[n+1]=s[n]*a[n]}if(r.ndims()>2){throw Error("Matrix.accumarray: Subs must be a 2D Array.")}var f=r.getData(),u=r.numel(),l=r.getSize(0);var h,g,v,c,p,m;var w=new Uint32Array(l);for(g=0,v=0;v<u;g++,v+=l){for(h=0,c=v,m=s[g];h<l;h++,c++){w[h]+=f[c]*m}}if(e instanceof t){e=e.getData()}var d=new t(a),x=d.getData();if(Tools.isArrayLike(e)&&e.length===w.length){for(n=0,o=w.length;n<o;n++){x[w[n]]+=e[n]}}else if(typeof e==="number"){for(n=0,o=w.length;n<o;n++){x[w[n]]+=e}}else{throw new Error("Matrix.accumarray: Wrong val argument.")}return d}})(Matrix,Matrix.prototype);(function(t,r){"use strict";r.cast=function(r){var e;switch(r.toLowerCase()){case"boolean":case"bool":case"logical":e=true;break;default:e=false}r=Tools.checkType(r);var a=new r(this.getData());return new t(this.getSize(),a,!this.isreal(),e)};r.double=function(){return this.cast("double")};r.single=function(){return this.cast("single")};r.int8=function(){return this.cast("int8")};r.int16=function(){return this.cast("int16")};r.int32=function(){return this.cast("int32")};r.uint8=function(){return this.cast("uint8")};r.logical=function(){return this.cast("logical")};r.uint8c=function(){return this.cast("uint8c")};r.uint16=function(){return this.cast("uint16")};r.uint32=function(){return this.cast("uint32")};r.isnan=function(){var r=new t(this.getSize(),"logical");var e=r.getData();var a,i;if(this.isreal()){var n=this.getData();for(a=0,i=e.length;a<i;a++){e[a]=isNaN(n[a])}}else{var o=this.getRealData(),s=this.getImagData();for(a=0,i=e.length;a<i;a++){e[a]=isNaN(o[a])||isNaN(s[a])}}return r};r.isinf=function(){var r=new t(this.getSize(),"logical");var e=r.getData();var a,i;if(this.isreal()){var n=this.getData();for(a=0,i=e.length;a<i;a++){var o=n[a];e[a]=o===Infinity||o===-Infinity?1:0}}else{var s=this.getRealData(),f=this.getImagData();for(a=0,i=e.length;a<i;a++){var u=s[a],l=f[a];e[a]=u===Infinity||u===-Infinity||l===Infinity||l===-Infinity?1:0}}return r};r.isfinite=function(){var r=new t(this.getSize(),"logical");var e=r.getData();var a,i;if(this.isreal()){var n=this.getData();for(a=0,i=e.length;a<i;a++){e[a]=isFinite(n[a])?1:0}}else{var o=this.getRealData(),s=this.getImagData();for(a=0,i=e.length;a<i;a++){e[a]=isFinite(o[a])||isFinite(s[a])?1:0}}return r}})(Matrix,Matrix.prototype);(function(t,r){"use strict";r.real=function(){if(this.isreal()){throw new Error("Matrix.real: This function can be only"+" used with a complex Matrix. ")}var r=this.getRealData();return new t(this.getSize(),new r.constructor(r))};r.imag=function(){if(this.isreal()){throw new Error("Matrix.imag: This function can be only"+" used with a complex Matrix. ")}var r=this.getImagData();return new t(this.getSize(),new r.constructor(r))};(function(t){var r=function(t){for(var r=0,e=t.length;r<e;r++){t[r]=0}};var e=function(t,r){for(var e=0,a=t.length;e<a;e++){t[e]=Math.atan2(r[e],t[e]);r[e]=0}};t.angle=function(){if(this.isreal()){r(this.getData())}else{e(this.getRealData(),this.getImagData())}return this}})(r);(function(t){var r=function(t){for(var r=0,e=t.length;r<e;r++){t[r]=t[r]>0?t[r]:-t[r]}};var e=function(t,r){for(var e=0,a=t.length;e<a;e++){var i=r[e],n=t[e];t[e]=Math.sqrt(i*i+n*n);r[e]=0}};t.abs=function(){if(this.isreal()){r(this.getData())}else{e(this.getRealData(),this.getImagData())}return this}})(r);r.conj=function(){if(this.isreal()===true){return this}var t,r,e=this.getImagData();for(t=0,r=e.length;t<r;t++){e[t]=-e[t]}return this}})(Matrix,Matrix.prototype);(function(Matrix,Matrix_prototype){"use strict";(function(t){var r=function(t){for(var r=0,e=t.length;r<e;r++){t[r]=Math.sqrt(t[r])}};var e=function(t,r){for(var e=0,a=t.length;e<a;e++){var i=t[e],n=r[e];var o=Math.sqrt(i*i+n*n);t[e]=Math.sqrt((i+o)*.5);r[e]=n<0?-Math.sqrt((o-i)*.5):Math.sqrt((o-i)*.5)}};t.sqrt=function(){if(this.isreal()){r(this.getData())}else{e(this.getRealData(),this.getImagData())}return this}})(Matrix_prototype);Matrix_prototype.cos=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.cos(t[r])}return this};Matrix_prototype.sin=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.sin(t[r])}return this};Matrix_prototype.tan=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.tan(t[r])}return this};(function(t){var r=function(t){for(var r=0,e=t.length;r<e;r++){t[r]=Math.exp(t[r])}};var e=function(t,r){for(var e=0,a=t.length;e<a;e++){var i=Math.exp(t[e]),n=r[e];t[e]=i*Math.cos(n);r[e]=i*Math.sin(n)}};t.exp=function(){if(this.isreal()){r(this.getData())}else{e(this.getRealData(),this.getImagData())}return this}})(Matrix_prototype);Matrix_prototype.log=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.log(t[r])}return this};Matrix_prototype.log10=function(){var t=this.getData(),r,e;var a=Math.log(10);for(r=0,e=t.length;r<e;r++){t[r]=Math.log(t[r])*a}return this};Matrix_prototype.log2=function(){var t=this.getData(),r,e;var a=Math.log(2);for(r=0,e=t.length;r<e;r++){t[r]=Math.log(t[r])*a}return this};Matrix_prototype.floor=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.floor(t[r])}return this};Matrix_prototype.ceil=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.ceil(t[r])}return this};Matrix_prototype.round=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.round(t[r])}return this};Matrix_prototype.acos=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.acos(t[r])}return this};Matrix_prototype.asin=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.asin(t[r])}return this};Matrix_prototype.atan=function(){var t=this.getData(),r,e;for(r=0,e=t.length;r<e;r++){t[r]=Math.acos(t[r])}return this};Matrix_prototype.atan2=function(t){var r=this.getCopy();if(!Tools.checkSizeEquals(r.size(),t.size(),Matrix.ignoreTrailingDims)){throw new Error("Matrix.atan2: Side of of elements must be equal.")}var e=r.getData(),a=t.getData();var i,n;for(i=0,n=e.length;i<n;i++){e[i]=Math.atan2(e[i],a[i])}return r};var booleanOperators=function(t,r,e){if(!r.isreal()||e instanceof Matrix&&!e.isreal()){throw new Error("Matrix.booleanOperators: This function doesn't "+"work with complex numbers.")}var a=r.getData(),i=a.length;var n,o,s;if(typeof e==="number"){n=new Matrix(r.size(),"boolean");o=n.getData();if(t==="==="||t==="=="){for(s=0;s<i;s++){o[s]=a[s]===e?1:0}}else if(t==="!=="||t==="!="){for(s=0;s<i;s++){o[s]=a[s]!==e?1:0}}else if(t==="&&"){for(s=0;s<i;s++){o[s]=a[s]&&e?1:0}}else if(t==="||"){for(s=0;s<i;s++){o[s]=a[s]||e?1:0}}else if(t==="<"){for(s=0;s<i;s++){o[s]=a[s]<e?1:0}}else if(t==="<="){for(s=0;s<i;s++){o[s]=a[s]<=e?1:0}}else if(t===">"){for(s=0;s<i;s++){o[s]=a[s]>e?1:0}}else if(t===">="){for(s=0;s<i;s++){o[s]=a[s]>=e?1:0}}else{throw new Error("Matrix: Unknown operator '"+t+"'.")}}else if(e instanceof Matrix){var f=Tools.checkSizeEquals(r.size(),e.size(),Matrix.ignoreTrailingDims);n=new Matrix(f,"boolean");o=n.getData();var u=e.getData();if(t==="==="||t==="=="){for(s=0;s<i;s++){o[s]=a[s]===u[s]?1:0}}else if(t==="!=="||t==="!="){for(s=0;s<i;s++){o[s]=a[s]!==u[s]?1:0}}else if(t==="&&"){for(s=0;s<i;s++){o[s]=a[s]&&u[s]?1:0}}else if(t==="||"){for(s=0;s<i;s++){o[s]=a[s]||u[s]?1:0}}else if(t==="<"){for(s=0;s<i;s++){o[s]=a[s]<u[s]?1:0}}else if(t==="<="){for(s=0;s<i;s++){o[s]=a[s]<=u[s]?1:0}}else if(t===">"){for(s=0;s<i;s++){o[s]=a[s]>=u[s]?1:0}}else if(t===">="){for(s=0;s<i;s++){o[s]=a[s]>=u[s]?1:0}}else{throw new Error("Unknown operator '"+t+"'.")}}else{throw new Error("Argument must be a Matrix or a number")}return n};Matrix_prototype.eq=function(t){return booleanOperators("===",this,t)};Matrix_prototype["==="]=Matrix_prototype.eq;Matrix_prototype.ne=function(t){return booleanOperators("!==",this,t)};Matrix_prototype["!=="]=Matrix_prototype.ne;Matrix_prototype.gt=function(t){return booleanOperators(">",this,t)};Matrix_prototype[">"]=Matrix_prototype.gt;Matrix_prototype.ge=function(t){return booleanOperators(">=",this,t)};Matrix_prototype[">="]=Matrix_prototype.ge;Matrix_prototype.lt=function(t){return booleanOperators("<",this,t)};Matrix_prototype["<"]=Matrix_prototype.lt;Matrix_prototype.le=function(t){return booleanOperators("<=",this,t)};Matrix_prototype["<="]=Matrix_prototype.le;Matrix_prototype.and=function(t){return booleanOperators("&&",this,t)};Matrix_prototype["&&"]=Matrix_prototype.and;Matrix_prototype.or=function(t){return booleanOperators("||",this,t)};Matrix_prototype["||"]=Matrix_prototype.or;Matrix_prototype.neg=function(){var t=this.getCopy();var r=t.getData();var e,a;for(e=0,a=r.length;e<a;e++){r[e]=!r[e]?1:0}return t};var generateArithmeticOperators=function(){var operators={"+":{name:"plus","real/real":{scalar:"a[x] += b;",matrix:"a[x] += b[x];"},"real/imag":{scalar:"ar[x] += br;    ai[x] = bi;",matrix:"ar[x] += br[x]; ai[x] = bi[x];"},"imag/real":{scalar:"ar[x] += b;",matrix:"ar[x] += b[x];"},"imag/imag":{scalar:"ar[x] += br;    ai[x] += bi;",matrix:"ar[x] += br[x]; ai[x] += bi[x];"},AIsScalar:"B.getCopy().plus(A);",AIsMatrix:"A.getCopy().plus(B);"},"-":{name:"minus","real/real":{scalar:"a[x] -= b;",matrix:"a[x] -= b[x];"},"real/imag":{scalar:"ar[x] -= br;    ai[x] = -bi;",matrix:"ar[x] -= br[x]; ai[x] = -bi[x];"},"imag/real":{scalar:"ar[x] -= b;",matrix:"ar[x] -= b[x];"},"imag/imag":{scalar:"ar[x] -= br;    ai[x] -= bi;",matrix:"ar[x] -= br[x]; ai[x] -= bi[x];"},AIsScalar:"B.getCopy().plus(A.uminus());",AIsMatrix:"A.getCopy().minus(B);"},".*":{name:"times","real/real":{scalar:"a[x] *= b;",matrix:"a[x] *= b[x];"},"real/imag":{scalar:"ai[x] = ar[x] * bi;    ar[x] *= br;",matrix:"ai[x] = ar[x] * bi[x]; ar[x] *= br[x];"},"imag/real":{scalar:"ar[x] *= b;    ai[x] *= b;",matrix:"ar[x] *= b[x]; ai[x] *= b[x];"},"imag/imag":{scalar:"var r = ar[x], i = ai[x];"+"ar[x] = r * br - i * bi;"+"ai[x] = r * bi + i * br;",matrix:"var r1 = ar[x], i1 = ai[x], r2 = br[x], i2 = bi[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().times(A);",AIsMatrix:"A.getCopy().times(B);"},"./":{name:"rdivide","real/real":{scalar:"a[x] /= b;",matrix:"a[x] /= b[x];"},"real/imag":{scalar_before:"ai.set(ar);"+"tmp = 1 / (br * br + bi * bi);"+"br = br * tmp;"+"bi = -bi * tmp;",scalar:"ai[x] *= bi;           ar[x] *= br;",matrix:"ai[x] = ar[x] * bi[x]; ar[x] *= br[x];"},"imag/real":{scalar_before:"var b = 1 / b;",scalar:"ar[x] *= b;    ai[x] *= b;",matrix:"ar[x] /= b[x]; ai[x] /= b[x];"},"imag/imag":{scalar_before:"var tmp = 1 / (br * br + bi * bi);"+"br *= tmp;"+"bi *= tmp;",scalar:"var r = ar[x], i = ai[x];"+"ar[x] = r * br + i * bi;"+"ai[x] = i * bi - r * br;",matrix:"var r1 = ar[x], i1 = ai[x], r2 = br[x], i2 = bi[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().rdivide(A);",AIsMatrix:"A.getCopy().ldivide(B);"},".\\":{name:"ldivide","real/real":{scalar:"a[x] = b / a[x];",matrix:"a[x] = b[x] / a[x];"},"real/imag":{scalar:"ai[x] = bi / ar[x];    ar[x] = br / ar[x];",matrix:"ai[x] = bi[x] / ar[x]; ar[x] = br[x] / ar[x];"},"imag/real":{scalar:"var tmp = 1 / (ar[x] * ar[x] + ai[x] * ai[x]);"+"ai[x] = bi * tmp; ar[x] = br * tmp;",matrix:"var tmp = 1 / (ar[x] * ar[x] + ai[x] * ai[x]);"+"ai[x] = bi[x] * tmp; ar[x] = br[x] * tmp;"},"imag/imag":{scalar:"var r = br[x], i = bi[x];"+"ar[x] = r * ar + i * ai;"+"ai[x] = i * ai - r * ar;",matrix:"var r1 = br[x], i1 = bi[x], r2 = ar[x], i2 = ai[x];"+"var t = 1 / (r2 * r2 + i2 * i2);"+"ar[x] = (r1 * r2 + i1 * i2) * t;"+"ai[x] = (i1 * r2 - r1 * i2) * t;"},AIsScalar:"B.getCopy().ldivide(A);",AIsMatrix:"A.getCopy().rdivide(B);"},".^":{name:"power","real/real":{scalar_before:"var pow = Math.pow;",matrix_before:"var pow = Math.pow;",scalar:"a[x] = pow(a[x], b);",matrix:"a[x] = pow(a[x], b[x]);"},"real/imag":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},"imag/real":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},"imag/imag":{scalar:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');",matrix:"throw new Error('Matrix.power: This function has not "+"been implemented yet for complex number.');"},AIsScalar:"B.isscalar() ? A.getCopy().power(B) : undefined;",AIsMatrix:"A.getCopy().power(B);"}};var fct=function(t){"use strict";t=Matrix.toMatrix(t);var r,e=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();"real/real-scalar"}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];"real/imag-scalar"}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();"imag/real-scalar"}else{o=t.getRealData()[0];s=t.getImagData()[0];"imag/imag-scalar"}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();"real/real-matrix"}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();"real/imag-matrix"}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();"imag/real-matrix"}else{o=t.getRealData();s=t.getImagData();"imag/imag-matrix"}}}return this}.toString();var fct2=function(t,r){"use strict";t=Matrix.toMatrix(t);r=Matrix.toMatrix(r);if(t.isscalar()){return"AIsScalar"}else{return"AIsMatrix"}}.toString();var addLoop=function(t){return"for (x = 0; x < n; x++) {"+t+"}"};var replace=function(t,r,e){var a=r[e].scalar_before?r[e].scalar_before:"";var i=r[e].matrix_before?r[e].matrix_before:"";a+=addLoop(r[e].scalar);i+=addLoop(r[e].matrix);t=t.replace('"'+e+'-matrix";',i);t=t.replace('"'+e+'-scalar";',a);return t};var o,op,fun;for(o in operators){op=operators[o];fun=replace(fct,op,"real/real");fun=replace(fun,op,"real/imag");fun=replace(fun,op,"imag/real");fun=replace(fun,op,"imag/imag");eval("Matrix.prototype."+op.name+" = "+fun);fun=fct2.replace('"AIsScalar";',op.AIsScalar);fun=fun.replace('"AIsMatrix";',op.AIsMatrix);eval("Matrix."+op.name+" = "+fun)}};Matrix_prototype.plus=function(t){t=Matrix.toMatrix(t);var r,e=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();for(r=0;r<e;r++){a[r]+=t}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){i[r]+=o;n[r]=s}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(r=0;r<e;r++){i[r]+=t}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){i[r]+=o;n[r]+=s}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(r=0;r<e;r++){a[r]+=t[r]}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){i[r]+=o[r];n[r]=s[r]}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){i[r]+=t[r]}}else{o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){i[r]+=o[r];n[r]+=s[r]}}}}return this};Matrix_prototype["+="]=function(t){return this.plus(t)};Matrix_prototype["+"]=function(t){return this.getCopy().plus(t)};Matrix.plus=function(t,r){return t["+"](r)};Matrix_prototype.minus=function(t){t=Matrix.toMatrix(t);var r,e=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();for(r=0;r<e;r++){a[r]-=t}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){i[r]-=o;n[r]=-s}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(r=0;r<e;r++){i[r]-=t}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){i[r]-=o;n[r]-=s}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(r=0;r<e;r++){a[r]-=t[r]}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){i[r]-=o[r];n[r]=-s[r]}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){i[r]-=t[r]}}else{o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){i[r]-=o[r];n[r]-=s[r]}}}}return this};Matrix_prototype["-="]=function(t){return this.minus(t)};Matrix_prototype["-"]=function(t){return this.getCopy().minus(t)};Matrix.minus=function(t,r){return t["-"](r)};Matrix_prototype.uminus=function(){var t,r=this.numel();if(this.isreal()){var e=this.getData();for(t=0;t<r;t++){e[t]=-e[t]}}else{var a=this.getRealData(),i=this.getImagData();for(t=0;t<r;t++){a[t]=-a[t];i[t]=-i[t]}}return this};Matrix.uminus=function(t){return t.getCopy().uminus()};Matrix_prototype.times=function(t){t=Matrix.toMatrix(t);var r,e=this.numel();var a=this,i,n,o,s;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();for(r=0;r<e;r++){a[r]*=t}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){n[r]=i[r]*s;i[r]*=o}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(r=0;r<e;r++){i[r]*=t;n[r]*=t}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){var f=i[r],u=n[r];i[r]=f*o-u*s;n[r]=f*s+u*o}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(r=0;r<e;r++){a[r]*=t[r]}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){n[r]=i[r]*s[r];i[r]*=o[r]}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){i[r]*=t[r];n[r]*=t[r]}}else{o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){var l=i[r],h=n[r],g=o[r],v=s[r];var c=1/(g*g+v*v);i[r]=(l*g+h*v)*c;n[r]=(h*g-l*v)*c}}}}return this};Matrix_prototype["*="]=function(t){return this.times(t)};Matrix_prototype[".*"]=function(t){return this.getCopy().times(t)};Matrix.times=function(t,r){return t[".*"](r)};Matrix_prototype.rdivide=function(t){t=Matrix.toMatrix(t);var r,e=this.numel(),a;var i=this,n,o,s,f;if(t.isscalar()){if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getDataScalar();for(r=0;r<e;r++){i[r]/=t}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData()[0];f=t.getImagData()[0];o.set(n);a=1/(s*s+f*f);s=s*a;f=-f*a;for(r=0;r<e;r++){o[r]*=f;n[r]*=s}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getDataScalar();
t=1/t;for(r=0;r<e;r++){n[r]*=t;o[r]*=t}}else{s=t.getRealData()[0];f=t.getImagData()[0];a=1/(s*s+f*f);s*=a;f*=a;for(r=0;r<e;r++){var u=n[r],l=o[r];n[r]=u*s+l*f;o[r]=l*f-u*s}}}}else{Tools.checkSizeEquals(i.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getData();for(r=0;r<e;r++){i[r]/=t[r]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData();f=t.getImagData();for(r=0;r<e;r++){o[r]=n[r]*f[r];n[r]*=s[r]}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){n[r]/=t[r];o[r]/=t[r]}}else{s=t.getRealData();f=t.getImagData();for(r=0;r<e;r++){var h=n[r],g=o[r],v=s[r],c=f[r];var p=1/(v*v+c*c);n[r]=(h*v+g*c)*p;o[r]=(g*v-h*c)*p}}}}return this};Matrix_prototype["/="]=function(t){return this.rdivide(t)};Matrix_prototype["./"]=function(t){return this.getCopy().rdivide(t)};Matrix.rdivide=function(t,r){return t["./"](r)};Matrix_prototype.ldivide=function(t){t=Matrix.toMatrix(t);var r,e=this.numel(),a;var i=this,n,o,s,f;if(t.isscalar()){if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getDataScalar();for(r=0;r<e;r++){i[r]=t/i[r]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData()[0];f=t.getImagData()[0];for(r=0;r<e;r++){o[r]=f/n[r];n[r]=s/n[r]}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getDataScalar();for(r=0;r<e;r++){a=1/(n[r]*n[r]+o[r]*o[r]);o[r]=f*a;n[r]=s*a}}else{s=t.getRealData()[0];f=t.getImagData()[0];for(r=0;r<e;r++){var u=s[r],l=f[r];n[r]=u*n+l*o;o[r]=l*o-u*n}}}}else{Tools.checkSizeEquals(i.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(i.isreal()){if(t.isreal()){i=i.getData();t=t.getData();for(r=0;r<e;r++){i[r]=t[r]/i[r]}}else{i.toComplex();n=i.getRealData();o=i.getImagData();s=t.getRealData();f=t.getImagData();for(r=0;r<e;r++){o[r]=f[r]/n[r];n[r]=s[r]/n[r]}}}else{n=i.getRealData();o=i.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){a=1/(n[r]*n[r]+o[r]*o[r]);o[r]=f[r]*a;n[r]=s[r]*a}}else{s=t.getRealData();f=t.getImagData();for(r=0;r<e;r++){var h=s[r],g=f[r],v=n[r],c=o[r];var p=1/(v*v+c*c);n[r]=(h*v+g*c)*p;o[r]=(g*v-h*c)*p}}}}return this};Matrix_prototype["\\="]=function(t){return this.ldivide(t)};Matrix_prototype[".\\"]=function(t){return this.getCopy().ldivide(t)};Matrix.ldivide=function(t,r){return t[".\\"](r)};Matrix_prototype.power=function(t){t=Matrix.toMatrix(t);var r,e=this.numel();var a=this,i,n,o,s,f,u;var l=Math.pow,h=Math.sqrt,g=Math.cos,v=Math.sin,c=Math.atan2;if(t.isscalar()){if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getDataScalar();for(r=0;r<e;r++){a[r]=l(a[r],t)}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getDataScalar();for(r=0;r<e;r++){f=l(h(i[r]*i[r]+n[r]*n[r]),t);u=t*c(n[r],i[r]);i[r]=f*g(u);n[r]=f*v(u)}}else{o=t.getRealData()[0];s=t.getImagData()[0];for(r=0;r<e;r++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}}else{Tools.checkSizeEquals(a.getSize(),t.getSize(),Matrix.ignoreTrailingDims);if(a.isreal()){if(t.isreal()){a=a.getData();t=t.getData();for(r=0;r<e;r++){a[r]=l(a[r],t[r])}}else{a.toComplex();i=a.getRealData();n=a.getImagData();o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}else{i=a.getRealData();n=a.getImagData();if(t.isreal()){t=t.getData();for(r=0;r<e;r++){f=l(h(i[r]*i[r]+n[r]*n[r]),t[r]);u=t[r]*c(n[r],i[r]);i[r]=f*g(u);n[r]=f*v(u)}}else{o=t.getRealData();s=t.getImagData();for(r=0;r<e;r++){throw new Error("Matrix.power: This function has not been implemented yet for complex number.")}}}}return this};Matrix_prototype[".^"]=function(t){return this.getCopy().power(t)};Matrix.power=function(t,r){return t[".^"](r)};(function(t){var r=function(t,r){var e,a;for(e=0,a=t.length;e<a;e++){t[e]=r(t[e])}};t.arrayfun=function(t){if(!this.isreal()){throw new Error("Matrix.arrayfun: This function doesn't "+"work with complex numbers.")}if(typeof t!=="function"){throw new Error("Matrix.arrayfun: Argument must be a function.")}r(this.getData(),t.bind(this));return this}})(Matrix_prototype);Matrix_prototype.transpose=function(){if(!this.ismatrix()){throw new Error("Matrix.transpose: "+"Transposition is only defined for matrix.")}var t=this.getView().swapDimensions(0,1);return this.extractViewFrom(t)};Matrix_prototype.ctranspose=function(){return this.transpose().conj()};(function(t){var r=function(t,r){for(var e=0,a=0;e<r;e++){var i=t[e];a+=i>0?i:-i}return a};var e=function(t,r){for(var e=0,a=0;e<r;e++){var i=t[e];a+=i*i}return a};var a=function(t,r,e){var a=Math.pow,i=Math.abs;for(var n=0,o=0;n<r;n++){o+=a(i(t[n]),e)}return o};t.norm=function(t){if(t===undefined){t=2}else if(!Tools.isNumber(t)){throw new Error("Matrix.norm: Argument p must be a number.")}var i=this.getData(),n=i.length;var o;if(t===1){o=r(i,n)}else if(t===2){o=e(i,n)}else{o=a(i,n,t)}return Math.pow(o,1/t)}})(Matrix_prototype);Matrix_prototype.triu=function(t){if(t===undefined){t=0}var r=this.getView();var e=r.getStep(1),a=r.getSize(0),i=r.getSize(1);var n,o,s,f;if(this.isreal()){var u=this.getData();for(n=0,o=0;n<i;o+=e,n++){for(s=o+n+1-t,f=o+a;s<f;s++){u[s]=0}}}else{var l=this.getRealData(),h=this.getImagData();for(n=0,o=0;n<i;o+=e,n++){for(s=o+n+1-t,f=o+a;s<f;s++){l[s]=0;h[s]=0}}}return this};Matrix_prototype.tril=function(t){var r=this.getCopy();if(t===undefined){t=0}var e=r.getView();var a=e.getStep(1),i=e.getSize(0),n=e.getSize(1);var o,s,f,u,l;l=Math.min(i,n);if(this.isreal()){var h=r.getData();for(o=0,s=0;o<n;s+=a,o++){for(f=s,u=s+o-t;f<u;f++){h[f]=0}}}else{var g=r.getRealData(),v=r.getImagData();for(o=0,s=0;o<n;s+=a,o++){for(f=s,u=s+o-t;f<u;f++){g[f]=0;v[f]=0}}}return r};Matrix_prototype.diag=function(t){if(t===undefined){t=0}var r=this.getView();var e=r.getStep(0),a=r.getSize(0);var i=r.getStep(1),n=r.getSize(1);var o,s;if(t>0){t=Math.abs(t);o=i;s=Math.min(a,n-t)}else{t=Math.abs(t);o=e;s=Math.min(a-t,n)}if(s<=0){throw new Error("Matrix.diag: Invalid diagonal requirement.")}var f=new Matrix([1,s],this.type(),!this.isreal());var u,l;var h=i+e;l=t*o;if(this.isreal()){var g=this.getData();var v=f.getData();for(u=0;u<s;u++,l+=h){v[u]=g[l]}}else{var c=this.getRealData(),p=this.getImagData();var m=f.getRealData(),w=f.getImagData();for(u=0;u<s;u++,l+=h){m[u]=c[l];w[u]=p[l]}}return f};Matrix.bsxfun=function(t,r,e){r=Matrix.toMatrix(r);e=Matrix.toMatrix(e);if(!r.isreal()||!e.isreal()){throw new Error("Matrix.bsxfun: This function doesn't "+"work with complex numbers.")}var a=r.getView(),i=e.getView();var n,o=Math.max(a.ndims(),i.ndims());for(n=0;n<o;n++){var s=r.getSize(n),f=e.getSize(n);if(s===1&&f>1){a.selectIndicesDimension(n,new Uint8Array(f))}else if(f===1&&s>1){i.selectIndicesDimension(n,new Uint8Array(s))}else if(f!==s){throw new Error("Matrix.bsxfun: Incompatiblity on dimension: "+n)}}var u=Matrix.zeros(a.getSize());var l=u.getData(),h=r.getData(),g=e.getData();var v=a.getIterator(0),c=i.getIterator(0);var p=v.iterator,m=v.begin,w=v.isEnd;var d=c.iterator,x=c.begin;var y,M,b;if(t instanceof Function){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=t(h[M],g[b])}}else if(t==="plus"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]+g[b]}}else if(t==="minus"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]-g[b]}}else if(t==="times"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]*g[b]}}else if(t==="rdivide"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]/g[b]}}else if(t==="ldivide"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=g[b]/h[M]}}else if(t==="min"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=g[b]>h[M]?h[M]:g[b]}}else if(t==="power"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=Math.pow(h[M],g[b])}}else if(t==="hypot"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=Math.sqrt(g[b]*g[b]+h[M]*h[M])}}else if(t==="atan2"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=Math.atan2(h[M],g[b])}}else if(t==="eq"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]===g[b]?1:0}}else if(t==="ne"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]!==g[b]?1:0}}else if(t==="lt"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]<g[b]?1:0}}else if(t==="le"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]<=g[b]?1:0}}else if(t==="gt"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]>g[b]?1:0}}else if(t==="ge"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]>=g[b]?1:0}}else if(t==="and"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]&&g[b]?1:0}}else if(t==="or"){for(M=m(),b=x(),y=0;!w();M=p(),b=d(),y++){l[y]=h[M]||g[b]?1:0}}else{throw new Error("Matrix.bsxfun: Wrong function argument.")}return u}})(Matrix,Matrix.prototype);(function(t){"use strict";var r={matrix:function(t,r,e,a,i){a=a||1;i=i||3;e=(e||1)*i;var n=r[0],o=r[3],s=r[6];var f=r[1],u=r[4],l=r[7];var h=r[2],g=r[5],v=r[8];for(var c=0,p=a,m=2*a;c<e;c+=i,p+=i,m+=i){var w=t[c],d=t[p],x=t[m];t[c]=n*w+o*d+s*x;t[p]=f*w+u*d+l*x;t[m]=h*w+g*d+v*x}return t},"RGB to RGB":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){var s=t[i],f=t[n],u=t[o];t[i]=s;t[n]=f;t[o]=u}return t},applyFunctionRGB:function(t,r,e,a,i){a=a||1;i=i||3;e=(e||1)*i;for(var n=0,o=a,s=2*a;n<e;n+=i,o+=i,s+=i){var f=r(t[n],t[o],t[s]);t[n]=f[0];t[o]=f[1];t[s]=f[2]}return t},applyFunctionColor:function(t,r,e,a,i){a=a||1;i=i||3;e=(e||1)*i;for(var n=0,o=a,s=2*a;n<e;n+=i,o+=i,s+=i){var f=t[n],u=t[o],l=t[s];var h=r([f,u,l]);t[n]=h[0];t[o]=h[1];t[s]=h[2]}return t},"RGB to GRAY":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){var s=t[i],f=t[n],u=t[o];var l=.2989*s+.587*f+.114*u;t[i]=l;t[n]=l;t[o]=l}return t},"RGB to HSV":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=1/6;for(var n=0,o=e,s=2*e;n<r;n+=a,o+=a,s+=a){var f=t[n],u=t[o],l=t[s];var h=(f>u?f:u)>l?f>u?f:u:l;var g=h-((f<u?f:u)<l?f<u?f:u:l),v=0;if(g!==0){if(h===f){v=(u-l)/g*i}else if(h===u){v=(2+(l-f)/g)*i}else if(h===l){v=(4+(f-u)/g)*i}if(v<0){v+=1}if(h!==0){g/=h}}t[n]=v;t[o]=g;t[s]=h}return t},"HSV to RGB":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){var s=t[i],f=t[n],u=t[o];var l=(s*6|0)%6;var h=s*6-l;var g=u*(1-f);var v=u*(1-h*f);var c=u*(1-(1-h)*f);switch(l){case 0:t[i]=u;t[n]=c;t[o]=g;break;case 1:t[i]=v;t[n]=u;t[o]=g;break;case 2:t[i]=g;t[n]=u;t[o]=c;break;case 3:t[i]=g;t[n]=v;t[o]=u;break;case 4:t[i]=c;t[n]=g;t[o]=u;break;case 5:t[i]=u;t[n]=g;t[o]=v;break}}return t},"RGB to HSL":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=Math.sqrt(3),n=1/(2*Math.PI),o=1/3;for(var s=0,f=e,u=2*e;s<r;s+=a,f+=a,u+=a){var l=t[s],h=t[f],g=t[u];var v=Math.atan2(i*(h-g),2*l-h-g)*n;t[s]=v<0?v+1:v;var c=(l>h?l:h)>g?l>h?l:h:g;var p=(l<h?l:h)<g?l<h?l:h:g;t[f]=c-p;t[u]=(l+h+g)*o}return t},"HSL to RGB":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=Math.PI,n=i/3,o=i*2,s=2*i/3;var f=1/3;var u=Math.sqrt(3)/2,l=1/Math.sqrt(3);for(var h=0,g=e,v=2*e;h<r;h+=a,g+=a,v+=a){var c=t[h],p=t[g],m=t[v];var w=c*o;var d=w;while(d>n){d-=n}var x=u*p/Math.sin(s-d);var y=x*Math.cos(w)*f,M=x*Math.sin(w)*l;t[h]=m+y*2;t[g]=m-y+M;t[v]=m-y-M}return t},"RGB to HSI":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=1/Math.sqrt(3),n=1/Math.sqrt(2),o=1/Math.sqrt(6);for(var s=0,f=e,u=2*e;s<r;s+=a,f+=a,u+=a){var l=t[s],h=t[f],g=t[u];var v=(h-g)*n;var c=(2*l-h-g)*o;t[s]=Math.atan2(v,c);t[f]=Math.sqrt(v*v+c*c);t[u]=(l+h+g)*i}return t},"HSI to RGB":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=Math.sqrt(3),n=Math.sqrt(2),o=Math.sqrt(6);var s=1/6,f=1/3;for(var u=0,l=e,h=2*e;u<r;u+=a,l+=a,h+=a){var g=t[u],v=t[l],c=t[h];var p=v*Math.sin(g);var m=v*Math.cos(g);var w=c*i,d=p*n,x=m*o;var y=(w+x)*f;var M=(2*w+3*d-x)*s;var b=(2*w-3*d-x)*s;t[u]=y;t[l]=M;t[h]=b}return t},"LinearRGB to sRGB":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=.055,n=1/2.4;for(var o=0,s=e,f=2*e;o<r;o+=a,s+=a,f+=a){var u=t[o],l=t[s],h=t[f];t[o]=u>.0031308?1.055*Math.pow(u,n)-i:u*12.92;t[s]=l>.0031308?1.055*Math.pow(l,n)-i:l*12.92;t[f]=h>.0031308?1.055*Math.pow(h,n)-i:h*12.92}return t},"sRGB to LinearRGB":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=1/12.92,n=.055,o=1/1.055;for(var s=0,f=e,u=2*e;s<r;s+=a,f+=a,u+=a){var l=t[s],h=t[f],g=t[u];t[s]=l>.04045?Math.pow((l+n)*o,2.4):l*i;t[f]=h>.04045?Math.pow((h+n)*o,2.4):h*i;t[u]=g>.04045?Math.pow((g+n)*o,2.4):g*i}return t},"RGB to CMY":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){t[i]=1-t[i];t[n]=1-t[n];t[o]=1-t[o]}return t},"CMY to RGB":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){t[i]=1-t[i];t[n]=1-t[n];t[o]=1-t[o]}return t},"RGB to Opponent":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=1/Math.sqrt(3),n=1/Math.sqrt(2),o=1/Math.sqrt(6);for(var s=0,f=e,u=2*e;s<r;s+=a,f+=a,u+=a){var l=t[s],h=t[f],g=t[u];t[s]=(l+h+g)*i;t[f]=(l-h)*n;t[u]=(l+h-2*g)*o}return t},"Opponent to RGB":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=Math.sqrt(3),n=Math.sqrt(2),o=Math.sqrt(6);var s=1/6,f=1/3;for(var u=0,l=e,h=2*e;u<r;u+=a,l+=a,h+=a){var g=t[u],v=t[l],c=t[h];var p=g*i,m=v*n,w=c*o;t[u]=(2*p+3*m+w)*s;t[l]=(2*p-3*m+w)*s;t[h]=(p-w)*f}return t},"RGB to Ohta":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=1/Math.sqrt(3),n=1/Math.sqrt(2),o=1/Math.sqrt(6);for(var s=0,f=e,u=2*e;s<r;s+=a,f+=a,u+=a){var l=t[s],h=t[f],g=t[u];t[s]=(l+h+g)*i;t[f]=(l-g)*n;t[u]=(-l+2*h-g)*o}return t},"Ohta to RGB":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=Math.sqrt(3),n=Math.sqrt(2),o=Math.sqrt(6);var s=1/6,f=1/3;for(var u=0,l=e,h=2*e;u<r;u+=a,l+=a,h+=a){var g=t[u],v=t[l],c=t[h];var p=g*i,m=v*n,w=c*o;t[l]=(p+w)*f;t[u]=(2*p+3*m-w)*s;t[h]=(2*p-3*m-w)*s}return t},"LinearRGB to rgY":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){var s=t[i],f=t[n],u=t[o];var l=s+f+u;if(l>0){var h=1/l;t[i]=s*h;t[n]=f*h;t[o]=l}else{t[i]=1/3;t[n]=1/3;t[o]=0}}return t},"rgY to LinearRGB":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){var s=t[i],f=t[n],u=t[o];t[i]=s*u;t[n]=f*u;t[o]=(1-s-f)*u}return t},getXYZTransform:function(t,e,a){e=e||[.31271,.32902,1];a=a||[.64,.33,1,.3,.6,1,.15,.06,1];var i=r["xyY to XYZ"](e);i=Matrix.toMatrix(i);var a=r["xyY to XYZ"](a,3);a=new Matrix([3,3],a);var n=Matrix.diag(a.inv().mtimes(i));var o=a.mtimes(n);return t?o.inv():o},"LinearRGB to XYZ":function(t,e,a,i,n,o){var s=r.getXYZTransform(false,n,o).getData();r.matrix(t,s,e,a,i);return t},"XYZ to LinearRGB":function(t,e,a,i,n,o){var s=r.getXYZTransform(true,n,o).getData();r.matrix(t,s,e,a,i);return t},"XYZ to Lab":function(t,r,e,a,i){e=e||1;a=a||3;r=(r||1)*a;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o;var u=(1-n-o)*s/o;var l=1/f,h=1/s,g=1/u;var v=1/3,c=16/116;for(var p=0,m=e,w=2*e;p<r;p+=a,m+=a,w+=a){var d=t[p],x=t[m],y=t[w];var M=d*l;if(M>.008856){M=Math.pow(M,v)}else{M=7.787*M+c}var b=x*h;if(b>.008856){b=Math.pow(b,v)}else{b=7.787*b+c}var D=y*g;if(D>.008856){D=Math.pow(D,v)}else{D=7.787*D+c}t[p]=116*b-16;t[m]=500*(M-b);t[w]=200*(b-D)}return t},"Lab to XYZ":function(t,r,e,a,i){e=e||1;a=a||3;r=(r||1)*a;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o;var u=(1-n-o)*s/o;var l=Math.pow(.008856,1/3),h=1/7.787;var g=1/116,v=1/500,c=1/200;var p=16/116;for(var m=0,w=e,d=2*e;m<r;m+=a,w+=a,d+=a){var x=t[m],y=t[w],M=t[d];var b=(x+16)*g;var D=b+y*v;var S=b-M*c;if(b>l){b=Math.pow(b,3)}else{b=(b-p)*h}if(D>l){D=Math.pow(D,3)}else{D=(D-p)*h}if(S>l){S=Math.pow(S,3)}else{S=(S-p)*h}t[m]=D*f;t[w]=b*s;t[d]=S*u}return t},"XYZ to Luv":function(t,r,e,a,i){e=e||1;a=a||3;r=(r||1)*a;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o;var u=(1-n-o)*s/o;var l=1/s;var h=4*f/(f+15*s+3*u);var g=9*s/(f+15*s+3*u);var v=1/3;for(var c=0,p=e,m=2*e;c<r;c+=a,p+=a,m+=a){var w=t[c],d=t[p],x=t[m];var y=d*l;if(y>.008856){y=116*Math.pow(y,v)-16}else{y*=903.3}var M=1/(w+15*d+3*x);M=isFinite(M)?M:0;var b=4*M*w;var D=9*M*d;M=13*y;t[c]=y;t[p]=M*(b-h);t[m]=M*(D-g)}return t},"Luv to XYZ":function(t,r,e,a,i){e=e||1;a=a||3;r=(r||1)*a;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o;var u=(1-n-o)*s/o;var l=4*f/(f+15*s+3*u);var h=9*s/(f+15*s+3*u);var g=Math.pow(.008856,1/3),v=1/7.787;var c=1/116,p=16/116;for(var m=0,w=e,d=2*e;m<r;m+=a,w+=a,d+=a){var x=t[m],y=t[w],M=t[d];var b=(x+16)*c;if(b>g){b=Math.pow(b,3)}else{b=(b-p)*v}var D=1/(13*x);D=isFinite(D)?D:0;var S=y*D+l;var I=M*D+h;D=b/(4*I);t[m]=9*S*D;t[w]=b;t[d]=(12-3*S-20*I)*D}return t},"Lab to Lch":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=1/(2*Math.PI);for(var n=0,o=e,s=2*e;n<r;n+=a,o+=a,s+=a){var f=t[n],u=t[o],l=t[s];var h=Math.atan2(l,u)*i;t[n]=f;t[o]=Math.sqrt(u*u+l*l);t[s]=h<0?h+1:h}return t},"Lch to Lab":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=Math.PI*2;for(var n=0,o=e,s=2*e;n<r;n+=a,o+=a,s+=a){var f=t[n],u=t[o],l=t[s];var h=l*i;var g=Math.cos(h)*u;var v=Math.sin(h)*u;t[n]=f;t[o]=g;t[s]=v}return t},"RGB to XYZ":function(t,e,a,i){r["sRGB to LinearRGB"](t,e,a,i);r["LinearRGB to XYZ"](t,e,a,i);return t},"XYZ to RGB":function(t,e,a,i){r["XYZ to LinearRGB"](t,e,a,i);r["LinearRGB to sRGB"](t,e,a,i);return t},"RGB to Lab":function(t,e,a,i,n){r["sRGB to LinearRGB"](t,e,a,i);r["LinearRGB to XYZ"](t,e,a,i,n);r["XYZ to Lab"](t,e,a,i,n);return t},"Lab to RGB":function(t,e,a,i){r["Lab to XYZ"](t,e,a,i);r["XYZ to LinearRGB"](t,e,a,i);r["LinearRGB to sRGB"](t,e,a,i);return t},"RGB to Luv":function(t,e,a,i,n){r["sRGB to LinearRGB"](t,e,a,i);r["LinearRGB to XYZ"](t,e,a,i);r["XYZ to Luv"](t,e,a,i,n);return t},"Luv to RGB":function(t,e,a,i,n){r["Luv to XYZ"](t,e,a,i,n);r["XYZ to LinearRGB"](t,e,a,i);r["LinearRGB to sRGB"](t,e,a,i);return t},"RGB to Lch":function(t,e,a,i,n){r["sRGB to LinearRGB"](t,e,a,i);r["LinearRGB to XYZ"](t,e,a,i);r["XYZ to Lab"](t,e,a,i,n);r["Lab to Lch"](t,e,a,i);return t},"Lch to RGB":function(t,e,a,i,n){r["Lch to Lab"](t,e,a,i);r["Lab to XYZ"](t,e,a,i,n);r["XYZ to LinearRGB"](t,e,a,i);r["LinearRGB to sRGB"](t,e,a,i);return t},"XYZ to xyY":function(t,r,e,a,i){e=e||1;a=a||3;r=(r||1)*a;i=i||[.31271,.32902,1];var n=i[0],o=i[1];for(var s=0,f=e,u=2*e;s<r;s+=a,f+=a,u+=a){var l=t[s],h=t[f],g=t[u];var v=1/(l+h+g);if(isFinite(v)){t[s]=l*v;t[f]=h*v;t[u]=h}else{t[s]=n;t[f]=o;t[u]=0}}return t},"xyY to XYZ":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){var s=t[i],f=t[n],u=t[o];var l=u/f;t[i]=s*l;t[n]=u;t[o]=(1-s-f)*l}return t},"XYZ to 1960 uvY":function(t,r,e,a,i){e=e||1;a=a||3;r=(r||1)*a;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o,u=(1-n-o)*s/o;var l=4*f/(f+15*s+3*u);var h=6*s/(f+15*s+3*u);for(var g=0,v=e,c=2*e;g<r;g+=a,v+=a,c+=a){var p=t[g],m=t[v],w=t[c];if(m===0){t[g]=l;t[v]=h;t[c]=0}else{var d=1/(p+15*m+3*w);t[g]=4*p*d;t[v]=6*m*d;t[c]=m}}return t},"1960 uvY to XYZ":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=6/4,n=1/3;for(var o=0,s=e,f=2*e;o<r;o+=a,s+=a,f+=a){var u=t[o],l=t[s],h=t[f];var g=1/l;var v=i*h*u*g;t[o]=v;t[s]=h;t[f]=(6*h*g-v-15*h)*n}return t},"XYZ to 1976 u'v'Y":function(t,r,e,a,i){e=e||1;a=a||3;r=(r||1)*a;i=i||[.31271,.32902,1];var n=i[0],o=i[1],s=i[2];var f=n*s/o,u=(1-n-o)*s/o;var l=4*f/(f+15*s+3*u);var h=9*s/(f+15*s+3*u);for(var g=0,v=e,c=2*e;g<r;g+=a,v+=a,c+=a){var p=t[g],m=t[v],w=t[c];if(m===0){t[g]=l;t[v]=h;t[c]=0}else{var d=1/(p+15*m+3*w);t[g]=4*p*d;t[v]=9*m*d;t[c]=m}}return t},"1976 u'v'Y to XYZ":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;var i=9/4,n=1/3;for(var o=0,s=e,f=2*e;o<r;o+=a,s+=a,f+=a){var u=t[o],l=t[s],h=t[f];var g=1/l;var v=i*h*u*g;t[o]=v;t[s]=h;t[f]=(9*h*g-v-15*h)*n}return t},"xyY to 1960 uvY":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){var s=t[i],f=t[n];var u=1/(-2*s+12*f+3);t[i]=4*s*u;t[n]=6*f*u}return t},"1960 uvY to xyY":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){var s=t[i],f=t[n];var u=1/(2*s-8*f+4);t[i]=3*s*u;t[n]=2*f*u}return t},"1976 u'v'Y to xyY":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){var s=t[i],f=t[n];var u=1/(6*s-16*f+12);t[i]=9*s*u;t[n]=4*f*u}return t},"xyY to 1976 u'v'Y":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a;for(var i=0,n=e,o=2*e;i<r;i+=a,n+=a,o+=a){var s=t[i],f=t[n];var u=1/(-2*s+12*f+3);t[i]=4*s*u;t[n]=9*f*u}return t},"1976 u'v'Y to 1960 uvY":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a+e;var i=2/3;for(var n=e;n<r;n+=a){t[n]*=i}return t},"1960 uvY to 1976 u'v'Y":function(t,r,e,a){e=e||1;a=a||3;r=(r||1)*a+e;var i=3/2;for(var n=e;n<r;n+=a){t[n]*=i}return t},"RGB to rgY":function(t,e,a,i){r["sRGB to LinearRGB"](t,e,a,i);r["LinearRGB to rgY"](t,e,a,i);return t},"rgY to RGB":function(t,e,a,i){r["rgY to LinearRGB"](t,e,a,i);r["LinearRGB to sRGB"](t,e,a,i);return t},"rgY to xyY":function(t,e,a,i){r["rgY to LinearRGB"](t,e,a,i);r["LinearRGB to XYZ"](t,e,a,i);r["XYZ to xyY"](t,e,a,i);return t},"xyY to rgY":function(t,e,a,i){r["xyY to XYZ"](t,e,a,i);r["XYZ to LinearRGB"](t,e,a,i);r["LinearRGB to rgY"](t,e,a,i);return t},"RGB to xyY":function(t,e,a,i){r["sRGB to LinearRGB"](t,e,a,i);r["LinearRGB to XYZ"](t,e,a,i);r["XYZ to xyY"](t,e,a,i);return t},"xyY to RGB":function(t,e,a,i){r["xyY to XYZ"](t,e,a,i);r["XYZ to LinearRGB"](t,e,a,i);r["LinearRGB to sRGB"](t,e,a,i);return t},"RGB to 1960 uvY":function(t,e,a,i){r["sRGB to LinearRGB"](t,e,a,i);r["LinearRGB to XYZ"](t,e,a,i);r["XYZ to xyY"](t,e,a,i);r["xyY to 1960 uvY"](t,e,a,i);return t},"1960 uvY to RGB":function(t,e,a,i){r["1960 uvY to xyY"](t,e,a,i);r["xyY to XYZ"](t,e,a,i);r["XYZ to LinearRGB"](t,e,a,i);r["LinearRGB to sRGB"](t,e,a,i);return t},"RGB to 1976 u'v'Y":function(t,e,a,i){r["sRGB to LinearRGB"](t,e,a,i);r["LinearRGB to XYZ"](t,e,a,i);r["XYZ to 1976 u'v'Y"](t,e,a,i);return t},"1976 u'v'Y to RGB":function(t,e,a,i){r["1976 u'v'Y to XYZ"](t,e,a,i);r["XYZ to LinearRGB"](t,e,a,i);r["LinearRGB to sRGB"](t,e,a,i);return t}};t.Colorspaces=r})(Matrix);(function(t,r){"use strict";var e={lab2lch:"Lab to Lch",lab2srgb:"Lab to RGB",lab2xyz:"Lab to XYZ",lch2lab:"Lch to Lab",srgb2cmyk:"RGB to CMY",srgb2lab:"RGB to Lab",srgb2xyz:"RGB to XYZ",upvpl2xyz:"1976 u'v'Y to XYZ",uvl2xyz:"1960 uvY to XYZ",xyl2xyz:"xyY to XYZ",xyz2lab:"XYZ to Lab",xyz2srgb:"XYZ to RGB",xyz2upvpl:"XYZ to 1976 u'v'",xyz2uvl:"XYZ to 1960 uv",xyz2xyl:"XYZ to xyY"};r.applycform=function(r){if(this.ndims()!==3||this.getSize(2)<3){throw new Error("Matrix.applycform: Matrix must be an "+"image with RGB components.")}var a=this.getSize(0)*this.getSize(1);if(typeof r==="string"){if(t.Colorspaces[r]){t.Colorspaces[r](this.getData(),a,a,1)}else if(t.Colorspaces[e[r]]){t.Colorspaces[e[r]](this.getData(),a,a,1)}else{throw new Error("Matrix.applycform: Unknown color transformation "+r)}}else if(typeof r==="function"){if(r.length===3){t.Colorspaces.applyFunctionRGB(this.getData(),r,a,a,1)}else if(r.length===1){t.Colorspaces.applyFunctionColor(this.getData(),r,a,a,1)}}else{r=t.toMatrix(r);if(!Tools.checkSizeEquals(r.size(),[3,3],t.ignoreTrailingDims)){throw new Error("Matrix.applycform: Matrix argument must be 3x3.")}t.Colorspaces.matrix(this.getData(),r.getData(),a,a,1)}return this};t.applycform=function(t,r){return t.getCopy().applycform(r)};r.toColormap=function(r){var e=this.getData(),a=this.getSize(),i=e.length;a[2]=3;var n=new t(a),o=n.getData();var s=o.subarray(0,i),f=o.subarray(i,2*i),u=o.subarray(2*i,3*i);var l,h,g=Math.floor;if(r==="JET"){for(l=0;l<i;l++){h=e[l]*4;if(h>=4){h=3.99}else if(h<0){h=0}switch(g(h*2)%8){case 0:s[l]=0;f[l]=0;u[l]=h+.5;break;case 1:case 2:s[l]=0;u[l]=1;f[l]=h-.5;break;case 3:case 4:s[l]=h-1.5;f[l]=1;u[l]=2.5-h;break;case 5:case 6:s[l]=1;f[l]=3.5-h;u[l]=0;break;case 7:s[l]=4.5-h;f[l]=0;u[l]=0;break}}}else if(r==="HUE"){for(l=0;l<i;l++){var v=e[l];h=g(v*6)%6;var c=v*6-h;switch(h){case 0:s[l]=1;f[l]=c;u[l]=0;break;case 1:s[l]=1-c;f[l]=1;u[l]=0;break;case 2:s[l]=0;f[l]=1;u[l]=c;break;case 3:s[l]=0;f[l]=1-c;u[l]=1;break;case 4:s[l]=c;f[l]=0;u[l]=1;break;case 5:s[l]=1;f[l]=0;u[l]=1-c;break}}}else if(r==="HUE"){o.set(e)}return n};r.correctImage=function(r,e){e=e||t.CIE.getIlluminant("D65");var a=t.CIE.getIlluminantConversionMatrix(e,r);this.applycform("sRGB to LinearRGB").applycform(a).applycform("LinearRGB to sRGB");return this};t.correctImage=function(t,r,e){return t.getCopy().correctImage(r,e)};r.im2CCT=function(){var r=t.CIE["xyY to CCT"];var e=this.getSize();e.pop();var a=new t(e,"single");var i=this.getData(),n=a.getData();var o=this.getView();var s=o.getStep(0),f=o.getEnd(0),u;var l=o.getStep(1),h=o.getEnd(1),g;var v=o.getStep(2);var c,p,m,w,d,x=[];for(c=0,g=h;c!==g;c+=l){p=c;m=c+v;w=c+2*v;for(u=c+f;p!==u;p+=s,m+=s,w+=s){x[0]=i[p];x[1]=i[m];x[2]=i[w];d=r(x);d=d<1668?1668:d>2e4?2e4:d;d=isNaN(d)?24999:d;n[p]=d}}return a};r.CCT2im=function(){var r=t.CIE["CCT to xyY"];var e=this.getSize();e[2]=3;var a=new t(e,"single");var i=this.getData(),n=a.getData();var o=a.getView();var s=o.getStep(0),f=o.getEnd(0),u;var l=o.getStep(1),h=o.getEnd(1),g;var v=o.getStep(2);var c,p,m,w,d=[];for(c=0,g=h;c!==g;c+=l){p=c;m=c+v;w=c+2*v;for(u=c+f;p!==u;p+=s,m+=s,w+=s){d=r(i[p]);n[p]=d[0];n[m]=d[1];n[w]=d[2]}}return a}})(Matrix,Matrix.prototype);(function(t){"use strict";var r=function(t,r){if(!Tools.isInteger(r)||!Tools.isInRange(r,0,2)){throw new Error("Matrix.calerf: Invalid argument.")}var e=3.97886080735226;var a=.2753747415973768;var i=.49016508058531844;var n=.7743681991195386;var o=1.0792551515585667;var s=1.313146538310231;var f=1.3704021768233816;var u=1.1890298290927332;var l=.8052764087529106;var h=.35752427444953105;var g=.016620792496936737;var v=-.11946395996432542;var c=-.0838864557023002;var p=.002493672000535033;var m=.039097684558848406;var w=.016131532973325226;var d=-.013382364453346007;var x=-.012722381378212275;var y=.003833351262648873;var M=.007736725283135267;var b=-.0008707796353172959;var D=-.003963850973605135;var S=.00011931402283834095;var I=.0012710976495261409;var E=new Float64Array([5.958930743e-11,-1.13739022964e-9,1.466005199839e-8,-1.635035446196e-7,16461004480962e-19,-1492559551950604e-20,.00012055331122299264,-.0008548326981129666,.005223977624823223,-.026866170645077334,.11283791670954882,-.3761263890318375,1.1283791670955126,2.372510631e-11,-4.5493253732e-10,5.90362766598e-9,-6.642090827576e-8,6.7595634268133e-7,-621188515924e-17,510388300970969e-19,-.00037015410692956176,.00233307631218881,-.012549884771821921,.05657061146827042,-.21379664776456006,.8427007929497149,9.49905026e-12,-1.8310229805e-10,2.39463074e-9,-2.721444369609e-8,2.8045522331686e-7,-261830022482897e-20,2195455056768781e-20,-.00016358986921372656,.0010705215356411031,-.006082847181135901,.029869784652462584,-.13055593046562267,.674933236039655,3.82722073e-12,-7.421598602e-11,9.793057408e-10,-1.126008898854e-8,1.1775134830784e-7,-11199275838265e-19,962023443095201e-20,-7404402135070773e-20,.0005068999365414488,-.003075530514392729,.016689778925531657,-.08548534594781312,.5690907664239364,1.55296588e-12,-3.032205868e-11,4.0424830707e-10,-4.71135111493e-9,5.011915876293e-8,-4.8722516178974e-7,430683284629395e-20,-3445026145385764e-20,.00024879276133931664,-.0016294094174807928,.009887863739323505,-.05962426839442304,.49766113250947636]);var z=new Float64Array([-2.9734388465e-10,2.69776334046e-9,-6.40788827665e-9,-1.6678201321e-8,-2.1854388148686e-7,266246030457984e-20,1612722157047886e-20,-.00025616361025506627,.00015380842432375364,.00815533022524928,-.014022836638963193,-.19746892495383023,.7151172032884284,-1.951073787e-11,-3.2302692214e-10,5.22461866919e-9,3.42940918551e-9,-3.5772874310272e-7,1.9999935792654e-7,2687044575042908e-20,-.00011843240273775776,-.0008099172895603227,.006610629705022412,.009095309223548273,-.20160072778491014,.5116969671872764,3.147682272e-11,-4.8465972408e-10,6.3675740242e-10,3.377623323271e-8,-1.5451139637086e-7,-203340624738438e-20,1947204525295057e-20,2854147231653228e-20,-.0010156506315220028,.0027118700352009566,.023280950354228107,-.16725021123116876,.32490054966649434,2.31936337e-11,-6.303206648e-11,-2.64888267434e-9,2.050708040581e-8,1.1371857327578e-7,-211211337219663e-20,368797328322935e-20,9823686253424796e-20,-.0006586024399045536,-.0007528581489523087,.025854344242029606,-.11637092784486193,.1826733677529661,-3.67789363e-12,2.0876046746e-10,-1.93319027226e-9,-4.35953392472e-9,1.8006992266137e-7,-7.8441223763969e-7,-675407647949153e-20,8428418334440096e-20,-.00017604388937031816,-.002397296114350716,.02064129023876023,-.06905562880005864,.09084526782065479]);var L=t.getCopy();var R=L.getData(),T,A;var k,C,V,B,Y;var G=Math.abs,F=Math.floor,q=Math.exp;if(r===0){for(T=0,A=L.getLength();T<A;T++){k=G(R[T]);if(k<2.2){C=k*k;V=F(C);C=C-V;V=V*13;B=((((((((((((E[V]*C+E[V+1])*C+E[V+2])*C+E[V+3])*C+E[V+4])*C+E[V+5])*C+E[V+6])*C+E[V+7])*C+E[V+8])*C+E[V+9])*C+E[V+10])*C+E[V+11])*C+E[V+12])*k}else if(k<6.9){V=F(k);C=k-V;V=13*(V-2);B=(((((((((((z[V]*C+z[V+1])*C+z[V+2])*C+z[V+3])*C+z[V+4])*C+z[V+5])*C+z[V+6])*C+z[V+7])*C+z[V+8])*C+z[V+9])*C+z[V+10])*C+z[V+11])*C+z[V+12];B=B*B;B=B*B;B=B*B;B=1-B*B}else{B=1}if(R[T]<0){B=-B}R[T]=B}}else if(r===1){for(T=0,A=L.getLength();T<A;T++){C=e/(e+G(R[T]));Y=C-.5;B=(((((((((I*Y+S)*Y+D)*Y+b)*Y+M)*Y+y)*Y+x)*Y+d)*Y+w)*Y+m)*Y+p;B=((((((((((((B*Y+c)*Y+v)*Y+g)*Y+h)*Y+l)*Y+u)*Y+f)*Y+s)*Y+o)*Y+n)*Y+i)*Y+a)*C*q(-R[T]*R[T]);if(R[T]<0){B=2-B}R[T]=B}}else if(r===2){for(T=0,A=L.getLength();T<A;T++){C=e/(e+G(R[T]));Y=C-.5;B=(((((((((I*Y+S)*Y+D)*Y+b)*Y+M)*Y+y)*Y+x)*Y+d)*Y+w)*Y+m)*Y+p;B=((((((((((((B*Y+c)*Y+v)*Y+g)*Y+h)*Y+l)*Y+u)*Y+f)*Y+s)*Y+o)*Y+n)*Y+i)*Y+a)*C*q(-R[T]*R[T]);if(R[T]<0){B=2-B}R[T]=q(R[T]*R[T])*B}}return L};t.erf=function(){return r(this,0)};t.erfc=function(){return r(this,1)};t.erfcx=function(){return r(this,2)};(function(t){var r=171.624;var e=new Float64Array([-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054]),a=new Float64Array([-30.840230011973897,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.25967555349]),i=new Float64Array([-.001910444077728,.00084171387781295,-.0005952379913043012,.0007936507935003503,-.0027777777777776816,.08333333333333333,.0057083835261]);var n=function(t){return t>0?Math.floor(t):Math.ceil(t)};t.gamma=function(){if(!this.isreal()){throw"Matrix.gamma: Do not work on complex numbers."}var t=Number.POSITIVE_INFINITY,o=.9189385332046728,s=2.22507e-308,f=2.220446049250313e-16;var u,l,h,g,v,c,p,m,w;var d=this.getData(),x,y;for(x=0,y=d.length;x<y;x++){u=d[x];var M=0,b=1,D=0,S=u;if(S<=0){S=-u;c=n(S);p=S-c;if(p!==0){if(c!==n(c*.5)*2){M=1}b=-Math.PI/Math.sin(Math.PI*p);S+=1}else{d[x]=t;continue}}if(S<f){if(S>=s){p=1/S}else{d[x]=t;continue}}else if(S<12){c=S;if(S<1){v=S;S+=1}else{D=parseInt(S,10)-1;S-=parseFloat(D);v=S-1}g=0;h=1;for(l=0;l<8;++l){g=(g+e[l])*v;h=h*v+a[l]}p=g/h+1;if(c<S){p/=c}else if(c>S){for(l=0;l<D;++l){p*=S;S+=1}}}else{if(S<=r){w=S*S;m=i[6];for(l=0;l<6;l++){m=m/w+i[l]}m=m/S-S+o;m+=(S-.5)*Math.log(S);p=Math.exp(m)}else{d[x]=t;continue}}if(M){p=-p}if(b!==1){p=b/p}d[x]=p}return this}})(t)})(Matrix.prototype);(function(t,r){"use strict";var e=typeof module!=="undefined"&&module.exports?true:false;var a,i,n;if(e){a=require("fs");i=require("canvas");n=i.Image}else{n=Image}var o=function(t,r){var a;if(e){a=new i}else{a=document.createElement("canvas")}a.width=t||0;a.height=r||0;return a};r.convertImage=function(r){var e=new t(this.getSize(),r);var a,i;if(this.isfloat()||this.islogical()){a=[0,1]}else if(this.isinteger()){a=[t.intmin(this.type()),t.intmax(this.type())]}var n=a[0],o=1/(a[1]-a[0]);if(e.isfloat()||this.islogical()){i=[0,1]}else if(e.isinteger()){i=[t.intmin(e.type()),t.intmax(e.type())]}var s=i[0],f=o*(i[1]-i[0]);var u=this.getData(),l=new e.getData;var h,g;for(h=0,g=u.length;h<g;h++){l[h]=(u[h]-n)*f-s}return new t(this.getSize(),l)};r.im2double=function(){return this.convertImage("double")};r.im2single=function(){return this.convertImage("single")};r.im2uint8=function(){return this.convertImage("uint8")};r.im2uint8c=function(){return this.convertImage("uint8c")
};r.getImageData=function(){var r;if(this.isfloat()||this.islogical()){r=[0,1]}else if(this.isinteger()){r=[t.intmin(this.type()),t.intmax(this.type())]}var e=r[0],a=255/(r[1]-r[0]);var i=this.getSize(1),n=this.getSize(0);var s=o().getContext("2d").createImageData(i,n);var f=n*i,u;var l=this.getData(),h=s.data;var g,v,c,p,m,w,d;switch(this.getSize(2)){case 1:for(v=0,g=0;v<n;v++){for(c=v,u=v+f;c<u;c+=n){d=(l[c]-e)*a;h[g++]=d;h[g++]=d;h[g++]=d;h[g++]=255}}break;case 2:for(v=0,g=0;v<n;v++){for(c=v,p=v+f,u=v+f;c<u;c+=n,p+=n){d=(l[c]-e)*a;h[g++]=d;h[g++]=d;h[g++]=d;h[g++]=(l[p]-e)*a}}break;case 3:for(v=0,g=0;v<n;v++){for(c=v,p=v+f,m=v+2*f,u=p;c<u;c+=n,p+=n,m+=n){h[g++]=(l[c]-e)*a;h[g++]=(l[p]-e)*a;h[g++]=(l[m]-e)*a;h[g++]=255}}break;case 4:for(v=0,g=0;v<n;v++){for(c=v,p=c+f,m=p+f,w=m+f,u=p;c<u;c+=n,p+=n,m+=n,w+=n){h[g++]=(l[c]-e)*a;h[g++]=(l[p]-e)*a;h[g++]=(l[m]-e)*a;h[g++]=(l[w]-e)*a}}break}return s};r.toImage=function(t){if(e){throw new Error("Matrix.toImage: Canvas doesn't exist.")}var r=o(this.getSize(1),this.getSize(0));var a=this.getImageData();r.getContext("2d").putImageData(a,0,0);var i=new Image;i.src=r.toDataURL();i.onload=t;return i};if(e){t.prototype.imwrite=function(t,r){var e=o(this.getSize(1),this.getSize(0));e.getContext("2d").putImageData(this.getImageData(),0,0);var i=a.createWriteStream(t),n;if(/\.(png)$/i.test(t.toLowerCase())){n=e.pngStream()}else if(/\.(jpeg|jpg)$/i.test(t.toLowerCase())){n=e.jpegStream()}else{throw new Error("Matrix.imwrite: invalid file extension.")}n.on("data",function(t){i.write(t)});if(r){n.on("end",r.bind(this))}}}t.fspecial=function(r,e,a){var i,n,o,s;var f,u,l,h,g,v,c,p;var m,w,d;var x=function(t,r){return Math.exp(-(t*t+r*r)/(2*s*s))};switch(r.toLowerCase()){case"average":if(Tools.isArrayLike(e)){o=e[0];n=e[1]}else{o=e===undefined?3:e;n=o}return t.ones([o,n])["./"](o*n);case"disk":break;case"gaussian":if(Tools.isArrayLike(e)){o=e[0];n=e[1]}else{o=e===undefined?3:e;n=o}s=a===undefined?.5:a;f=[];p=0;for(h=0,u=-(n-1)/2,v=n*o;h<v;h+=o,u++){for(g=h,c=h+o,l=-(o-1)/2;g<c;g++,l++){m=x(u,l);f[g]=m;p+=m}}for(w=0,d=f.length;w<d;w++){f[w]/=p}return new t([o,n],f);case"laplacian":i=e===undefined?.2:e;return new t([3,3],[i/4,(1-i)/4,i/4,(1-i)/4,-1,(1-i)/4,i/4,(1-i)/4,i/4])[".*"](4/(i+1));case"log":if(Tools.isArrayLike(e)){o=e[0];n=e[1]}else{o=e===undefined?3:e;n=o}s=a===undefined?.5:a;f=[];p=0;for(h=0,u=-(n-1)/2,v=n*o;h<v;h+=o,u++){for(g=h,c=h+o,l=-(o-1)/2;g<c;g++,l++){m=x(u,l);f[g]=(u*u+l*l-2*s*s)*m/Math.pow(s,4);p+=m}}for(w=0,d=f.length;w<d;w++){f[w]/=p}p=0;for(w=0,d=f.length;w<d;w++){p+=f[w]}p/=n*o;for(w=0,d=f.length;w<d;w++){f[w]-=p}return new t([o,n],f);case"unsharp":i=e===undefined?.2:e;return new t([3,3],[-i,i-1,-i,i-1,i+5,i-1,-i,i-1,-i])[".*"](1/(i+1));case"prewitt":return new t([3,3],[1,0,-1,1,0,-1,1,0,-1]);case"sobel":return new t([3,3],[1,0,-1,2,0,-2,1,0,-1]);default:return}};r.filter1d=function(r,e){var a=this.constructor.name+".filter1d: ";if(e===undefined){e="C"}if(!r.isvector()){throw new Error("Matrix.filter1d: Kernel must be a vector")}var i=r.getLength(),n=r.getData();if(typeof e==="string"){switch(e.toUpperCase()){case"C":case"CL":e=Math.floor((i-1)/2);break;case"CR":e=Math.ceil((i-1)/2);break;case"L":e=0;break;case"R":e=i-1;break;default:throw new Error(a+"unknown origin position '"+e+"'")}}else if(typeof e==="number"){if(e<0){e+=i}if(e<0||e>=i){throw new Error(a+"origin value must satisfy : |origin| < kernel.length")}}var o=new t(this.getSize(),this.getDataType());var s=this.getData(),f=o.getData();var u=o.getView();var l=u.getStep(2),h=u.getEnd(2);var g=u.getStep(1),v=u.getEnd(1);var c=u.getEnd(0);if(e>=c/2){throw new Error("Matrix.filter1d: Kernel is too large.")}var p,m=c-e;var w,d,x,y,M,b,D;for(w=0;w!==h;w+=l){for(d=w,x=w+v;d!==x;d+=g){for(y=d,M=d+e;y<M;y++){for(p=0,D=0,b=2*d+e-y;b>d;D++,b--){p+=n[D]*s[b]}for(b=d;D<i;D++,b++){p+=n[D]*s[b]}f[y]=p}for(y=d+e,M=d+m;y<M;y++){for(p=0,D=0,b=y-e;D<i;D++,b++){p+=n[D]*s[b]}f[y]=p}for(y=d+m,M=d+c;y<M;y++){for(p=0,D=0,b=y-e;b<M;D++,b++){p+=n[D]*s[b]}for(b=M-2;D<i;D++,b--){p+=n[D]*s[b]}f[y]=p}}}return o};r.separableFilter=function(t,r){if(r===undefined){r=t}return this.filter1d(t).permute([1,0,2]).filter1d(r).permute([1,0,2])};r.gaussian=function(t,r,e){e=e||3;var a=f.gaussian(t,0,e);var i;if(typeof r==="number"){i=f.gaussian(r,0,e)}else{i=a}return this.separableFilter(a,i)};r.gaussianGradient=function(r){if(!r){r=2}var e=f.gaussian(r,1,3);var a=f.gaussian(r,0,3);var i=this.separableFilter(a,e);var n=this.separableFilter(e,a);var o=.5/Math.PI;var s=t.zeros(this.getSize()),u=t.zeros(this.getSize());var l=i.getData(),h=n.getData();var g=s.getData(),v=u.getData();var c,p;for(c=0,p=l.length;c<p;c++){var m=l[c],w=h[c];g[c]=Math.sqrt(m*m+w*w);var d=Math.atan2(w,m)*o;v[c]=d<0?d+1:d}return{x:i,y:n,norm:s,phase:u}};r.gradient=function(r,e,a,i,n){var o=.70710678,s=6.8284271,f=.35355339;var u=.29289322,l=1/s,h=.5/Math.PI;var g={},v,c,p,m,w;var d=this.getSize();var x=this.getDataType();if(r){g.x=new t(d,x);v=g.x.getData()}if(e){g.y=new t(d,x);c=g.y.getData()}if(a){g.norm=new t(d,x);p=g.norm.getData()}if(i){g.phase=new t(d,x);m=g.phase.getData()}if(n){g.laplacian=new t(d,x);w=g.laplacian.getData()}var y=this.getData();var M=this.getView();var b=M.getStep(2),D=M.getEnd(2);var S=M.getStep(1),I=M.getEnd(1);var E=M.getEnd(0);var z,L,R,T,A,k,C;for(z=0;z!==D;z+=b){for(L=z+S,R=z+I-S;L!==R;L+=S){for(k=L-S,T=L,C=L+S,A=L+E-2;T<A;T){var V=y[k],B=y[++k],Y=y[k+1];var G=y[T],F=y[++T],q=y[T+1];var _=y[C],H=y[++C],X=y[C+1];var Z=X-V,U=Y-_;var O=u*(H-B+f*(Z-U));var N=u*(G-q-f*(Z+U));if(r){v[T]=O}if(e){c[T]=N}if(a){p[T]=Math.sqrt(O*O+N*N)}if(i){var P=Math.atan2(-N,O)*h;m[T]=P<0?P+1:P}if(n){w[T]=(o*(V+Y+_+X)+(G+B+H+q))*l-F}}}}return g};r.conv=function(r,e){if(!this.isvector()||!r.isvector()){throw new Error("Matrix.conv: Input must be vector.")}var a=this.getData(),i=a.length;var n=r.getData(),o=n.length;if(i<o){return r.conv(this,e)}var s=Tools.checkType(this.getDataType());var f=new s(i+o-1),u=f.length;var l,h,g,v,c,p,m;for(c=0,p=o-1;c<p;c++){for(m=0,h=0,g=c+1,v=c;h<g;h++,v--){m+=a[h]*n[v]}f[c]=m}for(c=o-1,l=0,p=i;c<p;c++,l++){for(m=0,h=l,g=c+1,v=o-1;h<g;h++,v--){m+=a[h]*n[v]}f[c]=m}for(c=i,l=i-o+1;c<u;c++,l++){for(m=0,h=l,v=o-1;h<i;h++,v--){m+=a[h]*n[v]}f[c]=m}switch(e){case undefined:case"full":return new t(u,f);case"same":var w=Math.ceil(o/2);return new t(i,f.subarray(w,w+i));case"valid":return new t(i-o+1,f.subarray(o-1,i));default:throw new Error("Matrix.conv: Invalid shape parameter.")}};var s=function(t){var r=t.getView(),e=t.getData();var a=r.getStep(2),i=r.getEnd(2);var n=r.getStep(1),o=r.getEnd(1),s;var f=r.getEnd(0),u;var l,h,g;for(l=0;l<i;l+=a){for(h=l+1,u=l+f;h<u;h++){e[h]+=e[h-1]}for(g=l+n,s=l+o;g<s;g+=n){var v=e[g];e[g]+=e[g-n];for(h=g+1,u=g+f;h<u;h++){v+=e[h];e[h]=e[h-n]+v}}}};r.fastBlur=function(r,e,a){a=a||3;e=e||r;var i=Math.round(Math.sqrt(12/a*r*r+1)/2)*2+1;var n=Math.round(Math.sqrt(12/a*e*e+1)/2)*2+1;var o=t.zeros(this.getSize());var f=this.getView();var u=f.getStep(2),l=f.getEnd(2);var h=f.getStep(1),g=f.getEnd(1);var v=f.getEnd(0);e=n/2|0;r=(i/2|0)*h;var c=i/2|0;var p,m,w,d,x,y,M;var b,D,S;var I=this.im2double();for(var E=0;E<a;E++){s(I);var z=I.getData(),L=o.getData();var R=r+e+h+1,T=r+e,A=-(r+h)+e,k=r-e-1;var C=z.subarray(T),V=z.subarray(k);for(w=0;w<l;w+=u){for(y=w,x=0,m=w+e+1;y<m;y++,x++){D=x+e+1;for(M=y,d=0,p=y+r+h;M<p;M+=h,d++){L[M]=C[M]/((d+c+1)*D)}b=1/(i*D);for(M=y+r+h,p=y+g-r;M<p;M+=h){L[M]=(C[M]-z[M+A])*b}S=z[y+g-h+e];for(M=y+g-r,p=y+g;M<p;M+=h){L[M]=S-z[M+A];L[M]/=(r+p-M)/h*D}}for(d=w,p=w+r+h;d<p;d+=h){b=1/(((d-w+r)/h+1)*n);for(x=d+e+1,m=d+v-e;x<m;x++){L[x]=C[x]-V[x];L[x]*=b}}b=1/(i*n);for(d=w+r+h,p=w+g-r;d<p;d+=h){for(x=d+e+1,m=d+v-e;x<m;x++){L[x]=(z[x-R]+C[x]-z[x+A]-V[x])*b}}for(d=w+g-r,p=w+g;d<p;d+=h){b=1/((w+g-d+r)/h*n);for(x=d+e+1,m=d+v-e;x<m;x++){L[x]=z[x-R]+z[w+g-h+x-d+e]-z[w+g-h+x-d-e-1]-z[x+A];L[x]*=b}}for(x=w+v-e,m=w+v;x<m;x++){for(d=x,p=x+r+h;d<p;d+=h){L[d]=z[d-x+w+v-1+r]-V[d];L[d]/=((d-x+r)/h+1)*(e+(v-(x-w)))}b=1/(i*(e+(v-(x-w))));for(d=x+r+h,p=x+g-r;d<p;d+=h){L[d]=z[d-x+w+v-1+r]-z[d-x+w+v-1-r-h]+z[d-R]-V[d];L[d]*=b}for(d=x+g-r,p=x+g;d<p;d+=h){L[d]=z[w+g-h+v-1]+z[d-R]-z[w+d-x+v-1-r-h]-z[w+g-h+x-w-e-1];L[d]/=(g-(d-x)+r)/h*(e+(v-(x-w)))}}}var B=o;o=I;I=B}return B};var f={};f.normalize=function(t){var r;var e=t.length;var a=0;for(r=0;r<e;r++){a+=Math.abs(t[r])}if(a!==0){for(r=0;r<e;r++){t[r]/=a}}return t};f.gaussian=function(r,e,a){var i,n;if(a===undefined){a=3}if(e===undefined){e=0}var o=1+2*Math.ceil(r*Math.sqrt(a*2*Math.log(10)));var s=new t.dataType(o);var f=(o-1)/2;var u=0,l=Math.abs;for(i=0;i<(o+1)/2;i++){n=i-f;var h=1/(Math.sqrt(2*Math.PI)*r);h*=Math.exp(-(n*n)/(2*r*r));s[i]=s[o-1-i]=h}switch(e){case 0:for(i=0,u=0;i<s.length;i++){u+=l(s[i])}break;case 1:for(i=0,u=0;i<s.length;i++){n=i-f;s[i]*=-n/Math.pow(r,2);u+=l(n*s[i])}break;case 2:for(i=0,u=0;i<s.length;i++){n=i-f;s[i]*=n*n/Math.pow(r,4)-1/Math.pow(r,2);u+=l(s[i])}u/=s.length;for(i=0;i<s.length;i++){s[i]-=l(u)}for(i=0,u=0;i<s.length;i++){n=i-f;u+=l(.5*n*n*s[i])}break;default:throw new Error("Kernel.gaussian: Derive order can be 0,1 or 2 but not "+e)}if(u!==0){for(i=0;i<s.length;i++){s[i]/=u}}return new t(s.length,s)};r.imshow=function(t,r){if(e){console.warn("Matrix.imshow: function not available in nodejs.");return}var a=this.constructor.name+".imshow: ";var i=this.getSize(1);var n=this.getSize(0);if(typeof t==="string"&&document.getElementById(t)){t=document.getElementById(t)}var o;if(t===undefined||t===null){t=document.createElement("canvas");o=window.open("","","width="+i,"height="+n);o.document.body.appendChild(t)}if(!(t instanceof HTMLCanvasElement)){throw new Error(a+"Invalid canvas.")}var s=this.getImageData();if(r===undefined||r===1){t.width=i;t.height=n;t.getContext("2d").putImageData(s,0,0)}else{if(r==="fit"){var f=t.width/i;var u=t.height/n;r=Math.min(f,u);r=r>1?1:r}else if(typeof r!=="number"){throw new Error(a+"scale must be a number or 'fit'")}t.width=Math.round(i*r);t.height=Math.round(n*r);var l=document.createElement("canvas");l.width=i;l.height=n;var h=l.getContext("2d");h.putImageData(s,0,0);t.getContext("2d").drawImage(l,0,0,i,n,0,0,t.width,t.height)}return o||this};r.print=function(){var t=this.imshow();t.print();t.close();return this};r.imagesc=function(t,r){var e=this.min().getDataScalar(),a=this.max().getDataScalar();if(e-a===0){return this["-"](e).imshow(t,r)}return this["-"](e)["./"](a-e).imshow(t,r)};r.imtransform=function(r){r=t.toMatrix(r);var e=this.getSize(0),a=this.getSize(1);var i=o(a,e),n=i.getContext("2d");var s=o(),f=s.getContext("2d");var u=t.toMatrix([0,0,1,a,0,1,a,e,1,0,e,1]).reshape([3,4]);var l=r.mtimes(u).transpose();var h=l.max(0).getData(),g=l.min(0).getData();var v=this.getImageData();n.putImageData(v,0,0);var c=r.getData();s.width=h[0]-g[0];s.height=h[1]-g[1];f.translate(-g[0],-g[1]);f.transform(c[0],c[1],c[3],c[4],c[6],c[7]);f.drawImage(i,0,0);return t.imread(s).convertImage(this.type())};r.imhist=function(r){if(!this.ismatrix()){throw new Error("Matrix.imhist: This function only works on grey-level images.")}r=r||256;var e=this.getData();var a=t.zeros(r,1),i=a.getData();var n;if(this.isinteger()){n=t.intmax(this.type())}else if(this.islogical()){n=1;r=2}else if(this.isfloat()){n=1}else{throw new Error("Matrix.imhist: unknow data type.")}var o,s,f=1/n*r;for(o=0,s=e.length;o<s;o++){i[e[o]*f|0]++}return a};(function(){var e=function(t,r){var e=t.length;var a=new Float32Array(r);var i,n=Math.floor;for(i=0;i<e;++i){var o=n(t[i]*r);o=o>=r?r-1:o;++a[o]}var s=1/e;for(i=1;i<r;++i){a[i]+=a[i-1];a[i-1]*=s}a[i-1]*=s;return a};r.histeq=function(r){var a=this.im2double();var i=a;if(this.getSize(2)>1){i=a.applycform("RGB to HSL").get([],[],2)}i=i.getData();var n=e(i,r);var o=Math.floor;for(var s=0;s<i.length;++s){i[s]=n[o(i[s]*(r-1))]}var f=new t([a.size(0),a.size(1)],i);a.set([],[],2,f);if(this.getSize(2)>1){a.applycform("HSL to RGB")}return a}})();r.rgb2gray=function(){if(this.ndims()!==3||this.getSize(2)<3){throw new Error("Matrix.rgb2gray: Matrix must be an "+"image with RGB components.")}var r=this.getSize();r[2]-=2;var e=new t(r,this.getDataType());var a=this.getData(),i=e.getData();var n=this.getView();var o=n.getEnd(0),s;var f=n.getStep(1),u=n.getEnd(1),l;var h=n.getStep(2);var g,v,c,p;for(g=0,l=u;g!==l;g+=f){v=g;c=g+h;p=g+2*h;for(s=g+o;v<s;v++,c++,p++){i[v]=.3*a[v]+.59*a[c]+.11*a[p]}}if(this.getSize(2)===4){var m=i.subarray(h);var w=a.subarray(3*h);m.set(w)}return e}})(Matrix,Matrix.prototype);(function(){var t=function(t,r,e){this.x=t;this.y=r;this.parent=e};t.prototype.initChildren=function(r,e){var a=this.x,i=this.y;if(i+1<e){this.top=new t(a,i+1,this)}if(i-1>=0){this.bottom=new t(a,i-1,this)}if(a+1<r){this.left=new t(a+1,i,this)}if(a-1>=0){this.right=new t(a-1,i,this)}};t.prototype.remove=function(t){if(this.bottom===t){this.bottom=undefined}else if(this.top===t){this.top=undefined}else if(this.right===t){this.right=undefined}else if(this.left===t){this.left=undefined}return this};t.prototype.getNext=function(){if(this.top){return this.top}if(this.bottom){return this.bottom}if(this.left){return this.left}if(this.right){return this.right}if(this.parent){return this.parent.remove(this).getNext()}return undefined};Matrix.prototype.getConnectedComponent=function(r,e,a){var i=this.getSize(0),n=this.getSize(1),o=this.getSize(2);var s=a*a;var f=new Matrix([i,n],"logical"),u=new Matrix([i,n],"logical");var l=f.getData(),h=this.getData(),g=u.getData();window.CC=f;window.IV=u;var v=e+i*r;var c;if(o===1){if(this.type()==="logical"){}else{var p=h[v];c=function(t){var r=h[t]-p;return r*r<s}}}else if(o===3){var m=h[v],w=h[v+i*n],d=h[v+i*n*2];var x=h,y=h.subarray(i*n),M=h.subarray(i*n*2);c=function(t){var r=x[t]-m,e=y[t]-w,a=M[t]-d;return r*r+e*e+a*a<s}}else{throw new Error("Matrix.getConnectedComponent: This function only support "+"images with depth 1 or 3.")}var b=new t(r,e),D=b;while(D!==undefined){var S=D.x,I=D.y,E=I+i*S;if(g[E]===1){D=D.parent.remove(D).getNext();continue}g[E]=1;if(c(E)){l[E]=1;D.initChildren(n,i)}D=D.getNext()}return f};Matrix.prototype.bwconncomp=function(){}})();(function(t,r){"use strict";var e=function(t,r,e,a){var i=r>>1,n=t>>1;return{xS:new Int32Array([0,0,0,n,n,n,e-n,e-n,e-n]),xE:new Int32Array([n,n,n,e-n,e-n,e-n,e,e,e]),yS:new Int32Array([0,i,a-i,0,i,a-i,0,i,a-i]),yE:new Int32Array([i,a-i,a,i,a-i,a,i,a-i,a]),jS:new Int32Array([0,0,0,-n,-n,-n,-n,-n,-n]),jE:new Int32Array([n+1,n+1,n+1,n+1,n+1,n+1,e,e,e]),iS:new Int32Array([0,-i,-i,0,-i,-i,0,-i,-i]),iE:new Int32Array([i+1,i+1,a,i+1,i+1,a,i+1,i+1,a]),lS:new Int32Array([n,n,n,0,0,0,0,0,0]),lE:new Int32Array([t,t,t,t,t,t,n+e,n+e,n+e]),kS:new Int32Array([i,0,0,i,0,0,i,0,0]),kE:new Int32Array([r,r,i+a,r,r,i+a,r,r,i+a]),jxS:new Int32Array([0,0,0,1,1,1,1,1,1]),jxE:new Int32Array([1,1,1,1,1,1,0,0,0]),iyS:new Int32Array([0,1,1,0,1,1,0,1,1]),iyE:new Int32Array([1,1,0,1,1,0,1,1,0])}};var a=function(t,r,e,a,i,n,o,s,f,u,l){var h=-Infinity;for(var g=o,v=u;g<l;g+=e,v+=a){for(var c=n+g,p=s+v,m=f+g;c<m;c++,p++){if(t[c]>h&&r[p]){h=t[c]}}}return h};var i=function(t,r,e,a,i,n,o,s,f,u,l){var h=Infinity;for(var g=o,v=u;g<l;g+=e,v+=a){for(var c=n+g,p=s+v,m=f+g;c<m;c++,p++){if(t[c]<h&&r[p]){h=t[c]}}}return h};var n=function(t,r,e,a,i,n,o,s,f,u,l){var h=0;for(var g=o,v=u;g<l;g+=e,v+=a){for(var c=n+g,p=s+v,m=f+g;c<m;c++,p++){h+=t[c]*r[p]}}return h};var o=function(r,a,i){var n=r.getSize(0),o=r.getSize(1),s=r.getSize(2),f=r.getData();var u=new t(r.getSize(),r.type()),l=u.getData();var h=a.getSize(0),g=a.getSize(1),v=a.getData();var c=e(g,h,o,n);var p=c.xS,m=c.xE,w=c.yS,d=c.yE,x=c.jS,y=c.jE,M=c.iS,b=c.iE,D=c.lS,S=c.kS,I=c.jxS,E=c.jxE,z=c.iyS,L=c.iyE;var R,T,A,k,C,V,B,Y,G,F;var q,_,H,X;for(T=0,q=f.length;T<q;T+=o*n){var Z=f.subarray(T,T+o*n),U=l.subarray(T,T+o*n);for(R=0;R<9;R++){for(A=p[R],_=m[R],C=A*n;A<_;A++,C+=n){var O=(x[R]+(I[R]?A:0))*n,N=(y[R]+(E[R]?A:0))*n;var P=(D[R]-(I[R]?0:A))*h;for(k=w[R],H=d[R],V=k+C;k<H;k++,V++){var W=M[R]+(z[R]?k:0),j=b[R]+(L[R]?k:0);var J=S[R]-(z[R]?0:k);U[V]=i(Z,v,n,h,V,W,O,J,j,P,N)}}}}return u};r.imdilate=function(t){return o(this,t,a)};r.imerode=function(t){return o(this,t,i)};r.imopen=function(t){return o(o(this,t,i),t,a)};r.imclose=function(t){return o(o(this,t,a),t,i)};r.imfilter=function(t){return o(this,t,n)};r.median=function(t){var r=t.length*.5|0;var e=function(t,e,a,i,n,o,s,f,u,l,h){var g=[];for(var v=s,c=l;v<h;v+=a,c+=i){for(var p=o+v,m=f+c,w=u+v;p<w;p++,m++){if(e[m]){g.push(t[p])}}}return g.sort()[r]};return o(this,t,e)};r.imbilateral=function(r,e,a){a=a||3;var i=t.fspecial("gaussian",Math.round(a*r/2)*2+1,r);var n=-1/(2*e);var s=function(t,r,e,a,i,o,s,f,u,l,h){var g=0,v=0,c=t[i];for(var p=s,m=l;p<h;p+=e,m+=a){for(var w=o+p,d=f+m,x=u+p;w<x;w++,d++){var y=c-t[w];var M=r[d]*Math.exp(n*y*y);g+=M;v+=t[w]*M}}return v/g};return o(this,i,s)}})(Matrix,Matrix.prototype);(function(t,r){"use strict";var e=460;var a=new Uint16Array([2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997,1009,1013,1019,1021,1031,1033,1039,1049,1051,1061,1063,1069,1087,1091,1093,1097,1103,1109,1117,1123,1129,1151,1153,1163,1171,1181,1187,1193,1201,1213,1217,1223,1229,1231,1237,1249,1259,1277,1279,1283,1289,1291,1297,1301,1303,1307,1319,1321,1327,1361,1367,1373,1381,1399,1409,1423,1427,1429,1433,1439,1447,1451,1453,1459,1471,1481,1483,1487,1489,1493,1499,1511,1523,1531,1543,1549,1553,1559,1567,1571,1579,1583,1597,1601,1607,1609,1613,1619,1621,1627,1637,1657,1663,1667,1669,1693,1697,1699,1709,1721,1723,1733,1741,1747,1753,1759,1777,1783,1787,1789,1801,1811,1823,1831,1847,1861,1867,1871,1873,1877,1879,1889,1901,1907,1913,1931,1933,1949,1951,1973,1979,1987,1993,1997,1999,2003,2011,2017,2027,2029,2039,2053,2063,2069,2081,2083,2087,2089,2099,2111,2113,2129,2131,2137,2141,2143,2153,2161,2179,2203,2207,2213,2221,2237,2239,2243,2251,2267,2269,2273,2281,2287,2293,2297,2309,2311,2333,2339,2341,2347,2351,2357,2371,2377,2381,2383,2389,2393,2399,2411,2417,2423,2437,2441,2447,2459,2467,2473,2477,2503,2521,2531,2539,2543,2549,2551,2557,2579,2591,2593,2609,2617,2621,2633,2647,2657,2659,2663,2671,2677,2683,2687,2689,2693,2699,2707,2711,2713,2719,2729,2731,2741,2749,2753,2767,2777,2789,2791,2797,2801,2803,2819,2833,2837,2843,2851,2857,2861,2879,2887,2897,2903,2909,2917,2927,2939,2953,2957,2963,2969,2971,2999,3001,3011,3019,3023,3037,3041,3049,3061,3067,3079,3083,3089,3109,3119,3121,3137,3163,3167,3169,3181,3187,3191,3203,3209,3217,3221,3229,3251,3253,3257]);var i=function(t){if(t==1){return 0}var r=[],i,n,o;for(i=n=0;n<e;n++){if(t%a[n]===0){o=a[n];do{r[i]=o;i++;t=t/o}while(t%o===0)}}if(t!==1){r[i]=t;i++}return r};var n=function(t,r,e){var a=t[r];t[r]=t[e];t[e]=a};var o=function(t,r,e,a){var i=t.length/2,n,o;if(a===1){for(n=0,o=0;n<i;n++){r[n]=t[o++];e[n]=-t[o++]}}else{var s=1/i;for(n=0,o=0;n<i;n++){r[n]=t[o++]*s;e[n]=-t[o++]*s}}};var s=function(t,r){var e=t.length,a,i;var n=new Float64Array(2*e);if(r){for(a=0,i=0;a<e;a++){n[i++]=t[a];n[i++]=-r[a]}}else{for(a=0,i=0;a<e;a++,i++){n[i++]=t[a]}}return n};var f=function(t,r,e){var a,i,o,f,u;var l,h,g,v,c,p;var m,w;var d=t.length,x=s(t,r);var y=d<<1;for(u=1,o=1;u<y;u+=2){if(o>u){n(x,o-1,u-1);n(x,o,u)}a=y>>1;while(a>=2&&o>a){o=o-a;a>>=1}o=o+a}var M=2;while(y>M){f=2*M;p=2*Math.PI/(e*M);l=Math.sin(.5*p);g=-2*l*l;v=Math.sin(p);h=1;c=0;for(a=1;a<M;a+=2){for(u=a-1;u<=y-1;u+=f){o=u+M;m=h*x[o]-c*x[o+1];w=h*x[o+1]+c*x[o];x[o]=x[u]-m;x[o+1]=x[u+1]-w;x[u]+=m;x[u+1]+=w}h=(l=h)*g-c*v+h;c=c*g+l*v+c}M=f}return x};var u=function(t,r,e,a){var i=t.length;var n=new Float64Array(i),o=new Float64Array(i);var f=2*Math.PI/i;for(h=0;h<i;h++){n[h]=Math.cos(h*f);o[h]=e*Math.sin(h*f)}var u=s(t,r),l=new Float64Array(2*i);var h,g,v,c,p,m,w;var d=1,x,y=a.length;for(x=0;x<y;x++){p=a[x];m=i/d/p;w=d*p;for(v=0;v<2*i;v++){l[v]=0}for(g=0;g<p;g++){for(c=0;c<w;c++){var M=c*g%w*m;var b=n[M],D=o[M];var S=2*m*c,I=2*m*(g+c%d*p);for(h=0;h<m;h++,S+=2,I+=2){l[S]+=u[I]*b-u[I+1]*D;l[S+1]+=u[I]*D+u[I+1]*b}}}var E=u;u=l;l=E;d*=p}return u};var l=function(t,r,e,a,n){var s=t.length,l=i(s),h=l.length;var g=!n?1:-1,v;if(s>1&&l[h-1]!=2){v=u(t,r,g,l)}else{v=f(t,r,g)}return o(v,e,a,g)};var h=function(r,e){if(r.isreal()){r.toComplex()}var a=new t(r.getSize(),Float64Array,true);var i=r.getRealData(),n=r.getImagData();var o=a.getRealData(),s=a.getImagData();var f=r.getSize(0),u=r.numel()/f;for(var h=0,g=0;h<u;h++,g+=f){var v=i.subarray(g,f+g),c=n.subarray(g,f+g);var p=o.subarray(g,f+g),m=s.subarray(g,f+g);l(v,c,p,m,e)}return a};r.fft=function(){return h(this,false)};t.fft=function(r){return h(t.toMatrix(r),false)};r.fft2=function(){var t=h(this,false);t=h(t.transpose(),false);return t.transpose()};t.fft2=function(r){var e=h(t.toMatrix(r),false);e=h(e.transpose(),false);return e.transpose()};r.ifft=function(){return h(this,true)};t.ifft=function(r){return h(t.toMatrix(r),false)};r.ifft2=function(){return this.fft().transpose().fft().transpose()};t.ifft2=function(r){return t.toMatrix(r).fft().transpose().fft().transpose()}})(Matrix,Matrix.prototype);var root=typeof window==="undefined"?module.exports:window;(function(t){function r(t,r,e,a){"use strict";this.bins=[t,r];this.mesure=e;if(a){this.baryCenter(a)}}r.prototype.toString=function(){"use strict";return"["+this.bins.toString()+"]"};r.prototype.getCopy=function(){"use strict";var t=new r(this.bins[0],this.bins[1],this.mesure);t.norm=this.norm;t.phase=this.phase;return t};r.prototype.compar=function(t,r){"use strict";return t.mesure<r.mesure};r.prototype.baryCenter=function(t,r){"use strict";var e=t.length;var a=this.bins[0],i=this.bins[1];r=r||e;var n=0,o,s=0;if(i>=a){for(o=a;o<=i;o++){s+=t[o]}for(o=a;o<=i;o++){n+=t[o]*o}n/=s}else{for(o=a;o<e;o++){s+=t[o]}for(o=0;o<=i;o++){s+=t[o]}for(o=a;o<e;o++){n+=t[o]*(o-a)}for(o=0;o<=i;o++){n+=t[o]*(o+e-a)}n/=s;n+=a;n=n>=e?n-e:n}this.norm=s;this.phase=n/r;return this};root.Mode=r})(root);(function(t){"use strict";var r=function(t){var r,e;for(r=1,e=t.length;r<e;r++){t[r]+=t[r-1]}};var e=function(t,r){r=1/r;var e,a;for(e=0,a=t.length;e<a;e++){t[e]*=r}};var a=function(t,r,e){var a,i,n,o,s=t.length;var f=new Float32Array(s*s);for(o=0;o<s;o++){f[o]=t[o]}for(a=1,i=s;a<s;a++,i+=s){if(r){for(n=0,o=i;n<a;n++,o++){f[o]=t[n]+e-t[a-1]}}for(n=a,o=i+n;n<s;n++,o++){f[o]=t[n]-t[a-1]}}return f};var i=function(t,r,e,a,i){var n,o,s,f=Math.sqrt(t.length),u,l;var h=new Float32Array(f*f);var g=new Float32Array(f*f);for(n=0,o=0,u=f*f;o<u;n++,o+=f){if(i){for(s=o,l=o+n;s<l;s++){h[s]=e(t[s],r[s]);g[s]=e(a-t[s],1-r[s])}}for(s=o+n,l=o+f;s<l;s++){h[s]=e(t[s],r[s]);g[s]=e(a-t[s],1-r[s])}}return[h,g]};var n=function(t){var r=new Float32Array(t.length);var e,a=t.length,i=1/a;for(e=0;e<a;e++){r[e]=i}return r};var o=function(t,r,e){var a=Math.log,i=Math.sqrt,n=Math.lerfc;var o=1/a(10),s=a(.5);var f=Number.MIN_VALUE;if(r!==undefined&&e!==undefined){var u=-1/t*o,l=t*r,h=e/r;return function(e,a){if(a<=f){return 0}var o=a*l;var g=o*(r*(1-a)+h);var v=(t*e-o)/i(2*g);return(s+n(v))*u}}else{return function(t,r){if(t<=r||r<=f){return 0}if(t===1){return-a(r)*o}return(t*a(t/r)+(1-t)*a((1-t)/(1-r)))*o}}};var s=function(t,r,e,a){if(a){return(Math.log(t*(t-1))/Math.log(10)+e)/r}else{return(Math.log(t*(t-1)/2)/Math.log(10)+e)/r}};var f=function(t,r,e){if(t>r){if(t>e){return t}else{return e}}else{if(r>e){return r}else{return e}}};var u=function(t,r,e){if(t<r){if(t<e){return t}else{return e}}else{if(r<e){return r}else{return e}}};var l=function(t,r,e){var a,i,n,o,s;var u=new Float32Array(r*r);for(a=0,i=r*r;a<i;a+=r+1){u[a]=t[a]}for(a=r-2;a>=0;a--){for(n=a*r+a+1,o=(a+1)*r;n<o;n++){u[n]=f(u[n+r],u[n-1],t[n])}}if(e){u[(r-1)*r]=f(u[0],u[(r-1)*r+r-1],t[(r-1)*r]);for(s=1,n=(r-1)*r+s;s<r-1;++s,++n){u[n]=f(t[n],u[s],u[n-1])}for(a=(r-2)*r;a>0;a-=r){u[a]=f(t[a],u[a+r-1],u[a+r])}for(a=r-2;a>0;a--){for(n=a*r+1,o=a*r+a;n<o;++n){u[n]=f(t[n],u[n-1],u[n+r])}}}return u};var h=function(t,r,e){var a,i,n,o,s;var u=new Float32Array(r*r);if(e){for(a=r,i=r*r;a<i;a+=r+1){u[a]=t[a]}for(a=2;a<r;++a){for(o=a*r-1,n=a*r+a-2;n>o;--n){u[n]=f(t[n],u[n-r],u[n+1])}}}u[r-1]=t[r-1];for(n=r-2,s=(r-1)*r+n;n>=0;--n,--s){u[n]=f(t[n],u[n+1],u[s])}for(a=1*r,i=r*r;a<i;a+=r){u[a+r-1]=f(u[a-1],u[a],t[a+r-1])}for(a=1;a<r-1;a++){for(n=a*r+r-2,o=a*r+a;n>=o;n--){u[n]=f(u[n-r],u[n+1],t[n])}}return u};var g=function(t,r,e,a,i){var n,o,s,f,u,l,h;var g=new Float32Array(e*e);for(l=0,h=g.length;l<h;++l){g[l]=r[l]>=a?1:0}for(n=e-2;n>=0;n--){for(f=n*e+n+1,u=(n+1)*e;f<u;f++){g[f]+=g[f-1]+g[f+e]}}if(i){g[(e-1)*e]+=g[0]+g[(e-1)*e+e-1];for(f=1;f<e-1;++f){g[(e-1)*e+f]+=g[f]+g[(e-1)*e+f-1]}for(s=e-2,n=s*e,o=0;n>o;n-=e,--s){g[n]+=g[n+e]+g[n+e-1];for(f=n+1,u=n+s;f<u;++f){g[f]+=g[f-1]+g[f+e]}}}for(l=0,h=g.length;l<h;++l){g[l]=g[l]?0:t[l]}return g};var v=function(t,r,e,a,i,n){var o=[];var s,f,u,l,h=Math.sqrt(e.length),g,v;for(s=0,f=0,g=h*h;f<g;s++,f+=h){for(u=r?0:s,l=f+u,v=f+h;l<v;u++,l++){if(e[l]>=n&&a[l]<=e[l]&&i[l]<=e[l]){o.push(new Mode(s,u,e[l],t))}}}return o.sort(Mode.prototype.compar)};var c=function(t,f,u,l,h,g,v){var c=t.length;var p=new Float32Array(t);f=f===undefined?false:f;u=u===undefined?0:u;v=v===undefined?n(t):new Float32Array(v);r(v);r(p);var m=p[c-1];l=l===undefined?m:l;e(v,v[c-1]);e(p,l);var w=a(v,f,1);var d,x,y;if(l&&h&&g){d=a(p,f,m/l);x=o(l,h,g);y=i(d,w,x,m/l,f)}else{d=a(p,f,1);x=o(l,h,g);y=i(d,w,x,1,f)}var M=s(c,l,u,f);var b=y[0],D=y[1];return{Hmod:b,Hgap:D,thresh:M}};var p=function(t,r,e,a,i,n,o){var s=c(t,r,e,a,i,n,o);var f=g(s.Hgap,s.Hmod,t.length,s.thresh,r);var u=h(f,t.length,r);var p=l(f,t.length,r);var m=v(t,r,f,u,p,s.thresh);var w=g(s.Hmod,s.Hgap,t.length,s.thresh,r);var d=h(w,t.length,r);var x=l(w,t.length,r);var y=v(t,r,w,d,x,s.thresh);return{modes:y,gaps:m}};var m=function(t,r,e,a,i,n,o){var s=c(t,r,e,a,i,n,o);var f=g(s.Hmod,s.Hgap,t.length,s.thresh,r);var u=h(f,t.length,r);var p=l(f,t.length,r);var m=v(t,r,f,u,p,s.thresh);return m};var w=function(t,r,e,a,i,n,o){var s=c(t,r,e,a,i,n,o);var f=g(s.Hgap,s.Hmod,t.length,s.thresh,r);var u=h(f,t.length,r);var p=l(f,t.length,r);var m=v(t,r,f,u,p,s.thresh);return m};Matrix.prototype.getModesAndGaps=function(t,r,e,a,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return p(o,t,r,e,a,i,n)};Matrix.getModesAndGaps=function(t,r,e,a,i,n,o){t=Matrix.toMatrix(t);return t.getModesAndGaps(r,e,a,i,n,o)};Matrix.prototype.getModes=function(t,r,e,a,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return m(o,t,r,e,a,i,n)};Matrix.getModes=function(t,r,e,a,i,n,o){t=Matrix.toMatrix(t);return t.getModes(r,e,a,i,n,o)};Matrix.prototype.getGaps=function(t,r,e,a,i,n){var o=this.getData();if(n instanceof Matrix){n=n.getData()}return w(o,t,r,e,a,i,n)};Matrix.getGaps=function(t,r,e,a,i,n,o){t=Matrix.toMatrix(t);return t.getGaps(r,e,a,i,n,o)};root.extractModes=m;root.extractGaps=w;root.extravctModesAndGaps=p})(Matrix);function getHistograms(t,r,e,a,i,n){"use strict";var o=0,s=0,f=0;var u,l;var h,g,v,c;var p=Math.floor,m=1/(i-a),w;h=new Float32Array(e);if(r){g=new Float32Array(e);if(n){for(u=0,l=t.length;u<l;u++){w=p((t[u]-a)*m*e);w=w<0?e+w%e:w%e;g[w]+=r[u];h[w]++;s+=r[u];o++}s/=o;for(u=0,l=t.length;u<l;u++){v=r[u]-s;f+=v*v}f=f/(o-1)}else{for(u=0,l=t.length;u<l;u++){c=t[u];if(c<a||c>i){continue}w=p((t[u]-a)*m*e);g[w]+=r[u];h[w]++;s+=r[u];o++}s/=o;for(u=0,l=t.length;u<l;u++){c=t[u];if(c<a||c>i){continue}v=r[u]-s;f+=v*v}f=f/(o-1)}}else{if(n){for(u=0,l=t.length;u<l;u++){w=p((t[u]-a)*m*e);w=w<0?e+w%e:w%e;h[w]++;o++}}else{for(o=0,u=0,l=t.length;u<l;u++){w=p((t[u]-a)*m*e);if(w<0||w>e){continue}h[w]++;o++}}}return{histw:g,hist:h,mu:s,sigma:f,M:o}}(function(){function t(r){"use strict";var e=this.constructor.name+": ";if(r===undefined){this.name="haar"}else{this.name=r.toLowerCase()}if(t.list[this.name]){var a=t.list[this.name];var i=a.normalized!==undefined&&!a.normalized?function(r){return t.filter(r,"norm")}:function(t){return t};this.filterL=i(a.filterL);this.orthogonal=a.orthogonal?true:false;if(a.filterH){this.filterH=i(a.filterH)}if(a.invFilterL){this.invFilterL=i(a.invFilterL)}if(a.invFilterH){this.invFilterH=i(a.invFilterH)}}if(this.filterL===undefined){var n=e+"unknown wavelet '"+r+"'. \n";n+="User-defined wavelets not implemented yet.";throw new Error(n)}var o=function(r,e){return t.filter(r,"conjugate",e?-1:1)};if(!this.filterH&&this.orthogonal){this.filterH=t.filter(o(this.filterL),"mirror")}if(!this.invFilterL){this.invFilterL=o(this.filterH,true)}if(!this.invFilterH){this.invFilterH=o(this.filterL,false)}return this}t.list=t.list||{haar:{orthogonal:true,normalized:false,filterL:[1,1]},db2:{name:"Daubechies 2",orthogonal:true,normalized:false,filterL:[1+Math.sqrt(3),3+Math.sqrt(3),3-Math.sqrt(3),1-Math.sqrt(3)]},db4:{name:"Daubechies 4",orthogonal:true,filterL:[-.010597401784997278,.032883011666982945,.030841381835986965,-.18703481171888114,-.02798376941698385,.6308807679295904,.7148465705525415,.23037781330885523]},db8:{name:"Daubechies 8",orthogonal:true,filterL:[-.00011747678400228192,.0006754494059985568,-.0003917403729959771,-.00487035299301066,.008746094047015655,.013981027917015516,-.04408825393106472,-.01736930100202211,.128747426620186,.00047248457399797254,-.2840155429624281,-.015829105256023893,.5853546836548691,.6756307362980128,.3128715909144659,.05441584224308161]},sym2:{name:"Symlets 2",orthogonal:true,filterL:[-.12940952255092145,.22414386804185735,.836516303737469,.48296291314469025]},sym4:{name:"Symlets 4",orthogonal:true,filterL:[-.07576571478927333,-.02963552764599851,.49761866763201545,.8037387518059161,.29785779560527736,-.09921954357684722,-.012603967262037833,.0322231006040427]},sym8:{name:"Symlets 8",orthogonal:true,filterL:[-.0033824159510061256,-.0005421323317911481,.03169508781149298,.007607487324917605,-.1432942383508097,-.061273359067658524,.4813596512583722,.7771857517005235,.3644418948353314,-.05194583810770904,-.027219029917056003,.049137179673607506,.003808752013890615,-.01495225833704823,-.0003029205147213668,.0018899503327594609]},coif1:{name:"Coiflets 1",orthogonal:true,filterL:[-.01565572813546454,-.0727326195128539,.38486484686420286,.8525720202122554,.3378976624578092,-.0727326195128539]},coif2:{name:"Coiflets 2",orthogonal:true,filterL:[-.0007205494453645122,-.0018232088707029932,.0056114348193944995,.023680171946334084,-.0594344186464569,-.0764885990783064,.41700518442169254,.8127236354455423,.3861100668211622,-.06737255472196302,-.04146493678175915,.016387336463522112]},coif4:{name:"Coiflets 4",orthogonal:true,filterL:[-17849850030882614e-22,-32596802368833675e-22,31229875865345646e-21,6233903446100713e-20,-.00025997455248771324,-.0005890207562443383,.0012665619292989445,.003751436157278457,-.00565828668661072,-.015211731527946259,.025082261844864097,.03933442712333749,-.09622044203398798,-.06662747426342504,.4343860564914685,.782238930920499,.41530840703043026,-.05607731331675481,-.08126669968087875,.026682300156053072,.016068943964776348,-.0073461663276420935,-.0016294920126017326,.0008923136685823146]},bi13:{name:"Biorthogonal 1-3",orthogonal:false,filterL:[-.08838834764831845,.08838834764831845,.7071067811865476,.7071067811865476,.08838834764831845,-.08838834764831845],filterH:[-.7071067811865476,.7071067811865476]},bi31:{name:"Biorthogonal 3-1",orthogonal:false,filterL:[-.3535533905932738,1.0606601717798214,1.0606601717798214,-.3535533905932738],filterH:[-.1767766952966369,.5303300858899107,-.5303300858899107,.1767766952966369]},bi68:{name:"Biorthogonal 6-8",orthogonal:false,filterL:[0,.0019088317364812906,-.0019142861290887667,-.016990639867602342,.01193456527972926,.04973290349094079,-.07726317316720414,-.09405920349573646,.4207962846098268,.8259229974584023,.4207962846098268,-.09405920349573646,-.07726317316720414,.04973290349094079,.01193456527972926,-.016990639867602342,-.0019142861290887667,.0019088317364812906],filterH:[0,.014426282505624435,-.014467504896790148,-.07872200106262882,.04036797903033992,.41784910915027457,-.7589077294536541,.41784910915027457,.04036797903033992,-.07872200106262882,-.014467504896790148,.014426282505624435,0,0]},bi97:{name:"Biorthogonal 9-7",orthogonal:false,filterL:[0,.02674875741080976,-.01686411844287495,-.07822326652898785,.2668641184428723,.6029490182363579,.2668641184428723,-.07822326652898785,-.01686411844287495,.02674875741080976],filterH:[0,-.09127176311424948,.05754352622849957,.591271763114247,-1.115087052456994,.591271763114247,.05754352622849957,-.09127176311424948,0,0]}};
t.filter=function(t,r,e){"use strict";var a="Wavelet.filter: ";if(e===undefined||e===0){e=1}if(typeof e!=="number"){throw new Error(a+"argument 'factor' must be a number")}if(typeof r!=="string"){throw new Error(a+"argument 'action' must be a string")}r=r.toLowerCase().substr(0,3);var i;var n=t.length;var o=[];var s=1,f=1;if(r==="mir"){for(i=0;i<n;i++){o[i]=e*t[n-1-i]}return o}if(r==="nor"){var u=0;for(i=0;i<n;i++){u+=t[i]*t[i]}e=!u?1:1/Math.sqrt(u)}else if(r==="con"){f=-1}else if(r!=="res"){throw new Error(a+"unknown action")}for(i=0;i<n;i++,s*=f){o[i]=e*s*t[i]}return o};function r(e,a,i,n){"use strict";if(e instanceof Matrix){if(a!==undefined&&typeof a!=="boolean"){throw new Error("WT: argument 'redundant' must be boolean")}if(n===undefined){n=3}else if(typeof n!=="number"){throw new Error("WT: argument 'level' must be an integer")}this.width=e.getSize(1);this.height=e.getSize(0);this.chan=e.getSize(2);this.redundant=a?true:false;this.level=n===undefined?3:n;this.wavelet=i instanceof t?i:new t(i);this.tmp=e;this.wt2()}else if(e instanceof r){this.width=e.width;this.height=e.height;this.chan=e.chan;this.redundant=e.redundant;this.level=e.level;this.wavelet=e.wavelet;this.data=e.data.getCopy();this.subband=[];var o,s;for(o=0;o<e.subband.length;o++){this.subband[o]={};for(s in e.subband[o]){if(e.subband[o].hasOwnProperty(s)&&e.subband[o][s]instanceof ImageJS){this.subband[o][s]=e.subband[o][s].getView();this.subband[o][s].data=this.data.data}}}}else{throw new Error("WT: first parameter must be an ImageJS or a WT")}return this}Matrix.prototype._filter1d=function(t,r,e,a,i,n,o){"use strict";o=o?true:false;var s=1,f=1;if(typeof a==="number"){s=a}else if(typeof a==="object"){s=a.Dout||s;f=a.Dker||f}var u=r.length;e=e==="cl"?Math.floor((u-1)/2):Math.ceil((u-1)/2);var l=t.getFirst(1),h=n.getFirst(1);var g=t.getFirst(0),v=n.getFirst(0);var c=t.getStep(2),p=n.getStep(2);var m=t.getStep(1),w=n.getStep(1);var d=t.getStep(0),x=n.getStep(0);var y=t.getEnd(2);var M=t.getEnd(1);var b=t.getEnd(0);var D=this.getData(),S=i.getData();var I=t.getSize(0),E=I*d;var z,L,R;var T,A,k,C;var V,B,Y,G;e=e*d*s;for(T=0,z=0;T<y;T+=c,z+=p){for(A=T+l,L=z+h,k=T+M;A<k;A+=m,L+=w){var F=g+A,q=b+A;for(C=F,R=L+v;C<q;C+=d*s,R+=x){for(V=0,B=C-e,G=0;V<u;V++,B+=d){Y=B;while(Y<F){Y+=E}while(Y>=q){Y-=E}G+=r[V]*D[Y]}if(o){S[R]+=G}else{S[R]=G}}}}return i};r.prototype.getScalesParameters=function(){"use strict";var t=this.width;var r=this.height;var e=1;var a=[];var i;for(i=this.level;i>0;i--,e*=2){if(!this.redundant){t=Math.ceil(t/2);r=Math.ceil(r/2)}a[i]={width:t,height:r,pow:e,cumWidth:0,cumHeight:0}}a[0]={width:t,height:r,pow:e,cumWidth:0,cumHeight:0};t=r=0;for(i=0;i<=this.level;i++){a[i].cumWidth=t;a[i].cumHeight=r;t+=a[i].width;r+=a[i].height}return a};r.prototype.wt2=function(){"use strict";var t=this.wavelet;var r=this.tmp;var e=this.getScalesParameters();window.scaleList=e;var a=e[e.length-1];var i=a.cumWidth+a.width;var n=a.cumHeight+a.height;if(this.redundant){}this.data=Matrix.zeros(n,i,r.getSize(2));var o=this.data.getView(),s=this.data.getView();var f=this.data.getView(),u=this.data.getView();this.subband=[];if(this.redundant){}var l=this.redundant?this.height:Math.ceil(this.height/2);var h=Matrix.zeros(2*l,this.width,r.getSize(2));var g=h.getView().select([0,l-1]);var v=h.getView().select([l,-1]);var c=r.getView();window.buffer=h;window.data=this.data;while(e.length>1){var p=e.pop();var m=this.redundant?{Dker:p.pow}:{Dout:2};g.select([0,p.height-1]);v.select([0,p.height-1]);r._filter1d(o,t.filterL,"cl",m,h,g);r._filter1d(o,t.filterH,"cl",m,h,v);if(this.redundant){}else{o.select([0,p.height-1],[0,p.width-1]);s.select([0,p.height-1],[p.width,2*p.width-1]);f.select([p.height,2*p.height-1],[0,p.width-1]);u.select([p.height,2*p.height-1],[p.width,2*p.width-1])}this.subband[e.length]={HL:new MatrixView(f),LH:new MatrixView(s),HH:new MatrixView(u)};g.swapDimensions(0,1);v.swapDimensions(0,1);o.swapDimensions(0,1);s.swapDimensions(0,1);f.swapDimensions(0,1);u.swapDimensions(0,1);h._filter1d(g,t.filterL,"cl",m,this.data,o);h._filter1d(g,t.filterH,"cl",m,this.data,s);h._filter1d(v,t.filterL,"cl",m,this.data,f);h._filter1d(v,t.filterH,"cl",m,this.data,u);g.swapDimensions(0,1);v.swapDimensions(0,1);o.restore().select([0,p.height-1],[0,p.width-1]);s.restore();f.restore();u.restore();g.select([],[0,p.width-1]);v.select([],[0,p.width-1]);r=this.data}this.subband[0]={LL:r.getView()}};r.prototype.iwt2=function(r){"use strict";var e=this.redundant;var a=e?.5:1;var i=t.filter(this.wavelet.invFilterL,"rescale",a);var n=t.filter(this.wavelet.invFilterH,"rescale",a);var o;if(!e){var s=this.data.getSize();if(s.length<3){s.push(1)}var f=Matrix.zeros(s[0]*2,s[1]*2,s[2]||1);f=f.set([0,2,-1],[0,2,-1],[],this.data);window.data2=f;var u=function(t,r,e){var a=s[0]*e,i=s[1]*e;var n=Math.pow(2,this.level-t+1);var o=a/n,f=i/n;var u=new MatrixView([a,i,s[2]]);if(r==="LL"){u.select([0,2*o-1],[0,2*f-1])}else if(r==="LH"){u.select([0,o-1],[f,2*f-1])}else if(r==="HL"){u.select([o,2*o-1],[0,f-1])}else if(r==="HH"){u.select([o,2*o-1],[f,2*f-1])}return u}.bind(this)}var l=e?this.width:2*Math.ceil(this.width/2);var h=e?this.height:2*Math.ceil(this.height/2);var g=Matrix.zeros(h*2*a,l*2*a,s[2]);var v=Matrix.zeros(2*h,l,s[2]);var c,p;var m,w=Math.pow(2,this.level-1);var d=f;var x={};for(m=1;m<=this.level;m++,w/=2){x.LL=u(m-1,"LL",e?1:2),x.HL=u(m,"HL",e?1:2);x.LH=u(m,"LH",e?1:2);x.HH=u(m,"HH",e?1:2);var y=!e?1:{Dker:w};if(!e){var M=[0,x.LL.getSize(1)-1];c=v.getView().select([0,x.LL.getSize(0)-1],M);p=v.getView().select([h,h+x.LL.getSize(0)-1],M)}d._filter1d(x.LL,i,"cr",y,v,c,false);f._filter1d(x.HL,n,"cr",y,v,c,true);f._filter1d(x.LH,i,"cr",y,v,p,false);f._filter1d(x.HH,n,"cr",y,v,p,true);c.swapDimensions(0,1);p.swapDimensions(0,1);d=g;if(!e){x.LL=u(m,"LL",2);x.LL.select([0,2,-1],[0,2,-1])}x.LL.swapDimensions(0,1);v._filter1d(c,i,"cr",y,d,x.LL,false);v._filter1d(p,n,"cr",y,d,x.LL,true);c.swapDimensions(0,1);p.swapDimensions(0,1)}return g.extractViewFrom(x.LL.swapDimensions(0,1))};Matrix.psnr=function(t,r){"use strict";t=Matrix.toMatrix(t);r=Matrix.toMatrix(r);var e=r.getData(),a=t.getData();var i,n,o=0;for(i=0,n=a.length;i<n;i++){var s=e[i]-a[i];o+=s*s}return Matrix.toMatrix(10*Math.log10(n/o))};Matrix.prototype.dwt2=function(t){var e=new r(this,false,t,1);return e.data};Matrix.prototype.idwt2=function(){}})();(function(t,r){"use strict";var e=function(t){var r=t.getSize(0),e=t.getSize(1),a=t.getData(),i=[];for(var n=0,o=0;n<e;n++,o+=r){i[n]=a.subarray(o,r+o)}return i};var a=function(t){var r=t.getSize(0),e=t.getSize(1);var a=t.getImagData(),i=[];for(var n=0,o=0;n<e;n++,o+=r){i[n]=a.subarray(o,r+o)}return i};var i=function(r,a,i){var n=Math.min(r.getSize(1),i);var o=new t([a,i]);var s=e(o);var f=e(r);for(var u=0;u<n;u++){s[u].set(f[u].subarray(0,a))}return o};var n=function(r,i,n){var o=Math.min(r.getSize(1),n);var s=new t([i,n],undefined,true);var f=e(s);var u=a(s);var l=e(r);var h=a(r);for(var g=0;g<o;g++){f[g].set(l[g].subarray(0,i));u[g].set(h[g].subarray(0,i))}return s};var o=function(t,r,e){var a=t[r];t[r]=t[e];t[e]=a};var s=function(t,r,e,a){a.set(t[r]);t[r].set(t[e]);t[e].set(a)};var f=function(t,r){var e,a,i;i=t[r];for(e=r+1,a=t.length;e<a;e++){if(t[e]>i){r=e;i=t[e]}}return r};var u=function(t,r){var e,a,i=0;for(e=r,a=t.length;e<a;e++){i+=t[e]}return Math.sqrt(i)};var l=function(t,r){var e,a=t.length,i=new Array(a);for(e=0;e<a;e++){i[e]=t[e][r]}return i};var h=function(t,r,e){for(var a=0,i=t.length;a<i;a++){t[a][r]=e[a]}};var g=function(t,r,e,a,i,n,o){for(var s=0;s<r;s++){var f=t[s];for(var u=0,l=a;l<i;l++){u+=f[l]*e[l]}f[n]-=u;f[n]*=o}};var v=function(t,r,e,a,i,n){var o,s,f,u,l,h,g;var v=new Float64Array(i);for(o=0;o<a;o++){for(s=0,u=o;s<i;s++,u+=a){v[s]=t[u]}for(l=o,f=0;f<n;l+=a,f++){h=r[f];for(g=0,s=0;s<i;s++){g+=v[s]*h[s]}e[l]=g}}};var c=function(t,r,e,a,i,n,o,s){var f,u,l,h,g,v,c,p,m,w;var d=new Float64Array(o);for(f=0;f<n;f++){for(u=0,h=f;u<o;u++,h+=n){d[u]=t[h]}for(g=f,l=0;l<s;g+=n,l++){v=r[l];c=e[l];for(p=0,m=0,u=0;u<o;u++){w=d[u];p+=w*v[u];m+=w*c[u]}a[g]=p;i[g]=m}}};var p=function(t,r,e,a,i,n,o,s){var f,u,l,h,g,v,c,p,m;var w=new Float64Array(o);var d=new Float64Array(o);for(f=0;f<n;f++){for(u=0,h=f;u<o;u++,h+=n){w[u]=t[h];d[u]=r[h]}for(l=0,g=f;l<s;l++,g+=n){v=e[l];for(c=0,p=0,u=0;u<o;u++){m=v[u];c+=w[u]*m;p+=d[u]*m}a[g]=c;i[g]=p}}};var m=function(r,e,a,i,n,o,s,f,u){var l,h,g,v,c,p,m,w,d,x,y,M,b;var D=new t.dataType(f);var S=new t.dataType(f);for(l=0;l<s;l++){for(h=0,v=l;h<f;h++,v+=s){D[h]=r[v];S[h]=e[v]}for(c=l,g=0;g<u;c+=s,g++){p=a[g];m=i[g];for(w=0,d=0,h=0;h<f;h++){x=D[h];y=S[h];M=p[h];b=m[h];w+=x*M-y*b;d+=x*b+y*M}n[c]=w;o[c]=d}}};var w=function(t,r,a,i){var n=r.getView();var o=n.getSize(0),s=n.getSize(1),f=n.getStep(1);var u=Math.min(o,s);var l=Tools.checkType(r.getDataType());var h=a.getView();var v=h.getSize(1);var c=e(a);var p=r.getData();var m,w;var d,x;var y,M,b;var D=new l(u);var S=t?0:u-1;y=t?u:-1;var I=t?1:-1;var E=t?f+1:-f-1;for(m=S,x=m+m*f;m!==y;m+=I,x+=E){var z=i===undefined?p[x]:i[m];var L=1/z;var R=t?0:m+1;M=t?m+1:u;var T=t?0:m;var A=t?m:x;b=t?x:m+u*f;for(w=T,d=A;d<b;w++,d+=f){D[w]=p[d]}g(c,v,D,R,M,m,L)}};var d=function(t,r,i,n){var o=r.getView();var s=o.getSize(0),f=o.getSize(1),u=o.getStep(1);var l=Math.min(s,f);var h=Tools.checkType(r.getDataType());var g=i.getView();var v=g.getSize(1);var c=e(i);var p=a(i);var m=r.getData();var w,d,x,y;var M,b;var D,S,I;var E=t?0:l-1;D=t?l:-1;var z=t?1:-1;var L=t?u+1:-u-1;var R,T;var A=new h(l);for(w=E,b=w+w*u;w!==D;w+=z,b+=L){var k=n===undefined?m[b]:n[w];var C=1/k;var V=t?0:w+1;S=t?w+1:l;var B=t?0:w;var Y=t?w:b;I=t?b:w+l*u;for(d=B,M=Y;M<I;d++,M+=u){A[d]=m[M]}for(y=0;y<v;y++){var G=c[y];var F=p[y];for(R=0,T=0,x=V;x<S;x++){var q=A[x];R+=G[x]*q;T+=F[x]*q}G[w]-=R;F[w]-=T;G[w]*=C;F[w]*=C}}};var x=function(t,r,i,n,o){var s=r.getView();var f=s.getSize(0),u=s.getSize(1),l=s.getStep(1);var h=Math.min(f,u);var g=Tools.checkType(r.getDataType());var v=i.getView();var c=v.getSize(1);if(i.isreal()){i.toComplex()}var p=r.getRealData(),m=r.getImagData();var w=e(i),d=a(i);var x,y,M,b;var D,S;var I,E,z;var L,R,T;L=t?0:h-1;I=t?h:-1;R=t?1:-1;T=t?l+1:-l-1;var A=new g(h),k=new g(h);var C,V,B,Y,G,F;for(x=L,S=x+x*l;x!==I;x+=R,S+=T){var q=n===undefined?p[S]:n[x];var _=o===undefined?m[S]:o[x];var H=1/(q*q+_*_);var X=t?0:x+1;E=t?x+1:h;var Z=t?0:x;var U=t?x:S;z=t?S:x+h*l;for(y=Z,D=U;D<z;y++,D+=l){A[y]=p[D];k[y]=m[D]}for(b=0;b<c;b++){var O=w[b];var N=d[b];for(C=0,V=0,M=X;M<E;M++){B=O[M];Y=N[M];G=A[M];F=k[M];C+=B*G-Y*F;V+=Y*G+B*F}B=O[x]-C;Y=N[x]-V;O[x]=(B*q+Y*_)*H;N[x]=(Y*q-B*_)*H}}};var y=function(t,r,e,a,i){if(r.isreal()){if(e.isreal()){w(t,r,e,a)}else{d(t,r,e,a)}}else{x(t,r,e,a,i)}return e};var M=function(t,r){var e,a,i,n,o,s,f;for(e=0;e<r;e++){n=t[e];for(s=0,a=0;a<e;a++){s+=n[a]*n[a]}if(n[e]-s<0){throw new Error("Matrix.chol: Input must be positive definite.")}n[e]=Math.sqrt(n[e]-s);f=1/n[e];for(a=e+1;a<r;a++){n[a]=0}for(i=e+1;i<r;i++){o=t[i];for(s=0,a=0;a<e;a++){s+=o[a]*n[a]}o[e]-=s;o[e]*=f}}};var b=function(t,r,e){var a,i,n,o;var s,f,u,l,h,g;var v,c,p,m;for(v=0;v<e;v++){a=t[v];i=r[v];for(s=0,c=0;c<v;c++){h=a[c];g=i[c];s+=h*h+g*g}if(a[v]-s<0){throw new Error("Matrix.chol: Input must be positive definite.")}if(i[v]!==0){throw new Error("Matrix.chol: Diagonal must be real positive.")}a[v]=Math.sqrt(a[v]-s);i[v]=0;m=1/(a[v]*a[v]);for(c=v+1;c<e;c++){a[c]=0;i[c]=0}for(p=v+1;p<e;p++){n=t[p];o=r[p];for(s=0,f=0,c=0;c<v;c++){u=n[c];l=o[c];h=a[c];g=i[c];s+=u*h+l*g;f+=l*h-u*g}n[v]-=s;o[v]-=f;u=n[c];l=o[c];h=a[c];g=i[c];n[v]=(u*h+l*g)*m;o[v]=(l*h-u*g)*m}}};var D=function(t,r,e,a){var i,n,s,f=Math.abs,u=1;for(s=0;s<e;s++){var l=t[s];var h=s;for(i=s+1;i<r;i++){if(f(l[i])>f(l[h])){h=i}}if(h!==s){for(n=0;n<e;n++){o(t[n],h,s)}o(a,h,s);u=-u}var g=1/l[s];for(i=s+1;i<r;i++){l[i]*=g}for(n=s+1;n<e;n++){var v=t[n];g=v[s];for(i=s+1;i<r;i++){v[i]-=l[i]*g}}}};var S=function(t){var r=t.getCopy();var e=r.getView();var a=e.getStep(1),i=e.getSize(0),n=e.getSize(1);var s,f,u,l,h;var g=Tools.checkType(t.getDataType());var v=new g(t.getSize(0)),c=1;for(u=0;u<i;u++){v[u]=u}if(r.isreal()){var p=r.getData(),m=[];for(s=0,f=0;s<n;f+=a,s++){m[s]=p.subarray(f,i+f)}D(m,i,n,v)}else{var w=r.getRealData(),d=[],x,y,M;var b=r.getImagData(),S=[],I,E,z;for(s=0,f=0;s<n;f+=a,s++){d[s]=w.subarray(f,i+f);S[s]=b.subarray(f,i+f)}var L,R,T,A,k;for(s=0;s<n;s++){x=d[s];I=S[s];h=s;for(u=s+1;u<i;u++){R=x[u];T=I[u];A=x[h];k=I[h];if(R*R+T*T>A*A+k*k){h=u}}if(h!==s){for(l=0;l<n;l++){o(d[l],h,s);o(S[l],h,s)}o(v,h,s);c=-c}M=x[s];z=I[s];L=M*M+z*z;M=M/L;z=-z/L;for(u=s+1;u<i;u++){R=x[u];T=I[u];x[u]=R*M-T*z;I[u]=R*z+T*M}for(l=s+1;l<n;l++){y=d[l];E=S[l];M=y[s];z=E[s];for(u=s+1;u<i;u++){R=x[u];T=I[u];y[u]-=R*M-T*z;E[u]-=T*M+R*z}}}}return{LU:r,piv:v,pivsign:c}};var I=function(t){var r=t.getView(),e=t.getData();var a=r.getSize(0);var i,n,o;for(i=0,n=a*a,o=a+1;i<n;i+=o){if(e[i]===0){return false}}return true};var E=function(r,e){var a,i;var n=r.LU.getSize(0);var o=r.LU.getSize(1);if(n===o){a=r.LU.getCopy();i=r.LU.getCopy()}else if(n<o){a=r.LU.get([],[0,n-1]);i=r.LU.get([0,n-1],[])}else{a=r.LU.get([],[0,o-1]);i=r.LU.get([0,o-1],[])}var s,f;var u,l;var h,g,v;var c;var p,m,w;s=a.getView();f=s.getEnd(0);u=s.getStep(1);l=s.getEnd(1);if(r.LU.isreal()){var d=a.getData();for(g=0,v=0,m=l,g=0;v<m;g++,v+=u){for(c=v,w=g+v;c<w;c++){d[c]=0}d[c]=1}}else{var x=a.getRealData(),y=a.getImagData();for(g=0,v=0,m=l,g=0;v<m;g++,v+=u){for(c=v,w=g+v;c<w;c++){x[c]=0;y[c]=0}x[c]=1;y[c]=0}}s=i.getView();f=s.getEnd(0);u=s.getStep(1);l=s.getEnd(1);if(r.LU.isreal()){var M=i.getData();for(g=0,v=0,m=l,g=0;v<m;g++,v+=u){for(c=g+1+v,w=f+v;c<w;c++){M[c]=0}}}else{var b=i.getRealData(),D=i.getImagData();for(g=0,v=0,m=l,g=0;v<m;g++,v+=u){for(c=g+1+v,w=f+v;c<w;c++){b[c]=0;D[c]=0}}}var S=r.piv;if(e===false){var I=Tools.checkType(a.getDataType());var E=new I(n);for(h=0,p=S.length;h<p;h++){E[S[h]]=h}a=a.get([E]);return[a,i]}e=new t([n,n]);var z=e.getData();s=e.getView();f=s.getEnd(0);u=s.getStep(1);l=s.getEnd(1);for(h=0;h<n;h++){z[h+S[h]*u]=1}return[a,i,e]};var z=function(r,e){var a=S(r);var i=a.LU,n=a.piv;if(!I(i)){throw new Error("Matrix.mldivide: Matrix is singular.")}e=e.get([n]);var o=t.ones(i.getSize(0)).getData();var s=t.zeros(i.getSize(0)).getData();y(true,i,e,o,s);return y(false,i,e)};var L=function(t,r){var e,a=t.length;var i=-Infinity,n;for(e=r;e<a;e++){n=Math.abs(t[e]);if(n>i){i=n}}var o=i!==0?1/i:0;var s=0,f=t[r]*o;for(t[r]=1,e=r+1;e<a;e++){t[e]*=o;s+=t[e]*t[e]}var u=Math.sqrt(f*f+s);var l=f>0?1:-1;var h=f+l*u;var g=h*h;var v=2*g/(s+g);var c=1/h;for(e=r+1;e<a;e++){t[e]*=c}t[r]=-l*u*i;return v};var R=function(t,r,e,a,i){var n,o,s=r.length,f=r[0].length;var u,l;for(o=i;o<s;o++){l=r[o];for(u=l[a],n=a+1;n<f;n++){u+=t[n]*l[n]}u*=e;for(l[a]-=u,n=a+1;n<f;n++){l[n]-=t[n]*u}}};var T=function(t,r,e){var a,i=t.length,n,o;var s=-Infinity,f;for(a=e;a<i;a++){f=Math.abs(t[a])+Math.abs(r[a]);if(f>s){s=f}}var u=s!==0?1/s:0;var l=0,h=t[e]*u,g=r[e]*u;for(t[e]=1,r[e]=0,a=e+1;a<i;a++){t[a]*=u;r[a]*=u;n=t[a];o=r[a];l+=n*n+o*o}var v=Math.sqrt(h*h+g*g+l),c=Math.atan2(g,h);var p=h+v*Math.cos(c),m=g+v*Math.sin(c);var w=p*p+m*m;var d=2*w/(l+w);f=1/(p*p+m*m);var x=p*f,y=-m*f;for(a=e+1;a<i;a++){n=t[a];o=r[a];t[a]=n*x-o*y;r[a]=o*x+n*y}t[e]=-v*s*Math.cos(c);r[e]=-v*s*Math.sin(c);return d};var A=function(t,r,e,a,i,n,o){var s,f;var u,l,h=e.length,g=e[0].length;var v,c;for(l=o;l<h;l++){v=e[l];c=a[l];for(s=v[n],f=c[n],u=n+1;u<g;u++){s+=t[u]*v[u]+r[u]*c[u];f+=t[u]*c[u]-r[u]*v[u]}s*=i;f*=i;for(v[n]-=s,c[n]-=f,u=n+1;u<g;u++){v[u]-=t[u]*s-r[u]*f;c[u]-=r[u]*s+t[u]*f}}};var k=function(t,r,e,a,i){var n,o,s,f=r.length,u=r[0].length;for(o=i;o<u;o++){for(n=r[a][o],s=a+1;s<f;s++){n+=t[s]*r[s][o]}n*=e;for(r[a][o]-=n,s=a+1;s<f;s++){r[s][o]-=t[s]*n}}};var C=function(t,r,e,a,i,n,o){var s,f;var u,l,h=e.length,g=e[0].length;for(u=o;u<g;u++){for(s=e[n][u],f=a[n][u],l=n+1;l<h;l++){s+=t[l]*e[l][u]+r[l]*a[l][u];f+=t[l]*a[l][u]-r[l]*e[l][u]}s*=i;f*=i;for(e[n][u]-=s,a[n][u]-=f,l=n+1;l<h;l++){e[l][u]-=t[l]*s-r[l]*f;a[l][u]-=r[l]*s+t[l]*f}}};var V=function(t){t=t.getCopy();var r=Tools.checkType(t.getDataType());var i=t.getView();var n=i.getSize(1);var o;var s=new r(n),f=new r(n);if(t.isreal()){var u=e(t);for(o=0;o<n;o++){s[o]=L(u[o],o);R(u[o],u,s[o],o,o+1);if(o<n-2){var g=l(u,o);f[o]=L(g,o+1);h(u,o,g);k(g,u,f[o],o+1,o+1)}}}else{var v=e(t),c=a(t);for(o=0;o<n;o++){s[o]=T(v[o],c[o],o);A(v[o],c[o],v,c,s[o],o,o+1);if(o<n-2){var p=l(v,o);var m=l(c,o);f[o]=T(p,m,o+1);h(v,o,p);h(c,o,m);C(p,m,v,c,f[o],o+1,o+1)}}}return[t,s,f]};var B=function(r){var i=r[1];r=r[0];var n=r.getSize(0),o=r.getSize(1);var s=t.eye(n);var f=s.getView(),u=f.getStep(1);var l,h;if(r.isreal()){var g=e(s);var v=r.getData();for(l=o-1,h=u*l;l>=0;l--,h-=u){var c=v.subarray(h,n+h);R(c,g,i[l],l,l)}}else{s.toComplex();var p=e(s),m=a(s);var w=r.getRealData(),d=r.getImagData();for(l=o-1,h=u*l;l>=0;l--,h-=u){var x=w.subarray(h,n+h);var y=d.subarray(h,n+h);A(x,y,p,m,i[l],l,l)}}return s};var Y=function(t){return t[0].triu().tril(1)};var G=function(r){var i=r[2];r=r[0].transpose();var n=r.getSize(0),o=r.getSize(1);var s=t.eye(n);var f=s.getView(),u=f.getStep(1);var l,h;if(r.isreal()){var g=e(s);var v=r.getData();for(l=o-1,h=u*l;l>=0;l--,h-=u){var c=v.subarray(h,n+h);R(c,g,i[l],l+1,l+1)}}else{s.toComplex();var p=e(s),m=a(s);var w=r.getRealData(),d=r.getImagData();for(l=n-3,h=u*l;l>=0;l--,h-=u){var x=w.subarray(h,n+h);var y=d.subarray(h,n+h);A(x,y,p,m,i[l],l+1,l+1)}}return s.transpose()};var F=function(t){return[B(t),Y(t),G(t)]};t.golubStep=function(t,r){var e=t11-t;var a=t12;for(var i=0,n=r-1;i<n;i++){}};var q=function(t){var r=t[0].getCopy();var e=r.getView();var a=e.getStep(1),i=e.getEnd(0);var n=e.getSize(0),o=e.getSize(1);var s,f,u,l,h;if(r.isreal()){var g=r.getData();for(s=0,f=0,l=0;s<n;s++,f+=a,l=s+f){for(u=l+1,h=i+f;u<h;u++){g[u]=0}}for(;s<o;s++,f+=a,l=s+f){for(u=l+1,h=i+f;u<h;u++){g[u]=0}}}else{var v=r.getRealData(),c=r.getImagData();for(s=0,f=0,l=0;s<n;s++,f+=a,l=s+f){for(u=l+1,h=i+f;u<h;u++){v[u]=0;c[u]=0}}for(;s<o;s++,f+=a,l=s+f){for(u=l+1,h=i+f;u<h;u++){v[u]=0;c[u]=0}}}return r};var _=function(r){var i=r[1];r=r[0];var n=r.getSize(0),o=r.getSize(1);var s=t.eye(n);var f=s.getView(),u=f.getStep(1);var l,h;if(r.isreal()){var g=e(s);var v=r.getData();for(l=o-1,h=u*l;l>=0;l--,h-=u){var c=v.subarray(h,n+h);R(c,g,i[l],l,l)}}else{s.toComplex();var p=e(s);var m=a(s);var w=r.getRealData(),d=r.getImagData();for(l=o-1,h=u*l;l>=0;l--,h-=u){var x=w.subarray(h,n+h);var y=d.subarray(h,n+h);A(x,y,p,m,i[l],l,l)}}return s};var H=function(r){var e=r[2];var a=e.length;var i=new t([a,a]);var n=i.getView(),o=i.getData();var s=n.getStep(1);var f=a;var u,l;for(u=0,l=0;u<f;u++,l+=s){o[e[u]+l]=1}return i};var X=function(t,r){var i;var n=2.220446049250313e-16||1.19209289550781e-7;var l=t.getCopy();var h=l.getView();var g=h.getSize(0),v=h.getSize(1);var c,p,m;var w=Tools.checkType(t.getDataType());var d=new w(g);var x=new w(v);var y=new w(v);var M=new w(v),b,D;if(l.isreal()){var S=e(l);if(r){for(p=0;p<v;p++){var I=S[p];for(m=0,c=0;c<g;c++){m+=I[c]*I[c]}x[p]=m;y[p]=p}i=u(x,0)}for(b=0;b<v;b++){if(r){D=f(x,b);if(u(x,b)<=i*n){return[l,M,y,b]}else if(b!==D){s(S,b,D,d);o(x,b,D);o(y,b,D)}}M[b]=L(S[b],b);R(S[b],S,M[b],b,b+1);if(r){for(c=b+1;c<v;c++){x[c]-=S[c][b]*S[c][b]}}}}else{var E=e(l);var z=a(l);if(r){for(p=0;p<v;p++){var k=E[p],C=z[p];for(m=0,c=0;c<g;c++){m+=k[c]*k[c]+C[c]*C[c]}x[p]=m;y[p]=p}i=u(x,0)}for(b=0;b<v;b++){if(r){D=f(x,b);if(u(x,b)<=i*n){return[l,M,y,b+1]}else if(b!==D){s(E,b,D,d);s(z,b,D,d);o(x,b,D);o(y,b,D)}}M[b]=T(E[b],z[b],b);A(E[b],z[b],E,z,M[b],b,b+1);if(r){for(c=b+1;c<v;c++){x[c]-=E[c][b]*E[c][b]+z[c][b]*z[c][b]}}}}return[l,M,y,b]};var Z=function(t,r){var o=X(t,true);var s=o[1];var f=o[2];o=o[0];var u=t.getSize(0),l=t.getSize(1),h=r.getSize(1);var g=Math.min(u,l);r=r.getCopy();var v,c;if(o.isreal()&&r.isreal()){var p=e(r);var m=e(o);for(v=0;v<l;v++){R(m[v],p,s[v],v,0)}y(false,o,r);c=i(r,g,h)}else{if(o.isreal()){o.toComplex()}if(r.isreal()){r.toComplex()}var w=e(r);var d=a(r);var x=e(o);var M=a(o);for(v=0;v<l;v++){A(x[v],M[v],w,d,s[v],v,0)}y(false,o,r);c=n(r,g,h)}var b=new Uint32Array(g);var D,S;for(D=0,S=f.length;D<S;D++){b[f[D]]=D}return c.get([b])};var U=function(t,r){var o=X(t.ctranspose(),true);var s=o[1];var f=o[2];o=o[0];var u;var l=o.getSize(0),h=o.getSize(1),g=r.getSize(1);var v=Math.min(l,h);var c=new Uint32Array(v);for(var p=0,m=f.length;p<m;p++){c[f[p]]=p}r=r.get([c]);var w=y(true,o.ctranspose(),r);if(o.isreal()&&r.isreal()){w=i(w,l,g);var d=e(w);var x=e(o);for(u=h-1;u>=0;u--){R(x[u],d,s[u],u,0)}}else{if(o.isreal()){o.toComplex()}if(w.isreal()){w.toComplex()}w=n(w,l,g);var M=e(w);var b=a(w);var D=e(o);var S=a(o);for(u=h-1;u>=0;u--){A(D[u],S[u],M,b,s[u],u,0)}}return w};var O=function(t,r){if(t.getSize(0)<t.getSize(1)){return U(t,r)}return Z(t,r)};r.mtimes=function(r){r=t.toMatrix(r);if(!this.ismatrix()||!r.ismatrix()){throw new Error("Matrix.mtimes: mtimes is undefined for ND array.")}var i=this.getSize(0);var n=this.getSize(1);var o=r.getSize(1);if(i!==r.getSize(0)){throw new Error("Matrix.mtimes: Matrix sizes must match.")}var s=this.isreal()&r.isreal()?false:true;var f=Tools.checkType(this.getDataType());var u=new t([i,o],f,s);if(this.isreal()){if(r.isreal()){v(this.getData(),e(r),u.getData(),i,n,o)}else{c(this.getData(),e(r),a(r),u.getRealData(),u.getImagData(),i,n,o)}}else{if(r.isreal()){p(this.getRealData(),this.getImagData(),e(r),u.getRealData(),u.getImagData(),i,n,o)}else{m(this.getRealData(),this.getImagData(),e(r),a(r),u.getRealData(),u.getImagData(),i,n,o)}}return u};t.mtimes=function(r,e){return t.toMatrix(r).mtimes(e)};r["*"]=r.mtimes;r.chol=function(t){if(!this.ismatrix()){throw new Error("Matrix.chol: Input must be a matrix.")}if(!this.issquare()){throw new Error("Matrix.chol: Matrix must be square.")}if(t==="lower"){t=true}else if(t==="upper"||t===undefined){t=false}else{throw new Error("Matrix.chol: Invalid parameters.")}var r=this.getCopy();if(r.isreal()){M(e(r),r.getSize(1))}else{b(e(r),a(r),r.getSize(1))}return t?r.ctranspose(r):r};r.inv=function(){return this.mldivide(t.eye(this.getSize()))};r.det=function(){if(!this.issquare()){throw new Error("Matrix.det: Matrix must be square.")}var r=S(this);var e=r.LU;var a,i,n;var o=e.getView();var s=o.getSize(0);if(this.isreal()){var f=r.pivsign;var u=e.getData();for(a=0,i=s*s,n=s+1;a<i;a+=n){f*=u[a]}return new t([1,1],[f])}var l=e.getRealData();var h=e.getImagData();var g=r.pivsign,v=0;for(a=0,i=s*s,n=s+1;a<i;a+=n){g=g*l[a]-v*h[a];v=g*h[a]+v*l[a]}return new t([1,1],[g,v],true)};r.rank=function(){var t=X(this,true);return t[3]};r.lu=function(){return E(S(this),false)};r.lup=function(){return E(S(this),true)};r.qrp=function(){var t=X(this,true);return[_(t),q(t),H(t)]};r.qr=function(){var t=X(this,false);return[_(t),q(t)]};r.mldivide=function(t){if(!this.ismatrix()||!t.ismatrix()){throw new Error("1 Matrix.mldivide: Both arguments must be Matrix.")}if(t.getSize(0)!==this.getSize(0)){throw new Error("2 Matrix.mldivide: Row dimensions must agree.")}return O(this,t.getCopy())};r.mrdivide=function(t){if(!this.ismatrix()||!t.ismatrix()){throw new Error("Matrix.mrdivide: Both arguments must be Matrix.")}if(t.getSize(0)!==this.getSize(0)){throw new Error("Matrix.mrdivide: Row dimensions must agree.")}return O(t.ctranspose(),this.ctranspose()).ctranspose()};r.bidiag=function(){var t=V(this.getCopy());return F(t)};r.svd=function(){var r;var e=Math.pow(2,-52);var a=1e-64/e;var i=50;var n=0,o=0,s=0,f=0,u=0;var l=this.toArray();var h=l.length;var g=l[0].length;if(h<g){throw"Matrix.svd: Need more rows than columns"}var v=new Array(g);var c=new Array(g);for(o=0;o<g;o++){v[o]=0;c[o]=0}var p=t.zeros(g).toArray();var m=function(t,r){t=Math.abs(t);r=Math.abs(r);if(t>r){return t*Math.sqrt(1+r*r/t/t)}else if(r===0){return t}return r*Math.sqrt(1+t*t/r/r)};var w=0,d=0,x=0,y=0,M=0,b=0,D=0;for(o=0;o<g;o++){v[o]=d;D=0;u=o+1;for(s=o;s<h;s++){D+=l[s][o]*l[s][o]}if(D<=a){d=0}else{w=l[o][o];d=Math.sqrt(D);if(w>=0){d=-d}x=w*d-D;l[o][o]=w-d;for(s=u;s<g;s++){D=0;for(f=o;f<h;f++){D+=l[f][o]*l[f][s]}w=D/x;for(f=o;f<h;f++){l[f][s]+=w*l[f][o]}}}c[o]=d;D=0;for(s=u;s<g;s++){D=D+l[o][s]*l[o][s]}if(D<=a){d=0}else{w=l[o][o+1];d=Math.sqrt(D);if(w>=0){d=-d}x=w*d-D;l[o][o+1]=w-d;for(s=u;s<g;s++){v[s]=l[o][s]/x}for(s=u;s<h;s++){D=0;for(f=u;f<g;f++){D+=l[s][f]*l[o][f]}for(f=u;f<g;f++){l[s][f]+=D*v[f]}}}M=Math.abs(c[o])+Math.abs(v[o]);if(M>y){y=M}}for(o=g-1;o!=-1;o+=-1){if(d!==0){x=d*l[o][o+1];for(s=u;s<g;s++){p[s][o]=l[o][s]/x}for(s=u;s<g;s++){D=0;for(f=u;f<g;f++){D+=l[o][f]*p[f][s]}for(f=u;f<g;f++){p[f][s]+=D*p[f][o]}}}for(s=u;s<g;s++){p[o][s]=0;p[s][o]=0}p[o][o]=1;d=v[o];u=o}for(o=g-1;o!=-1;o+=-1){u=o+1;d=c[o];for(s=u;s<g;s++){l[o][s]=0}if(d!==0){x=l[o][o]*d;for(s=u;s<g;s++){D=0;for(f=u;f<h;f++){D+=l[f][o]*l[f][s]}w=D/x;for(f=o;f<h;f++){l[f][s]+=w*l[f][o]}}for(s=o;s<h;s++){l[s][o]=l[s][o]/d}}else{for(s=o;s<h;s++){l[s][o]=0}}l[o][o]+=1}e=e*y;var S;for(f=g-1;f!=-1;f+=-1){for(S=0;S<i;S++){var I=false;for(u=f;u!=-1;u+=-1){if(Math.abs(v[u])<=e){I=true;break}if(Math.abs(c[u-1])<=e){break}}if(!I){n=0;D=1;var E=u-1;for(o=u;o<f+1;o++){w=D*v[o];v[o]=n*v[o];if(Math.abs(w)<=e){break}d=c[o];x=m(w,d);c[o]=x;n=d/x;D=-w/x;for(s=0;s<h;s++){M=l[s][E];b=l[s][o];l[s][E]=M*n+b*D;l[s][o]=-M*D+b*n}}}b=c[f];if(u===f){if(b<0){c[f]=-b;for(s=0;s<g;s++){p[s][f]=-p[s][f]}}break}if(S>=i-1){throw"Error: no convergence."}y=c[u];M=c[f-1];d=v[f-1];x=v[f];w=((M-b)*(M+b)+(d-x)*(d+x))/(2*x*M);d=m(w,1);if(w<0){w=((y-b)*(y+b)+x*(M/(w-d)-x))/y}else{w=((y-b)*(y+b)+x*(M/(w+d)-x))/y}n=1;D=1;for(o=u+1;o<f+1;o++){d=v[o];M=c[o];x=D*d;d=n*d;b=m(w,x);v[o-1]=b;n=w/b;D=x/b;w=y*n+d*D;d=-y*D+d*n;x=M*D;M=M*n;for(s=0;s<g;s++){y=p[s][o-1];b=p[s][o];p[s][o-1]=y*n+b*D;p[s][o]=-y*D+b*n}b=m(w,x);c[o-1]=b;n=w/b;D=x/b;w=n*d+D*M;y=-D*d+n*M;for(s=0;s<h;s++){M=l[s][o-1];b=l[s][o];l[s][o-1]=M*n+b*D;l[s][o]=-M*D+b*n}}v[u]=0;v[f]=w;c[f]=y}}for(o=0;o<c.length;o++){if(c[o]<e){c[o]=0}}for(o=0;o<g;o++){for(s=o-1;s>=0;s--){if(c[s]<c[o]){n=c[s];c[s]=c[o];c[o]=n;for(f=0;f<l.length;f++){r=l[f][o];l[f][o]=l[f][s];l[f][s]=r}for(f=0;f<p.length;f++){r=p[f][o];p[f][o]=p[f][s];p[f][s]=r}o=s}}}return[t.fromArray(l).transpose(),t.diag(t.toMatrix(c)),t.fromArray(p).transpose()]}})(Matrix,Matrix.prototype);